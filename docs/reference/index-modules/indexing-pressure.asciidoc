[[index-modules-indexing-pressure]]
== Indexing pressure

Indexing documents into Elasticsearch introduces system load in the form of
memory and CPU load. Each indexing operation includes coordinating, primary, and
replica stages. These stages can be performed across multiple nodes in the
cluster. If too much indexing work is introduced into the system, the cluster
can become saturated. This can adversely impact other components of the system
such as searches, cluster coordination, background processing, etc.

Indexing pressure is primarily generated by external operations such as indexing
requests or internally by mechanisms such recoveries and cross-cluster
replication.

Elasticsearch internally monitors indexing load. When the load exceeds
certain limits, new indexing work will be rejected.

[discrete]
[[indexing-stages]]
=== Indexing stages

External indexing operations go through three stages: coordinating, primary, and
replica. See <<basic-write-model,here>>.

[discrete]
[[memory-limits]]
=== Memory limits

The `indexing_pressure.memory.limit` node setting restricts the number of bytes
available for outstanding indexing requests. This setting defaults to 10% of
the heap.

At the beginning of each indexing stage, {es} accounts for the
bytes consumed by an indexing request. This accounting is only released at the
end of the indexing stage. This means that upstream stages will account for the
request overheard until all downstream stages are complete. For example, the
coordinating request will remain accounted for until primary and replica
stages are complete. The primary request will remain accounted for until each
in-sync replica has responded to enable replica retries if necessary.

A node will start rejecting new indexing work at the coordinating or primary
stage when the number of outstanding coordinating, primary, and replica indexing
bytes exceeds the configured limit.

A node will start rejecting new indexing work at the replica stage when the
number of outstanding replica indexing bytes exceeds 1.5x the configured limit.
This design means that as indexing pressure builds on nodes, they will naturally
stop accepting coordinating and primary work in favor of outstanding replica
work.

The default limit `indexing_pressure.memory.limit` (10%) is generously sized and
should only be modified after careful consideration. Only indexing requests
contribute to this limit meaning that there is additional indexing overhead
(buffers, listeners, etc) which also require heap space. Finally, other
components of Elasticsearch also require memory. Configuring this limit to be
too high can starve other system components of operating memory.

[discrete]
[[indexing-pressure-monitoring]]
=== Monitoring

You can use the
<<cluster-nodes-stats-api-response-body-indexing-pressure,node stats API>> to
retrieve indexing pressure metrics.

[discrete]
[[indexing-pressure-settings]]
=== Indexing pressure settings

`indexing_pressure`::

  A configurable limit for the number of outstanding bytes consumed by indexing
  requests. New coordinating and primary operations will start being rejected
  once this limit is hit. New replica operations will start being rejected when
  replica operations consumed 1.5X this limit. Defaults to `10%` of the heap.
