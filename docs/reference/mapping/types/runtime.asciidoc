[[runtime]]
=== Runtime

////
[source,console]
----
PUT /my-index
----
// TESTSETUP
////

Typically, you must index fields to {es} before they can be retrieved,
aggregated, or searched. With runtime fields, you can explicitly define a field
in the mapping and access it at runtime without indexing your data. This
flexibility allows you to more quickly ingest raw data into the Elastic Stack
and immediately access it. By dynamically evaluating runtime fields at query
time, you can choose which fields to index and optimize disk space.

Runtime fields are not indexed, but are accessible from the search API like any
other field that has <<doc-values,doc_values>> and is searchable. You can
retrieve and query these fields, as well as aggregate and
sort on them.

NOTE: Runtime fields can be incur performance costs at search time, depending
on the <<runtime-params-runtime-type,`runtime_type`>>.

==== Specifying runtime fields
You specify runtime fields in the mapping by
<<modules-scripting-using,defining a script>>. At search time, the script runs
and generates values for each scripted field.

The script in the following request extracts the day of the week from the
`timestamp` field, which is defined as a `date` data type.

[source,console]
----
PUT /my-index/_mappings
{
  "properties" : {
    "day_of_week" : {
      "type" : "runtime", <1>
      "runtime_type" : "keyword", <2>
      "script" : {
        "source" : "emit(doc['timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT))"
      }
    }
  }
}
----

<1> Runtime fields are of the `runtime` data type.
<2> Each runtime has its own field type, defined by `runtime_type`.

[[runtime-params]]
==== Parameters for `runtime` fields
Runtime fields accept the following parameters:

`type`::
The type of runtime computation to perform at query time. Currently, runtime
fields only support the `runtime` data type.

[[runtime-params-runtime-type]]
`runtime_type`::
The <<mapping-types,field type>> for each scripted field. {es}
supports `boolean`, `date`, `double`, `ip`, `keyword`, and `long`.
+
Runtime fields with a `runtime_type` of `date` can accept the
<<mapping-date-format,`format`>> parameter exactly as the `date` field type.

==== Retrieving runtime fields
Use the <<search-fields,`fields`>> parameter on the `_search` API to retrieve
the values of runtime fields. This API works for all fields, even those that
were not sent as part of the original `_source`.

The following request uses the search API to retrieve the `day_of_week` field
that the previous request defined in the mapping.

[source,console]
----
GET /my-index/_search
{
  "aggs": {
    "days_of_week": {
      "terms": {
        "field": "day_of_week"
      }
    }
  }
}
----
