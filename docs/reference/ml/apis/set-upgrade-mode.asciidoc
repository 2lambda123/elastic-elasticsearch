[role="xpack"]
[testenv="platinum"]
[[ml-set-upgrade-mode]]
=== Set Upgrade Mode API
++++
<titleabbrev>Set Upgrade mode</titleabbrev>
++++

This sets a cluster wide setting for preparing {ml} indices for an upgrade.

==== Request
//////////////////////////

[source,js]
--------------------------------------------------
POST /_ml/set_upgrade_mode?enabled=false&timeout=10m
--------------------------------------------------
// CONSOLE
// TEST
// TEARDOWN

//////////////////////////


`POST _ml/set_upgrade_mode`

==== Description

Before starting the upgrade process on {ml} related indices, all {dfeed} and job
tasks must stop executing. This API provides this functionality and allows
for the tasks to be easily started again once upgrading is complete.

When `enabled=true` this API stops all job and {dfeed} tasks and
prohibits new job and {dfeed} tasks from starting.
Setting `enabled=false` will then allow {ml} tasks to start executing normally again.

You can see the current value for `upgrade_mode` via the <<get-ml-info, Get {ml} Info>>
endpoint.

IMPORTANT:  No new {ml} job may be opened while this setting is set to `enabled=true`.

==== Query Parameters

`enabled`::
  (boolean) When `true` this enables `upgrade_mode`.
  Defaults to `false`

`timeout`::
  (time) The time to wait for the request to be completed.
  The default value is 30 seconds.

==== Authorization

You must have `manage_ml`, or `manage` cluster privileges to use this API.
For more information, see
{xpack-ref}/security-privileges.html[Security Privileges].


==== Examples

The following example enables `upgrade_mode` for the cluster

[source,js]
--------------------------------------------------
POST _ml/set_upgrade_mode?enabled=true&timeout=10m
--------------------------------------------------
// CONSOLE
// TEST

When the call is successful, an acknowledged response is returned
[source,js]
----
{
  "acknowledged": true
}
----
// TESTRESPONSE


When upgrading is complete, be sure to set `enabled=false` or
{ml} jobs will not start running again.
[source,js]
--------------------------------------------------
POST _ml/set_upgrade_mode?enabled=false&timeout=10m
--------------------------------------------------
// CONSOLE
// TEST
