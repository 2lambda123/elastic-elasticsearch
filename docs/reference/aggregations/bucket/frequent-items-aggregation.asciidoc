[[search-aggregations-bucket-frequent-items-aggregation]]
=== Frequent items aggregation
++++
<titleabbrev>Frequent items</titleabbrev>
++++

A bucket aggregation which finds frequent item sets. Finding frequent item sets 
is a form of association rules mining that identifies items that are often occur 
together. Items that are frequently purchased together or log events that tend 
to co-occur are examples of frequent item sets. Finding frequent item sets helps 
to discover relationships between different data points (items) in a data set.


==== Syntax

A `frequent_items` aggregation looks like this in isolation:

[source,js]
--------------------------------------------------
"frequent_items": {
  "minimum_set_size": 3,
  "fields": [
    {"field": "my_field_1"},
    {"field": "my_field_2"}
  ]
}
--------------------------------------------------
// NOTCONSOLE

.`frequent_items` Parameters
|===
|Parameter Name |Description |Required |Default Value
|`field` |(array) Fields to analyze. | Required |
|`minimum_set_size` | (integer) The minimum size of one item set. | Optional | `1`
|`minimum_support` | (integer) The minimum support of one item set. | Optional | `0.1`
|`size` | (integer) The number of top item sets to return. | Optional |
|===


[discrete]
[[frequent-items-minimum-support]]
==== Minimum support

Support represents the frequency of an item set normalized between 0 
and 1. It is calculated by dividing the number of documents containing the item 
set by the total number of documents.

For example, if a given item set is contained by 5 documents and the total 
number of documents is 20, then the support of the item set is 5/20 = 0.25. 
Therefore, this set is returned only if the minimum support is 0.25 or lower. As 
a lower minimum support prunes more items, the calculation is less resource 
intensive. This parameter has an effect on memory and runtime.


[discrete]
[[frequent-items-minimum-set-size]]
==== Minimum set size

The minimum set size is the minimum number of item the set needs to contain. A 
value of 1 returns the frequency of single items. The higher the minimum set 
size the less items are returned. For example, the item set `apple, banana, 
orange` is only returned if the minimum set size is 3 or lower.


[discrete]
[[frequent-items-size]]
==== Size

This parameter defines the maximum number of item sets to return. The result 
contains top-k item sets; the item sets with the highest support values. This 
parameter has a significant effect on memory and runtime.

[discrete]
[[frequent-items-example]]
==== Example

In this example, we use the e-commerce {kib} sample data set. The goal is to 
find out from what product categories customers frequently purchase products 
together based on transaction data. We are interested in sets with two items, 
and want to see the first three frequent item setes with the highest support. 

[source,console]
-------------------------------------------------
GET kibana_sample_data_ecommerce / _search 
{
 "size": 0,
	"aggs": {
		"my_agg": {
			"frequent_items": {
				"minimum_set_size": 2,
				"fields": [ 
          {"field": "category.keyword"}
				],
				"size": 3
			}
		}
	}
}
-------------------------------------------------
// TEST[skip:setup kibana sample data]

The API returns a response similar to the following one:

[source,console-result]
-------------------------------------------------
(...)
"aggregations" : {
    "frequ" : {
      "buckets" : [
        {
          "key" : {
            "category.keyword" : [
              "Women's Clothing",
              "Women's Shoes"
            ]
          },
          "doc_count" : 738,
          "support" : 0.15786096256684493
        },
        {
          "key" : {
            "category.keyword" : [
              "Men's Clothing",
              "Men's Shoes"
            ]
          },
          "doc_count" : 695,
          "support" : 0.14866310160427806
        },
        {
          "key" : {
            "category.keyword" : [
              "Women's Clothing",
              "Women's Accessories"
            ]
          },
          "doc_count" : 449,
          "support" : 0.0960427807486631
        }
      ],
    (...) 
  }
}
-------------------------------------------------

The response shows that the categories customers purcashe from most frequently 
together are `Women's Clothing` and `Women's Shoes`. It means that customers who 
buy products labelled Women's Clothing more likely buy products also from the 
Women's Shoes category. The item set with the second highest support is 
`Men's Clothing` and `Men's Shoes`. Finally, the item set with the third highest 
support is `Women's Clothing` and `Women's Accessories`.