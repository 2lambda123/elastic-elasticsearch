[role="xpack"]
[testenv="basic"]
[[enrich-processor]]
=== Enrich processor
++++
<titleabbrev>Enrich</titleabbrev>
++++

The `enrich` processor can enrich documents with data from another index.
See <<ingest-enriching-data,enrich data>> section for more information about how to set this up.

[[enrich-options]]
.Enrich Options
[options="header"]
|======
| Name               | Required  | Default              | Description
| `policy_name`      | yes       | -                    | The name of the enrich policy to use.
| `field`            | yes       | -                    | The field in the input document that matches the policies match_field used to retrieve the enrichment data. Supports <<template-snippets,template snippets>>.
| `target_field`     | yes       | -                    | Field added to incoming documents to contain enrich data. This field contains both the `match_field` and `enrich_fields` specified in the <<put-enrich-policy-api,enrich policy>>. Supports <<template-snippets,template snippets>>.
| `ignore_missing`   | no        | false                | If `true` and `field` does not exist, the processor quietly exits without modifying the document
| `override`         | no        | true                 | If processor will update fields with pre-existing non-null-valued field. When set to `false`, such fields will not be touched.
| `max_matches`      | no        | 1                    | The maximum number of matched documents to include under the configured target field. The `target_field` will be turned into a json array if `max_matches` is higher than 1, otherwise `target_field` will become a json object. In order to avoid documents getting too large, the maximum allowed value is 128.
| `shape_relation`   | no        | `INTERSECTS`         | A spatial relation operator used to match the <<geo-shape,geoshape>> of incoming documents to documents in the enrich index. This option is only used for `geo_match` enrich policy types. See <<_spatial_relations>> for operators and more information.

include::common-options.asciidoc[]
|======

[[ingest-enrich-settings]]
===== Node Settings

The `enrich` processor has node settings for enrich coordinator and
enrich policy executor.

The enrich coordinator supports the following node settings:

`enrich.cache_size`::

    The maximum number of searches for enriching documents that should be cached.
    Defaults to `1000`. Note that these settings are node settings and apply to
    all `enrich` processors, i.e. there is one cache for all defined `enrich` processors.

`enrich.coordinator_proxy.max_concurrent_requests`::

    The maximum number of concurrent msearch requests that coordinator executes
    to enrich documents across multiple bulk requests. Defaults to `8`.

`enrich.coordinator_proxy.max_lookups_per_request`::

    The maximum number of search requests for enriching documents that are batched
    into a single msearch request. Defaults to `128`.

The enrich policy executor supports the following node settings:

`enrich.fetch_size`::

    The maximum fetch size when reindexing the source index into
    a new system enrich index. Defaults to `10000`.

`enrich.max_force_merge_attempts`::

    The maximum number of attempts in order to force merge a new
    system enrich index shard into a single segment. Defaults to `3`.

`enrich.cleanup_period`::

    The cleanup maintenance service cleans up unused enrich system
    indices in the background. This setting controls how often this
    service should check whether unused enrich system indices should
    be removed. Defaults to `15m`.

`enrich.max_concurrent_policy_executions`::

    Controls the maximum number of policy that are allowed to execute
    concurrently.Defaults to `50`.
