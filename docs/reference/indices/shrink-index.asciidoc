[[indices-shrink-index]]
== Shrink Index API
++++
<titleabbrev>Shrink Index</titleabbrev>
++++

Shrinks an existing index into a new index with fewer primary shards.

[float]
[[indices-shrink-index-request]]
=== {api-request-title}

`POST <source-index>/_shrink/<target-index>`

[float]
[[indices-shrink-index-prereqs]]
=== {api-prereq-title}

To be shrunk, an index must meet the following criteria:

* The index cannot contain more than `2,147,483,519` documents that will be
shrunk into a single shard. This is the maximum number of documents a shard can
contain.

* The index must be read-only.

* All primary and replica shards in the index must be on the same node.

* The cluster must have a `green` health status. You can check the health
status of a cluster using the <<cluster-health, cluster health API>>.

* The node handling the shrink process must have enough free disk space for a
second copy of the source index.

See <<prepare-index-for-shrinking>>.

[float]
[[indices-shrink-index-desc]]
=== {api-description-title}

You can use shrink index API to shrink an existing source index into a new
target index with fewer primary shards.

[float]
[[indices-shrink-index-path-params]]
=== {api-path-parms-title}

`<source-index>` (Required)::
(string) Name of the existing index to shrink.

`<target-index>` (Required)::
+
--
(string) Name of the new index to create.

This cannot be an existing index. If this index exists prior to the request,
{es} returns an error.
--

[float]
[[indices-shrink-index-query-params]]
=== {api-query-parms-title}

`wait_for_active_shards` (Optional)::
(integer) Number of active shard copies required to start before returning a
response. See <<index-wait-for-active-shards>>.

include::{docdir}/rest-api/timeoutparms.asciidoc[]

[float]
[[indices-shrink-index-request-body]]
=== {api-request-body-title}

`aliases` (Optional)::
(object) Index aliases which include the new `<target-index>`. See
<<indices-aliases, Index aliases>>.

`settings` (Optional)::
+
--
(object) Configuration options for the new `<target-index>`. See
<<index-modules-settings, Index settings>>.

[IMPORTANT]
====
You can set the number of primary shards for the new `<target-index>` using the
`index.number_of_shards` setting.

The new number of primary shards in the target index **must be**:

* Less than the current number of shards in the source index.

* A factor of the number of shards in the source index.

For example, you can shrink a `<source-index>` with `8` primary shards into a
`<target-index>` with `4`, `2` or `1` primary shards.

See <<shrink-index>>.
====
--

[float]
[[indices-shrink-index-example]]
=== {api-example-title}

[source,js]
----
POST my_source_index/_shrink/my_target_index
{
  "settings": {
    "index.number_of_replicas": 1,
    "index.number_of_shards": 1
  },
  "aliases": {
    "my_search_indices": {}
  }
}
----
// CONSOLE
// TEST[s/^/PUT my_source_index\n{"settings": {"index.number_of_shards":5,"index.blocks.write": true}}\n/]