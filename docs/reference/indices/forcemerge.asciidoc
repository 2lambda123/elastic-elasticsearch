[[indices-forcemerge]]
== Force merge API
++++
<titleabbrev>Force merge</titleabbrev>
++++

Merges the segments one or more read-only indices.

[float]
[[indices-forcemerge-request]]
=== {api-request-title}

`POST <index>/_forcemerge`

[float]
[[indices-forcemerge-desc]]
=== {api-description-title}

You can use the force merge API to merge the segments of one or more indices
through an API. The merge relates to the number of segments a Lucene index holds
within each shard. The force merge operation allows to reduce the number of
segments by merging them.

This call will block until the merge is complete. If the http connection is
lost, the request will continue in the background, and any new requests will
block until the previous force merge is complete.

WARNING: Force merge should only be called against *read-only indices*. Running
force merge against a read-write index can cause very large segments to be
produced (>5Gb per segment), and the merge policy will never consider it for
merging again until it mostly consists of deleted docs. This can cause very
large segments to remain in the shards.

[float]
[[indices-forcemerge-path-params]]
=== {api-path-parms-title}

`<index>` (Required)::
+
--
(string) Comma-separated list or wildcard expression of indices to merge.

You can use a value of `_all` or `*` to merge all indices.

If no value is provided, the API merges all indices.
--

[float]
[[indices-forcemerge-query-params]]
=== {api-query-parms-title}

`allow_no_indices` (Optional)::
(boolean) Indicates whether the operation is skipped if a wildcard expression
matches no indices. Defaults to `false`.

`expand_wildcards` (Optional)::
+
--
(string) Indicates whether wildcard expressions should expand to
<<indices-open-close, open or closed indices>>. Possible values are:

 * `open` (Default)
* `closed`
* `none`
* `all`
--

`flush` (Optional)::
(boolean) Indicates whether the index is flushed after the operation. Defaults
to `true`.

`ignore_unavailable` (Optional)::
(boolean) Indicates whether unavailable indices are skipped. Defaults to
`false`.

`max_num_segments` (Optional)::
+
--
(integer) Number of segments for the new merged index.

To fully merge indices, use a value of `1`. Defaults to checking if a
merge is needed, and if so, executes it.
--

`only_expunge_deletes` (Optional)::
+
--
(boolean) Indicates whether the merge operation only removes segments containing
delete documents. Defaults to `false`.

In Lucene, a document is not deleted from a segment, just marked as deleted.
During a merge process of segments, a new segment is created that does not have
those deletes. This flag allows to only merge segments that have deletes. Note
that this won't override the `index.merge.policy.expunge_deletes_allowed`
setting threshold.
--

[float]
[[indices-forcemerge-example]]
=== {api-examples-title}

[source,js]
----
POST /twitter/_forcemerge
----
// CONSOLE
// TEST[setup:twitter]