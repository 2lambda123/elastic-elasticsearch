---
"line_54":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "settings": {
              "analysis": {
                "analyzer": {
                  "my_analyzer": {
                    "tokenizer": "standard",
                    "char_filter": [
                      "my_char_filter"
                    ]
                  }
                },
                "char_filter": {
                  "my_char_filter": {
                    "type": "pattern_replace",
                    "pattern": "(\\d+)-(?=\\d)",
                    "replacement": "_"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000001/_analyze"
        body: |
          {
            "analyzer": "my_analyzer",
            "text": "My credit card is 123-456-789"
          }
  - is_false: _shards.failures
---
"line_104":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "settings": {
              "analysis": {
                "analyzer": {
                  "my_analyzer": {
                    "tokenizer": "standard",
                    "char_filter": [
                      "my_char_filter"
                    ],
                    "filter": [
                      "lowercase"
                    ]
                  }
                },
                "char_filter": {
                  "my_char_filter": {
                    "type": "pattern_replace",
                    "pattern": "(?<=\\p{Lower})(?=\\p{Upper})",
                    "replacement": " "
                  }
                }
              }
            },
            "mappings": {
              "properties": {
                "text": {
                  "type": "text",
                  "analyzer": "my_analyzer"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000001/_analyze"
        body: |
          {
            "analyzer": "my_analyzer",
            "text": "The fooBarBaz method"
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "tokens": [
            {
              "token": "the",
              "start_offset": 0,
              "end_offset": 3,
              "type": "<ALPHANUM>",
              "position": 0
            },
            {
              "token": "foo",
              "start_offset": 4,
              "end_offset": 6,
              "type": "<ALPHANUM>",
              "position": 1
            },
            {
              "token": "bar",
              "start_offset": 7,
              "end_offset": 9,
              "type": "<ALPHANUM>",
              "position": 2
            },
            {
              "token": "baz",
              "start_offset": 10,
              "end_offset": 13,
              "type": "<ALPHANUM>",
              "position": 3
            },
            {
              "token": "method",
              "start_offset": 14,
              "end_offset": 20,
              "type": "<ALPHANUM>",
              "position": 4
            }
          ]
        }
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        refresh: ""
        body: |
          {
            "text": "The fooBarBaz method"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "match": {
                "text": "bar"
              }
            },
            "highlight": {
              "fields": {
                "text": {}
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "timed_out": false,
          "took": "$body.took",
          "_shards": {
            "total": 1,
            "successful": 1,
            "skipped" : 0,
            "failed": 0
          },
          "hits": {
            "total" : {
                "value": 1,
                "relation": "eq"
            },
            "max_score": 0.2876821,
            "hits": [
              {
                "_index": "my-index-000001",
                "_id": "1",
                "_score": 0.2876821,
                "_source": {
                  "text": "The fooBarBaz method"
                },
                "highlight": {
                  "text": [
                    "The foo<em>Ba</em>rBaz method"
                  ]
                }
              }
            ]
          }
        }
