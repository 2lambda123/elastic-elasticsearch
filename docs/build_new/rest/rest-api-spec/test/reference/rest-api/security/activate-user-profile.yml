---
"line_98":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup jacknich_user

  - do:
      security.put_user:
        username: "jacknich"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com",
            "metadata" : { "intelligence" : 7 }
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }

  - do:
      raw:
        method: POST
        path: "_security/profile/_activate"
        body: |
          {
            "grant_type": "password",
            "username" : "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "uid": "u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0",
          "enabled": true,
          "last_synchronized": $body.last_synchronized,
          "user": {
            "username": "jacknich",
            "roles": [
              "admin", "other_role1"
            ],
            "realm_name": "native",
            "full_name": "Jack Nicholson",
            "email": "jacknich@example.com"
          },
          "labels": {},
          "data": {},
          "_doc": {
            "_primary_term": $body._doc._primary_term,
            "_seq_no": $body._doc._seq_no
          }
        }
