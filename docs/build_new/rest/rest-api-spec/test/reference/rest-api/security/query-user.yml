---
"line_115":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup jacknich_user

  - do:
      security.put_user:
        username: "jacknich"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com",
            "metadata" : { "intelligence" : 7 }
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }

# Named setup sandrakn_user

  - do:
      security.put_user:
        username: "sandrakn"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Sandra Knight",
            "email" : "sandrakn@example.com",
            "metadata" : { "intelligence" : 7 }
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "sandrakn",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }


  - do:
      raw:
        method: GET
        path: "_security/_query/user"
  - is_false: _shards.failures
  - match:
      $body:
        {
            "total": 2,
            "count": 2,
            "users": [
                {
                    "username": "jacknich",
                    "roles": [
                        "admin",
                        "other_role1"
                    ],
                    "full_name": "Jack Nicholson",
                    "email": "jacknich@example.com",
                    "metadata": {
                        "intelligence": 7
                    },
                    "enabled": true
                },
                {
                    "username": "sandrakn",
                    "roles": [
                        "admin",
                        "other_role1"
                    ],
                    "full_name": "Sandra Knight",
                    "email": "sandrakn@example.com",
                    "metadata": {
                        "intelligence": 7
                    },
                    "enabled": true
                }
            ]
        }
---
"line_165":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/user/jacknich"
        body: |
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com",
            "metadata" : {
              "intelligence" : 7
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "created": true
        }
---
"line_190":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup jacknich_user

  - do:
      security.put_user:
        username: "jacknich"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com",
            "metadata" : { "intelligence" : 7 }
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }

  - do:
      raw:
        method: GET
        path: "_security/_query/user"
        body: |
          {
              "query": {
                  "prefix": {
                      "roles": "other"
                  }
              }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
            "total": 1,
            "count": 1,
            "users": [
                {
                    "username": "jacknich",
                    "roles": [
                        "admin",
                        "other_role1"
                    ],
                    "full_name": "Jack Nicholson",
                    "email": "jacknich@example.com",
                    "metadata": {
                        "intelligence": 7
                    },
                    "enabled": true
                }
            ]
        }
---
"line_230":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup jacknich_user

  - do:
      security.put_user:
        username: "jacknich"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com",
            "metadata" : { "intelligence" : 7 }
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }

  - do:
      raw:
        method: GET
        path: "_security/_query/user"
        with_profile_uid: "true"
        body: |
          {
              "query": {
                  "prefix": {
                      "roles": "other"
                  }
              }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
            "total": 1,
            "count": 1,
            "users": [
                {
                    "username": "jacknich",
                    "roles": [
                        "admin",
                        "other_role1"
                    ],
                    "full_name": "Jack Nicholson",
                    "email": "jacknich@example.com",
                    "metadata": {
                        "intelligence": 7
                    },
                    "enabled": true,
                    "profile_uid": "u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0"
                }
            ]
        }
