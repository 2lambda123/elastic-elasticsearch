---
"line_10":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "city": {
                  "type": "text",
                  "fields": {
                    "raw": {
                      "type":  "keyword"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        body: |
          {
            "city": "New York"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        body: |
          {
            "city": "York"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "match": {
                "city": "york"
              }
            },
            "sort": {
              "city.raw": "asc"
            },
            "aggs": {
              "Cities": {
                "terms": {
                  "field": "city.raw"
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_82":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "text": {
                  "type": "text",
                  "fields": {
                    "english": {
                      "type":     "text",
                      "analyzer": "english"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        body: |
          { "text": "quick brown fox" }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        body: |
          { "text": "quick brown foxes" }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "multi_match": {
                "query": "quick brown foxes",
                "fields": [
                  "text",
                  "text.english"
                ],
                "type": "most_fields"
              }
            }
          }
  - is_false: _shards.failures
