---
setup:
  - do:
      raw:
        method: PUT
        path: "_snapshot/found-snapshots"
        body: |
          {
           "type": "fs",
            "settings": {
              "location": "my_backup_location"
            }
          }
---
"line_31":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ilm/policy/logs"
        body: |
          {
            "policy": {
              "phases": {
                "hot": {
                  "actions": {
                    "rollover": {
                      "max_primary_shard_size": "50gb"
                    }
                  }
                },
                "warm": {
                  "min_age": "30d",
                  "actions": {
                    "shrink": {
                      "number_of_shards": 1
                    },
                    "forcemerge": {
                      "max_num_segments": 1
                    }
                  }
                },
                "cold": {
                  "min_age": "60d",
                  "actions": {
                    "searchable_snapshot": {
                      "snapshot_repository": "found-snapshots"
                    }
                  }
                },
                "frozen": {
                  "min_age": "90d",
                  "actions": {
                    "searchable_snapshot": {
                      "snapshot_repository": "found-snapshots"
                    }
                  }
                },
                "delete": {
                  "min_age": "735d",
                  "actions": {
                    "delete": {}
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
