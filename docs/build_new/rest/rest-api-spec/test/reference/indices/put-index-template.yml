---
setup:
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns" : ["te*"],
            "priority" : 1,
            "template": {
              "settings" : {
                "number_of_shards" : 2
              }
            }
          }
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_index_template/template_*"
---
"line_186":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns" : ["te*"],
            "template": {
              "settings" : {
                  "number_of_shards" : 1
              },
              "aliases" : {
                  "alias1" : {},
                  "alias2" : {
                      "filter" : {
                          "term" : {"user.id" : "kimchy" }
                      },
                      "routing" : "shard-1"
                  },
                  "{index}-alias" : {}
              }
            }
          }
  - is_false: _shards.failures
---
"line_218":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns" : ["t*"],
            "priority" : 0,
            "template": {
              "settings" : {
                "number_of_shards" : 1,
                "number_of_replicas": 0
              },
              "mappings" : {
                "_source" : { "enabled" : false }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_index_template/template_2"
        body: |
          {
            "index_patterns" : ["te*"],
            "priority" : 1,
            "template": {
              "settings" : {
                "number_of_shards" : 2
              },
              "mappings" : {
                "_source" : { "enabled" : true }
              }
            }
          }
  - is_false: _shards.failures
---
"line_268":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns" : ["foo", "bar"],
            "priority" : 0,
            "template": {
              "settings" : {
                  "number_of_shards" : 1
              }
            },
            "version": 123
          }
  - is_false: _shards.failures
---
"line_296":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns": ["foo", "bar"],
            "template": {
              "settings" : {
                  "number_of_shards" : 3
              }
            },
            "_meta": {
              "description": "set number of shards to three",
              "serialization": {
                "class": "MyIndexTemplate",
                "id": 17
              }
            }
          }
  - is_false: _shards.failures
---
"line_324":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns": ["logs-*"],
            "data_stream": { }
          }
  - is_false: _shards.failures
---
"line_344":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_component_template/template_with_2_shards"
        body: |
          {
            "template": {
              "settings": {
                "index.number_of_shards": 2
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_component_template/template_with_3_shards"
        body: |
          {
            "template": {
              "settings": {
                "index.number_of_shards": 3
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_index_template/template_1"
        body: |
          {
            "index_patterns": ["t*"],
            "composed_of": ["template_with_2_shards", "template_with_3_shards"]
          }
  - is_false: _shards.failures
