---
"line_17":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  TBD
  - do:
      raw:
        method: GET
        path: "_search"
        body: |
          {
             "query":{
                "text_expansion":{
                   "<sparse_vector_field>":{
                      "model_id":"the model to produce the token weights",
                      "model_text":"the query string"
                   }
                }
             }
          }
  - is_false: _shards.failures
---
"line_98":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
             "query":{
                "text_expansion":{
                   "ml.tokens":{
                      "model_id":".elser_model_2",
                      "model_text":"How is the weather in Jamaica?"
                   }
                }
             }
          }
  - is_false: _shards.failures
---
"line_117":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
            "query": {
              "bool": {
                "should": [
                  {
                    "text_expansion": {
                      "ml.inference.title_expanded.predicted_value": {
                        "model_id": ".elser_model_2",
                        "model_text": "How is the weather in Jamaica?",
                        "boost": 1
                      }
                    }
                  },
                  {
                    "text_expansion": {
                      "ml.inference.description_expanded.predicted_value": {
                        "model_id": ".elser_model_2",
                        "model_text": "How is the weather in Jamaica?",
                        "boost": 1
                      }
                    }
                  },
                  {
                    "multi_match": {
                      "query": "How is the weather in Jamaica?",
                      "fields": [
                        "title",
                        "description"
                      ],
                      "boost": 4
                    }
                  }
                ]
              }
            }
          }
  - is_false: _shards.failures
---
"line_163":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
            "retriever": {
              "rrf": {
                "retrievers": [
                  {
                    "standard": {
                      "query": {
                        "multi_match": {
                          "query": "How is the weather in Jamaica?",
                          "fields": [
                            "title",
                            "description"
                          ]
                        }
                      }
                    }
                  },
                  {
                    "standard": {
                      "query": {
                        "text_expansion": {
                          "ml.inference.title_expanded.predicted_value": {
                            "model_id": ".elser_model_2",
                            "model_text": "How is the weather in Jamaica?"
                          }
                        }
                      }
                    }
                  },
                  {
                    "standard": {
                      "query": {
                        "text_expansion": {
                          "ml.inference.description_expanded.predicted_value": {
                            "model_id": ".elser_model_2",
                            "model_text": "How is the weather in Jamaica?"
                          }
                        }
                      }
                    }
                  }
                ],
                "window_size": 10,
                "rank_constant": 20
              }
            }
          }
  - is_false: _shards.failures
---
"line_228":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
             "query":{
                "text_expansion":{
                   "ml.tokens":{
                      "model_id":".elser_model_2",
                      "model_text":"How is the weather in Jamaica?"
                   },
                   "pruning_config": {
                       "tokens_freq_ratio_threshold": 5,
                       "tokens_weight_threshold": 0.4,
                       "only_score_pruned_tokens": false
                   }
                }
             },
             "rescore": {
                "window_size": 100,
                "query": {
                   "rescore_query": {
                      "text_expansion": {
                         "ml.tokens": {
                            "model_id": ".elser_model_2",
                            "model_text": "How is the weather in Jamaica?"
                         },
                         "pruning_config": {
                            "tokens_freq_ratio_threshold": 5,
                            "tokens_weight_threshold": 0.4,
                            "only_score_pruned_tokens": true
                         }
                      }
                   }
                }
             }
          }
  - is_false: _shards.failures
