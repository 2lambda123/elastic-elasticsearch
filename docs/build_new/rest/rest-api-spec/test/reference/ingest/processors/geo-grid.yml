---
"line_39":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "geocells"
        body: |
          {
            "mappings": {
              "properties": {
                "geocell": {
                  "type": "geo_shape"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/geotile2shape"
        body: |
          {
            "description": "translate rectangular z/x/y geotile to bounding box",
            "processors": [
              {
                "geo_grid": {
                  "field": "geocell",
                  "tile_type": "geotile"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/geohex2shape"
        body: |
          {
            "description": "translate H3 cell to polygon",
            "processors": [
              {
                "geo_grid": {
                  "field": "geocell",
                  "tile_type": "geohex",
                  "target_format": "wkt"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "geocells/_doc/1"
        pipeline: "geotile2shape"
        body: |
          {
            "geocell": "4/8/5"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "geocells/_doc/1"
  - is_false: _shards.failures
  - match:
      $body:
        {
         "_index": "geocells",
          "_id": "1",
          "_version": $body._version,
          "_seq_no": $body._seq_no,
          "_primary_term": $body._primary_term,
          "found": true,
          "_source": {
            "geocell": {
              "type": "Envelope",
              "coordinates": [
                [ 0.0, 55.77657301866769 ],
                [ 22.5, 40.979898069620134 ]
              ]
            }
          }
        }
  - do:
      raw:
        method: PUT
        path: "geocells/_doc/1"
        pipeline: "geohex2shape"
        body: |
          {
            "geocell": "811fbffffffffff"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "geocells/_doc/1"
  - is_false: _shards.failures
  - match:
      $body:
        {
         "_index": "geocells",
          "_id": "1",
          "_version": $body._version,
          "_seq_no": $body._seq_no,
          "_primary_term": $body._primary_term,
          "found": true,
          "_source": {
            "geocell": "POLYGON ((1.1885095294564962 49.470279179513454, 2.0265689212828875 45.18424864858389, 7.509948452934623 43.786609335802495, 12.6773177459836 46.40695743262768, 12.345747342333198 50.55427505169064, 6.259687012061477 51.964770150370896, 3.6300085578113794 50.610463307239115, 1.1885095294564962 49.470279179513454))"
          }
        }
---
"line_174":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/geohex2shape"
        body: |
          {
            "description": "translate H3 cell to polygon with enriched fields",
            "processors": [
              {
                "geo_grid": {
                  "description": "Ingest H3 cells like '811fbffffffffff' and create polygons",
                  "field": "geocell",
                  "tile_type": "geohex",
                  "target_format": "wkt",
                  "target_field": "shape",
                  "parent_field": "parent",
                  "children_field": "children",
                  "non_children_field": "nonChildren",
                  "precision_field": "precision"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "geocells/_doc/1"
        pipeline: "geohex2shape"
        body: |
          {
            "geocell": "811fbffffffffff"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "geocells/_doc/1"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_index": "geocells",
          "_id": "1",
          "_version": $body._version,
          "_seq_no": $body._seq_no,
          "_primary_term": $body._primary_term,
          "found": true,
          "_source": {
            "parent": "801ffffffffffff",
            "geocell": "811fbffffffffff",
            "precision": 1,
            "shape": "POLYGON ((1.1885095294564962 49.470279179513454, 2.0265689212828875 45.18424864858389, 7.509948452934623 43.786609335802495, 12.6773177459836 46.40695743262768, 12.345747342333198 50.55427505169064, 6.259687012061477 51.964770150370896, 3.6300085578113794 50.610463307239115, 1.1885095294564962 49.470279179513454))",
            "children": [
              "821f87fffffffff",
              "821f8ffffffffff",
              "821f97fffffffff",
              "821f9ffffffffff",
              "821fa7fffffffff",
              "821faffffffffff",
              "821fb7fffffffff"
            ],
            "nonChildren": [
              "821ea7fffffffff",
              "82186ffffffffff",
              "82396ffffffffff",
              "821f17fffffffff",
              "821e37fffffffff",
              "82194ffffffffff"
            ]
          }
        }
