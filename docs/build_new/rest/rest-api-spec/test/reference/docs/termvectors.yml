---
"line_10":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup my_index

  - do:
        indices.create:
          index: my-index-000001
          body:
            settings:
              number_of_shards: 1
              number_of_replicas: 1
            mappings:
              properties:
                "@timestamp":
                  type: date
                http:
                  properties:
                    request:
                      properties:
                        method:
                          type: keyword
                message:
                  type: text
                  fields:
                    keyword:
                      type: keyword
                user:
                  properties:
                    id:
                      type: keyword
                      doc_values: true
  - do:
        bulk:
          index: my-index-000001
          refresh: true
          body: |
            { "index":{"_id": "0"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "127.0.0.1" }, "user": { "id": "kimchy" } }
            { "index":{"_id": "1"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "2"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "3"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "4"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors/1"
  - is_false: _shards.failures
---
"line_36":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup my_index

  - do:
        indices.create:
          index: my-index-000001
          body:
            settings:
              number_of_shards: 1
              number_of_replicas: 1
            mappings:
              properties:
                "@timestamp":
                  type: date
                http:
                  properties:
                    request:
                      properties:
                        method:
                          type: keyword
                message:
                  type: text
                  fields:
                    keyword:
                      type: keyword
                user:
                  properties:
                    id:
                      type: keyword
                      doc_values: true
  - do:
        bulk:
          index: my-index-000001
          refresh: true
          body: |
            { "index":{"_id": "0"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "127.0.0.1" }, "user": { "id": "kimchy" } }
            { "index":{"_id": "1"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "2"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "3"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
            { "index":{"_id": "4"} }
            { "@timestamp": "2099-11-15T14:12:12", "http": { "request": { "method": "get" }, "response": { "bytes": 1070000, "status_code": 200 }, "version": "1.1" }, "message": "GET /search HTTP/1.1 200 1070000", "source": { "ip": "10.42.42.42" }, "user": { "id": "elkbee" } }
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors/1"
        fields: "message"
  - is_false: _shards.failures
---
"line_177":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          { "mappings": {
              "properties": {
                "text": {
                  "type": "text",
                  "term_vector": "with_positions_offsets_payloads",
                  "store" : true,
                  "analyzer" : "fulltext_analyzer"
                 },
                 "fullname": {
                  "type": "text",
                  "term_vector": "with_positions_offsets_payloads",
                  "analyzer" : "fulltext_analyzer"
                }
              }
            },
            "settings" : {
              "index" : {
                "number_of_shards" : 1,
                "number_of_replicas" : 0
              },
              "analysis": {
                "analyzer": {
                  "fulltext_analyzer": {
                    "type": "custom",
                    "tokenizer": "whitespace",
                    "filter": [
                      "lowercase",
                      "type_as_payload"
                    ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        body: |
          {
            "fullname" : "John Doe",
            "text" : "test test test "
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        refresh: "wait_for"
        body: |
          {
            "fullname" : "Jane Doe",
            "text" : "Another test ..."
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors/1"
        body: |
          {
            "fields" : ["text"],
            "offsets" : true,
            "payloads" : true,
            "positions" : true,
            "term_statistics" : true,
            "field_statistics" : true
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_index": "my-index-000001",
          "_id": "1",
          "_version": 1,
          "found": true,
          "took": "$body.took",
          "term_vectors": {
            "text": {
              "field_statistics": {
                "sum_doc_freq": 4,
                "doc_count": 2,
                "sum_ttf": 6
              },
              "terms": {
                "test": {
                  "doc_freq": 2,
                  "ttf": 4,
                  "term_freq": 3,
                  "tokens": [
                    {
                      "position": 0,
                      "start_offset": 0,
                      "end_offset": 4,
                      "payload": "d29yZA=="
                    },
                    {
                      "position": 1,
                      "start_offset": 5,
                      "end_offset": 9,
                      "payload": "d29yZA=="
                    },
                    {
                      "position": 2,
                      "start_offset": 10,
                      "end_offset": 14,
                      "payload": "d29yZA=="
                    }
                  ]
                }
              }
            }
          }
        }
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors/1"
        body: |
          {
            "fields" : ["text", "some_field_without_term_vectors"],
            "offsets" : true,
            "positions" : true,
            "term_statistics" : true,
            "field_statistics" : true
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors"
        body: |
          {
            "doc" : {
              "fullname" : "John Doe",
              "text" : "test test test"
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_termvectors"
        body: |
          {
            "doc" : {
              "fullname" : "John Doe",
              "text" : "test test test"
            },
            "fields": ["fullname"],
            "per_field_analyzer" : {
              "fullname": "keyword"
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_index": "my-index-000001",
          "_version": 0,
          "found": true,
          "took": "$body.took",
          "term_vectors": {
            "fullname": {
               "field_statistics": {
                  "sum_doc_freq": "$body.term_vectors.fullname.field_statistics.sum_doc_freq",
                  "doc_count": "$body.term_vectors.fullname.field_statistics.doc_count",
                  "sum_ttf": "$body.term_vectors.fullname.field_statistics.sum_ttf"
               },
               "terms": {
                  "John Doe": {
                     "term_freq": 1,
                     "tokens": [
                        {
                           "position": 0,
                           "start_offset": 0,
                           "end_offset": 8
                        }
                     ]
                  }
               }
            }
          }
        }
---
"line_418":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: no imdb test index
  - do:
      raw:
        method: GET
        path: "imdb/_termvectors"
        body: |
          {
            "doc": {
              "plot": "When wealthy industrialist Tony Stark is forced to build an armored suit after a life-threatening incident, he ultimately decides to use its technology to fight against evil."
            },
            "term_statistics": true,
            "field_statistics": true,
            "positions": false,
            "offsets": false,
            "filter": {
              "max_num_terms": 3,
              "min_term_freq": 1,
              "min_doc_freq": 1
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
           "_index": "imdb",
           "_version": 0,
           "found": true,
           "term_vectors": {
              "plot": {
                 "field_statistics": {
                    "sum_doc_freq": 3384269,
                    "doc_count": 176214,
                    "sum_ttf": 3753460
                 },
                 "terms": {
                    "armored": {
                       "doc_freq": 27,
                       "ttf": 27,
                       "term_freq": 1,
                       "score": 9.74725
                    },
                    "industrialist": {
                       "doc_freq": 88,
                       "ttf": 88,
                       "term_freq": 1,
                       "score": 8.590818
                    },
                    "stark": {
                       "doc_freq": 44,
                       "ttf": 47,
                       "term_freq": 1,
                       "score": 9.272792
                    }
                 }
              }
           }
        }
