---
"line_64":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: GET
        path: "_snapshot"
  - is_false: _shards.failures
---
"line_73":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/*"
        verbose: "false"
  - is_false: _shards.failures
---
"line_114":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/logs-my_app-default"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_snapshot/my_repository/my_snapshot_2099.05.06/_restore"
        wait_for_completion: "true"
        body: |
          {
            "indices": "my-index,logs-my_app-default"
          }
  - is_false: _shards.failures
---
"line_152":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: POST
        path: "_snapshot/my_repository/my_snapshot_2099.05.06/_restore"
        wait_for_completion: "true"
        body: |
          {
            "indices": "my-index,logs-my_app-default",
            "rename_pattern": "(.+)",
            "rename_replacement": "restored-$1"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_reindex"
        body: |
          {
            "source": {
              "index": "restored-my-index"
            },
            "dest": {
              "index": "my-index"
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/logs-my_app-default"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_reindex"
        body: |
          {
            "source": {
              "index": "restored-logs-my_app-default"
            },
            "dest": {
              "index": "logs-my_app-default",
              "op_type": "create"
            }
          }
  - is_false: _shards.failures
---
"line_225":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/my_snapshot_2099.05.06"
  - is_false: _shards.failures
---
"line_246":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/logs-my_app-default"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_snapshot/my_repository/my_snapshot_2099.05.06/_restore"
        wait_for_completion: "true"
        body: |
          {
            
            "include_global_state": false,
            "indices": "-*"
          }
  - is_false: _shards.failures
---
"line_295":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "ingest.geoip.downloader.enabled": false,
              "indices.lifecycle.history_index_enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_308":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ilm/stop"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_ilm/start"
  - is_false: _shards.failures
---
"line_323":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ml/set_upgrade_mode"
        enabled: "true"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_ml/set_upgrade_mode"
        enabled: "false"
  - is_false: _shards.failures
---
"line_338":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      warnings:
         - "[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "xpack.monitoring.collection.enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_351":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_watcher/_stop"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_watcher/_start"
  - is_false: _shards.failures
---
"line_368":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cluster/settings"
        filter_path: "**.xpack.profiling.templates.enabled"
        include_defaults: "true"
  - is_false: _shards.failures
---
"line_375":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "xpack.profiling.templates.enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_408":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "action.destructive_requires_name": false
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/*"
        expand_wildcards: "all"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "*"
        expand_wildcards: "all"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_snapshot/my_repository/my_snapshot_2099.05.06/_restore"
        wait_for_completion: "true"
        body: |
          {
            "indices": "*",
            "include_global_state": true
          }
  - is_false: _shards.failures
---
"line_455":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "ingest.geoip.downloader.enabled": false,
              "indices.lifecycle.history_index_enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_469":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ilm/start"
  - is_false: _shards.failures
---
"line_476":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ml/set_upgrade_mode"
        enabled: "false"
  - is_false: _shards.failures
---
"line_483":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      warnings:
         - "[xpack.monitoring.collection.enabled] setting was deprecated in Elasticsearch and will be removed in a future release."
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "xpack.monitoring.collection.enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_497":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_watcher/_start"
  - is_false: _shards.failures
---
"line_507":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "xpack.profiling.templates.enabled": false
            }
          }
  - is_false: _shards.failures
---
"line_520":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "action.destructive_requires_name": null
            }
          }
  - is_false: _shards.failures
---
"line_550":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cluster/health"
  - is_false: _shards.failures
---
"line_558":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: GET
        path: "my-index/_recovery"
  - is_false: _shards.failures
---
"line_566":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cat/shards"
        v: "true"
        h: "index,shard,prirep,state,node,unassigned.reason"
        s: "state"
---
"line_578":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "_cluster/allocation/explain"
        body: |
          {
            "index": "my-index",
            "shard": 0,
            "primary": false
            
          }
  - is_false: _shards.failures
---
"line_600":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/logs-my_app-default"
  - is_false: _shards.failures
---
"line_643":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup setup-snapshots

  - do:
      snapshot.create_repository:
        repository: my_repository
        body:
          type: fs
          settings:
            location: buildDir/cluster/shared/repo

  - do:
      bulk:
        index: my-index
        refresh: true
        body: |
          {"index":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      bulk:
        index: logs-my_app-default
        refresh: true
        body: |
          {"create":{"_id": "0"}}
          {"message": "trying out Elasticsearch", "context": "foo"}
  - do:
      snapshot.create:
        repository: my_repository
        snapshot: my_snapshot_2099.05.06
        wait_for_completion: true

  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/logs-my_app-default"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_snapshot/my_repository/my_snapshot_2099.05.06/_restore"
        wait_for_completion: "true"
        body: |
          {
            "indices": "my-index,logs-my_app-default",
            "index_settings": {
              "index.number_of_replicas": 1
            }
          }
  - is_false: _shards.failures
