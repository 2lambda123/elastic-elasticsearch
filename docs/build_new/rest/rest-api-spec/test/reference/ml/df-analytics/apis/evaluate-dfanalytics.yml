---
"line_253":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
            "index": "my_analytics_dest_index",
            "evaluation": {
              "outlier_detection": {
                "actual_field": "is_outlier",
                "predicted_probability_field": "ml.outlier_score"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "outlier_detection": {
            "auc_roc": {
              "value": 0.92584757746414444
            },
            "confusion_matrix": {
              "0.25": {
                  "tp": 5,
                  "fp": 9,
                  "tn": 204,
                  "fn": 5
              },
              "0.5": {
                  "tp": 1,
                  "fp": 5,
                  "tn": 208,
                  "fn": 9
              },
              "0.75": {
                  "tp": 0,
                  "fp": 4,
                  "tn": 209,
                  "fn": 10
              }
            },
            "precision": {
                "0.25": 0.35714285714285715,
                "0.5": 0.16666666666666666,
                "0.75": 0
            },
            "recall": {
                "0.25": 0.5,
                "0.5": 0.1,
                "0.75": 0
            }
          }
        }
---
"line_315":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
            "index": "house_price_predictions",
            "query": {
                "bool": {
                  "filter": [
                    { "term":  { "ml.is_training": false } }
                  ]
                }
            },
            "evaluation": {
              "regression": {
                "actual_field": "price",
                "predicted_field": "ml.price_prediction",
                "metrics": {
                  "r_squared": {},
                  "mse": {},
                  "msle": {"offset": 10},
                  "huber": {"delta": 1.5}
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_354":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
            "index": "student_performance_mathematics_reg",
            "query": {
              "term": {
                "ml.is_training": {
                  "value": true
                }
              }
            },
            "evaluation": {
              "regression": {
                "actual_field": "G3",
                "predicted_field": "ml.G3_prediction",
                "metrics": {
                  "r_squared": {},
                  "mse": {},
                  "msle": {},
                  "huber": {}
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_395":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
            "index": "student_performance_mathematics_reg",
            "query": {
              "term": {
                "ml.is_training": {
                  "value": false
                }
              }
            },
            "evaluation": {
              "regression": {
                "actual_field": "G3",
                "predicted_field": "ml.G3_prediction",
                "metrics": {
                  "r_squared": {},
                  "mse": {},
                  "msle": {},
                  "huber": {}
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_436":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
             "index": "animal_classification",
             "evaluation": {
                "classification": {
                   "actual_field": "animal_class",
                   "predicted_field": "ml.animal_class_prediction",
                   "metrics": {
                     "multiclass_confusion_matrix" : {}
                   }
                }
             }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
           "classification" : {
              "multiclass_confusion_matrix" : {
                 "confusion_matrix" : [
                 {
                    "actual_class" : "cat",
                    "actual_class_doc_count" : 12,
                    "predicted_classes" : [
                      {
                        "predicted_class" : "cat",
                        "count" : 12
                      },
                      {
                        "predicted_class" : "dog",
                        "count" : 0
                      }
                    ],
                    "other_predicted_class_doc_count" : 0
                  },
                  {
                    "actual_class" : "dog",
                    "actual_class_doc_count" : 11,
                    "predicted_classes" : [
                      {
                        "predicted_class" : "dog",
                        "count" : 7
                      },
                      {
                        "predicted_class" : "cat",
                        "count" : 4
                      }
                    ],
                    "other_predicted_class_doc_count" : 0
                  }
                ],
                "other_actual_class_count" : 0
              }
            }
          }
---
"line_517":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_ml/data_frame/_evaluate"
        body: |
          {
             "index": "animal_classification",
             "evaluation": {
                "classification": {
                   "actual_field": "animal_class",
                   "metrics": {
                      "auc_roc" : {
                        "class_name": "dog"
                      }
                   }
                }
             }
          }
  - is_false: _shards.failures
