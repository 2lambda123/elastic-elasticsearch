---
"line_37":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: needs-licence
  - do:
      raw:
        method: PUT
        path: "_ml/filters/safe_domains"
        body: |
          {
            "description": "Our list of safe domains",
            "items": ["safe.com", "trusted.com"]
          }
  - is_false: _shards.failures
---
"line_50":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: needs-licence
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/dns_exfiltration_with_rule"
        body: |
          {
            "analysis_config" : {
              "bucket_span":"5m",
              "detectors" :[{
                "function":"high_info_content",
                "field_name": "subdomain",
                "over_field_name": "highest_registered_domain",
                "custom_rules": [{
                  "actions": ["skip_result"],
                  "scope": {
                    "highest_registered_domain": {
                      "filter_id": "safe_domains",
                      "filter_type": "include"
                    }
                  }
                }]
              }]
            },
            "data_description" : {
              "time_field":"timestamp"
            }
          }
  - is_false: _shards.failures
---
"line_83":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: setup:ml_filter_safe_domains
  - do:
      raw:
        method: POST
        path: "_ml/filters/safe_domains/_update"
        body: |
          {
            "add_items": ["another-safe.com"]
          }
  - is_false: _shards.failures
---
"line_97":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: needs-licence
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/scoping_multiple_fields"
        body: |
          {
            "analysis_config" : {
              "bucket_span":"5m",
              "detectors" :[{
                "function":"count",
                "partition_field_name": "my_partition",
                "over_field_name": "my_over",
                "by_field_name": "my_by",
                "custom_rules": [{
                  "actions": ["skip_result"],
                  "scope": {
                    "my_partition": {
                      "filter_id": "filter_1"
                    },
                    "my_over": {
                      "filter_id": "filter_2"
                    },
                    "my_by": {
                      "filter_id": "filter_3"
                    }
                  }
                }]
              }]
            },
            "data_description" : {
              "time_field":"timestamp"
            }
          }
  - is_false: _shards.failures
---
"line_146":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: needs-licence
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/cpu_with_rule"
        body: |
          {
            "analysis_config" : {
              "bucket_span":"5m",
              "detectors" :[{
                "function":"high_mean",
                "field_name": "cpu_utilization",
                "custom_rules": [{
                  "actions": ["skip_result"],
                  "conditions": [
                    {
                      "applies_to": "actual",
                      "operator": "lt",
                      "value": 0.20
                    }
                  ]
                }]
              }]
            },
            "data_description" : {
              "time_field":"timestamp"
            }
          }
  - is_false: _shards.failures
---
"line_181":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: needs-licence
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/rule_with_range"
        body: |
          {
            "analysis_config" : {
              "bucket_span":"5m",
              "detectors" :[{
                "function":"count",
                "custom_rules": [{
                  "actions": ["skip_result"],
                  "conditions": [
                    {
                      "applies_to": "actual",
                      "operator": "gt",
                      "value": 30
                    },
                    {
                      "applies_to": "actual",
                      "operator": "lt",
                      "value": 50
                    }
                  ]
                }]
              }]
            },
            "data_description" : {
              "time_field":"timestamp"
            }
          }
  - is_false: _shards.failures
