---
"line_411":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/jwt1_users"
        refresh: "true"
        body: |
          {
            "roles" : [ "user" ],
            "rules" : { "all" : [
                { "field": { "realm.name": "jwt1" } },
                { "field": { "username": "principalname1" } },
                { "field": { "dn": "CN=Principal Name 1,DC=example.com" } },
                { "field": { "groups": "group1" } },
                { "field": { "metadata.jwt_claim_other": "other1" } }
            ] },
            "enabled": true
          }
  - is_false: _shards.failures
---
"line_471":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/native1_users"
        refresh: "true"
        body: |
          {
            "roles" : [ "user" ],
            "rules" : { "all" : [
                { "field": { "realm.name": "native1" } },
                { "field": { "username": "principalname1" } }
            ] },
            "enabled": true
          }
  - is_false: _shards.failures
---
"line_504":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/jwt_role1"
        refresh: "true"
        body: |
          {
            "cluster": ["manage"],
            "indices": [ { "names": [ "*" ], "privileges": ["read"] } ],
            "run_as": [ "user123_runas" ],
            "metadata" : { "version" : 1 }
          }
  - is_false: _shards.failures
---
"line_522":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role_mapping/jwt_user1"
        refresh: "true"
        body: |
          {
            "roles": [ "jwt_role1"],
            "rules" : { "all" : [
                { "field": { "realm.name": "jwt2" } },
                { "field": { "username": "user2" } }
            ] },
            "enabled": true,
            "metadata" : { "version" : 1 }
          }
  - is_false: _shards.failures
---
"line_676":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/jwt8_users"
        refresh: "true"
        body: |
          {
            "roles" : [ "user" ],
            "rules" : { "all" : [
                { "field": { "realm.name": "jwt8" } },
                { "field": { "username": "principalname1" } }
            ] },
            "enabled": true
          }
  - is_false: _shards.failures
