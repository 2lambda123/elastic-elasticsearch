---
"line_50":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        refresh: ""
        body: |
          {
            "text": "quick brown fox",
            "popularity": 1
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        refresh: ""
        body: |
          {
            "text": "quick fox",
            "popularity": 5
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "function_score": {
                "query": {
                  "match": {
                    "text": "quick brown fox"
                  }
                },
                "script_score": {
                  "script": {
                    "lang": "expression",
                    "source": "_score * doc['popularity']"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_94":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        refresh: ""
        body: |
          {
            "cost_price": 100
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "script_fields": {
              "sales_price": {
                "script": {
                  "lang":   "expression",
                  "source": "doc['cost_price'] * markup",
                  "params": {
                    "markup": 0.2
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_171":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "first_name": {
                  "type": "text"
                },
                "last_name": {
                  "type": "text"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        refresh: ""
        body: |
          {
            "first_name": "Barry",
            "last_name": "White"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "script_fields": {
              "full_name": {
                "script": {
                  "lang": "painless",
                  "source": "params._source.first_name + ' ' + params._source.last_name"
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_214":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "full_name": {
                  "type": "text",
                  "store": true
                },
                "title": {
                  "type": "text",
                  "store": true
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        refresh: ""
        body: |
          {
            "full_name": "Alice Ball",
            "title": "Professor"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "script_fields": {
              "name_with_title": {
                "script": {
                  "lang": "painless",
                  "source": "params._fields['title'].value + ' ' + params._fields['full_name'].value"
                }
              }
            }
          }
  - is_false: _shards.failures
