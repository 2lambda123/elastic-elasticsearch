---
"line_152":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "params.count / params.total",
              "params": {
                "count": 100.0,
                "total": 1000.0
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result": "0.1"
        }
---
"line_185":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "field": {
                  "type": "keyword"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "doc['field'].value.length() <= params.max_length",
              "params": {
                "max_length": 4
              }
            },
            "context": "filter",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "field": "four"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result": true
        }
---
"line_236":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "field": {
                  "type": "keyword"
                },
                "rank": {
                  "type": "long"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "doc['rank'].value / params.max_rank",
              "params": {
                "max_rank": 5.0
              }
            },
            "context": "score",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "rank": 4
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result": 0.8
        }
---
"line_305":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "name": {
                  "type": "keyword"
                },
                "author": {
                  "type": "keyword"
                },
                "release_date": {
                  "type": "date"
                },
                "page_count": {
                  "type": "double"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      emit(doc['release_date'].value.year < 1972);\n    "
            },
            "context": "boolean_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "name": "Dune",
                "author": "Frank Herbert",
                "release_date": "1965-06-01",
                "page_count": 604
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            true
          ]
        }
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      int space = doc['author'].value.indexOf(' ');\n      emit(space > 0 && space < 5);\n    "
            },
            "context": "boolean_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "name": "Dune",
                "author": "Frank Herbert",
                "release_date": "1965-06-01",
                "page_count": 604
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            false
          ]
        }
---
"line_417":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "name": {
                  "type": "keyword"
                },
                "author": {
                  "type": "keyword"
                },
                "release_date": {
                  "type": "date"
                },
                "page_count": {
                  "type": "long"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      String author = doc['author'].value;\n      long pageTime = 28800000;\n      if (author == 'Robert A. Heinlein') {\n        pageTime /= 2;\n      } else if (author == 'Alastair Reynolds') {\n        pageTime *= 2;\n      }\n      emit(doc['release_date'].value.toInstant().toEpochMilli() - pageTime * doc['page_count'].value);\n    "
            },
            "context": "date_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "name": "Revelation Space",
                "author": "Alastair Reynolds",
                "release_date": "2000-03-15",
                "page_count": 585
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            "1999-02-19T00:00:00.000Z"
          ]
        }
---
"line_514":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "@timestamp": {
                  "type": "date"
                },
                "model_number": {
                  "type": "keyword"
                },
                "measures": {
                  "properties": {
                    "voltage": {
                      "type": "double"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      if (doc['model_number'].value.equals('QVKC92Q'))\n      {emit(1.7 * params._source['measures']['voltage']);}\n      else{emit(params._source['measures']['voltage']);}\n    "
            },
            "context": "double_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "@timestamp": 1516470094000,
                "model_number": "QVKC92Q",
                "measures": {
                  "voltage": 5.6
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            9.52
          ]
        }
---
"line_590":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/"
        body: |
          {
            "mappings": {
              "properties": {
                "lat": {
                  "type": "double"
                },
                "lon": {
                  "type": "double"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      emit(doc['lat'].value, doc['lon'].value);\n    "
            },
            "context": "geo_point_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "lat": 41.12,
                "lon": -71.34
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            {
              "coordinates" : [
                -71.34,
                41.12
              ],
              "type" : "Point"
            }
          ]
        }
---
"line_662":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/"
        body: |
          {
            "mappings": {
              "properties": {
                "message": {
                  "type": "wildcard"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      String clientip=grok('%{COMMONAPACHELOG}').extract(doc[\"message\"].value)?.clientip;\n      if (clientip != null) emit(clientip);\n    "
            },
            "context": "ip_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "message": "40.135.0.0 - - [30/Apr/2020:14:30:17 -0500] \"GET /images/hm_bg.jpg HTTP/1.0\" 200 24736"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            "40.135.0.0"
          ]
        }
---
"line_726":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "@timestamp": {
                  "type": "date"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      emit(doc['@timestamp'].value.dayOfWeekEnum.getDisplayName(TextStyle.FULL, Locale.ROOT));\n    "
            },
            "context": "keyword_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "@timestamp": "2020-04-30T14:31:43-05:00"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            "Thursday"
          ]
        }
---
"line_784":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/"
        body: |
          {
            "mappings": {
              "properties": {
                "measures": {
                  "properties": {
                    "start": {
                      "type": "long"
                    },
                    "end": {
                     "type": "long"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "\n      emit(doc['measures.end'].value - doc['measures.start'].value);\n    "
            },
            "context": "long_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "measures": {
                  "voltage": "4.0",
                  "start": "400",
                  "end": "8625309"
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : [
            8624909
          ]
        }
---
"line_851":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001/"
        body: |
          {
            "mappings": {
              "properties": {
                "message": {
                  "type" : "keyword"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_scripts/painless/_execute"
        body: |
          {
            "script": {
              "source": "emit(grok(\"%{COMMONAPACHELOG}\").extract(doc[\"message\"].value));"
            },
            "context": "composite_field",
            "context_setup": {
              "index": "my-index-000001",
              "document": {
                "timestamp":"2020-04-30T14:31:27-05:00",
                "message":"252.0.0.0 - - [30/Apr/2020:14:31:27 -0500] \"GET /images/hm_bg.jpg HTTP/1.0\" 200 24736"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "result" : {
            "composite_field.timestamp" : [
              "30/Apr/2020:14:31:27 -0500"
            ],
            "composite_field.auth" : [
              "-"
            ],
            "composite_field.response" : [
              "200"
            ],
            "composite_field.ident" : [
              "-"
            ],
            "composite_field.httpversion" : [
              "1.0"
            ],
            "composite_field.verb" : [
              "GET"
            ],
            "composite_field.bytes" : [
              "24736"
            ],
            "composite_field.clientip" : [
              "252.0.0.0"
            ],
            "composite_field.request" : [
              "/images/hm_bg.jpg"
            ]
          }
        }
