pr: 93396
summary: Add support for Reciprocal Rank Fusion to the search API
area: Ranking
type: feature
issues: []
highlight:
  title: Add support for Reciprocal Rank Fusion (RRF) to the search API
  body: |-
    This change at a high level adds global ranking on the coordinating
    node at the end of query reduction prior to the fetch phase. The
    singular ranking model added in this change is reciprocal rank fusion
    (RRF) which follows the basic formula for merging `1...n` sets of
    results sets together with `sum(1/(k+d))` where `k` is a ranking constant
    and `d` is a document's scored position within a result set from a query.

    The API for this change adds a `rank` top-level element to the search
    endpoint. An example:

    [source,Java]
    ----
    {
      "query": {
        "match": {
          "product": {
            "query": "brown shoes"
          }
        }
      },
      "knn": {
        "field": "product-vector",
        "query_vector": [54, 10, -2],
        "k": 20,
        "num_candidates": 75
      },
      "rank": {
         "rrf": {
            "window_size": 100,
            "rank_constant": 20
         }
      }
    }
    ----

    The above example will execute the search query and the knn search separately for
    It will preserve separate result sets up to the point where the queries are
    ranked on the coordinating node using RRF.

  notable: true
