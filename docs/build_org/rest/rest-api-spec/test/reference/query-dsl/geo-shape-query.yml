---
setup:
  - do:
      raw:
        method: PUT
        path: "example"
        body: |
          {
            "mappings": {
              "properties": {
                "location": {
                  "type": "geo_shape"
                }
              }
            }
          }
  - do:
      raw:
        method: POST
        path: "example/_doc"
        refresh: ""
        body: |
          {
            "name": "Wind & Wetter, Berlin, Germany",
            "location": {
              "type": "point",
              "coordinates": [ 13.400544, 52.530286 ]
            }
          }
---
"line_58":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "example/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_shape": {
                    "location": {
                      "shape": {
                        "type": "envelope",
                        "coordinates": [ [ 13.0, 53.0 ], [ 14.0, 52.0 ] ]
                      },
                      "relation": "within"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "example_points"
        body: |
          {
            "mappings": {
              "properties": {
                "location": {
                  "type": "geo_point"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "example_points/_doc/1"
        refresh: ""
        body: |
          {
            "name": "Wind & Wetter, Berlin, Germany",
            "location": [13.400544, 52.530286]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "example_points/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_shape": {
                    "location": {
                      "shape": {
                        "type": "envelope",
                        "coordinates": [ [ 13.0, 53.0 ], [ 14.0, 52.0 ] ]
                      },
                      "relation": "intersects"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took" : $body.took,
          "timed_out" : false,
          "_shards" : {
            "total" : 1,
            "successful" : 1,
            "skipped" : 0,
            "failed" : 0
          },
          "hits" : {
            "total" : {
              "value" : 1,
              "relation" : "eq"
            },
            "max_score" : 1.0,
            "hits" : [
              {
                "_index" : "example_points",
                "_id" : "1",
                "_score" : 1.0,
                "_source" : {
                  "name": "Wind & Wetter, Berlin, Germany",
                  "location": [13.400544, 52.530286]
                }
              }
            ]
          }
        }
---
"line_189":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "shapes"
        body: |
          {
            "mappings": {
              "properties": {
                "location": {
                  "type": "geo_shape"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "shapes/_doc/deu"
        body: |
          {
            "location": {
              "type": "envelope",
              "coordinates" : [[13.0, 53.0], [14.0, 52.0]]
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "example/_search"
        body: |
          {
            "query": {
              "bool": {
                "filter": {
                  "geo_shape": {
                    "location": {
                      "indexed_shape": {
                        "index": "shapes",
                        "id": "deu",
                        "path": "location"
                      }
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_262":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "test/_doc/1"
        body: |
          {
            "location": [
              {
                "coordinates": [46.25,20.14],
                "type": "point"
              },
              {
                "coordinates": [47.49,19.04],
                "type": "point"
              }
            ]
          }
  - is_false: _shards.failures
---
"line_280":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "test/_doc/1"
        body: |
          {
            "location":
              {
                "coordinates": [[46.25,20.14],[47.49,19.04]],
                "type": "multipoint"
              }
          }
  - is_false: _shards.failures
