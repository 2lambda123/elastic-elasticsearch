---
setup:
  - do:
      raw:
        method: PUT
        path: "my_locations"
        body: |
          {
            "mappings": {
              "properties": {
                "pin": {
                  "properties": {
                    "location": {
                      "type": "geo_point"
                    }
                  }
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "my_locations/_doc/1"
        body: |
          {
            "pin": {
              "location": {
                "lat": 40.12,
                "lon": -71.34
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "my_geoshapes"
        body: |
          {
            "mappings": {
              "properties": {
                "pin": {
                  "properties": {
                    "location": {
                      "type": "geo_shape"
                    }
                  }
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "my_geoshapes/_doc/1"
        body: |
          {
            "pin": {
              "location": {
                "type" : "polygon",
                "coordinates" : [[[13.0 ,51.5], [15.0, 51.5], [15.0, 54.0], [13.0, 54.0], [13.0 ,51.5]]]
              }
            }
          }
---
"line_75":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "200km",
                    "pin.location": {
                      "lat": 40,
                      "lon": -70
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_100":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_geoshapes/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "200km",
                    "pin.location": {
                      "lat": 40,
                      "lon": -70
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_125":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations,my_geoshapes/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "200km",
                    "pin.location": {
                      "lat": 40,
                      "lon": -70
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_158":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "12km",
                    "pin.location": {
                      "lat": 40,
                      "lon": -70
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_187":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "12km",
                    "pin.location": [ -70, 40 ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_213":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "12km",
                    "pin.location": "POINT (-70 40)"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_236":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my_locations/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match_all": {}
                },
                "filter": {
                  "geo_distance": {
                    "distance": "12km",
                    "pin.location": "drm3btev3e86"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
