---
setup:
  - do:
      raw:
        method: PUT
        path: "items"
        body: |
          {
            "mappings": {
              "properties": {
                "name": {
                  "type": "keyword"
                },
                "production_date": {
                  "type": "date"
                },
                "location": {
                  "type": "geo_point"
                }
              }
            }
          }
---
"line_62":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "items/_doc/1"
        refresh: ""
        body: |
          {
            "name" : "chocolate",
            "production_date": "2018-02-01",
            "location": [-71.34, 41.12]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "items/_doc/2"
        refresh: ""
        body: |
          {
            "name" : "chocolate",
            "production_date": "2018-01-01",
            "location": [-71.3, 41.15]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "items/_doc/3"
        refresh: ""
        body: |
          {
            "name" : "chocolate",
            "production_date": "2017-12-01",
            "location": [-71.3, 41.12]
          }
  - is_false: _shards.failures
---
"line_98":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "items/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match": {
                    "name": "chocolate"
                  }
                },
                "should": {
                  "distance_feature": {
                    "field": "production_date",
                    "pivot": "7d",
                    "origin": "now"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_127":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "items/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": {
                  "match": {
                    "name": "chocolate"
                  }
                },
                "should": {
                  "distance_feature": {
                    "field": "location",
                    "pivot": "1000m",
                    "origin": [-71.3, 41.15]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
