---
setup:
  - do:
      raw:
        method: PUT
        path: "example"
        body: |
          {
            "mappings": {
              "properties": {
                "geometry": {
                  "type": "shape"
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "example/_doc/1"
        refresh: "wait_for"
        body: |
          {
            "name": "Lucky Landing",
            "geometry": {
              "type": "point",
              "coordinates": [ 1355.400544, 5255.530286 ]
            }
          }
---
"line_54":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "example/_search"
        body: |
          {
            "query": {
              "shape": {
                "geometry": {
                  "shape": {
                    "type": "envelope",
                    "coordinates": [ [ 1355.0, 5355.0 ], [ 1400.0, 5200.0 ] ]
                  },
                  "relation": "within"
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took": $body.took,
          "timed_out": false,
          "_shards": {
            "total": 1,
            "successful": 1,
            "skipped": 0,
            "failed": 0
          },
          "hits": {
            "total": {
              "value": 1,
              "relation": "eq"
            },
            "max_score": 0.0,
            "hits": [
              {
                "_index": "example",
                "_id": "1",
                "_score": 0.0,
                "_source": {
                  "name": "Lucky Landing",
                  "geometry": {
                    "type": "point",
                    "coordinates": [
                      1355.400544,
                      5255.530286
                    ]
                  }
                }
              }
            ]
          }
        }
---
"line_132":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "shapes"
        body: |
          {
            "mappings": {
              "properties": {
                "geometry": {
                  "type": "shape"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "shapes/_doc/footprint"
        body: |
          {
            "geometry": {
              "type": "envelope",
              "coordinates": [ [ 1355.0, 5355.0 ], [ 1400.0, 5200.0 ] ]
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "example/_search"
        body: |
          {
            "query": {
              "shape": {
                "geometry": {
                  "indexed_shape": {
                    "index": "shapes",
                    "id": "footprint",
                    "path": "geometry"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
