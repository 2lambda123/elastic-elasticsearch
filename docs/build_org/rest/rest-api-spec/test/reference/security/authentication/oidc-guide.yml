---
"line_431":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/oidc-example"
        body: |
          {
            "roles": [ "example_role" ],
            "enabled": true,
            "rules": {
              "field": { "realm.name": "oidc1" }
            }
          }
  - is_false: _shards.failures
---
"line_470":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/oidc-finance"
        body: |
          {
            "roles": [ "finance_data" ],
            "enabled": true,
            "rules": { "all": [
                  { "field": { "realm.name": "oidc1" } },
                  { "field": { "groups": "finance-team" } }
            ] }
          }
  - is_false: _shards.failures
---
"line_610":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/facilitator-role"
        body: |
          {
            "cluster" : ["manage_oidc", "manage_token"]
          }
  - is_false: _shards.failures
---
"line_619":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/user/facilitator"
        body: |
          {
            "password" : "<somePasswordHere>",
            "roles"    : [ "facilitator-role"]
          }
  - is_false: _shards.failures
---
"line_639":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/oidc/prepare"
        body: |
          {
            "realm" : "oidc1"
          }
  - is_false: _shards.failures
---
"line_662":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      catch: unauthorized
      raw:
        method: POST
        path: "_security/oidc/authenticate"
        body: |
          {
            "redirect_uri" : "https://oidc-kibana.elastic.co:5603/api/security/oidc/callback?code=jtI3Ntt8v3_XvcLzCFGq&state=4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I",
            "state" : "4dbrihtIAt3wBTwo6DxK-vdk-sSyDBV8Yf0AjdkdT5I",
            "nonce" : "WaBPH0KqPVdG5HHdSxPRjfoZbXMCicm5v1OiAj0DUFM",
            "realm" : "oidc1"
          }
  - is_false: _shards.failures
---
"line_680":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      catch: request
      raw:
        method: POST
        path: "_security/oidc/logout"
        body: |
          {
            "token" : "dGhpcyBpcyBub3QgYSByZWFsIHRva2VuIGJ1dCBpdCBpcyBvbmx5IHRlc3QgZGF0YS4gZG8gbm90IHRyeSB0byByZWFkIHRva2VuIQ==",
            "refresh_token": "vLBPvmAB6KvwvJZr27cS"
          }
  - is_false: _shards.failures
