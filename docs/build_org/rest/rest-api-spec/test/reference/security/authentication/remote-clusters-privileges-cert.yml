---
"line_46":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/remote-replication"
        body: |
          {
            "cluster": [
              "read_ccr"
            ],
            "indices": [
              {
                "names": [
                  "leader-index-name"
                ],
                "privileges": [
                  "monitor",
                  "read"
                ]
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_security/role/remote-replication"
  - is_false: _shards.failures
---
"line_83":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/remote-replication"
        body: |
          {
            "cluster": [
              "manage_ccr"
            ],
            "indices": [
              {
                "names": [
                  "follower-index-name"
                ],
                "privileges": [
                  "monitor",
                  "read",
                  "write",
                  "manage_follow_index"
                ]
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_security/user/cross-cluster-user"
        body: |
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "remote-replication" ]
          }
  - is_false: _shards.failures
---
"line_149":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/remote-search"
        body: |
          {
            "indices": [
              {
                "names": [
                  "target-indices"
                ],
                "privileges": [
                  "read",
                  "read_cross_cluster"
                ]
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_security/role/remote-search"
  - is_false: _shards.failures
---
"line_184":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/remote-search"
        body: |
          {}
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_security/user/cross-search-user"
        body: |
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "remote-search" ]
          }
  - is_false: _shards.failures
---
"line_244":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/logstash-reader"
        body: |
          {
            "indices": [
              {
                "names": [
                  "logstash-*"
                  ],
                  "privileges": [
                    "read",
                    "view_index_metadata"
                    ]
              }
            ]
          }
  - is_false: _shards.failures
---
"line_268":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/user/cross-cluster-kibana"
        body: |
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [
              "logstash-reader",
              "kibana-access"
              ]
          }
  - is_false: _shards.failures
---
"line_286":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_security/role/logstash-reader"
        body: |
          {
            "indices": [
              {
                "names": [
                  "logstash-*"
                  ],
                  "privileges": [
                    "read_cross_cluster",
                    "read",
                    "view_index_metadata"
                    ]
              }
            ]
          }
  - is_false: _shards.failures
