---
"line_95":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_text_structure/find_structure"
        body: |
          {"name": "Leviathan Wakes", "author": "James S.A. Corey", "release_date": "2011-06-02", "page_count": 561}
          {"name": "Hyperion", "author": "Dan Simmons", "release_date": "1989-05-26", "page_count": 482}
          {"name": "Dune", "author": "Frank Herbert", "release_date": "1965-06-01", "page_count": 604}
          {"name": "Dune Messiah", "author": "Frank Herbert", "release_date": "1969-10-15", "page_count": 331}
          {"name": "Children of Dune", "author": "Frank Herbert", "release_date": "1976-04-21", "page_count": 408}
          {"name": "God Emperor of Dune", "author": "Frank Herbert", "release_date": "1981-05-28", "page_count": 454}
          {"name": "Consider Phlebas", "author": "Iain M. Banks", "release_date": "1987-04-23", "page_count": 471}
          {"name": "Pandora's Star", "author": "Peter F. Hamilton", "release_date": "2004-03-02", "page_count": 768}
          {"name": "Revelation Space", "author": "Alastair Reynolds", "release_date": "2000-03-15", "page_count": 585}
          {"name": "A Fire Upon the Deep", "author": "Vernor Vinge", "release_date": "1992-06-01", "page_count": 613}
          {"name": "Ender's Game", "author": "Orson Scott Card", "release_date": "1985-06-01", "page_count": 324}
          {"name": "1984", "author": "George Orwell", "release_date": "1985-06-01", "page_count": 328}
          {"name": "Fahrenheit 451", "author": "Ray Bradbury", "release_date": "1953-10-15", "page_count": 227}
          {"name": "Brave New World", "author": "Aldous Huxley", "release_date": "1932-06-01", "page_count": 268}
          {"name": "Foundation", "author": "Isaac Asimov", "release_date": "1951-06-01", "page_count": 224}
          {"name": "The Giver", "author": "Lois Lowry", "release_date": "1993-04-26", "page_count": 208}
          {"name": "Slaughterhouse-Five", "author": "Kurt Vonnegut", "release_date": "1969-06-01", "page_count": 275}
          {"name": "The Hitchhiker's Guide to the Galaxy", "author": "Douglas Adams", "release_date": "1979-10-12", "page_count": 180}
          {"name": "Snow Crash", "author": "Neal Stephenson", "release_date": "1992-06-01", "page_count": 470}
          {"name": "Neuromancer", "author": "William Gibson", "release_date": "1984-07-01", "page_count": 271}
          {"name": "The Handmaid's Tale", "author": "Margaret Atwood", "release_date": "1985-06-01", "page_count": 311}
          {"name": "Starship Troopers", "author": "Robert A. Heinlein", "release_date": "1959-12-01", "page_count": 335}
          {"name": "The Left Hand of Darkness", "author": "Ursula K. Le Guin", "release_date": "1969-06-01", "page_count": 304}
          {"name": "The Moon is a Harsh Mistress", "author": "Robert A. Heinlein", "release_date": "1966-04-01", "page_count": 288}
  - is_false: _shards.failures
  - match:
      $body:
        {
          "num_lines_analyzed" : 24,
          "num_messages_analyzed" : 24,
          "sample_start" : "$body.sample_start",
          "charset" : "UTF-8",
          "has_byte_order_marker" : false,
          "format" : "ndjson",
          "ecs_compatibility" : "disabled",
          "timestamp_field" : "release_date",
          "joda_timestamp_formats" : [
            "ISO8601"
          ],
          "java_timestamp_formats" : [
            "ISO8601"
          ],
          "need_client_timezone" : true,
          "mappings" : {
            "properties" : {
              "@timestamp" : {
                "type" : "date"
              },
              "author" : {
                "type" : "keyword"
              },
              "name" : {
                "type" : "keyword"
              },
              "page_count" : {
                "type" : "long"
              },
              "release_date" : {
                "type" : "date",
                "format" : "iso8601"
              }
            }
          },
          "ingest_pipeline" : {
            "description" : "Ingest pipeline created by text structure finder",
            "processors" : [
              {
                "date" : {
                  "field" : "release_date",
                  "timezone" : "{{ event.timezone }}",
                  "formats" : [
                    "ISO8601"
                  ]
                }
              }
            ]
          },
          "field_stats" : {
            "author" : {
              "count" : 24,
              "cardinality" : 20,
              "top_hits" : [
                {
                  "value" : "Frank Herbert",
                  "count" : 4
                },
                {
                  "value" : "Robert A. Heinlein",
                  "count" : 2
                },
                {
                  "value" : "Alastair Reynolds",
                  "count" : 1
                },
                {
                  "value" : "Aldous Huxley",
                  "count" : 1
                },
                {
                  "value" : "Dan Simmons",
                  "count" : 1
                },
                {
                  "value" : "Douglas Adams",
                  "count" : 1
                },
                {
                  "value" : "George Orwell",
                  "count" : 1
                },
                {
                  "value" : "Iain M. Banks",
                  "count" : 1
                },
                {
                  "value" : "Isaac Asimov",
                  "count" : 1
                },
                {
                  "value" : "James S.A. Corey",
                  "count" : 1
                }
              ]
            },
            "name" : {
              "count" : 24,
              "cardinality" : 24,
              "top_hits" : [
                {
                  "value" : "1984",
                  "count" : 1
                },
                {
                  "value" : "A Fire Upon the Deep",
                  "count" : 1
                },
                {
                  "value" : "Brave New World",
                  "count" : 1
                },
                {
                  "value" : "Children of Dune",
                  "count" : 1
                },
                {
                  "value" : "Consider Phlebas",
                  "count" : 1
                },
                {
                  "value" : "Dune",
                  "count" : 1
                },
                {
                  "value" : "Dune Messiah",
                  "count" : 1
                },
                {
                  "value" : "Ender's Game",
                  "count" : 1
                },
                {
                  "value" : "Fahrenheit 451",
                  "count" : 1
                },
                {
                  "value" : "Foundation",
                  "count" : 1
                }
              ]
            },
            "page_count" : {
              "count" : 24,
              "cardinality" : 24,
              "min_value" : 180,
              "max_value" : 768,
              "mean_value" : 387.0833333333333,
              "median_value" : 329.5,
              "top_hits" : [
                {
                  "value" : 180,
                  "count" : 1
                },
                {
                  "value" : 208,
                  "count" : 1
                },
                {
                  "value" : 224,
                  "count" : 1
                },
                {
                  "value" : 227,
                  "count" : 1
                },
                {
                  "value" : 268,
                  "count" : 1
                },
                {
                  "value" : 271,
                  "count" : 1
                },
                {
                  "value" : 275,
                  "count" : 1
                },
                {
                  "value" : 288,
                  "count" : 1
                },
                {
                  "value" : 304,
                  "count" : 1
                },
                {
                  "value" : 311,
                  "count" : 1
                }
              ]
            },
            "release_date" : {
              "count" : 24,
              "cardinality" : 20,
              "earliest" : "1932-06-01",
              "latest" : "2011-06-02",
              "top_hits" : [
                {
                  "value" : "1985-06-01",
                  "count" : 3
                },
                {
                  "value" : "1969-06-01",
                  "count" : 2
                },
                {
                  "value" : "1992-06-01",
                  "count" : 2
                },
                {
                  "value" : "1932-06-01",
                  "count" : 1
                },
                {
                  "value" : "1951-06-01",
                  "count" : 1
                },
                {
                  "value" : "1953-10-15",
                  "count" : 1
                },
                {
                  "value" : "1959-12-01",
                  "count" : 1
                },
                {
                  "value" : "1965-06-01",
                  "count" : 1
                },
                {
                  "value" : "1966-04-01",
                  "count" : 1
                },
                {
                  "value" : "1969-10-15",
                  "count" : 1
                }
              ]
            }
          }
        }
