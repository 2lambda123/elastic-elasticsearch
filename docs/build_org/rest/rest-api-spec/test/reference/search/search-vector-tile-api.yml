---
"line_13":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
        body: |
          {
            "mappings": {
              "properties": {
                "my-geo-field": {
                  "type": "geo_point"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index/_doc/0"
        refresh: ""
        body: |
          {
            "my-geo-field": "POINT (-122.0863176 37.3864953)"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index/_mvt/my-geo-field/15/5271/12710"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
            "size": 10000,
            "query": {
              "geo_bounding_box": {
                "my-geo-field": {
                  "top_left": {
                    "lat": -40.979898069620134,
                    "lon": -45
                  },
                  "bottom_right": {
                    "lat": -66.51326044311186,
                    "lon": 0
                  }
                }
              }
            },
            "aggregations": {
              "grid": {
                "geotile_grid": {
                  "field": "my-geo-field",
                  "precision": 11,
                  "size": 65536,
                  "bounds": {
                    "top_left": {
                      "lat": -40.979898069620134,
                      "lon": -45
                    },
                    "bottom_right": {
                      "lat": -66.51326044311186,
                      "lon": 0
                    }
                  }
                }
              },
              "bounds": {
                "geo_bounds": {
                  "field": "my-geo-field",
                  "wrap_longitude": false
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_666":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "museums"
        body: |
          {
            "mappings": {
              "properties": {
                "location": {
                  "type": "geo_point"
                },
                "name": {
                  "type": "keyword"
                },
                "price": {
                  "type": "long"
                },
                "included": {
                  "type": "boolean"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "museums/_bulk"
        refresh: ""
        body: |
          { "index": { "_id": "1" } }
          { "location": "POINT (4.912350 52.374081)", "name": "NEMO Science Museum",  "price": 1750, "included": true }
          { "index": { "_id": "2" } }
          { "location": "POINT (4.901618 52.369219)", "name": "Museum Het Rembrandthuis", "price": 1500, "included": false }
          { "index": { "_id": "3" } }
          { "location": "POINT (4.914722 52.371667)", "name": "Nederlands Scheepvaartmuseum", "price":1650, "included": true }
          { "index": { "_id": "4" } }
          { "location": "POINT (4.914722 52.371667)", "name": "Amsterdam Centre for Architecture", "price":0, "included": true }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "museums/_mvt/location/13/4207/2692"
        body: |
          {
            "grid_agg": "geotile",
            "grid_precision": 2,
            "fields": [
              "name",
              "price"
            ],
            "query": {
              "term": {
                "included": true
              }
            },
            "aggs": {
              "min_price": {
                "min": {
                  "field": "price"
                }
              },
              "max_price": {
                "max": {
                  "field": "price"
                }
              },
              "avg_price": {
                "avg": {
                  "field": "price"
                }
              }
            }
          }
  - is_false: _shards.failures
