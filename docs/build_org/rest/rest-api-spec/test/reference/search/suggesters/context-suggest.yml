---
setup:
  - do:
      raw:
        method: PUT
        path: "place"
        body: |
          {
            "mappings": {
              "properties": {
                "suggest": {
                  "type": "completion",
                  "contexts": [
                    {
                      "name": "place_type",
                      "type": "category"
                    },
                    {
                      "name": "location",
                      "type": "geo",
                      "precision": 4
                    }
                  ]
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "place_path_category"
        body: |
          {
            "mappings": {
              "properties": {
                "suggest": {
                  "type": "completion",
                  "contexts": [
                    {
                      "name": "place_type",
                      "type": "category",
                      "path": "cat"
                    },
                    {
                      "name": "location",
                      "type": "geo",
                      "precision": 4,
                      "path": "loc"
                    }
                  ]
                },
                "loc": {
                  "type": "geo_point"
                }
              }
            }
          }
---
"line_100":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "place/_doc/1"
        body: |
          {
            "suggest": {
              "input": [ "timmy's", "starbucks", "dunkin donuts" ],
              "contexts": {
                "place_type": [ "cafe", "food" ]
              }
            }
          }
  - is_false: _shards.failures
---
"line_118":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "place_path_category/_doc/1"
        body: |
          {
            "suggest": ["timmy's", "starbucks", "dunkin donuts"],
            "cat": ["cafe", "food"]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "place/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "place_suggestion": {
                "prefix": "tim",
                "completion": {
                  "field": "suggest",
                  "size": 10,
                  "contexts": {
                    "place_type": [ "cafe", "restaurants" ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "place/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "place_suggestion": {
                "prefix": "tim",
                "completion": {
                  "field": "suggest",
                  "size": 10,
                  "contexts": {
                    "place_type": [
                      { "context": "cafe" },
                      { "context": "restaurants", "boost": 2 }
                    ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_253":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "place/_doc/1"
        body: |
          {
            "suggest": {
              "input": "timmy's",
              "contexts": {
                "location": [
                  {
                    "lat": 43.6624803,
                    "lon": -79.3863353
                  },
                  {
                    "lat": 43.6624718,
                    "lon": -79.3873227
                  }
                ]
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "place/_search"
        body: |
          {
            "suggest": {
              "place_suggestion": {
                "prefix": "tim",
                "completion": {
                  "field": "suggest",
                  "size": 10,
                  "contexts": {
                    "location": {
                      "lat": 43.662,
                      "lon": -79.380
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "place/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "place_suggestion": {
                "prefix": "tim",
                "completion": {
                  "field": "suggest",
                  "size": 10,
                  "contexts": {
                    "location": [
                                {
                        "lat": 43.6624803,
                        "lon": -79.3863353,
                        "precision": 2
                      },
                      {
                        "context": {
                          "lat": 43.6624803,
                          "lon": -79.3863353
                        },
                        "boost": 2
                      }
                    ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
