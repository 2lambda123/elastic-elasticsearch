---
setup:
  - do:
      raw:
        method: PUT
        path: "music"
        body: |
          {
            "mappings": {
              "properties": {
                "suggest": {
                  "type": "completion"
                }
              }
            }
          }
---
"line_47":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "music/_doc/1"
        refresh: ""
        body: |
          {
            "suggest" : {
              "input": [ "Nevermind", "Nirvana" ],
              "weight" : 34
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "music/_doc/1"
        refresh: ""
        body: |
          {
            "suggest": [
              {
                "input": "Nevermind",
                "weight": 10
              },
              {
                "input": "Nirvana",
                "weight": 3
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "music/_doc/1"
        refresh: ""
        body: |
          {
            "suggest" : [ "Nevermind", "Nirvana" ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "music/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "song-suggest": {
                "prefix": "nir",
                "completion": {
                    "field": "suggest"
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_shards" : {
            "total" : 1,
            "successful" : 1,
            "skipped" : 0,
            "failed" : 0
          },
          "hits": "$body.hits",
          "took": "$body.took",
          "timed_out": false,
          "suggest": {
            "song-suggest" : [ {
              "text" : "nir",
              "offset" : 0,
              "length" : 3,
              "options" : [ {
                "text" : "Nirvana",
                "_index": "music",
                "_id": "1",
                "_score": 1.0,
                "_source": {
                  "suggest": ["Nevermind", "Nirvana"]
                }
              } ]
            } ]
          }
        }
  - do:
      raw:
        method: POST
        path: "music/_search"
        body: |
          {
            "_source": "suggest",
            "suggest": {
              "song-suggest": {
                "prefix": "nir",
                "completion": {
                  "field": "suggest",
                  "size": 5
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took": $body.took,
          "timed_out": false,
          "_shards": {
            "total": 1,
            "successful": 1,
            "skipped": 0,
            "failed": 0
          },
          "hits": {
            "total": {
              "value": 0,
              "relation": "eq"
            },
            "max_score": null,
            "hits": []
          },
          "suggest": {
            "song-suggest": [ {
                "text": "nir",
                "offset": 0,
                "length": 3,
                "options": [ {
                    "text": "Nirvana",
                    "_index": "music",
                    "_id": "1",
                    "_score": 1.0,
                    "_source": {
                      "suggest": [ "Nevermind", "Nirvana" ]
                    }
                  } ]
              } ]
          }
        }
---
"line_279":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "music/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "song-suggest": {
                "prefix": "nor",
                "completion": {
                  "field": "suggest",
                  "skip_duplicates": true
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_304":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "music/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "song-suggest": {
                "prefix": "nor",
                "completion": {
                  "field": "suggest",
                  "fuzzy": {
                    "fuzziness": 2
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_362":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "music/_search"
        pretty: ""
        body: |
          {
            "suggest": {
              "song-suggest": {
                "regex": "n[ever|i]r",
                "completion": {
                  "field": "suggest"
                }
              }
            }
          }
  - is_false: _shards.failures
