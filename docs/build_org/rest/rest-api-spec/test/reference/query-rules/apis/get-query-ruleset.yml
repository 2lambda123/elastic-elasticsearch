---
setup:
  - do:
      raw:
        method: PUT
        path: "_query_rules/my-ruleset"
        body: |
          {
              "rules": [
                  {
                      "rule_id": "my-rule1",
                      "type": "pinned",
                      "criteria": [
                          {
                              "type": "contains",
                              "metadata": "query_string",
                              "values": [ "pugs", "puggles" ]
                          }
                      ],
                      "actions": {
                          "ids": [
                              "id1",
                              "id2"
                          ]
                      }
                  },
                  {
                      "rule_id": "my-rule2",
                      "type": "pinned",
                      "criteria": [
                          {
                              "type": "fuzzy",
                              "metadata": "query_string",
                              "values": [ "rescue dogs" ]
                          }
                      ],
                      "actions": {
                          "docs": [
                              {
                                  "_index": "index1",
                                  "_id": "id3"
                              },
                              {
                                  "_index": "index2",
                                  "_id": "id4"
                              }
                          ]
                      }
                  }
              ]
          }
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_query_rules/my-ruleset"
---
"line_104":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_query_rules/my-ruleset/"
  - is_false: _shards.failures
  - match:
      $body:
        {
            "ruleset_id": "my-ruleset",
            "rules": [
                {
                    "rule_id": "my-rule1",
                    "type": "pinned",
                    "criteria": [
                        {
                            "type": "contains",
                            "metadata": "query_string",
                            "values": [ "pugs", "puggles" ]
                        }
                    ],
                    "actions": {
                        "ids": [
                            "id1",
                            "id2"
                        ]
                    }
                },
                {
                    "rule_id": "my-rule2",
                    "type": "pinned",
                    "criteria": [
                        {
                            "type": "fuzzy",
                            "metadata": "query_string",
                            "values": [ "rescue dogs" ]
                        }
                    ],
                    "actions": {
                        "docs": [
                            {
                                "_index": "index1",
                                "_id": "id3"
                            },
                            {
                                "_index": "index2",
                                "_id": "id4"
                            }
                        ]
                    }
                }
            ]
        }
