---
"line_31":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/user_agent"
        body: |
          {
            "description" : "Add user agent information",
            "processors" : [
              {
                "user_agent" : {
                  "field" : "agent"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/my_id"
        pipeline: "user_agent"
        body: |
          {
            "agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_doc/my_id"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "found": true,
          "_index": "my-index-000001",
          "_id": "my_id",
          "_version": 1,
          "_seq_no" : $body._seq_no,
          "_primary_term" : $body._primary_term,
          "_source": {
            "agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36",
            "user_agent": {
              "name": "Chrome",
              "original": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36",
              "version": "51.0.2704.103",
              "os": {
                "name": "Mac OS X",
                "version": "10.10.5",
                "full": "Mac OS X 10.10.5"
              },
              "device" : {
                "name" : "Mac"
              }
            }
          }
        }
