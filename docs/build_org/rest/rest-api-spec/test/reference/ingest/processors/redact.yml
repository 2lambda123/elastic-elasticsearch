---
"line_51":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ingest/pipeline/_simulate"
        body: |
          {
            "pipeline": {
              "description" : "Hide my IP",
              "processors": [
                {
                  "redact": {
                    "field": "message",
                    "patterns": ["%{IP:client}"]
                  }
                }
              ]
            },
            "docs":[
              {
                "_source": {
                  "message": "55.3.244.1 GET /index.html 15824 0.043"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "docs": [
            {
              "doc": {
                "_index": "_index",
                "_id": "_id",
                "_version": "-3",
                "_source": {
                  "message": "<client> GET /index.html 15824 0.043"
                },
                "_ingest": {
                  "timestamp": "$body.docs.0.doc._ingest.timestamp"
                }
              }
            }
          ]
        }
---
"line_108":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ingest/pipeline/_simulate"
        body: |
          {
            "pipeline": {
              "description": "Hide my IP",
              "processors": [
                {
                  "redact": {
                    "field": "message",
                    "patterns": [
                      "%{IP:REDACTED}",
                      "%{EMAILADDRESS:REDACTED}"
                    ],
                    "prefix": "*",
                    "suffix": "*"
                  }
                }
              ]
            },
            "docs": [
              {
                "_source": {
                  "message": "55.3.244.1 GET /index.html 15824 0.043 test@elastic.co"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "docs": [
            {
              "doc": {
                "_index": "_index",
                "_id": "_id",
                "_version": "-3",
                "_source": {
                  "message": "*REDACTED* GET /index.html 15824 0.043 *REDACTED*"
                },
                "_ingest": {
                  "timestamp": "$body.docs.0.doc._ingest.timestamp"
                }
              }
            }
          ]
        }
---
"line_180":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_ingest/pipeline/_simulate"
        body: |
          {
            "pipeline": {
              "processors": [
                {
                  "redact": {
                    "field": "message",
                    "patterns": [
                      "%{GITHUB_NAME:GITHUB_NAME}"
                    ],
                    "pattern_definitions": {
                      "GITHUB_NAME": "@%{USERNAME}"
                    }
                  }
                }
              ]
            },
            "docs": [
              {
                "_source": {
                  "message": "@elastic-data-management the PR is ready for review"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "docs": [
            {
              "doc": {
                "_index": "_index",
                "_id": "_id",
                "_version": "-3",
                "_source": {
                  "message": "<GITHUB_NAME> the PR is ready for review"
                },
                "_ingest": {
                  "timestamp": "$body.docs.0.doc._ingest.timestamp"
                }
              }
            }
          ]
        }
