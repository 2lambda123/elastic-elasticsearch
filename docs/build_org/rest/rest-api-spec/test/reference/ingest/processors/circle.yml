---
"line_27":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "circles"
        body: |
          {
            "mappings": {
              "properties": {
                "circle": {
                  "type": "geo_shape"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/polygonize_circles"
        body: |
          {
            "description": "translate circle to polygon",
            "processors": [
              {
                "circle": {
                  "field": "circle",
                  "error_distance": 28.0,
                  "shape_type": "geo_shape"
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "circles/_doc/1"
        pipeline: "polygonize_circles"
        body: |
          {
            "circle": "CIRCLE (30 10 40)"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "circles/_doc/1"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "found": true,
          "_index": "circles",
          "_id": "1",
          "_version": 1,
          "_seq_no" : $body._seq_no,
          "_primary_term" : $body._primary_term,
          "_source": {
            "circle": "POLYGON ((30.000365257263184 10.0, 30.000111397193788 10.00034284530941, 29.999706043744222 10.000213571721195, 29.999706043744222 9.999786428278805, 30.000111397193788 9.99965715469059, 30.000365257263184 10.0))"
          }
        }
  - do:
      raw:
        method: PUT
        path: "circles/_doc/2"
        pipeline: "polygonize_circles"
        body: |
          {
            "circle": {
              "type": "circle",
              "radius": "40m",
              "coordinates": [30, 10]
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "circles/_doc/2"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "found": true,
          "_index": "circles",
          "_id": "2",
          "_version": 1,
          "_seq_no" : $body._seq_no,
          "_primary_term" : $body._primary_term,
          "_source": {
            "circle": {
              "coordinates": [
                [
                  [30.000365257263184, 10.0],
                  [30.000111397193788, 10.00034284530941],
                  [29.999706043744222, 10.000213571721195],
                  [29.999706043744222, 9.999786428278805],
                  [30.000111397193788, 9.99965715469059],
                  [30.000365257263184, 10.0]
                ]
              ],
              "type": "Polygon"
            }
          }
        }
