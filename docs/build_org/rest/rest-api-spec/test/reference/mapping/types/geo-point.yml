---
"line_28":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "location": {
                  "type": "geo_point"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        body: |
          {
            "text": "Geopoint as an object using GeoJSON format",
            "location": {
              "type": "Point",
              "coordinates": [-71.34, 41.12]
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        body: |
          {
            "text": "Geopoint as a WKT POINT primitive",
            "location" : "POINT (-71.34 41.12)"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/3"
        body: |
          {
            "text": "Geopoint as an object with 'lat' and 'lon' keys",
            "location": {
              "lat": 41.12,
              "lon": -71.34
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/4"
        body: |
          {
            "text": "Geopoint as an array",
            "location": [ -71.34, 41.12 ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/5"
        body: |
          {
            "text": "Geopoint as a string",
            "location": "41.12,-71.34"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/6"
        body: |
          {
            "text": "Geopoint as a geohash",
            "location": "drm3btev3e86"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "geo_bounding_box": {
                "location": {
                  "top_left": {
                    "lat": 42,
                    "lon": -72
                  },
                  "bottom_right": {
                    "lat": 40,
                    "lon": -74
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"synthetic-source-geo-point-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "idx"
        body: |
          {
            "mappings": {
              "_source": { "mode": "synthetic" },
              "properties": {
                "point": { "type": "geo_point" }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "idx/_doc/1"
        body: |
          {
            "point": [
              {"lat":-90, "lon":-80},
              {"lat":10, "lon":30}
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "idx/_doc/1"
        filter_path: "_source"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "idx/_doc/1"
        filter_path: "_source"
  - is_false: _shards.failures
  - match:
      $body:
        {"_source":{
          "point": [
            {"lat":-90.0, "lon":-80.00000000931323},
            {"lat":9.999999990686774, "lon":29.999999972060323}
           ]
        }}
