---
"line_31":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "phonetic_sample"
        body: |
          {
            "settings": {
              "index": {
                "analysis": {
                  "analyzer": {
                    "my_analyzer": {
                      "tokenizer": "standard",
                      "filter": [
                        "lowercase",
                        "my_metaphone"
                      ]
                    }
                  },
                  "filter": {
                    "my_metaphone": {
                      "type": "phonetic",
                      "encoder": "metaphone",
                      "replace": false
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "phonetic_sample/_analyze"
        body: |
          {
            "analyzer": "my_analyzer",
            "text": "Joe Bloggs"
          }
  - is_false: _shards.failures
