---
"line_20":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "hockey/_doc/1"
        refresh: ""
        body: |
          {"first":"johnny","last":"gaudreau","goals":[9,27,1],"assists":[17,46,0],"gp":[26,82,1]}
  - is_false: _shards.failures
  - do:
      catch: /painless_explain_error/
      raw:
        method: POST
        path: "hockey/_explain/1"
        error_trace: "false"
        body: |
          {
            "query": {
              "script": {
                "script": "Debug.explain(doc.goals)"
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
           "error": {
              "type": "script_exception",
              "to_string": "[1, 9, 27]",
              "painless_class": "org.elasticsearch.index.fielddata.ScriptDocValues.Longs",
              "java_class": "org.elasticsearch.index.fielddata.ScriptDocValues$Longs",
              "script_stack": $body.error.script_stack, "script": $body.error.script, "lang": $body.error.lang, "position": $body.error.position, "caused_by": $body.error.caused_by, "root_cause": $body.error.root_cause, "reason": $body.error.reason
           },
           "status": 400
        }
  - do:
      catch: /painless_explain_error/
      raw:
        method: POST
        path: "hockey/_update/1"
        error_trace: "false"
        body: |
          {
            "script": "Debug.explain(ctx._source)"
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "error" : {
            "root_cause": $body.error.root_cause,
            "type": "illegal_argument_exception",
            "reason": "failed to execute script",
            "caused_by": {
              "type": "script_exception",
              "to_string": $body.error.caused_by.to_string,
              "painless_class": "java.util.LinkedHashMap",
              "java_class": "java.util.LinkedHashMap",
              "script_stack": $body.error.caused_by.script_stack, "script": $body.error.caused_by.script, "lang": $body.error.caused_by.lang, "position": $body.error.caused_by.position, "caused_by": $body.error.caused_by.caused_by, "reason": $body.error.caused_by.reason
            }
          },
          "status": 400
        }
