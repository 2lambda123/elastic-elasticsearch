---
"line_223":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "datetime": {
                  "type": "date",
                  "format": "yyyy/MM/dd HH:mm:ss||yyyy/MM/dd||epoch_millis"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_mapping"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "my-index-000001" : {
            "mappings" : {
              "properties" : {
                 "datetime": {
                   "type": "date",
                   "format": "yyyy/MM/dd HH:mm:ss||yyyy/MM/dd||epoch_millis"
                 }
              }
            }
          }
        }
  - do:
      raw:
        method: PUT
        path: "my-index-000002"
        body: |
          {
            "mappings": {
              "properties": {
                "datetime": {
                  "type": "date",
                  "format": "uuuu/MM/dd HH:mm:ss||uuuu/MM/dd||epoch_millis"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_reindex"
        body: |
          {
            "source": {
              "index": "my-index-000001"
            },
            "dest": {
              "index": "my-index-000002"
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "_aliases"
        body: |
          {
            "actions" : [
              { "remove" : { "index" : "my-index-000001", "alias" : "my-index" } },
              { "add" : { "index" : "my-index-000002", "alias" : "my-index" } }
            ]
          }
  - is_false: _shards.failures
