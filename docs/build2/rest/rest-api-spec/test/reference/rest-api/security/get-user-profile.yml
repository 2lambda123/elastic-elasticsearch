---
"line_63":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup user_profiles

  - do:
      security.put_user:
        username: "jacknich"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin", "other_role1" ],
            "full_name" : "Jack Nicholson",
            "email" : "jacknich@example.com"
          }
  - do:
      security.put_user:
        username: "jackrea"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "admin" ],
            "full_name" : "Jack Reacher",
            "email" : "jackrea@example.com"
          }
  - do:
      security.put_user:
        username: "jackspa"
        body:  >
          {
            "password" : "l0ng-r4nd0m-p@ssw0rd",
            "roles" : [ "user" ],
            "full_name" : "Jack Sparrow",
            "email" : "jackspa@example.com"
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jacknich",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jackrea",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }
  - do:
      security.activate_user_profile:
        body: >
          {
            "grant_type": "password",
            "username": "jackspa",
            "password" : "l0ng-r4nd0m-p@ssw0rd"
          }
  # jacknich
  - do:
      security.update_user_profile_data:
        uid: "u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0"
        body: >
          {
            "labels": {
              "direction": "north"
            },
            "data": {
              "app1": {
                "key1": "value1"
              }
            }
          }
  # jackrea
  - do:
      security.update_user_profile_data:
        uid: "u_P_0BMHgaOK3p7k-PFWUCbw9dQ-UFjt01oWJ_Dp2PmPc_0"
        body: >
          {
            "labels": {
              "direction": "west"
            }
          }
  # jackspa
  - do:
      security.update_user_profile_data:
        uid: "u_8RKO7AKfEbSiIHZkZZ2LJy2MUSDPWDr3tMI_CkIGApU_0"
        body: >
          {
            "labels": {
              "direction": "south"
            }
          }

  - do:
      raw:
        method: GET
        path: "_security/profile/u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "profiles": [
            {
              "uid": "u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0",
              "enabled": true,
              "last_synchronized": $body.profiles.0.last_synchronized,
              "user": {
                "username": "jacknich",
                "roles": [
                  "admin", "other_role1"
                ],
                "realm_name": "native",
                "full_name": "Jack Nicholson",
                "email": "jacknich@example.com"
              },
              "labels": {
                "direction": "north"
              },
              "data": {},
              "_doc": {
                "_primary_term": $body.profiles.0._doc._primary_term,
                "_seq_no": $body.profiles.0._doc._seq_no
              }
            }
          ]
        }
  - do:
      raw:
        method: GET
        path: "_security/profile/u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0"
        data: "app1.key1"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "profiles": [
            {
              "uid": "u_79HkWkwmnBH5gqFKwoxggWPjEBOur1zLPXQPEl1VBW0_0",
              "enabled": true,
              "last_synchronized": $body.profiles.0.last_synchronized,
              "user": {
                "username": "jacknich",
                "roles": [
                  "admin", "other_role1"
                ],
                "realm_name": "native",
                "full_name": "Jack Nicholson",
                "email": "jacknich@example.com"
              },
              "labels": {
                "direction": "north"
              },
              "data": {
                "app1": {
                  "key1": "value1"
                }
              },
              "_doc": {
                "_primary_term": $body.profiles.0._doc._primary_term,
                "_seq_no": $body.profiles.0._doc._seq_no
              }
            }
          ]
        }
