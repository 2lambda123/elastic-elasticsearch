---
"line_47":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_analyze"
        body: |
          {
            "tokenizer": "whitespace",
            "filter": ["delimited_payload"],
            "text": "the|0 brown|10 fox|5 is|0 quick|10"
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "tokens": [
            {
              "token": "the",
              "start_offset": 0,
              "end_offset": 5,
              "type": "word",
              "position": 0
            },
            {
              "token": "brown",
              "start_offset": 6,
              "end_offset": 14,
              "type": "word",
              "position": 1
            },
            {
              "token": "fox",
              "start_offset": 15,
              "end_offset": 20,
              "type": "word",
              "position": 2
            },
            {
              "token": "is",
              "start_offset": 21,
              "end_offset": 25,
              "type": "word",
              "position": 3
            },
            {
              "token": "quick",
              "start_offset": 26,
              "end_offset": 34,
              "type": "word",
              "position": 4
            }
          ]
        }
---
"line_120":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "delimited_payload"
        body: |
          {
            "settings": {
              "analysis": {
                "analyzer": {
                  "whitespace_delimited_payload": {
                    "tokenizer": "whitespace",
                    "filter": [ "delimited_payload" ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_173":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "delimited_payload_example"
        body: |
          {
            "settings": {
              "analysis": {
                "analyzer": {
                  "whitespace_plus_delimited": {
                    "tokenizer": "whitespace",
                    "filter": [ "plus_delimited" ]
                  }
                },
                "filter": {
                  "plus_delimited": {
                    "type": "delimited_payload",
                    "delimiter": "+",
                    "encoding": "int"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_206":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "text_payloads"
        body: |
          {
            "mappings": {
              "properties": {
                "text": {
                  "type": "text",
                  "term_vector": "with_positions_payloads",
                  "analyzer": "payload_delimiter"
                }
              }
            },
            "settings": {
              "analysis": {
                "analyzer": {
                  "payload_delimiter": {
                    "tokenizer": "whitespace",
                    "filter": [ "delimited_payload" ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "text_payloads/_doc/1"
        body: |
          {
            "text": "the|0 brown|3 fox|4 is|0 quick|10"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "text_payloads/_termvectors/1"
        body: |
          {
            "fields": [ "text" ],
            "payloads": true
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_index": "text_payloads",
          "_id": "1",
          "_version": 1,
          "found": true,
          "took": "$body.took",
          "term_vectors": {
            "text": {
              "field_statistics": {
                "sum_doc_freq": 5,
                "doc_count": 1,
                "sum_ttf": 5
              },
              "terms": {
                "brown": {
                  "term_freq": 1,
                  "tokens": [
                    {
                      "position": 1,
                      "payload": "QEAAAA=="
                    }
                  ]
                },
                "fox": {
                  "term_freq": 1,
                  "tokens": [
                    {
                      "position": 2,
                      "payload": "QIAAAA=="
                    }
                  ]
                },
                "is": {
                  "term_freq": 1,
                  "tokens": [
                    {
                      "position": 3,
                      "payload": "AAAAAA=="
                    }
                  ]
                },
                "quick": {
                  "term_freq": 1,
                  "tokens": [
                    {
                      "position": 4,
                      "payload": "QSAAAA=="
                    }
                  ]
                },
                "the": {
                  "term_freq": 1,
                  "tokens": [
                    {
                      "position": 0,
                      "payload": "AAAAAA=="
                    }
                  ]
                }
              }
            }
          }
        }
