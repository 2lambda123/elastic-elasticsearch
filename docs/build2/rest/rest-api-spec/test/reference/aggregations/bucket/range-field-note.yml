---
setup:
  - do:
      raw:
        method: PUT
        path: "range_index"
        body: |
          {
            "settings": {
              "number_of_shards": 2
            },
            "mappings": {
              "properties": {
                "expected_attendees": {
                  "type": "integer_range"
                },
                "time_frame": {
                  "type": "date_range",
                  "format": "yyyy-MM-dd||epoch_millis"
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "range_index/_doc/1"
        refresh: ""
        body: |
          {
            "expected_attendees" : {
              "gte" : 10,
              "lte" : 20
            },
            "time_frame" : {
              "gte" : "2019-10-28",
              "lte" : "2019-11-04"
            }
          }
---
"range-field-aggregation-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "range_index/_search"
        size: "0"
        body: |
          {
            "aggs": {
              "range_histo": {
                "histogram": {
                  "field": "expected_attendees",
                  "interval": 5
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took": $body.took,"timed_out": false,"_shards": $body._shards,"hits": $body.hits,
          "aggregations" : {
            "range_histo" : {
              "buckets" : [
                {
                  "key" : 10.0,
                  "doc_count" : 1
                },
                {
                  "key" : 15.0,
                  "doc_count" : 1
                },
                {
                  "key" : 20.0,
                  "doc_count" : 1
                }
              ]
            }
          }
        }
---
"range-field-aggregation-query-bounds-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "range_index/_search"
        size: "0"
        body: |
          {
            "query": {
              "range": {
                "time_frame": {
                  "gte": "2019-11-01",
                  "format": "yyyy-MM-dd"
                }
              }
            },
            "aggs": {
              "november_data": {
                "date_histogram": {
                  "field": "time_frame",
                  "calendar_interval": "day",
                  "format": "yyyy-MM-dd"
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took": $body.took,"timed_out": false,"_shards": $body._shards,"hits": $body.hits,
          "aggregations" : {
            "november_data" : {
              "buckets" : [
                      {
                  "key_as_string" : "2019-10-28",
                  "key" : 1572220800000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-10-29",
                  "key" : 1572307200000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-10-30",
                  "key" : 1572393600000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-10-31",
                  "key" : 1572480000000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-11-01",
                  "key" : 1572566400000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-11-02",
                  "key" : 1572652800000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-11-03",
                  "key" : 1572739200000,
                  "doc_count" : 1
                },
                {
                  "key_as_string" : "2019-11-04",
                  "key" : 1572825600000,
                  "doc_count" : 1
                }
              ]
            }
          }
        }
