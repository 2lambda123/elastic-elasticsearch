---
"line_18":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-time-series-index"
        body: |
          {
              "settings": {
                  "index": {
                      "mode": "time_series",
                      "time_series": {
                          "start_time": "2022-06-10T00:00:00Z",
                          "end_time": "2022-06-30T23:59:59Z"
                      },
                      "routing_path": [
                          "test.namespace"
                      ],
                      "number_of_replicas": 0,
                      "number_of_shards": 2
                  }
              },
              "mappings": {
                  "properties": {
                      "@timestamp": {
                          "type": "date"
                      },
                      "metric": {
                          "type": "long",
                          "time_series_metric": "gauge"
                      },
                      "dimension": {
                          "type": "keyword",
                          "time_series_dimension": true
                      }
                  }
              }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-time-series-index/_block/write"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-time-series-index/_downsample/my-downsampled-time-series-index"
        body: |
          {
              "fixed_interval": "1d"
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "my-time-series-index*"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_data_stream/*"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_index_template/*"
  - is_false: _shards.failures
