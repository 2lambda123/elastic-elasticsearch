---
setup:
  - do:
      raw:
        method: PUT
        path: "_index_template/template"
        body: |
          {
            "index_patterns": ["my-data-stream*"],
            "data_stream": { }
          }
  - do:
      raw:
        method: PUT
        path: "my-data-stream/_bulk"
        refresh: ""
        body: |
          {"create":{ }}
          { "@timestamp": "2020-12-08T11:04:05.000Z" }
          {"create":{ }}
          { "@timestamp": "2020-12-08T11:06:07.000Z" }
          {"create":{ }}
          { "@timestamp": "2020-12-09T11:07:08.000Z" }
  - do:
      raw:
        method: POST
        path: "my-data-stream/_rollover/"
  - do:
      raw:
        method: POST
        path: "my-data-stream/_rollover/"
  - do:
      raw:
        method: PUT
        path: "my-data-stream-two/_bulk"
        refresh: ""
        body: |
          {"create":{ }}
          { "@timestamp": "2020-12-08T11:04:05.000Z" }
          {"create":{ }}
          { "@timestamp": "2020-12-08T11:06:07.000Z" }
  - do:
      raw:
        method: POST
        path: "my-data-stream-two/_rollover/"
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_data_stream/my-data-stream*"
  - do:
      raw:
        method: DELETE
        path: "_index_template/template"
---
"line_51":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_data_stream/my-data-stream/_stats"
  - is_false: _shards.failures
---
"line_176":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_data_stream/my-data-stream*/_stats"
        human: "true"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "_shards": {
            "total": 10,
            "successful": 5,
            "failed": 0
          },
          "data_stream_count": 2,
          "backing_indices": 5,
          "total_store_size": $body.total_store_size,
          "total_store_size_bytes": $body.total_store_size_bytes,
          "data_streams": [
            {
              "data_stream": "my-data-stream",
              "backing_indices": 3,
              "store_size": $body.data_streams.0.store_size,
              "store_size_bytes": $body.data_streams.0.store_size_bytes,
              "maximum_timestamp": 1607512028000
            },
            {
              "data_stream": "my-data-stream-two",
              "backing_indices": 2,
              "store_size": $body.data_streams.1.store_size,
              "store_size_bytes": $body.data_streams.1.store_size_bytes,
              "maximum_timestamp": 1607425567000
            }
          ]
        }
