---
setup:
  - do:
      raw:
        method: PUT
        path: "foo_closed"
  - do:
      raw:
        method: POST
        path: "foo_closed/_close"
  - do:
      raw:
        method: PUT
        path: "remotecluster-bar-01"
  - do:
      raw:
        method: PUT
        path: "freeze-index"
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
  - do:
      raw:
        method: PUT
        path: "freeze-index/_alias/f-alias"
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_alias/f-alias"
  - do:
      raw:
        method: PUT
        path: "_index_template/foo_data_stream"
        body: |
          {
            "index_patterns": [ "foo" ],
            "data_stream": { }
          }
  - do:
      raw:
        method: PUT
        path: "_data_stream/foo"
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_data_stream/*"
  - do:
      raw:
        method: DELETE
        path: "_index_template/foo_data_stream"
---
"line_47":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: unable to ignore deprecation warning
  - do:
      raw:
        method: GET
        path: "_resolve/index/my-index-*"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "_resolve/index/f*,remotecluster-bar*"
        expand_wildcards: "all"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "indices": [
            {
              "name": "foo_closed",
              "attributes": [
                "closed"
              ]
            },
            {
              "name": "freeze-index",
              "aliases": [
                "f-alias"
              ],
              "attributes": [
                "open"
              ]
            },
            {
              "name": "remotecluster-bar-01",
              "attributes": [
                "open"
              ]
            }
          ],
          "aliases": [
            {
              "name": "f-alias",
              "indices": [
                "freeze-index",
                "my-index-000001"
              ]
            }
          ],
          "data_streams": [
            {
              "name": "foo",
              "backing_indices": [
                "$body.data_streams.0.backing_indices.0"
              ],
              "timestamp_field": "@timestamp"
            }
          ]
        }
