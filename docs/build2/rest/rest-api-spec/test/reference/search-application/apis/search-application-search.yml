---
setup:
  - do:
      raw:
        method: PUT
        path: "index1"
  - do:
      raw:
        method: PUT
        path: "index1/_doc/1"
        refresh: "true"
        body: |
          {
            "title": "Sample document",
            "description": "A sample document that matches my first query"
          }
  - do:
      raw:
        method: PUT
        path: "_application/search_application/my-app"
        body: |
          {
            "indices": ["index1"],
            "template": {
              "script": {
                "lang": "mustache",
                "source": "\n      {\n        \"query\": {\n          \"multi_match\": {\n            \"query\": \"{{query_string}}\",\n            \"fields\": [{{#text_fields}}\"{{name}}^{{boost}}\",{{/text_fields}}]\n          }\n        },\n        \"explain\": \"{{explain}}\",\n        \"from\": \"{{from}}\",\n        \"size\": \"{{size}}\"\n      }\n      ",
                "params": {
                  "query_string": "*",
                  "text_fields": [
                    {"name": "title", "boost": 10},
                    {"name": "description", "boost": 5}
                  ],
                  "explain": false,
                  "from": 0,
                  "size": 10
                }
              }
            }
          }
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_application/search_application/my-app"
  - do:
      raw:
        method: DELETE
        path: "index1"
---
"line_120":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_application/search_application/my-app/_search"
        body: |
          {
            "params": {
              "query_string": "my first query",
              "text_fields": [
                {"name": "title", "boost": 5},
                {"name": "description", "boost": 1}
              ]
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took": $body.$_path,
          "timed_out": false,
          "_shards": {
            "total": 1,
            "successful": 1,
            "skipped": 0,
            "failed": 0
          },
          "hits": {
            "total": {
              "value": 1,
              "relation": "eq"
            },
            "max_score": 0.8630463,
            "hits": $body.$_path
          }
        }
