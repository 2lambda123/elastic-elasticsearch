---
"line_59":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: PUT
        path: "my-index"
        body: |
          {
            "mappings": {
              "properties": {
                "content_embedding": {
                  "type": "sparse_vector"
                },
                "content": {
                  "type": "text"
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_95":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/elser-v2-test"
        body: |
          {
            "processors": [
              {
                "inference": {
                  "model_id": ".elser_model_2",
                  "input_output": [
                    {
                      "input_field": "content",
                      "output_field": "content_embedding"
                    }
                  ]
                }
              }
            ]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_ingest/pipeline/elser-v2-test"
  - is_false: _shards.failures
---
"line_158":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: POST
        path: "_reindex"
        wait_for_completion: "false"
        body: |
          {
            "source": {
              "index": "test-data",
              "size": 50
            },
            "dest": {
              "index": "my-index",
              "pipeline": "elser-v2-test"
            }
          }
  - is_false: _shards.failures
---
"line_179":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: GET
        path: "_tasks/%3Ctask_id%3E"
  - is_false: _shards.failures
---
"line_198":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
             "query":{
                "text_expansion":{
                   "content_embedding":{
                      "model_id":".elser_model_2",
                      "model_text":"How to avoid muscle soreness after running?"
                   }
                }
             }
          }
  - is_false: _shards.failures
---
"line_279":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: GET
        path: "my-index/_search"
        body: |
          {
            "query": {
              "bool": {
                "should": [
                  {
                    "text_expansion": {
                      "content_embedding": {
                        "model_text": "How to avoid muscle soreness after running?",
                        "model_id": ".elser_model_2",
                        "boost": 1
                      }
                    }
                  },
                  {
                    "query_string": {
                      "query": "toxins",
                      "boost": 4
                    }
                  }
                ]
              }
            },
            "min_score": 10
          }
  - is_false: _shards.failures
---
"line_346":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: TBD
  - do:
      raw:
        method: PUT
        path: "my-index"
        body: |
          {
            "mappings": {
              "_source": {
                "excludes": [
                  "content_embedding"
                ]
              },
              "properties": {
                "content_embedding": {
                  "type": "sparse_vector"
                },
                "content": {
                  "type": "text"
                }
              }
            }
          }
  - is_false: _shards.failures
