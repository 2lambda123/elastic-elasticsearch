---
"date-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "date": {
                  "type": "date"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/1"
        body: |
          { "date": "2015-01-01" }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/2"
        body: |
          { "date": "2015-01-01T12:10:30Z" }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/3"
        body: |
          { "date": 1420070400001 }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "sort": { "date": "asc"}
          }
  - is_false: _shards.failures
---
"date-format-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "date": {
                  "type":   "date",
                  "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
                }
              }
            }
          }
  - is_false: _shards.failures
---
"date-epoch-seconds-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "date": {
                  "type":   "date",
                  "format": "strict_date_optional_time||epoch_second"
                }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000001/_doc/example"
        refresh: ""
        body: |
          { "date": 1618321898 }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000001/_search"
        filter_path: "hits.hits"
        body: |
          {
            "fields": [ {"field": "date"}],
            "_source": false
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "hits": {
            "hits": [
              {
                "_id": "example",
                "_index": "my-index-000001",
                "_score": 1.0,
                "fields": {
                  "date": ["2021-04-13T13:51:38.000Z"]
                }
              }
            ]
          }
        }
---
"synthetic-source-date-example":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "idx"
        body: |
          {
            "mappings": {
              "_source": { "mode": "synthetic" },
              "properties": {
                "date": { "type": "date" }
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "idx/_doc/1"
        body: |
          {
            "date": ["2015-01-01T12:10:30Z", "2014-01-01T12:10:30Z"]
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "idx/_doc/1"
        filter_path: "_source"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "idx/_doc/1"
        filter_path: "_source"
  - is_false: _shards.failures
  - match:
      $body:
        {"_source":{
          "date": ["2014-01-01T12:10:30.000Z", "2015-01-01T12:10:30.000Z"]
        }}
