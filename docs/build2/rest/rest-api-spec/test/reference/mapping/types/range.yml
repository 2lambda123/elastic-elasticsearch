---
setup:
  - do:
      raw:
        method: PUT
        path: "range_index"
        body: |
          {
            "settings": {
              "number_of_shards": 2
            },
            "mappings": {
              "properties": {
                "expected_attendees": {
                  "type": "integer_range"
                },
                "time_frame": {
                  "type": "date_range",
                  "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
                }
              }
            }
          }
  - do:
      raw:
        method: PUT
        path: "range_index/_doc/1"
        refresh: ""
        body: |
          {
            "expected_attendees" : {
              "gte" : 10,
              "lt" : 20
            },
            "time_frame" : {
              "gte" : "2015-10-31 12:00:00",
              "lte" : "2015-11-01"
            }
          }
---
"line_75":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "range_index/_search"
        body: |
          {
            "query" : {
              "term" : {
                "expected_attendees" : {
                  "value": 12
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took" : $body.took,
          "timed_out": false,
          "_shards" : {
            "total": 2,
            "successful": 2,
            "skipped" : 0,
            "failed": 0
          },
          "hits" : {
            "total" : {
                "value": 1,
                "relation": "eq"
            },
            "max_score" : 1.0,
            "hits" : [
              {
                "_index" : "range_index",
                "_id" : "1",
                "_score" : 1.0,
                "_source" : {
                  "expected_attendees" : {
                    "gte" : 10, "lt" : 20
                  },
                  "time_frame" : {
                    "gte" : "2015-10-31 12:00:00", "lte" : "2015-11-01"
                  }
                }
              }
            ]
          }
        }
---
"line_130":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "range_index/_search"
        body: |
          {
            "query" : {
              "range" : {
                "time_frame" : {
                  "gte" : "2015-10-31",
                  "lte" : "2015-11-01",
                  "relation" : "within"
                }
              }
            }
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "took" : $body.took,
          "timed_out": false,
          "_shards" : {
            "total": 2,
            "successful": 2,
            "skipped" : 0,
            "failed": 0
          },
          "hits" : {
            "total" : {
                "value": 1,
                "relation": "eq"
            },
            "max_score" : 1.0,
            "hits" : [
              {
                "_index" : "range_index",
                "_id" : "1",
                "_score" : 1.0,
                "_source" : {
                  "expected_attendees" : {
                    "gte" : 10, "lt" : 20
                  },
                  "time_frame" : {
                    "gte" : "2015-10-31 12:00:00", "lte" : "2015-11-01"
                  }
                }
              }
            ]
          }
        }
---
"line_195":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "range_index/_mapping"
        body: |
          {
            "properties": {
              "ip_allowlist": {
                "type": "ip_range"
              }
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "range_index/_doc/2"
        body: |
          {
            "ip_allowlist" : "192.168.0.0/16"
          }
  - is_false: _shards.failures
