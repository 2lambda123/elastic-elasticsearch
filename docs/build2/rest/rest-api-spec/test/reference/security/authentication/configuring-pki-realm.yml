---
"line_159":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/users"
        body: |
          {
            "roles" : [ "user" ],
            "rules" : { "field" : {
              "dn" : "cn=John Doe,ou=example,o=com"
            } },
            "enabled": true
          }
  - is_false: _shards.failures
---
"line_267":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_security/role_mapping/direct_pki_only"
        body: |
          {
            "roles" : [ "role_for_pki1_direct" ],
            "rules" : {
              "all": [
                {
                  "field": {"realm.name": "pki1"}
                },
                {
                  "field": {
                    "metadata.pki_delegated_by_user": null
                  }
                }
              ]
            },
            "enabled": true
          }
  - is_false: _shards.failures
