---
setup:
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository"
        body: |
          {
            "type": "fs",
            "settings": {
              "location": "my_backup_location"
            }
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/my_snapshot"
        wait_for_completion: "true"
        body: |
          {
            "indices":"-*"
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/snapshot_1"
        wait_for_completion: "true"
        body: |
          {
            "indices":"-*"
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/snapshot_2"
        wait_for_completion: "true"
        body: |
          {
            "indices":"-*"
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/snapshot_3"
        wait_for_completion: "true"
        body: |
          {
            "indices":"-*"
          }
---
"line_44":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/my_snapshot"
  - is_false: _shards.failures
---
"line_351":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot_2"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_2",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 1,
          "remaining": 0
        }
---
"line_402":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot*"
        size: "2"
        sort: "name"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_1",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            },
            {
              "snapshot": "snapshot_2",
              "uuid": $body.snapshots.1.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.1.start_time,
              "start_time_in_millis": $body.snapshots.1.start_time_in_millis,
              "end_time": $body.snapshots.1.end_time,
              "end_time_in_millis": $body.snapshots.1.end_time_in_millis,
              "duration_in_millis": $body.snapshots.1.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "next": "c25hcHNob3RfMixteV9yZXBvc2l0b3J5LHNuYXBzaG90XzI=",
          "total": 3,
          "remaining": 1
        }
---
"line_482":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot*"
        size: "2"
        sort: "name"
        after: "c25hcHNob3RfMixteV9yZXBvc2l0b3J5LHNuYXBzaG90XzI"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_3",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 3,
          "remaining": 0
        }
---
"line_532":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot*"
        size: "2"
        sort: "name"
        offset: "2"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_3",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 3,
          "remaining": 0
        }
---
"line_583":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot*,-snapshot_3"
        sort: "name"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_1",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            },
            {
              "snapshot": "snapshot_2",
              "uuid": $body.snapshots.1.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.1.start_time,
              "start_time_in_millis": $body.snapshots.1.start_time_in_millis,
              "end_time": $body.snapshots.1.end_time,
              "end_time_in_millis": $body.snapshots.1.end_time_in_millis,
              "duration_in_millis": $body.snapshots.1.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 2,
          "remaining": 0
        }
---
"line_664":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/*"
        sort: "name"
        from_sort_value: "snapshot_2"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_2",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            },
            {
              "snapshot": "snapshot_3",
              "uuid": $body.snapshots.1.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.1.start_time,
              "start_time_in_millis": $body.snapshots.1.start_time_in_millis,
              "end_time": $body.snapshots.1.end_time,
              "end_time_in_millis": $body.snapshots.1.end_time_in_millis,
              "duration_in_millis": $body.snapshots.1.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 2,
          "remaining": 0
        }
---
"line_745":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot_*"
        sort: "start_time"
        from_sort_value: "1577833200000"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots": [
            {
              "snapshot": "snapshot_1",
              "uuid": $body.snapshots.0.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.0.start_time,
              "start_time_in_millis": $body.snapshots.0.start_time_in_millis,
              "end_time": $body.snapshots.0.end_time,
              "end_time_in_millis": $body.snapshots.0.end_time_in_millis,
              "duration_in_millis": $body.snapshots.0.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            },
            {
              "snapshot": "snapshot_2",
              "uuid": $body.snapshots.1.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.1.start_time,
              "start_time_in_millis": $body.snapshots.1.start_time_in_millis,
              "end_time": $body.snapshots.1.end_time,
              "end_time_in_millis": $body.snapshots.1.end_time_in_millis,
              "duration_in_millis": $body.snapshots.1.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            },
            {
              "snapshot": "snapshot_3",
              "uuid": $body.snapshots.2.uuid,
              "repository": "my_repository",
              "version_id": $body.snapshots.0.version_id,
              "version": $body.snapshots.0.version,
              "indices": [],
              "data_streams": [],
              "feature_states": [],
              "include_global_state": true,
              "state": "SUCCESS",
              "start_time": $body.snapshots.2.start_time,
              "start_time_in_millis": $body.snapshots.2.start_time_in_millis,
              "end_time": $body.snapshots.2.end_time,
              "end_time_in_millis": $body.snapshots.2.end_time_in_millis,
              "duration_in_millis": $body.snapshots.2.duration_in_millis,
              "failures": [],
              "shards": {
                "total": 0,
                "failed": 0,
                "successful": 0
              }
            }
          ],
          "total": 3,
          "remaining": 0
        }
