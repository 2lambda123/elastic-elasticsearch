---
setup:
  - do:
      raw:
        method: PUT
        path: "index_1"
  - do:
      raw:
        method: PUT
        path: "index_1/_doc/1"
        body: |
          {
            "title": "Elastic, Vol.1", "category": "Non-Fiction",
            "author": {
              "first_name": "Elk",
              "last_name": "Stack"
            }
          }
  - do:
      raw:
        method: PUT
        path: "index_1/_doc/2"
        body: |
          {
            "title": "Elastic, Vol.2", "category": "Non-Fiction",
            "author": {
              "first_name": "Elk",
              "last_name": "Stack"
            }
          }
  - do:
      raw:
        method: PUT
        path: "index_1/_doc/3"
        body: |
          {
            "title": "Elastic, Vol.3", "category": "Non-Fiction",
            "author": {
              "first_name": "Elk",
              "last_name": "Stack"
            }
          }
  - do:
      raw:
        method: PUT
        path: "index_1/_doc/4"
        body: |
          {
            "title": "Elastic, Vol.4", "category": "Non-Fiction",
            "author": {
              "first_name": "Elk",
              "last_name": "Stack"
            }
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository"
        body: |
          {
            "type": "fs",
            "settings": {
              "location": "my_backup_location"
            }
          }
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/my_snapshot"
        wait_for_completion: "true"
  - do:
      raw:
        method: PUT
        path: "_snapshot/my_repository/snapshot_2"
        wait_for_completion: "true"
        body: |
          {
            "indices": ["index_1"],
            "ignore_unavailable": true,
            "include_global_state": false,
            "metadata": {
              "taken_by": "Elastic Machine",
              "taken_because": "backup testing"
            }
          }
---
"line_75":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/_status"
  - is_false: _shards.failures
---
"line_332":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_snapshot/my_repository/snapshot_2/_status"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "snapshots" : [
            {
              "snapshot" : "snapshot_2",
              "repository" : "my_repository",
              "uuid" : $body.snapshots.0.uuid,
              "state" : "SUCCESS",
              "include_global_state" : false,
              "shards_stats" : {
                "initializing" : 0,
                "started" : 0,
                "finalizing" : 0,
                "done" : 1,
                "failed" : 0,
                "total" : 1
              },
              "stats" : {
                "incremental" : {
                  "file_count" : $body.snapshots.0.stats.incremental.file_count,
                  "size_in_bytes" : $body.snapshots.0.stats.incremental.size_in_bytes
                },
                "total" : {
                  "file_count" : $body.snapshots.0.stats.total.file_count,
                  "size_in_bytes" : $body.snapshots.0.stats.total.size_in_bytes
                },
                "start_time_in_millis" : $body.snapshots.0.stats.start_time_in_millis,
                "time_in_millis" : $body.snapshots.0.stats.time_in_millis
              },
              "indices" : {
                "index_1" : {
                  "shards_stats" : {
                    "initializing" : 0,
                    "started" : 0,
                    "finalizing" : 0,
                    "done" : 1,
                    "failed" : 0,
                    "total" : 1
                  },
                  "stats" : {
                    "incremental" : {
                      "file_count" : $body.snapshots.0.stats.incremental.file_count,
                      "size_in_bytes" : $body.snapshots.0.stats.incremental.size_in_bytes
                    },
                    "total" : {
                      "file_count" : $body.snapshots.0.stats.total.file_count,
                      "size_in_bytes" : $body.snapshots.0.stats.total.size_in_bytes
                    },
                    "start_time_in_millis" : $body.snapshots.0.indices.index_1.stats.start_time_in_millis,
                    "time_in_millis" : $body.$_path
                  },
                  "shards" : {
                    "0" : {
                      "stage" : "DONE",
                      "stats" : {
                        "incremental" : {
                          "file_count" : $body.snapshots.0.stats.incremental.file_count,
                          "size_in_bytes" : $body.snapshots.0.stats.incremental.size_in_bytes
                        },
                        "total" : {
                          "file_count" : $body.snapshots.0.stats.total.file_count,
                          "size_in_bytes" : $body.snapshots.0.stats.total.size_in_bytes
                        },
                        "start_time_in_millis" : $body.snapshots.0.indices.index_1.stats.start_time_in_millis,
                        "time_in_millis" : $body.$_path
                      }
                    }
                  }
                }
              }
            }
          ]
        }
