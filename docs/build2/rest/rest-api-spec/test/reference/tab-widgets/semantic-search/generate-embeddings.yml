---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_ingest/pipeline/my-text-embeddings-pipeline"
---
"line_17":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/my-text-embeddings-pipeline"
        body: |
          {
            "description": "Text embedding pipeline",
            "processors": [
              {
                "inference": {
                  "model_id": ".elser_model_2",
                  "input_output": [
                    {
                      "input_field": "my_text_field",
                      "output_field": "my_tokens"
                    }
                  ]
                }
              }
            ]
          }
  - is_false: _shards.failures
---
"line_54":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ingest/pipeline/my-text-embeddings-pipeline"
        body: |
          {
            "description": "Text embedding pipeline",
            "processors": [
              {
                "inference": {
                  "model_id": "sentence-transformers__msmarco-minilm-l-12-v3",
                  "target_field": "my_embeddings",
                  "field_map": {
                    "my_text_field": "text_field"
                  }
                }
              }
            ]
          }
  - is_false: _shards.failures
