---
setup:
  - do:
      raw:
        method: PUT
        path: "_query_rules/my-ruleset"
        body: |
          {
            "rules": [
              {
                "rule_id": "my-rule1",
                "type": "pinned",
                "criteria": [
                  {
                    "type": "exact",
                    "metadata": "user_query",
                    "values": ["puggles"]
                  }
                ],
                "actions": {
                  "ids": [ "id1" ]
                }
              }
            ]
          }
---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_query_rules/my-ruleset"
---
"line_59":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_search"
        body: |
          {
            "query": {
              "rule_query": {
                "match_criteria": {
                  "user_query": "pugs"
                },
                "ruleset_id": "my-ruleset",
                "organic": {
                  "match": {
                    "description": "puggles"
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
