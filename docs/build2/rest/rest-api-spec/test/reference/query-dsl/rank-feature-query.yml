---
setup:
  - do:
      raw:
        method: PUT
        path: "test"
        body: |
          {
            "mappings": {
              "properties": {
                "pagerank": {
                  "type": "rank_feature"
                },
                "url_length": {
                  "type": "rank_feature",
                  "positive_score_impact": false
                },
                "topics": {
                  "type": "rank_features"
                }
              }
            }
          }
---
"line_92":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "test/_doc/1"
        refresh: ""
        body: |
          {
            "url": "https://en.wikipedia.org/wiki/2016_Summer_Olympics",
            "content": "Rio 2016",
            "pagerank": 50.3,
            "url_length": 42,
            "topics": {
              "sports": 50,
              "brazil": 30
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "test/_doc/2"
        refresh: ""
        body: |
          {
            "url": "https://en.wikipedia.org/wiki/2016_Brazilian_Grand_Prix",
            "content": "Formula One motor race held on 13 November 2016",
            "pagerank": 50.3,
            "url_length": 47,
            "topics": {
              "sports": 35,
              "formula one": 65,
              "brazil": 20
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "test/_doc/3"
        refresh: ""
        body: |
          {
            "url": "https://en.wikipedia.org/wiki/Deadpool_(film)",
            "content": "Deadpool is a 2016 American superhero film",
            "pagerank": 50.3,
            "url_length": 37,
            "topics": {
              "movies": 60,
              "super hero": 65
            }
          }
  - is_false: _shards.failures
---
"line_138":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "bool": {
                "must": [
                  {
                    "match": {
                      "content": "2016"
                    }
                  }
                ],
                "should": [
                  {
                    "rank_feature": {
                      "field": "pagerank"
                    }
                  },
                  {
                    "rank_feature": {
                      "field": "url_length",
                      "boost": 0.1
                    }
                  },
                  {
                    "rank_feature": {
                      "field": "topics.sports",
                      "boost": 0.4
                    }
                  }
                ]
              }
            }
          }
  - is_false: _shards.failures
---
"line_254":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "rank_feature": {
                "field": "pagerank",
                "saturation": {
                  "pivot": 8
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_274":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "rank_feature": {
                "field": "pagerank",
                "saturation": {}
              }
            }
          }
  - is_false: _shards.failures
---
"line_295":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "rank_feature": {
                "field": "pagerank",
                "log": {
                  "scaling_factor": 4
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_321":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "rank_feature": {
                "field": "pagerank",
                "sigmoid": {
                  "pivot": 7,
                  "exponent": 0.6
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_348":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "test/_search"
        body: |
          {
            "query": {
              "rank_feature": {
                "field": "pagerank",
                "linear": {}
              }
            }
          }
  - is_false: _shards.failures
