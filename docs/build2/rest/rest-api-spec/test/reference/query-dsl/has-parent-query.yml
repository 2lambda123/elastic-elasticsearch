---
setup:
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
            "mappings": {
              "properties": {
                "my-join-field": {
                  "type": "join",
                  "relations": {
                    "parent": "child"
                  }
                },
                "tag": {
                  "type": "keyword"
                }
              }
            }
          }
---
"line_52":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "my-index-000001/_search"
        body: |
          {
            "query": {
              "has_parent": {
                "parent_type": "parent",
                "query": {
                  "term": {
                    "tag": {
                      "value": "Elasticsearch"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_122":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_search"
        body: |
          {
            "query": {
              "has_parent": {
                "parent_type": "parent",
                "score": true,
                "query": {
                  "function_score": {
                    "script_score": {
                      "script": "_score * doc['view_count'].value"
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
