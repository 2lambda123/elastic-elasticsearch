---
"line_131":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason: setup:farequote_data
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/kibana-sample-data-flights"
        body: |
          {
            "analysis_config": {
              "bucket_span": "60m",
              "detectors": [{
                "function": "mean",
                "field_name": "responsetime",
                "by_field_name": "airline"
              }],
              "summary_count_field_name": "doc_count"
            },
            "data_description": {
              "time_field":"time"
            },
            "datafeed_config":{
              "indices": ["kibana-sample-data-flights"],
              "aggregations": {
                "buckets": {
                  "date_histogram": {
                    "field": "time",
                    "fixed_interval": "360s",
                    "time_zone": "UTC"
                  },
                  "aggregations": {
                    "time": {
                      "max": {"field": "time"}
                    },
                    "airline": {
                      "terms": {
                       "field": "airline",
                        "size": 100
                      },
                      "aggregations": {
                        "responsetime": {
                          "avg": {
                            "field": "responsetime"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
---
"line_241":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_ml/anomaly_detectors/kibana-sample-data-flights-composite"
        body: |
          {
            "analysis_config": {
              "bucket_span": "60m",
              "detectors": [{
                "function": "mean",
                "field_name": "responsetime",
                "by_field_name": "airline"
              }],
              "summary_count_field_name": "doc_count"
            },
            "data_description": {
              "time_field":"time"
            },
            "datafeed_config":{
              "indices": ["kibana-sample-data-flights"],
              "aggregations": {
                "buckets": {
                  "composite": {
                    "size": 1000,
                    "sources": [
                      {
                        "time_bucket": {
                          "date_histogram": {
                            "field": "time",
                            "fixed_interval": "360s",
                            "time_zone": "UTC"
                          }
                        }
                      },
                      {
                        "airline": {
                          "terms": {
                            "field": "airline"
                          }
                        }
                      }
                    ]
                  },
                  "aggregations": {
                    "time": {
                      "max": {
                        "field": "time"
                      }
                    },
                    "responsetime": {
                      "avg": {
                        "field": "responsetime"
                      }
                    }
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
