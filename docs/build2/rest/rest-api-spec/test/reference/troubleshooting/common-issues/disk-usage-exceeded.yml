---
"line_26":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cat/shards"
        v: "true"
---
"line_34":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "_cluster/allocation/explain"
        body: |
          {
            "index": "my-index",
            "shard": 0,
            "primary": false
            
          }
  - is_false: _shards.failures
---
"line_51":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "cluster.routing.allocation.disk.watermark.low": "90%",
              "cluster.routing.allocation.disk.watermark.low.max_headroom": "100GB",
              "cluster.routing.allocation.disk.watermark.high": "95%",
              "cluster.routing.allocation.disk.watermark.high.max_headroom": "20GB",
              "cluster.routing.allocation.disk.watermark.flood_stage": "97%",
              "cluster.routing.allocation.disk.watermark.flood_stage.max_headroom": "5GB",
              "cluster.routing.allocation.disk.watermark.flood_stage.frozen": "97%",
              "cluster.routing.allocation.disk.watermark.flood_stage.frozen.max_headroom": "5GB"
            }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "*/_settings"
        expand_wildcards: "all"
        body: |
          {
            "index.blocks.read_only_allow_delete": null
          }
  - is_false: _shards.failures
---
"line_79":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "my-index"
  - is_false: _shards.failures
---
"line_87":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "cluster.routing.allocation.disk.watermark.low": null,
              "cluster.routing.allocation.disk.watermark.low.max_headroom": null,
              "cluster.routing.allocation.disk.watermark.high": null,
              "cluster.routing.allocation.disk.watermark.high.max_headroom": null,
              "cluster.routing.allocation.disk.watermark.flood_stage": null,
              "cluster.routing.allocation.disk.watermark.flood_stage.max_headroom": null,
              "cluster.routing.allocation.disk.watermark.flood_stage.frozen": null,
              "cluster.routing.allocation.disk.watermark.flood_stage.frozen.max_headroom": null
            }
          }
  - is_false: _shards.failures
