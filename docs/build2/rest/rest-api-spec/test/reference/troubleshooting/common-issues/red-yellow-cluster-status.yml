---
"line_17":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cluster/health"
        filter_path: "status,*_shards"
  - is_false: _shards.failures
---
"line_30":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cat/shards"
        v: "true"
        h: "index,shard,prirep,state,node,unassigned.reason"
        s: "state"
---
"line_42":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "_cluster/allocation/explain"
        filter_path: "index,node_allocation_decisions.node_name,node_allocation_decisions.deciders.*"
        body: |
          {
            "index": "my-index",
            "shard": 0,
            "primary": false
          }
  - is_false: _shards.failures
---
"line_69":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent" : {
              "cluster.routing.allocation.enable" : null
            }
          }
  - is_false: _shards.failures
---
"line_94":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: POST
        path: "_cluster/reroute"
        metric: "none"
  - is_false: _shards.failures
---
"line_113":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index/_settings"
        flat_settings: "true"
        include_defaults: "true"
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "_cluster/settings"
        flat_settings: "true"
        include_defaults: "true"
  - is_false: _shards.failures
---
"line_138":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "_settings"
        body: |
          {
            "index.number_of_replicas": 1
          }
  - is_false: _shards.failures
---
"line_159":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: GET
        path: "_cat/allocation"
        v: "true"
        h: "node,shards,disk.*"
---
"line_177":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index/_forcemerge"
  - is_false: _shards.failures
---
"line_186":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
        body: |
          {"settings":{"index.number_of_shards":2,"blocks.write":true}}
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index/_shrink/my-shrunken-index"
  - is_false: _shards.failures
---
"line_195":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "cluster.routing.allocation.disk.watermark.low": null
            }
          }
  - is_false: _shards.failures
---
"line_232":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index"
  - is_false: _shards.failures
  - do:
      catch: bad_request
      raw:
        method: POST
        path: "_cluster/reroute"
        metric: "none"
        body: |
          {
            "commands": [
              {
                "allocate_empty_primary": {
                  "index": "my-index",
                  "shard": 0,
                  "node": "my-node",
                  "accept_data_loss": "true"
                }
              }
            ]
          }
  - is_false: _shards.failures
