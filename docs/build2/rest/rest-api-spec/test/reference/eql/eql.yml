---
teardown:
  - do:
      raw:
        method: DELETE
        path: "_data_stream/*"
  - do:
      raw:
        method: DELETE
        path: "_index_template/*"
---
"line_66":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "is_partial": false,
          "is_running": false,
          "took": $body.took,
          "timed_out": false,
          "hits": {
            "total": {
              "value": 2,
              "relation": "eq"
            },
            "events": [
              {
                "_index": $body.hits.events.0._index,
                "_id": $body.hits.events.0._id,
                "_source": {
                  "@timestamp": "2099-12-07T11:07:09.000Z",
                  "event": {
                    "category": "process",
                    "id": "aR3NWVOs",
                    "sequence": 4
                  },
                  "process": {
                    "pid": 2012,
                    "name": "regsvr32.exe",
                    "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                    "executable": "C:\\Windows\\System32\\regsvr32.exe"
                  }
                }
              },
              {
                "_index": $body.hits.events.0._index,
                "_id": $body.hits.events.1._id,
                "_source": {
                  "@timestamp": "2099-12-07T11:07:10.000Z",
                  "event": {
                    "category": "process",
                    "id": "GTSmSqgz0U",
                    "sequence": 6,
                    "type": "termination"
                  },
                  "process": {
                    "pid": 2012,
                    "name": "regsvr32.exe",
                    "executable": "C:\\Windows\\System32\\regsvr32.exe"
                  }
                }
              }
            ]
          }
        }
---
"line_141":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  ",
            "size": 50
          }
  - is_false: _shards.failures
---
"line_161":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence\n      [ process where process.name == \"regsvr32.exe\" ]\n      [ file where stringContains(file.name, \"scrobj.dll\") ]\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
        "is_partial": false, "is_running": false, "took": $body.took, "timed_out": false,  "hits": {
            "total": { "value": 1, "relation": "eq" },
            "sequences": [
              {
                "events": [
                  {
                    "_index": $body.hits.sequences.0.events.0._index,
                    "_id": $body.hits.sequences.0.events.0._id,
                    "_source": {
                      "@timestamp": "2099-12-07T11:07:09.000Z",
                      "event": {
                        "category": "process",
                        "id": "aR3NWVOs",
                        "sequence": 4
                      },
                      "process": {
                        "pid": 2012,
                        "name": "regsvr32.exe",
                        "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll",
                        "executable": "C:\\Windows\\System32\\regsvr32.exe"
                      }
                    }
                  },
                  {
                    "_index": $body.hits.sequences.0.events.0._index,
                    "_id": $body.hits.sequences.0.events.1._id,
                    "_source": {
                      "@timestamp": "2099-12-07T11:07:10.000Z",
                      "event": {
                        "category": "file",
                        "id": "tZ1NWVOs",
                        "sequence": 5
                      },
                      "process": {
                        "pid": 2012,
                        "name": "regsvr32.exe",
                        "executable": "C:\\Windows\\System32\\regsvr32.exe"
                      },
                      "file": {
                        "path": "C:\\Windows\\System32\\scrobj.dll",
                        "name": "scrobj.dll"
                      }
                    }
                  }
                ]
              }
            ]
          }
        }
---
"line_240":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence with maxspan=1h\n      [ process where process.name == \"regsvr32.exe\" ]\n      [ file where stringContains(file.name, \"scrobj.dll\") ]\n  "
          }
  - is_false: _shards.failures
---
"line_256":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence with maxspan=1d\n      [ process where process.name == \"cmd.exe\" ]\n      ![ process where stringContains(process.command_line, \"ocx\") ]\n      [ file where stringContains(file.name, \"scrobj.dll\") ]\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
        "is_partial": false, "is_running": false, "took": $body.took, "timed_out": false,  "hits": {
            "total": { "value": 1, "relation": "eq" },
            "sequences": [
              {
                "events": [
                  {
                    "_index": $body.hits.sequences.0.events.0._index,
                    "_id": $body.hits.sequences.0.events.0._id,
                    "_source": {
                      "@timestamp": "2099-12-07T11:06:07.000Z",
                      "event": {
                        "category": "process",
                        "id": "cMyt5SZ2",
                        "sequence": 3
                      },
                      "process": {
                        "pid": 2012,
                        "name": "cmd.exe",
                        "executable": "C:\\Windows\\System32\\cmd.exe"
                      }
                    }
                  },
                  {
                    "_index": "",
                    "_id": "",
                    "_source": {},
                    "missing": true
                  },
                  {
                    "_index": $body.hits.sequences.0.events.0._index,
                    "_id": $body.hits.sequences.0.events.2._id,
                    "_source": {
                      "@timestamp": "2099-12-07T11:07:10.000Z",
                      "event": {
                        "category": "file",
                        "id": "tZ1NWVOs",
                        "sequence": 5
                      },
                      "process": {
                        "pid": 2012,
                        "name": "regsvr32.exe",
                        "executable": "C:\\Windows\\System32\\regsvr32.exe"
                      },
                      "file": {
                        "path": "C:\\Windows\\System32\\scrobj.dll",
                        "name": "scrobj.dll"
                      }
                    }
                  }
                ]
              }
            ]
          }
        }
---
"line_340":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence with maxspan=1h\n      [ process where process.name == \"regsvr32.exe\" ] by process.pid\n      [ file where stringContains(file.name, \"scrobj.dll\") ] by process.pid\n  "
          }
  - is_false: _shards.failures
---
"line_356":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence by process.pid with maxspan=1h\n      [ process where process.name == \"regsvr32.exe\" ]\n      [ file where stringContains(file.name, \"scrobj.dll\") ]\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
        "is_partial": false, "is_running": false, "took": $body.took, "timed_out": false,  "hits": { "total": { "value": 1, "relation": "eq" },
            "sequences": [
              {
                "join_keys": [
                  2012
                ],
                "events": $body.hits.sequences.0.events
              }
            ]
          }
        }
---
"line_394":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    sequence by process.pid with maxspan=1h\n      [ process where process.name == \"regsvr32.exe\" ]\n      [ file where stringContains(file.name, \"scrobj.dll\") ]\n    until [ process where event.type == \"termination\" ]\n  "
          }
  - is_false: _shards.failures
---
"line_422":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "my-index-000001"
        body: |
          {
              "mappings": {
                  "properties": {
                      "ip": {
                          "type":"ip"
                      },
                      "version": {
                          "type": "version"
                      },
                      "missing_keyword": {
                          "type": "keyword"
                      },
                      "@timestamp": {
                        "type": "date"
                      },
                      "type_test": {
                          "type": "keyword"
                      },
                      "@timestamp_pretty": {
                        "type": "date",
                        "format": "dd-MM-yyyy"
                      },
                      "event_type": {
                        "type": "keyword"
                      },
                      "event": {
                        "properties": {
                          "category": {
                            "type": "alias",
                            "path": "event_type"
                          }
                        }
                      },
                      "host": {
                        "type": "keyword"
                      },
                      "os": {
                        "type": "keyword"
                      },
                      "bool": {
                        "type": "boolean"
                      },
                      "uptime" : {
                        "type" : "long"
                      },
                      "port" : {
                        "type" : "long"
                      }
                  }
              }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000002"
        body: |
          {
              "mappings": {
                  "properties": {
                      "ip": {
                          "type":"ip"
                      },
                      "@timestamp": {
                        "type": "date"
                      },
                      "@timestamp_pretty": {
                        "type": "date",
                        "format": "yyyy-MM-dd"
                      },
                      "type_test": {
                          "type": "keyword"
                      },
                      "event_type": {
                        "type": "keyword"
                      },
                      "event": {
                        "properties": {
                          "category": {
                            "type": "alias",
                            "path": "event_type"
                          }
                        }
                      },
                      "host": {
                        "type": "keyword"
                      },
                      "op_sys": {
                        "type": "keyword"
                      },
                      "bool": {
                        "type": "boolean"
                      },
                      "uptime" : {
                        "type" : "long"
                      },
                      "port" : {
                        "type" : "long"
                      }
                  }
              }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: PUT
        path: "my-index-000003"
        body: |
          {
              "mappings": {
                  "properties": {
                      "host_ip": {
                          "type":"ip"
                      },
                      "@timestamp": {
                        "type": "date"
                      },
                      "date": {
                        "type": "date"
                      },
                      "event_type": {
                        "type": "keyword"
                      },
                      "event": {
                        "properties": {
                          "category": {
                            "type": "alias",
                            "path": "event_type"
                          }
                        }
                      },
                      "missing_keyword": {
                          "type": "keyword"
                      },
                      "host": {
                        "type": "keyword"
                      },
                      "os": {
                        "type": "keyword"
                      },
                      "bool": {
                        "type": "boolean"
                      },
                      "uptime" : {
                        "type" : "long"
                      },
                      "port" : {
                        "type" : "long"
                      }
                  }
              }
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000001/_bulk"
        refresh: ""
        body: |
          {"index":{"_id":1}}
          {"@timestamp":"1234567891","@timestamp_pretty":"12-12-2022","missing_keyword":"test","type_test":"abc","ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":1234,"os":"win10","version":"1.0.0","id":11}
          {"index":{"_id":2}}
          {"@timestamp":"1234567892","@timestamp_pretty":"13-12-2022","event_type":"alert","type_test":"abc","host":"CS","uptime":5,"port":1,"os":"win10","version":"1.2.0","id":12}
          {"index":{"_id":3}}
          {"@timestamp":"1234567893","@timestamp_pretty":"12-12-2022","event_type":"alert","type_test":"abc","host":"farcry","uptime":1,"port":1234,"bool":false,"os":"win10","version":"2.0.0","id":13}
          {"index":{"_id":4}}
          {"@timestamp":"1234567894","@timestamp_pretty":"13-12-2022","event_type":"alert","type_test":"abc","host":"GTA","uptime":3,"port":12,"os":"slack","version":"10.0.0","id":14}
          {"index":{"_id":5}}
          {"@timestamp":"1234567895","@timestamp_pretty":"17-12-2022","event_type":"alert","host":"sniper 3d","uptime":6,"port":1234,"os":"fedora","version":"20.1.0","id":15}
          {"index":{"_id":6}}
          {"@timestamp":"1234568896","@timestamp_pretty":"17-12-2022","event_type":"alert","host":"doom","port":65123,"bool":true,"os":"redhat","version":"20.10.0","id":16}
          {"index":{"_id":7}}
          {"@timestamp":"1234567897","@timestamp_pretty":"17-12-2022","missing_keyword":"yyy","event_type":"failure","host":"doom","uptime":15,"port":1234,"bool":true,"os":"redhat","version":"20.2.0","id":17}
          {"index":{"_id":8}}
          {"@timestamp":"1234567898","@timestamp_pretty":"12-12-2022","missing_keyword":"test","event_type":"success","host":"doom","uptime":16,"port":512,"os":"win10","version":"1.2.3","id":18}
          {"index":{"_id":9}}
          {"@timestamp":"1234567899","@timestamp_pretty":"15-12-2022","missing_keyword":"test","event_type":"success","host":"GTA","port":12,"bool":true,"os":"win10","version":"1.2.3","id":19}
          {"index":{"_id":10}}
          {"@timestamp":"1234567893","missing_keyword":null,"ip":"10.0.0.5","event_type":"alert","host":"farcry","uptime":1,"port":1234,"bool":true,"os":"win10","version":"1.2.3","id":110}
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000002/_bulk"
        refresh: ""
        body: |
          {"index":{"_id":1}}
          {"@timestamp":"1234567991","type_test":"abc","ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":1234,"op_sys":"win10","id":21}
          {"index":{"_id":2}}
          {"@timestamp":"1234567992","type_test":"abc","event_type":"alert","host":"CS","uptime":5,"port":1,"op_sys":"win10","id":22}
          {"index":{"_id":3}}
          {"@timestamp":"1234567993","type_test":"abc","@timestamp_pretty":"2022-12-17","event_type":"alert","host":"farcry","uptime":1,"port":1234,"bool":false,"op_sys":"win10","id":23}
          {"index":{"_id":4}}
          {"@timestamp":"1234567994","event_type":"alert","host":"GTA","uptime":3,"port":12,"op_sys":"slack","id":24}
          {"index":{"_id":5}}
          {"@timestamp":"1234567995","event_type":"alert","host":"sniper 3d","uptime":6,"port":1234,"op_sys":"fedora","id":25}
          {"index":{"_id":6}}
          {"@timestamp":"1234568996","@timestamp_pretty":"2022-12-17","ip":"10.0.0.5","event_type":"alert","host":"doom","port":65123,"bool":true,"op_sys":"redhat","id":26}
          {"index":{"_id":7}}
          {"@timestamp":"1234567997","@timestamp_pretty":"2022-12-17","event_type":"failure","host":"doom","uptime":15,"port":1234,"bool":true,"op_sys":"redhat","id":27}
          {"index":{"_id":8}}
          {"@timestamp":"1234567998","ip":"10.0.0.1","event_type":"success","host":"doom","uptime":16,"port":512,"op_sys":"win10","id":28}
          {"index":{"_id":9}}
          {"@timestamp":"1234567999","ip":"10.0.0.1","event_type":"success","host":"GTA","port":12,"bool":false,"op_sys":"win10","id":29}
  - is_false: _shards.failures
  - do:
      raw:
        method: POST
        path: "my-index-000003/_bulk"
        refresh: ""
        body: |
          {"index":{"_id":1}}
          {"@timestamp":"1334567891","host_ip":"10.0.0.1","event_type":"alert","host":"doom","uptime":0,"port":12,"os":"win10","id":31}
          {"index":{"_id":2}}
          {"@timestamp":"1334567892","event_type":"alert","host":"CS","os":"win10","id":32}
          {"index":{"_id":3}}
          {"@timestamp":"1334567893","event_type":"alert","host":"farcry","bool":true,"os":"win10","id":33}
          {"index":{"_id":4}}
          {"@timestamp":"1334567894","event_type":"alert","host":"GTA","os":"slack","bool":true,"id":34}
          {"index":{"_id":5}}
          {"@timestamp":"1234567895","event_type":"alert","host":"sniper 3d","os":"fedora","id":35}
          {"index":{"_id":6}}
          {"@timestamp":"1234578896","host_ip":"10.0.0.1","event_type":"alert","host":"doom","bool":true,"os":"redhat","id":36}
          {"index":{"_id":7}}
          {"@timestamp":"1234567897","event_type":"failure","missing_keyword":"test","host":"doom","bool":true,"os":"redhat","id":37}
          {"index":{"_id":8}}
          {"@timestamp":"1234577898","event_type":"success","host":"doom","os":"win10","id":38,"date":"1671235200000"}
          {"index":{"_id":9}}
          {"@timestamp":"1234577899","host_ip":"10.0.0.5","event_type":"success","host":"GTA","bool":true,"os":"win10","id":39}
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index*/_eql/search"
        body: |
          {
            "query": "\n    sample by host\n      [any where uptime > 0]\n      [any where port > 100]\n      [any where bool == true]\n  "
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index*/_eql/search"
        body: |
          {
            "query": "\n    sample by host\n      [any where uptime > 0]   by os\n      [any where port > 100]   by op_sys\n      [any where bool == true] by os\n  "
          }
  - is_false: _shards.failures
  - do:
      raw:
        method: GET
        path: "my-index*/_eql/search"
        body: |
          {
            "max_samples_per_key": 2,
            "size": 20,
            "query": "\n    sample\n      [any where uptime > 0]   by host,os\n      [any where port > 100]   by host,op_sys\n      [any where bool == true] by host,os\n  "
          }
  - is_false: _shards.failures
---
"line_974":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        filter_path: "hits.events._source.@timestamp,hits.events._source.process.pid"
        body: |
          {
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "hits": {
            "events": [
              {
                "_source": {
                  "@timestamp": "2099-12-07T11:07:09.000Z",
                  "process": {
                    "pid": 2012
                  }
                }
              },
              {
                "_source": {
                  "@timestamp": "2099-12-07T11:07:10.000Z",
                  "process": {
                    "pid": 2012
                  }
                }
              }
            ]
          }
        }
---
"line_1024":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        filter_path: "-hits.events._source"
        body: |
          {
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  ",
            "fields": [
              "event.type",
              "process.*",
              {
                "field": "@timestamp",
                "format": "epoch_millis"
              }
            ]
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
        "is_partial": false, "is_running": false, "took": $body.took, "timed_out": false,  "hits": {
            "total": { "value": 2, "relation": "eq" },
            "events": [
              {
                "_index": $body.hits.events.0._index,
                "_id": $body.hits.events.0._id,
                "fields": {
                  "process.name": [
                    "regsvr32.exe"
                  ],
                  "process.name.keyword": [
                    "regsvr32.exe"
                  ],
                  "@timestamp": [
                    "4100324829000"
                  ],
                  "process.command_line": [
                    "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll"
                  ],
                  "process.command_line.keyword": [
                    "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll"
                  ],
                  "process.executable.keyword": [
                    "C:\\Windows\\System32\\regsvr32.exe"
                  ],
                  "process.pid": [
                    2012
                  ],
                  "process.executable": [
                    "C:\\Windows\\System32\\regsvr32.exe"
                  ]
                }
              },
        $body.hits.events.1    ]
          }
        }
---
"line_1107":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        filter_path: "-hits.events._source"
        body: |
          {
            "runtime_mappings": {
              "day_of_week": {
                "type": "keyword",
                "script": "emit(doc['@timestamp'].value.dayOfWeekEnum.toString())"
              }
            },
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  ",
            "fields": [
              "@timestamp",
              "day_of_week"
            ]
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
        "is_partial": false, "is_running": false, "took": $body.took, "timed_out": false,  "hits": {
            "total": { "value": 2, "relation": "eq" },
            "events": [
              {
                "_index": $body.hits.events.0._index,
                "_id": $body.hits.events.0._id,
                "fields": {
                  "@timestamp": [
                    "2099-12-07T11:07:09.000Z"
                  ],
                  "day_of_week": [
                    "MONDAY"
                  ]
                }
              },
        $body.hits.events.1    ]
          }
        }
---
"line_1169":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "timestamp_field": "file.accessed",
            "event_category_field": "file.type",
            "query": "\n    file where (file.size > 1 and file.type == \"file\")\n  "
          }
  - is_false: _shards.failures
---
"line_1204":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "tiebreaker_field": "event.sequence",
            "query": "\n    process where process.name == \"cmd.exe\" and stringContains(process.executable, \"System32\")\n  "
          }
  - is_false: _shards.failures
---
"line_1223":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "filter": {
              "range": {
                "@timestamp": {
                  "gte": "now-1d/d",
                  "lt": "now/d"
                }
              }
            },
            "query": "\n    file where (file.type == \"file\" and file.name == \"cmd.exe\")\n  "
          }
  - is_false: _shards.failures
---
"line_1253":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "wait_for_completion_timeout": "2s",
            "query": "\n    process where process.name == \"cmd.exe\"\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "id": "$body.id",
          "is_partial": $body.is_partial,
          "is_running": $body.is_running,
          "took": $body.took,
          "timed_out": false,
          "hits": $body.hits
        }
---
"line_1296":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  no access to search ID
  - do:
      raw:
        method: GET
        path: "_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE="
        wait_for_completion_timeout: "2s"
  - is_false: _shards.failures
  - match:
      $body:
        {
          "id": "$body.id",
          "is_partial": false,
          "is_running": false,
          "took": $body.took,
          "timed_out": false,
          "hits": $body.hits
        }
---
"line_1324":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  no access to search ID
  - do:
      raw:
        method: GET
        path: "_eql/search/status/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE="
  - is_false: _shards.failures
  - match:
      $body:
        {
          "id": "$body.id",
          "is_running": false,
          "is_partial": false,
          "expiration_time_in_millis": $body.expiration_time_in_millis,
          "completion_status": 200
        }
---
"line_1351":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "keep_alive": "2d",
            "wait_for_completion_timeout": "2s",
            "query": "\n    process where process.name == \"cmd.exe\"\n  "
          }
  - is_false: _shards.failures
---
"line_1368":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  no access to search ID
  - do:
      raw:
        method: GET
        path: "_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE="
        keep_alive: "5d"
  - is_false: _shards.failures
---
"line_1378":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  no access to search ID
  - do:
      raw:
        method: DELETE
        path: "_eql/search/FmNJRUZ1YWZCU3dHY1BIOUhaenVSRkEaaXFlZ3h4c1RTWFNocDdnY2FSaERnUTozNDE="
  - is_false: _shards.failures
---
"line_1391":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "my-data-stream/_eql/search"
        body: |
          {
            "keep_on_completion": true,
            "wait_for_completion_timeout": "2s",
            "query": "\n    process where process.name == \"cmd.exe\"\n  "
          }
  - is_false: _shards.failures
  - match:
      $body:
        {
          "id": "$body.id",
          "is_partial": false,
          "is_running": false,
          "took": $body.took,
          "timed_out": false,
          "hits": $body.hits
        }
---
"line_1425":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
        - always_skip
      reason:  no access to search ID
  - do:
      raw:
        method: GET
        path: "_eql/search/FjlmbndxNmJjU0RPdExBTGg0elNOOEEaQk9xSjJBQzBRMldZa1VVQ2pPa01YUToxMDY="
  - is_false: _shards.failures
---
"line_1454":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
# Named setup host

  # Fetch the http host. We use the host of the master because we know there will always be a master.
  - do:
      cluster.state: {}
  - set: { master_node: master }
  - do:
      nodes.info:
        metric: [ http, transport ]
  - set: {nodes.$master.http.publish_address: host}
  - set: {nodes.$master.transport.publish_address: transport_host}

  - do:
      raw:
        method: PUT
        path: "_cluster/settings"
        body: |
          {
            "persistent": {
              "cluster": {
                "remote": {
                  "cluster_one": {
                    "seeds": [
                      "${transport_host}"
                    ]
                  },
                  "cluster_two": {
                    "seeds": [
                      "${transport_host}"
                    ]
                  }
                }
              }
            }
          }
  - is_false: _shards.failures
# Named setup sec_logs

  - do:
      indices.put_index_template:
        name: my-data-stream-template
        body: |
          {
            "index_patterns": [ "my-data-stream*" ],
            "data_stream": { },
            "priority": 500
          }

  - do:
      raw:
        method: PUT
        path: '_data_stream/my-data-stream'

  - do:
        bulk:
          index: my-data-stream
          refresh: true
          body: |
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:05.000Z", "event": { "category": "process", "id": "edwCRnyD", "sequence": 1 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-06T11:04:07.000Z", "event": { "category": "file", "id": "dGCHwoeS", "sequence": 2 }, "file": { "accessed": "2099-12-07T11:07:08.000Z", "name": "cmd.exe", "path": "C:\\Windows\\System32\\cmd.exe", "type": "file", "size": 16384 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:06:07.000Z", "event": { "category": "process", "id": "cMyt5SZ2", "sequence": 3 }, "process": { "pid": 2012, "name": "cmd.exe", "executable": "C:\\Windows\\System32\\cmd.exe" } }
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:09.000Z", "event": { "category": "process", "id": "aR3NWVOs", "sequence": 4 }, "process": { "pid": 2012, "name": "regsvr32.exe", "command_line": "regsvr32.exe  /s /u /i:https://...RegSvr32.sct scrobj.dll", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "file", "id": "tZ1NWVOs", "sequence": 5 }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }, "file": { "path": "C:\\Windows\\System32\\scrobj.dll", "name": "scrobj.dll" }}
            {"create":{}}
            {"@timestamp": "2099-12-07T11:07:10.000Z", "event": { "category": "process", "id": "GTSmSqgz0U", "sequence": 6, "type": "termination" }, "process": { "pid": 2012, "name": "regsvr32.exe", "executable": "C:\\Windows\\System32\\regsvr32.exe" }}
  - do:
      raw:
        method: GET
        path: "cluster_one:my-data-stream,cluster_two:my-data-stream/_eql/search"
        body: |
          {
            "query": "\n    process where process.name == \"regsvr32.exe\"\n  "
          }
  - is_false: _shards.failures
# Named teardown data_stream_cleanup

  - do:
      raw:
        method: DELETE
        path: '_data_stream/*'
  - is_true: acknowledged
  - do:
      raw:
        method: DELETE
        path: '_index_template/*'
  - is_true: acknowledged

