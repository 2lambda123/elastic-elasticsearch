---
setup:
  - do:
      raw:
        method: PUT
        path: "users/_doc/1"
        refresh: ""
        body: |
          {
            "email": "mardy.brown@asciidocsmith.com",
            "first_name": "Mardy",
            "last_name": "Brown",
            "city": "New Orleans",
            "county": "Orleans",
            "state": "LA",
            "zip": 70116,
            "web": "mardy.asciidocsmith.com"
          }
  - do:
      raw:
        method: PUT
        path: "_enrich/policy/my-policy"
        body: |
          {
            "match": {
              "indices": "users",
              "match_field": "email",
              "enrich_fields": ["first_name", "last_name", "city", "zip", "state"]
            }
          }
---
"line_39":
  - skip:
      features:
        - default_shards
        - stash_in_key
        - stash_in_path
        - stash_path_replace
        - warnings
  - do:
      raw:
        method: PUT
        path: "_enrich/policy/my-policy/_execute"
  - is_false: _shards.failures
  - do:
      raw:
        method: DELETE
        path: "_enrich/policy/my-policy"
  - is_false: _shards.failures
