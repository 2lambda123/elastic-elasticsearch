[[es-release-notes]]
= {es} Release Notes

[partintro]
--
// Use these for links to issue and pulls. Note issues and pulls redirect one to
// each other on Github, so don't worry too much on using the right prefix.
// :issue: https://github.com/elastic/elasticsearch/issues/
// :pull: https://github.com/elastic/elasticsearch/pull/

This section summarizes the changes in each release.

//* <<release-notes-5.6.10>>
* <<release-notes-5.6.9>>
* <<release-notes-5.0.0>>
* <<release-notes-5.0.0-GA>>
* <<release-notes-5.0.0-alpha1-2x>>
--

////
[[release-notes-5.6.x]]
== {es} version 5.6.x

//[float]
//[[breaking-5.6.x]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

//[float]
//=== Bug Fixes

//[float]
//=== Regressions

//[float]
//=== Known Issues
////

////
[[release-notes-5.6.10]]
== {es} version 5.6.10

//[float]
//[[breaking-5.6.10]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

//[float]
//=== Bug Fixes

//[float]
//=== Regressions

//[float]
//=== Known Issues
////

[[release-notes-5.6.9]]
== {es} version 5.6.9

//[float]
//[[breaking-5.6.9]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Allocation::
* Don't break allocation if resize source index is missing {pull}29311[#29311] (issue: {issue}26931[#26931])

Engine::
* Avoid class cast exception from index writer {pull}28989[#28989]
* Maybe die before failing engine {pull}28973[#28973] (issues: {issue}27265[#27265], {issue}28967[#28967])

Java High Level REST Client::
* REST high-level client: encode path parts {pull}28663[#28663] (issue: {issue}28625[#28625])

Network::
* Call addBytesSent with correct number of bytes {pull}29194[#29194] (issue: {issue}27258[#27258])

Plugins::
* Fix upgrading indices which use a custom similarity plugin. {pull}26985[#26985] (issue: {issue}25350[#25350])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.6.8]]
== {es} version 5.6.8

//[float]
//[[breaking-5.6.8]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Recovery::
* Synced-flush should not seal index of out of sync replicas {pull}28464[#28464] (issue: {issue}10032[#10032])

[float]
=== Bug Fixes

Aggregations::
* StringTerms.Bucket.getKeyAsNumber detection type {pull}28118[#28118] (issue: {issue}28012[#28012])
* Always include the _index and _id for nested search hits. {pull}27201[#27201] (issue: {issue}27053[#27053])

Core::
* Handle throws on tasks submitted to thread pools {pull}28667[#28667]
* Fix size blocking queue to not lie about its weight {pull}28557[#28557] (issue: {issue}28547[#28547])

Ingest::
* Fix for bug that prevents pipelines to load that use stored scripts after a restart {pull}28588[#28588]

Java High Level REST Client::
* Fix parsing of script fields {pull}28395[#28395] (issue: {issue}28380[#28380])
* Move to POST when calling API to retrieve which support request body {pull}28342[#28342] (issue: {issue}28326[#28326])

Packaging::
* Disable console logging in the Windows service {pull}28618[#28618] (issue: {issue}20422[#20422])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.6.7]]
== {es} version 5.6.7

//[float]
//[[breaking-5.6.7]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Engine::
* Use `_refresh` to shrink the version map on inactivity {pull}27918[#27918] (issue: {issue}27852[#27852])
* Allow resize version map under lock even if there are pending operations {pull}27870[#27870] (issue: {issue}27852[#27852])

Internal::
* Never return null from Strings.tokenizeToStringArray {pull}28224[#28224] (issue: {issue}28213[#28213])
* Fallback to TransportMasterNodeAction for cluster health retries {pull}28195[#28195] (issue: {issue}28169[#28169])

Java REST Client::
* Do not use system properties when building the HttpAsyncClient {pull}27829[#27829] (issue: {issue}27827[#27827])

Mapping::
* Allow update of `eager_global_ordinals` on `_parent`. {pull}28014[#28014] (issue: {issue}24407[#24407])

Scripting::
* Ensure we protect Collections obtained from scripts from self-referencing {pull}28335[#28335]

Snapshot/Restore::
* Avoid concurrent snapshot finalizations when deleting an INIT snapshot {pull}28078[#28078] (issues: {issue}27214[#27214], {issue}27931[#27931], {issue}27974[#27974])
* Do not start snapshots that are deleted during initialization {pull}27931[#27931]

Plugin Lang Painless::
* change float to double {pull}28221[#28221]

//[float]
//=== Regressions

//[float]
//=== Known Issues


[[release-notes-5.6.6]]
== {es} version 5.6.6

//[float]
//[[breaking-5.6.6]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Index Templates::
* Prevent constructing an index template without index patterns {pull}27662[#27662]

Network::
* Only bind loopback addresses when binding to local {pull}28029[#28029] (issue: {issue}1877[#1877])

Plugin Repository HDFS::
* Fix SecurityException when HDFS Repository used against HA Namenodes {pull}27196[#27196]

Search::
* Use the underlying connection version for CCS connections  {pull}28093[#28093]
* Fix routing with leading or trailing whitespace {pull}27712[#27712] (issue: {issue}27708[#27708])

Settings::
* Allow index settings to be reset by wildcards {pull}27671[#27671] (issue: {issue}27537[#27537])

Snapshot/Restore::
* Fail restore when the shard allocations max retries count is reached {pull}27493[#27493] (issue: {issue}26865[#26865])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Ingest::
* update ingest-attachment to use Tika 1.17 and newer deps {pull}27824[#27824]

[[release-notes-5.6.5]]
== {es} version 5.6.5

//[float]
//[[breaking-5.6.5]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Core::
* Fix classes that can exit {pull}27518[#27518]

Discovery::
* Stop responding to ping requests before master abdication {pull}27329[#27329] (issue: {issue}27328[#27328])

Internal::
* TemplateUpgradeService should only run on the master {pull}27294[#27294]

Plugin Repository S3::
* Remove S3 output stream {pull}27280[#27280] (issue: {issue}27278[#27278])
* Update to AWS SDK 1.11.223 {pull}27278[#27278]

Search::
* fix unnecessary logger creation {pull}27349[#27349]

Snapshot/Restore::
* Remove XContentType auto detection in BlobStoreRepository {pull}27480[#27480]
* Fixed references to Multi Index Syntax {pull}27283[#27283]

[float]
=== Bug Fixes

Cluster::
* Properly format IndexGraveyard deletion date as date {pull}27362[#27362]

Core::
* Avoid NPE when getting build information {pull}27442[#27442]
* Correctly encode warning headers {pull}27269[#27269] (issue: {issue}27244[#27244])

Engine::
* Reset LiveVersionMap on sync commit {pull}27534[#27534] (issue: {issue}27516[#27516])
* Carry over version map size to prevent excessive resizing {pull}27516[#27516] (issue: {issue}20498[#20498])
* Die with dignity while merging {pull}27265[#27265] (issue: {issue}19272[#19272])

Mapping::
* Fix dynamic mapping update generation. {pull}27467[#27467]

Network::
* Throw UOE from compressible bytes stream reset {pull}27564[#27564] (issue: {issue}24927[#24927])
* Bubble exceptions when closing compressible streams {pull}27542[#27542] (issue: {issue}27540[#27540])
* Add CompressibleBytesOutputStream for compression {pull}27540[#27540] (issues: {issue}23941[#23941], {issue}24927[#24927], {issue}27525[#27525])
* Fixed ByteBuf leaking in org.elasticsearch.http.netty4.Netty4HttpRequestHandler {pull}27222[#27222] (issues: {issue}3[#3], {issue}4[#4], {issue}5[#5], {issue}6[#6])

Plugin Lang Painless::
* Painless: Fix errors allowing void to be assigned to def. {pull}27460[#27460] (issue: {issue}27210[#27210])

Plugin Repository GCS::
* Create new handlers for every new request in GoogleCloudStorageService {pull}27339[#27339] (issue: {issue}27092[#27092])

Snapshot/Restore::
* Do not swallow exception in ChecksumBlobStoreFormat.writeAtomic() {pull}27597[#27597]
* Delete shard store files before restoring a snapshot {pull}27476[#27476] (issues: {issue}20220[#20220], {issue}26865[#26865])
* Fix snapshot getting stuck in INIT state {pull}27214[#27214] (issue: {issue}27180[#27180])
* Snapshot/Restore: better handle incorrect chunk_size settings in FS repo {pull}26844[#26844] (issue: {issue}26843[#26843])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Plugin Discovery EC2::
* Upgrade AWS SDK Jackson Databind to 2.6.7.1 {pull}27361[#27361] (issues: {issue}27278[#27278], {issue}27359[#27359])

Plugin Discovery GCE::
* Update Google SDK to version 1.23.0 {pull}27381[#27381] (issue: {issue}26636[#26636])


[[release-notes-5.6.4]]
== {es} version 5.6.4

//[float]
//[[breaking-5.6.4]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

[float]
=== Deprecations

Inner Hits::
* Added deprecation logging about nested inner hits source response format change {pull}27169[#27169]

//[float]
//=== New Features

[float]
=== Enhancements

Core::
* Ignore .DS_Store files on macOS {pull}27108[#27108] (issue: {issue}23982[#23982])

[float]
=== Bug Fixes

Aggregations::
* Create weights lazily in filter and filters aggregation {pull}26983[#26983]

CAT API::
* Fix NPE for /_cat/indices when no primary shard {pull}26953[#26953] (issue: {issue}26942[#26942])

Cache::
* Reduce the default number of cached queries. {pull}26949[#26949] (issue: {issue}26938[#26938])

Core::
* Stop invoking non-existent syscall {pull}27016[#27016] (issue: {issue}20179[#20179])

Ingest::
* date processor should not fail if timestamp is specified as json number {pull}26986[#26986] (issue: {issue}26967[#26967])

Java High Level REST Client::
* Make ShardSearchTarget optional when parsing ShardSearchFailure {pull}27078[#27078] (issue: {issue}27055[#27055])

Java REST Client::
* rest-client-sniffer: configurable threadfactory {pull}26897[#26897]

Mapping::
* wrong link target for datatype murmur3 {pull}27143[#27143]

Network::
* Check for closed connection while opening {pull}26932[#26932]

Packaging::
* Fix handling of Windows paths containing parentheses {pull}26916[#26916] (issue: {issue}26454[#26454])

Plugin Analysis Phonetic::
* Fix beidermorse phonetic token filter for unspecified `languageset` {pull}27112[#27112] (issue: {issue}26771[#26771])

Plugin Lang Painless::
* Misleading incorrect for in loop in painless documentation. {pull}27195[#27195]

REST::
* exists template needs a template name {pull}25988[#25988]

Search::
* Avoid stack overflow on search phases {pull}27069[#27069] (issue: {issue}27042[#27042])
* Let search phases override max concurrent requests {pull}26484[#26484] (issue: {issue}26198[#26198])

Settings::
* Emit settings deprecation logging on empty update {pull}27017[#27017] (issue: {issue}26419[#26419])
* Fix filtering for ListSetting {pull}26914[#26914]

Snapshot/Restore::
* Fix snapshot getting stuck in INIT state {pull}27214[#27214] (issue: {issue}27180[#27180])

Stats::
* Keep cumulative elapsed scroll time in microseconds {pull}27068[#27068] (issue: {issue}27046[#27046])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.6.3]]
== {es} version 5.6.3

//[float]
//[[breaking-5.6.3]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Network::
* Add additional low-level logging handler {pull}26887[#26887]
* Unwrap exception causes when checking if  dying {pull}26884[#26884]

[float]
=== Bug Fixes

Aggregations::
* Fix IndexOutOfBoundsException in histograms for NaN doubles (#26787) {pull}26856[#26856] (issue: {issue}26787[#26787])

Core::
* MetaData Builder doesn't properly prevent an alias with the same name as an index {pull}26804[#26804]

Packaging::
* Fix default paths for Windows service {pull}26875[#26875] (issue: {issue}26873[#26873])

Plugin Repository Azure::
* Use Azure upload method instead of our own implementation (#26751) {pull}26839[#26839] (issue: {issue}26751[#26751])

Search::
* Fix serialization errors when cross cluster search goes to a single shard {pull}26881[#26881] (issue: {issue}26833[#26833])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.6.2]]
== {es} version 5.6.2

//[float]
//[[breaking-5.6.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Aggregations::
* Do not delegate a null scorer to LeafBucketCollectors {pull}26747[#26747] (issue: {issue}26611[#26611])

Inner Hits::
* Do not allow inner hits that fetch _source and have a non nested object field as parent {pull}25749[#25749] (issue: {issue}25315[#25315])

Internal::
* Catch exceptions and inform handler in RemoteClusterConnection#collectNodes {pull}26725[#26725] (issue: {issue}26700[#26700])

Java API::
* BulkProcessor flush runnable preserves the thread context from creation time {pull}26718[#26718] (issue: {issue}26596[#26596])

Java High Level REST Client::
* Make RestHighLevelClient's Request class public {pull}26627[#26627] (issue: {issue}26455[#26455])

Plugin Analysis Kuromoji::
* Fix kuromoji default stoptags {pull}26600[#26600] (issue: {issue}26519[#26519])

Plugin Repository HDFS::
* Fix permission errors when using Read Only HDFS Repository {pull}26714[#26714] (issues: {issue}22793[#22793], {issue}26513[#26513])

Query DSL::
*  #26083 Fixed incomplete JSON body on count request making org.elasticsearch.rest.action.RestActions#parseTopLevelQueryBuilder go into endless loop {pull}26680[#26680] (issue: {issue}26083[#26083])

Scripting::
* Add missing script contexts and types allowed settings {pull}26703[#26703] (issue: {issue}26651[#26651])

Upgrade API::
* Upgrade API: fix excessive logging and unnecessary template updates {pull}26698[#26698] (issue: {issue}26673[#26673])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Logging::
* Upgrade to Log4j 2.9.1 {pull}26750[#26750] (issues: {issue}109[#109], {issue}26464[#26464], {issue}26467[#26467])

[[release-notes-5.6.1]]
== {es} version 5.6.1

//[float]
//[[breaking-5.6.1]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Highlighting::
* Fix percolator highlight sub fetch phase to not highlight query twice {pull}26622[#26622]

Mapping::
* Fix unmapped_type creation for indices created in 2.x  {pull}26602[#26602] (issue: {issue}26162[#26162])

Similarities::
* Add boolean similarity to built in similarity types {pull}26613[#26613]

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene-6.6.1. {pull}26535[#26535]

[[release-notes-5.6.0]]
== {es} version 5.6.0

[float]
[[breaking-5.6.0]]
=== Breaking Changes

[[breaking-msi-5.6.0]]
Breaking MSI Windows Installer changes::
* Upgrades from 5.5.0, 5.5.1, 5.5.2. See https://github.com/elastic/windows-installers/releases/tag/v5.6.0[release notes]. 
** `ES_HOME` and `ES_CONFIG` environment variables unset after successful upgrade
** Windows Service stopped after successful upgrade

[float]
=== Breaking Java Changes

Java High Level REST Client::
* Allow RestHighLevelClient to use plugins {pull}25024[#25024]

Java REST Client::
* Rename client artifacts {pull}25693[#25693] (issue: {issue}20248[#20248])

[float]
=== Deprecations

Highlighting::
* Postings highlighter deprecation {pull}25073[#25073]

Indexed Scripts/Templates::
* Scripting: Deprecate stored search template apis {pull}25437[#25437] (issue: {issue}24596[#24596])

Mapping::
* Add deprecation logging when _all is enabled {pull}26228[#26228] (issue: {issue}22144[#22144])

Query DSL::
* Deprecate omitting terms lookup index name in 5.6 {pull}25755[#25755] (issue: {issue}25750[#25750])

Scripting::
* Scripting: Deprecate scripts.max_compilation_per_minute setting {pull}26402[#26402]
* Scripting: Change keys for inline/stored scripts to source/id {pull}25127[#25127]

Tribe Node::
* Deprecate tribe service {pull}24598[#24598] (issue: {issue}24581[#24581])

[float]
=== New Features

Java High Level REST Client::
* Backport high level REST client {pull}25086[#25086] (issues: {issue}22371[#22371], {issue}22680[#22680], {issue}23040[#23040], {issue}23187[#23187], {issue}23266[#23266], {issue}23312[#23312], {issue}23328[#23328], {issue}23350[#23350], {issue}23351[#23351], {issue}23373[#23373], {issue}24796[#24796], {issue}24938[#24938], {issue}25038[#25038])

Parent/Child::
* Typeless parent child backport {pull}25104[#25104]
* Move parent_id query to the parent-join module {pull}25072[#25072] (issue: {issue}20257[#20257])
* Introduce ParentJoinFieldMapper, a field mapper that creates parent/child relation within documents of the same index {pull}24978[#24978] (issue: {issue}20257[#20257])

Upgrade API::
* TemplateUpgraders should be called during rolling restart {pull}25263[#25263] (issues: {issue}24379[#24379], {issue}24680[#24680])

[float]
=== Enhancements

Allocation::
* Adjust status on bad allocation explain requests {pull}25503[#25503] (issue: {issue}25458[#25458])
* Promote replica on the highest version node {pull}25277[#25277] (issue: {issue}10708[#10708])

Analysis::
* [analysis-icu] Allow setting unicodeSetFilter {pull}20814[#20814] (issue: {issue}20820[#20820])

CAT API::
* expand `/_cat/nodes` to return information about hard drive {pull}21775[#21775] (issue: {issue}21679[#21679])

Cluster::
* Validate a joining node's version with version of existing cluster nodes {pull}25808[#25808]

Core::
* Add max file size bootstrap check {pull}25974[#25974]
* Explicitly reject duplicate data paths {pull}25178[#25178]

Highlighting::
* Picks offset source for the unified highlighter directly from the es mapping {pull}25747[#25747] (issue: {issue}25699[#25699])

Index APIs::
* Create index request should return the index name {pull}25139[#25139] (issue: {issue}23044[#23044])

Ingest::
* Add Ingest-Processor specific Rest Endpoints & Add Grok endpoint {pull}25059[#25059] (issue: {issue}24725[#24725])
* Port support for commercial GeoIP2 databases from Logstash. {pull}24889[#24889]
* Allow removing multiple fields in ingest processor {pull}24750[#24750] (issue: {issue}24622[#24622])
* Add target_field parameter to ingest processors {pull}24133[#24133] (issues: {issue}23228[#23228], {issue}23682[#23682])

Internal::
* Use holder pattern for lazy deprecation loggers {pull}26218[#26218] (issue: {issue}26210[#26210])
* "shard started" should show index and shard ID {pull}25157[#25157]
* Break out clear scroll logic from TransportClearScrollAction {pull}25125[#25125] (issue: {issue}25094[#25094])
* Add helper methods to TransportActionProxy to identify proxy actions and requests {pull}25124[#25124]
* Add remote cluster infrastructure to fetch discovery nodes. {pull}25123[#25123] (issue: {issue}25094[#25094])
* Disallow multiple parent-join fields per mapping {pull}25002[#25002]

Java High Level REST Client::
* [DOCS] restructure java clients docs pages {pull}25517[#25517]
* Use SPI in High Level Rest Client to load XContent parsers {pull}25098[#25098] (issues: {issue}25024[#25024], {issue}25097[#25097])

Java REST Client::
* Shade external dependencies in the rest client jar {pull}25780[#25780] (issue: {issue}25208[#25208])
* RestClient uses system properties and system default SSLContext {pull}25757[#25757] (issue: {issue}23231[#23231])

Logging::
* Use LRU set to reduce repeat deprecation messages {pull}25474[#25474] (issue: {issue}25457[#25457])

Mapping::
* Optimize `terms` queries on `ip` addresses to use a `PointInSetQuery` whenever possible. {pull}25669[#25669] (issue: {issue}25667[#25667])

Network::
* Simplify connection closing and cleanups in TcpTransport {pull}25250[#25250]

Packaging::
* Remove memlock suggestion from systemd service {pull}25979[#25979]
* Set address space limit in systemd service file {pull}25975[#25975]

Parent/Child::
* Remove ParentJoinFieldSubFetchPhase {pull}25550[#25550] (issue: {issue}25363[#25363])
* Support parent id being specified as number in the _source {pull}25547[#25547]

Query DSL::
* Make slop optional when parsing `span_near` query {pull}25677[#25677] (issue: {issue}25642[#25642])

Search::
* Reduce the overhead of timeouts and low-level search cancellation. {pull}25776[#25776]
* Reduce profiling overhead. {pull}25772[#25772] (issue: {issue}24799[#24799])
* Backport `can_match` endpoint to 5.6 to allow 6.0 to use the optimization in mixed version {pull}25704[#25704] (issue: {issue}25658[#25658])
* Add a shard filter search phase to pre-filter shards based on query rewriting {pull}25658[#25658]
* Ensure we rewrite common queries to `match_none` if possible {pull}25650[#25650]
* Limit the number of concurrent shard requests per search request {pull}25632[#25632]
* Add cluster name validation to RemoteClusterConnection {pull}25568[#25568]
* Leverage scorerSupplier when applicable. {pull}25109[#25109]
* Add Cross Cluster Search support for scroll searches {pull}25094[#25094]

Sequence IDs::
* 5.x - Move primary term from ReplicationRequest to ConcreteShardRequest {pull}25824[#25824] (issue: {issue}25822[#25822])
* Forward compatibility for primary context handoff on 6.x {pull}25545[#25545] (issue: {issue}25468[#25468])

Settings::
* Emit settings deprecation logging at most once {pull}25457[#25457]
* IndexMetaData: Introduce internal format index setting {pull}25292[#25292]

Snapshot/Restore::
* Improves snapshot logging and snapshot deletion error handling {pull}25264[#25264]

Stats::
* Update `IndexShard#refreshMetric` via a `ReferenceManager.RefreshListener` {pull}25083[#25083] (issues: {issue}24806[#24806], {issue}25052[#25052])

[float]
=== Bug Fixes

Aggregations::
* Fixes array out of bounds for value count agg {pull}26038[#26038] (issue: {issue}17379[#17379])

Aliases::
* mget with an alias shouldn't ignore alias routing {pull}25697[#25697] (issue: {issue}25696[#25696])

Allocation::
* Allow wildcards for shard IP filtering {pull}26187[#26187] (issues: {issue}22591[#22591], {issue}26184[#26184])

Analysis::
* Pre-configured shingle filter should disable graph analysis {pull}25853[#25853] (issue: {issue}25555[#25555])

CRUD::
* Serialize and expose timeout of acknowledged requests in REST layer (ES 5.6) {pull}26213[#26213] (issue: {issue}26189[#26189])

Cluster::
* Register setting `cluster.indices.tombstones.size` {pull}26193[#26193] (issue: {issue}26191[#26191])

Core::
* Release operation permit on thread-pool rejection {pull}25930[#25930] (issue: {issue}25863[#25863])
* Node should start up despite of a lingering `.es_temp_file` {pull}21210[#21210] (issue: {issue}21007[#21007])

Discovery::
* MasterNodeChangePredicate should use the node instance to detect master change {pull}25877[#25877] (issue: {issue}25471[#25471])

Engine::
* Engine - Do not store operations that are not index into lucene in the translog (5.x only) {pull}25592[#25592]

Geo::
* Fix GeoPoint FieldStats ternary logic bug {pull}25211[#25211] (issue: {issue}24275[#24275])

Highlighting::
* Fix nested query highlighting {pull}26305[#26305] (issue: {issue}26230[#26230])
* FastVectorHighlighter should not cache the field query globally {pull}25197[#25197] (issue: {issue}25171[#25171])

Index APIs::
* Shrink API should ignore templates {pull}25380[#25380] (issue: {issue}25035[#25035])
* Rollover max docs should only count primaries {pull}24977[#24977] (issue: {issue}24217[#24217])

Ingest::
* Sort Processor does not have proper behavior with targetField {pull}25237[#25237] (issue: {issue}24133[#24133])

Inner Hits::
* Fix inner hits to work with queries wrapped in an indices query {pull}26138[#26138] (issue: {issue}26133[#26133])
* When fetching nested inner hits only access stored fields when needed {pull}25864[#25864] (issue: {issue}6[#6])

Internal::
* Fix BytesReferenceStreamInput#skip with offset {pull}25634[#25634]
* Fix race condition in RemoteClusterConnection node supplier {pull}25432[#25432]
* Initialise empty lists in BaseTaskResponse constructor {pull}25290[#25290]

Java High Level REST Client::
* Register ip_range aggregation with the high level client {pull}26383[#26383]
* add top hits as a parsed aggregation to the rest high level client {pull}26370[#26370]

Logging::
* Lazy initialize deprecation logger in parser {pull}26210[#26210] (issue: {issue}25879[#25879])
* Allow not configure logging without config {pull}26209[#26209] (issues: {issue}20575[#20575], {issue}24076[#24076])
* Declare XContent deprecation logger as static {pull}25881[#25881] (issue: {issue}25879[#25879])

Mapping::
* ICUCollationKeywordFieldMapper use SortedSetDocValuesField {pull}26267[#26267]
* Fixed bug that mapper_parsing_exception is thrown for numeric field with ignore_malformed=true when inserting "NaN" {pull}25967[#25967] (issue: {issue}25289[#25289])
* Coerce decimal strings for whole number types by truncating the decimal part {pull}25835[#25835] (issue: {issue}25819[#25819])
* Fix parsing of ip range queries. {pull}25768[#25768] (issue: {issue}25636[#25636])
* Remove `fielddata:false` from mappings of non-analyzed strings. {pull}25542[#25542]
* Disable date field mapping changing {pull}25285[#25285] (issue: {issue}25271[#25271])
* token_count datatype should handle null value {pull}25046[#25046] (issue: {issue}24928[#24928])
* keep _parent field while updating child type mapping {pull}24407[#24407] (issue: {issue}23381[#23381])

Nested Docs::
* In case of a single type the _id field should be added to the nested document instead of _uid field {pull}25149[#25149]

Network::
* Release pipelined http responses on close {pull}26226[#26226]
* Ensure pending transport handlers are invoked for all channel failures {pull}25150[#25150]

Packaging::
* setgid on /etc/elasticearch on package install {pull}26412[#26412] (issue: {issue}26410[#26410])
* Stop disabling explicit GC {pull}25759[#25759]
* Avoid failing install if system-sysctl is masked {pull}25657[#25657] (issue: {issue}24234[#24234])
* Get short path name for native controllers {pull}25344[#25344]
* When stopping via systemd only kill the JVM, not its control group {pull}25195[#25195]

Parent/Child::
* The default _parent field should not try to load global ordinals {pull}25851[#25851] (issue: {issue}25849[#25849])

Plugin Lang Painless::
* Painless: allow doubles to be casted to longs. {pull}25936[#25936]

Plugin Repository HDFS::
* Upgrading HDFS Repository Plugin to use HDFS 2.8.1 Client {pull}25497[#25497] (issue: {issue}25450[#25450])

Query DSL::
* Parse "*" in query_string_query as MatchAllDocsQuery {pull}25872[#25872] (issues: {issue}25556[#25556], {issue}25726[#25726])
* SpanNearQueryBuilder should return the inner clause when a single clause is provided {pull}25856[#25856] (issue: {issue}25630[#25630])
* WrapperQueryBuilder should also rewrite the parsed query {pull}25480[#25480]

REST::
* Fix handling of exceptions thrown on HEAD requests {pull}25172[#25172] (issue: {issue}21125[#21125])

Search::
* Fix term(s) query for range field {pull}25918[#25918]
* Caching a MinDocQuery can lead to wrong results. {pull}25909[#25909]
* First increment shard stats before notifying and potentially sending response {pull}25818[#25818]
* Remove assertion about deviation when casting to a float. {pull}25806[#25806] (issue: {issue}25330[#25330])
* Prevent skipping shards if a suggest builder is present {pull}25739[#25739] (issue: {issue}25658[#25658])
* Ensure remote cluster alias is preserved in inner hits aggs {pull}25627[#25627] (issue: {issue}25606[#25606])
* Do not search locally if remote index pattern resolves to no indices {pull}25436[#25436] (issue: {issue}25426[#25426])

Settings::
* Fix settings serialization to not serialize secure settings or not take the total size into account {pull}25323[#25323]
* Keystore CLI should use the AddFileKeyStoreCommand for files {pull}25298[#25298]

Snapshot/Restore::
* Snapshot/Restore: fix NPE while handling null failure reasons {pull}26127[#26127] (issues: {issue}25878[#25878], {issue}25941[#25941])
* Snapshot/Restore: Ensure that shard failure reasons are correctly stored in CS {pull}25941[#25941] (issue: {issue}25878[#25878])
* Output all empty snapshot info fields if in verbose mode {pull}25455[#25455] (issue: {issue}24477[#24477])

Stats::
* _nodes/stats should not fail due to concurrent AlreadyClosedException {pull}25016[#25016] (issue: {issue}23099[#23099])

Suggesters::
* Context suggester should filter doc values field {pull}25858[#25858] (issue: {issue}25404[#25404])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Network::
* Upgrade to Netty 4.1.13.Final {pull}25581[#25581] (issues: {issue}24729[#24729], {issue}6866[#6866])

Upgrade API::
* Improve stability and logging of TemplateUpgradeServiceIT tests {pull}25386[#25386] (issue: {issue}25382[#25382])

[[release-notes-5.5.3]]
== {es} version 5.5.3

[float]
[[breaking-5.5.3]]
=== Breaking Changes

[[breaking-msi-5.5.3]]
Breaking MSI Windows Installer changes::
* Upgrades from 5.5.0, 5.5.1, 5.5.2. See https://github.com/elastic/windows-installers/releases/tag/v5.5.3[release notes]
** `ES_HOME` and `ES_CONFIG` environment variables unset after successful upgrade
** Windows Service stopped after successful upgrade

//[float]
//=== Breaking Java Changes

[float]
=== Deprecations

Mapping::
* Add deprecation logging when _all is enabled {pull}26228[#26228] (issue: {issue}22144[#22144])

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Packaging::
* setgid on /etc/elasticearch on package install {pull}26412[#26412] (issue: {issue}26410[#26410])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.5.2]]
== {es} version 5.5.2

//[float]
//[[breaking-5.5.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Aggregations::
* Fixes array out of bounds for value count agg {pull}26038[#26038] (issue: {issue}17379[#17379])

Core::
* Release operation permit on thread-pool rejection {pull}25930[#25930] (issue: {issue}25863[#25863])

Inner Hits::
* Fix inner hits to work with queries wrapped in an indices query {pull}26138[#26138] (issue: {issue}26133[#26133])
* When fetching nested inner hits only access stored fields when needed {pull}25864[#25864] (issue: {issue}6[#6])

Logging::
* Declare XContent deprecation logger as static {pull}25881[#25881] (issue: {issue}25879[#25879])

Query DSL::
* Parse "*" in query_string_query as MatchAllDocsQuery {pull}25872[#25872] (issues: {issue}25556[#25556], {issue}25726[#25726])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.5.1]]
== {es} version 5.5.1

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

//[float]
//[[breaking-5.5.1]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes


Aliases::
* mget with an alias shouldn't ignore alias routing {pull}25697[#25697] (issue: {issue}25696[#25696])

Engine::
* Engine - Do not store operations that are not index into lucene in the translog (5.x only) {pull}25592[#25592]

Internal::
* Fix BytesReferenceStreamInput#skip with offset {pull}25634[#25634]

Packaging::
* Stop disabling explicit GC {pull}25759[#25759]
* Avoid failing install if system-sysctl is masked {pull}25657[#25657] (issue: {issue}24234[#24234])
* Get short path name for native controllers {pull}25344[#25344]

Query DSL::
* WrapperQueryBuilder should also rewrite the parsed query {pull}25480[#25480]

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.5.0]]
== {es} version 5.5.0

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

[float]
[[breaking-5.5.0]]
=== Breaking Changes

Plugins::
* Remove hidden file leniency from spawner {pull}24079[#24079] (issue: {issue}23980[#23980])

Settings::
* Remove support for default settings {pull}24093[#24093] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074])

[float]
=== Breaking Java Changes

Aggregations::
* Remove the unused SignificantTerms.compareTerm() method {pull}24714[#24714]
* Make SignificantTerms.Bucket an interface rather than an abstract class {pull}24670[#24670] (issue: {issue}24492[#24492])
* Make Terms.Bucket an interface rather than an abstract class {pull}24492[#24492]

Plugin Delete By Query::
* Move DeleteByQuery and Reindex requests into core {pull}24578[#24578]

[float]
=== Deprecations

Index APIs::
* Deprecated use of + in index expressions {pull}24585[#24585] (issue: {issue}24515[#24515])

Packaging::
* Add deprecation warnings for $ES_USER and $ES_GROUP {pull}24190[#24190] (issue: {issue}23989[#23989])

Plugin Repository S3::
* S3 Repository: Deprecate remaining `repositories.s3.*` settings {pull}24144[#24144] (issue: {issue}24143[#24143])

REST::
* Add deprecation logging for comma-separated feature parsing {pull}25040[#25040] (issue: {issue}24723[#24723])

Scripting::
* Scripting: Deprecate native scripts {pull}24692[#24692] (issue: {issue}19966[#19966])
* Scripting: Deprecate index lookup {pull}24691[#24691] (issue: {issue}19359[#19359])
* Deprecate Fine Grain Settings for Scripts {pull}24573[#24573] (issue: {issue}24532[#24532])
* Scripting: Deprecate file script settings {pull}24555[#24555] (issue: {issue}21798[#21798])
* Scripting: Deprecate file scripts {pull}24552[#24552] (issue: {issue}21798[#21798])

Settings::
* Settings: Update settings deprecation from yml to yaml {pull}24663[#24663] (issue: {issue}19391[#19391])
* Deprecate settings in .yml and .json {pull}24059[#24059] (issue: {issue}19391[#19391])

Tribe Node::
* Deprecate tribe service {pull}24598[#24598] (issue: {issue}24581[#24581])

[float]
=== New Features

Mapping::
* Add new ip_range field type {pull}24433[#24433]

Plugin Analysis ICU::
* Add ICUCollationFieldMapper {pull}24126[#24126]

[float]
=== Enhancements


Aggregations::
* Add superset size to Significant Term REST response {pull}24865[#24865]
* Add document count to Matrix Stats aggregation response {pull}24776[#24776]
*  Share XContent rendering code in significant terms aggregations {pull}24677[#24677]
* Add `count` to rest output of `geo_centroid` {pull}24387[#24387] (issue: {issue}24366[#24366])
* Allow scripted metric agg to access `_score` {pull}24295[#24295]

Aliases::
* Handle multiple aliases in _cat/aliases api {pull}23698[#23698] (issue: {issue}23661[#23661])

Circuit Breakers::
* Closing a ReleasableBytesStreamOutput closes the underlying BigArray {pull}23941[#23941]

Cluster::
* Add a cluster block that allows to delete indices that are read-only {pull}24678[#24678]
* Extract a common base class to allow services to listen to remote cluster config updates {pull}24367[#24367]

Core::
* Explicitly reject duplicate data paths {pull}25178[#25178]
* Use SPI in High Level Rest Client to load XContent parsers {pull}25097[#25097]
* Improve bootstrap checks error messages {pull}24548[#24548]
* Regex upgrades {pull}24316[#24316] (issue: {issue}24226[#24226])
* Detect remnants of path.data/default.path.data bug {pull}24099[#24099] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074], {issue}24093[#24093])

Engine::
* Add refresh stats tracking for realtime get {pull}25052[#25052] (issue: {issue}24806[#24806])
* Engine: store maxUnsafeAutoIdTimestamp in commit {pull}24149[#24149]

Exceptions::
* IllegalStateException: Only duplicated jar instead of classpath {pull}24953[#24953]

Index APIs::
* Open and close index to honour allow_no_indices option {pull}24222[#24222] (issue: {issue}24031[#24031])

Ingest::
* add `exclude_keys` option to KeyValueProcessor {pull}24876[#24876] (issue: {issue}23856[#23856])

Inner Hits::
* Reuse inner hit query weight {pull}24571[#24571] (issue: {issue}23917[#23917])

Internal::
* "shard started" should show index and shard ID {pull}25157[#25157]
* Add the ability to set eager_global_ordinals in the new parent-join field {pull}25019[#25019]
* Add assertions enabled helper {pull}24834[#24834]
* Add cross cluster support to `_field_caps` {pull}24463[#24463] (issue: {issue}24334[#24334])
* Log JVM arguments on startup {pull}24451[#24451]
* Preserve cluster alias throughout search execution to lookup nodes by cluster and ID {pull}24438[#24438]
* Move RemoteClusterService into TransportService {pull}24424[#24424]
* Enum related performance additions. {pull}24274[#24274] (issue: {issue}24226[#24226])

Java API::
* Always Accumulate Transport Exceptions {pull}25017[#25017] (issue: {issue}23099[#23099])

Java High Level REST Client::
* Add doc_count to ParsedMatrixStats {pull}24952[#24952] (issue: {issue}24776[#24776])
* Add fromXContent method to ClearScrollResponse {pull}24909[#24909]
* ClearScrollRequest to implement ToXContentObject {pull}24907[#24907]
* SearchScrollRequest to implement ToXContentObject {pull}24906[#24906] (issue: {issue}3889[#3889])
* Backport aggs parsers for high level REST Client {pull}24844[#24844] (issues: {issue}22278[#22278], {issue}22668[#22668], {issue}23826[#23826], {issue}23965[#23965], {issue}23973[#23973], {issue}23974[#23974], {issue}24085[#24085], {issue}24155[#24155], {issue}24160[#24160], {issue}24162[#24162], {issue}24182[#24182], {issue}24183[#24183], {issue}24208[#24208], {issue}24213[#24213], {issue}24239[#24239], {issue}24284[#24284], {issue}24291[#24291], {issue}24312[#24312], {issue}24330[#24330], {issue}24365[#24365], {issue}24371[#24371], {issue}24442[#24442], {issue}24521[#24521], {issue}24524[#24524], {issue}24559[#24559], {issue}24564[#24564], {issue}24583[#24583], {issue}24589[#24589], {issue}24648[#24648], {issue}24667[#24667], {issue}24675[#24675], {issue}24682[#24682], {issue}24700[#24700], {issue}24706[#24706], {issue}24717[#24717], {issue}24720[#24720], {issue}24738[#24738], {issue}24746[#24746], {issue}24789[#24789], {issue}24791[#24791], {issue}24794[#24794], {issue}24822[#24822], {issue}24824[#24824])
* Add utility method to parse named XContent objects with typed prefix {pull}24240[#24240] (issue: {issue}22965[#22965])

Logging::
* Warn on not enough masters during election {pull}20063[#20063] (issue: {issue}8362[#8362])

Mapping::
* Do not index `_type` when there is at most one type. {pull}24363[#24363]
* Only allow one type on 6.0 indices {pull}24317[#24317] (issue: {issue}15613[#15613])
* token_count type : add an option to count tokens (fix #23227) {pull}24175[#24175] (issue: {issue}23227[#23227])

Network::
* Disable the Netty recycler in the client {pull}24793[#24793] (issues: {issue}22452[#22452], {issue}24721[#24721])
* Remove Netty logging hack {pull}24653[#24653] (issues: {issue}24469[#24469], {issue}5624[#5624], {issue}6568[#6568], {issue}6696[#6696])
* Set available processors for Netty {pull}24420[#24420] (issue: {issue}6224[#6224])

Packaging::
* Set number of processes in systemd unit file {pull}24970[#24970] (issue: {issue}20874[#20874])

Plugin Lang Painless::
* Optimize instance creation in LambdaBootstrap {pull}24618[#24618]
* Allow painless to load stored fields {pull}24290[#24290]

Plugin Repository GCS::
* GCS Repository: Add secure storage of credentials {pull}24697[#24697]

Plugins::
* Add purge option to remove plugin CLI {pull}24981[#24981]
* Move ReindexAction class to core {pull}24684[#24684] (issue: {issue}24578[#24578])
* Plugins: Add support for platform specific plugins {pull}24265[#24265]

REST::
* Make ObjectParser support string to boolean conversion {pull}24668[#24668] (issue: {issue}21802[#21802])
* Allow passing single scrollID in clear scroll API body {pull}24242[#24242] (issue: {issue}24233[#24233])

Scripting::
* Add Ability to Specify No Types/Contexts Allowed For Scripts {pull}24782[#24782]
* Add New Security Script Settings {pull}24637[#24637] (issue: {issue}24532[#24532])

Search::
* Eliminate array access in tight loops when profiling is enabled. {pull}24959[#24959]
* Support Multiple Inner Hits on a Field Collapse Request {pull}24517[#24517]
* Expand cross cluster search indices for search requests to the concrete index or to it's aliases {pull}24502[#24502]
* Remove leniency when merging fetched hits in a search response phase {pull}24158[#24158]

Search Templates::
* Add max concurrent searches to multi template search {pull}24255[#24255] (issues: {issue}20912[#20912], {issue}21907[#21907])

Settings::
* Emit settings deprecation logging at most once {pull}25457[#25457]

Snapshot/Restore::
* Improves snapshot logging and snapshot deletion error handling {pull}25264[#25264]
* Enhances get snapshots API to allow retrieving repository index only {pull}24477[#24477] (issue: {issue}24288[#24288])
* Ensure every repository has an incompatible-snapshots blob {pull}24403[#24403] (issue: {issue}22267[#22267])
* Change snapshot status error to use generic SnapshotException {pull}24355[#24355] (issue: {issue}24225[#24225])

Stats::
* Show JVM arguments {pull}24450[#24450]

Suggesters::
* Provide informative error message in case of unknown suggestion context. {pull}24241[#24241]
* Allow different data types for category in Context suggester {pull}23491[#23491] (issue: {issue}22358[#22358])

Upgrade API::
* Allow plugins to upgrade templates and index metadata on startup {pull}24379[#24379]

[float]
=== Bug Fixes

Aggregations::
* Terms aggregation should remap global ordinal buckets when a sub-aggregator is used to sort the terms {pull}24941[#24941] (issue: {issue}24788[#24788])
* Correctly set doc_count when MovAvg "predicts" values on existing buckets {pull}24892[#24892] (issue: {issue}24327[#24327])
* InternalPercentilesBucket should not rely on ordered percents array {pull}24336[#24336] (issue: {issue}24331[#24331])
* Align behavior HDR percentiles iterator with percentile() method {pull}24206[#24206]
* DateHistogram: Fix `extended_bounds` with `offset` {pull}23789[#23789] (issue: {issue}23776[#23776])
* Fix ArrayIndexOutOfBoundsException when no ranges are specified in the query {pull}23241[#23241] (issue: {issue}22881[#22881])

Aliases::
* GET aliases should 404 if aliases are missing {pull}25043[#25043] (issue: {issue}24644[#24644])

Allocation::
* Discard stale node responses from async shard fetching {pull}24434[#24434] (issue: {issue}24007[#24007])

Analysis::
* PatternAnalyzer should lowercase wildcard queries when `lowercase` is true. {pull}24967[#24967]

Bulk::
* Reject empty IDs {pull}24118[#24118] (issue: {issue}24116[#24116])

Cache::
* fix bug of weight computation {pull}24856[#24856]

Circuit Breakers::
* Checks the circuit breaker before allocating bytes for a new big array {pull}25010[#25010] (issue: {issue}24790[#24790])

Core::
* Fix cache expire after access {pull}24546[#24546]
* Check for default.path.data included in path.data {pull}24285[#24285] (issue: {issue}24283[#24283])

Geo::
* Fix GeoPoint FieldStats ternary logic bug {pull}25211[#25211] (issue: {issue}24275[#24275])
* Fix GeoDistance Ordinal for BWC {pull}25033[#25033] (issue: {issue}24816[#24816])

Highlighting::
* Higlighters: Fix MultiPhrasePrefixQuery rewriting {pull}25103[#25103] (issue: {issue}25088[#25088])

Index APIs::
* Rollover max docs should only count primaries {pull}24977[#24977] (issue: {issue}24217[#24217])
* Fix legacy GeoPointField decoding in FieldStats {pull}24534[#24534] (issue: {issue}24275[#24275])
* Validates updated settings on closed indices {pull}24487[#24487] (issue: {issue}23787[#23787])
* Fixes restore of a shrunken index when initial recovery node is gone {pull}24322[#24322] (issue: {issue}24257[#24257])

Ingest::
* fix grok's pattern parsing to validate pattern names in expression {pull}25063[#25063] (issue: {issue}22831[#22831])
* Fix floating-point error when DateProcessor parses UNIX {pull}24947[#24947]
* add option for _ingest.timestamp to use new ZonedDateTime (5.x backport) {pull}24030[#24030] (issues: {issue}23168[#23168], {issue}23174[#23174])

Inner Hits::
* Fix Source filtering in new field collapsing feature {pull}24068[#24068] (issue: {issue}24063[#24063])

Internal::
* Fix race condition in RemoteClusterConnection node supplier {pull}25432[#25432]
* Initialise empty lists in BaseTaskResponse constructor {pull}25290[#25290]
* Extract a common base class for scroll executions {pull}24979[#24979] (issue: {issue}16555[#16555])
* Ensure remote cluster is connected before fetching `_field_caps` {pull}24845[#24845] (issue: {issue}24763[#24763])
* Obey lock order if working with store to get metadata snapshots {pull}24787[#24787] (issue: {issue}24481[#24481])
* Remove `_UNRELEASED` from Version constants for released versions {pull}24764[#24764]
* Fix `_field_caps` serialization in order to support cross cluster search {pull}24722[#24722]
* Avoid race when shutting down controller processes {pull}24579[#24579]
* Fix NPE if field caps request has a field that exists not in all indices {pull}24504[#24504]

More Like This::
* Pass over _routing value with more_like_this items to be retrieved {pull}24679[#24679] (issue: {issue}23699[#23699])

Nested Docs::
* In case of a single type the _id field should be added to the nested document instead of _uid field {pull}25149[#25149]

Network::
* Ensure pending transport handlers are invoked for all channel failures {pull}25150[#25150]
* Notify onConnectionClosed rather than onNodeDisconnect to prune transport handlers {pull}24639[#24639] (issues: {issue}24557[#24557], {issue}24575[#24575], {issue}24632[#24632])
* SniffNodesSampler should close connection after handling responses {pull}24632[#24632] (issues: {issue}22828[#22828], {issue}24557[#24557], {issue}24575[#24575])

Packaging::
* When stopping via systemd only kill the JVM, not its control group {pull}25195[#25195]
* Handle parentheses in batch file path {pull}24731[#24731] (issue: {issue}24712[#24712])

Percolator::
* Fix range queries with date range based on current time in percolator queries. {pull}24666[#24666] (issue: {issue}23921[#23921])
* For legacy indices rewrite percolator query upon percolation time {pull}24617[#24617] (issue: {issue}24485[#24485])
* Fix memory leak when percolator uses bitset or field data cache {pull}24115[#24115] (issue: {issue}24108[#24108])

Plugin Lang Painless::
* painless: Fix method references to ctor with the new LambdaBootstrap and cleanup code {pull}24406[#24406]
* Fix Painless Lambdas for Java 9 {pull}24070[#24070] (issue: {issue}23473[#23473])

Plugins::
* X-Pack plugin download fails on Windows desktop {pull}24570[#24570]
* Fix plugin installation permissions {pull}24527[#24527] (issue: {issue}24480[#24480])
* Fix delete of plugin directory on remove plugin {pull}24266[#24266] (issue: {issue}24252[#24252])
* Use a marker file when removing a plugin {pull}24252[#24252] (issue: {issue}24231[#24231])
* Remove hidden file leniency from plugin service {pull}23982[#23982] (issue: {issue}12465[#12465])

Query DSL::
* Thread falls into infinite loop when processing Indices query {pull}24736[#24736] (issue: {issue}24735[#24735])

REST::
* Fix handling of exceptions thrown on HEAD requests {pull}25172[#25172] (issue: {issue}21125[#21125])
* Fixed NPEs caused by requests without content. {pull}23497[#23497] (issue: {issue}24701[#24701])
* Fix get mappings HEAD requests {pull}23192[#23192] (issue: {issue}21125[#21125])

Recovery::
* Provide target allocation id as part of start recovery request {pull}24333[#24333] (issue: {issue}24167[#24167])

Reindex API::
* Reindex: don't duplicate _source parameter {pull}24629[#24629] (issue: {issue}24628[#24628])
* Add qa module that tests reindex-from-remote against pre-5.0 versions of Elasticsearch {pull}24561[#24561] (issues: {issue}23828[#23828], {issue}24520[#24520])

Scroll::
* Fix single shard scroll within a cluster with nodes in version `>= 5.3` and `<= 5.3` {pull}24512[#24512]

Search::
* Adds check for negative search request size {pull}25397[#25397] (issue: {issue}22530[#22530])
* Do not search locally if remote index pattern resolves to no indices {pull}25436[#25436] (issue: {issue}25426[#25426])
* Make sure range queries are correctly profiled. {pull}25108[#25108]
* Compute the took time of the query after the expand phase of field collapsing {pull}24902[#24902] (issue: {issue}24900[#24900])
* Fix RangeFieldMapper rangeQuery to properly handle relations {pull}24808[#24808] (issue: {issue}24744[#24744])
* Fix ExpandSearchPhase when response contains no hits {pull}24688[#24688] (issue: {issue}24672[#24672])
* Include all aliases including non-filtering in  `_search_shards` response {pull}24489[#24489]
* Cross Cluster Search: propagate original indices per cluster {pull}24328[#24328]

Search Templates::
* No longer add illegal content type option to stored search templates {pull}24251[#24251] (issue: {issue}24227[#24227])

Settings::
* Keystore CLI should use the AddFileKeyStoreCommand for files {pull}25298[#25298]
* Settings: Fix setting groups to include secure settings {pull}25076[#25076] (issue: {issue}25069[#25069])
* Allow resetting settings that use an IP validator {pull}24713[#24713] (issue: {issue}24709[#24709])
* Do not set path.data in environment if not set {pull}24132[#24132] (issue: {issue}24099[#24099])

Snapshot/Restore::
* Output all empty snapshot info fields if in verbose mode {pull}25455[#25455] (issue: {issue}24477[#24477])
* Remove redundant and broken MD5 checksum from repository-s3 {pull}25270[#25270] (issue: {issue}25269[#25269])
* Consolidates the logic for cleaning up snapshots on master election {pull}24894[#24894] (issue: {issue}24605[#24605])
* Removes completed snapshot from cluster state on master change {pull}24605[#24605] (issue: {issue}24452[#24452])
* Fix inefficient (worst case exponential) loading of snapshot repository {pull}24510[#24510] (issue: {issue}24509[#24509])
* Fixes maintaining the shards a snapshot is waiting on {pull}24289[#24289]

Stats::
* _nodes/stats should not fail due to concurrent AlreadyClosedException {pull}25016[#25016] (issue: {issue}23099[#23099])
* Avoid double decrement on current query counter {pull}24922[#24922] (issues: {issue}22996[#22996], {issue}24872[#24872])

Suggesters::
* Fix context suggester to read values from keyword type field {pull}24200[#24200] (issue: {issue}24129[#24129])

Task Manager::
* Task Management: Make TaskInfo parsing forwards compatible {pull}24073[#24073] (issue: {issue}23250[#23250])

[float]
=== Regressions

Highlighting::
* Fix Fast Vector Highlighter NPE on match phrase prefix {pull}25116[#25116] (issue: {issue}25088[#25088])

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.5.1 {pull}24399[#24399]

Network::
* Upgrade to Netty 4.1.11.Final {pull}24652[#24652]
* Upgrade Netty to 4.1.10.Final {pull}24414[#24414]

[[release-notes-5.4.3]]
== {es} version 5.4.3

//[float]
//[[breaking-5.4.3]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Snapshot/Restore::
* Improves snapshot logging and snapshot deletion error handling {pull}25264[#25264]

[float]
=== Bug Fixes

Snapshot/Restore::
* Remove redundant and broken MD5 checksum from repository-s3 {pull}25270[#25270] (issue: {issue}25269[#25269])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.4.2]]
== {es} version 5.4.2

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

//[float]
//[[breaking-5.4.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Core::
* Explicitly reject duplicate data paths {pull}25178[#25178]

Packaging::
* Set number of processes in systemd unit file {pull}24970[#24970] (issue: {issue}20874[#20874])

[float]
=== Bug Fixes

Aggregations::
* Terms aggregation should remap global ordinal buckets when a sub-aggregator is used to sort the terms {pull}24941[#24941] (issue: {issue}24788[#24788])

Analysis::
* PatternAnalyzer should lowercase wildcard queries when `lowercase` is true. {pull}24967[#24967]

Circuit Breakers::
* Checks the circuit breaker before allocating bytes for a new big array {pull}25010[#25010] (issue: {issue}24790[#24790])

Geo::
* Fix GeoPoint FieldStats ternary logic bug {pull}25211[#25211] (issue: {issue}24275[#24275])
* Fix GeoDistance Ordinal for BWC {pull}25033[#25033] (issue: {issue}24816[#24816])

Index APIs::
* Rollover max docs should only count primaries {pull}24977[#24977] (issue: {issue}24217[#24217])

Nested Docs::
* Fix the `max` score mode. {pull}25216[#25216] (issue: {issue}24647[#24647])

Network::
* Ensure pending transport handlers are invoked for all channel failures {pull}25150[#25150]

Packaging::
* When stopping via systemd only kill the JVM, not its control group {pull}25195[#25195]

Suggesters::
* Fix context suggester to read values from keyword type field {pull}24200[#24200] (issue: {issue}24129[#24129])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.4.1]]
== {es} version 5.4.1

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

//[float]
//[[breaking-5.4.1]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Aggregations::
* Allow scripted metric agg to access `_score` {pull}24295[#24295]

Core::
* Improve bootstrap checks error messages {pull}24548[#24548]

Internal::
* Log JVM arguments on startup {pull}24451[#24451]

Network::
* Disable the Netty recycler in the client {pull}24793[#24793] (issues: {issue}22452[#22452], {issue}24721[#24721])
* Remove Netty logging hack {pull}24653[#24653] (issues: {issue}24469[#24469], {issue}5624[#5624], {issue}6568[#6568], {issue}6696[#6696])
* Set available processors for Netty {pull}24420[#24420] (issue: {issue}6224[#6224])

Snapshot/Restore::
* Ensure every repository has an incompatible-snapshots blob {pull}24403[#24403] (issue: {issue}22267[#22267])

Stats::
* Show JVM arguments {pull}24450[#24450]

[float]
=== Bug Fixes

Aggregations::
* Fix ArrayIndexOutOfBoundsException when no ranges are specified in the query {pull}23241[#23241] (issue: {issue}22881[#22881])

Allocation::
* Discard stale node responses from async shard fetching {pull}24434[#24434] (issue: {issue}24007[#24007])

Core::
* Fix cache expire after access {pull}24546[#24546]

Index APIs::
* Fix legacy GeoPointField decoding in FieldStats {pull}24534[#24534] (issue: {issue}24275[#24275])
* Validates updated settings on closed indices {pull}24487[#24487] (issue: {issue}23787[#23787])

Internal::
* Remove `_UNRELEASED` from Version constants for released versions {pull}24764[#24764]
* Avoid race when shutting down controller processes {pull}24579[#24579]
* Fix NPE if field caps request has a field that exists not in all indices {pull}24504[#24504]

More Like This::
* Pass over _routing value with more_like_this items to be retrieved {pull}24679[#24679] (issue: {issue}23699[#23699])

Network::
* Notify onConnectionClosed rather than onNodeDisconnect to prune transport handlers {pull}24639[#24639] (issues: {issue}24557[#24557], {issue}24575[#24575], {issue}24632[#24632])
* SniffNodesSampler should close connection after handling responses {pull}24632[#24632] (issues: {issue}22828[#22828], {issue}24557[#24557], {issue}24575[#24575])

Packaging::
* Handle parentheses in batch file path {pull}24731[#24731] (issue: {issue}24712[#24712])

Percolator::
* Fix range queries with date range based on current time in percolator queries. {pull}24666[#24666] (issue: {issue}23921[#23921])

Plugin Repository HDFS::
* Fixing permission errors for `KERBEROS` security mode for HDFS Repository {pull}23439[#23439] (issue: {issue}22156[#22156])

Plugins::
* X-Pack plugin download fails on Windows desktop [ISSUE] {pull}24570[#24570]
* Fix plugin installation permissions {pull}24527[#24527] (issue: {issue}24480[#24480])

Reindex API::
* Reindex: don't duplicate _source parameter {pull}24629[#24629] (issue: {issue}24628[#24628])
* Add qa module that tests reindex-from-remote against pre-5.0 versions of Elasticsearch {pull}24561[#24561] (issues: {issue}23828[#23828], {issue}24520[#24520])

Scroll::
* Fix single shard scroll within a cluster with nodes in version `>= 5.3` and `<= 5.3` {pull}24512[#24512]

Search::
* Fix ExpandSearchPhase when response contains no hits {pull}24688[#24688] (issue: {issue}24672[#24672])
* Include all aliases including non-filtering in  `_search_shards` response {pull}24489[#24489]

Settings::
* Allow resetting settings that use an IP validator {pull}24713[#24713] (issue: {issue}24709[#24709])

Snapshot/Restore::
* Removes completed snapshot from cluster state on master change {pull}24605[#24605] (issue: {issue}24452[#24452])
* Fix inefficient (worst case exponential) loading of snapshot repository {pull}24510[#24510] (issue: {issue}24509[#24509])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.5.1 {pull}24399[#24399]

Network::
* Upgrade to Netty 4.1.11.Final {pull}24652[#24652]
* Upgrade Netty to 4.1.10.Final {pull}24414[#24414]

[[release-notes-5.4.0]]
== {es} version 5.4.0

[[release-notes-5.4.0]]
== 5.4.0 Release Notes

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

[float]
[[breaking-5.4.0]]
=== Breaking Changes

Settings::
* Remove support for default settings {pull}24093[#24093] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074])

[float]
=== Breaking Java Changes

Aggregations::
* Move getProperty method out of MultiBucketsAggregation.Bucket interface {pull}23988[#23988]
* Remove getProperty method from Aggregations interface and impl {pull}23972[#23972]
* Move getProperty method out of Aggregation interface {pull}23949[#23949]

Java API::
* Fold InternalSearchHits and friends into their interfaces {pull}23042[#23042]

[float]
=== Deprecations

Aggregations::
* Deprecate Stats#getCountAsString {pull}24292[#24292]

Java API::
* Add BulkProcessor methods with XContentType parameter {pull}23078[#23078] (issue: {issue}22691[#22691])

Network::
* Deprecate Netty 3 {pull}23459[#23459] (issue: {issue}23411[#23411])

Packaging::
* Add deprecation warnings for $ES_USER and $ES_GROUP {pull}24190[#24190] (issue: {issue}23989[#23989])

Plugin Delete By Query::
* Deprecate delete_by_query requests without an explicit query {pull}23635[#23635]

Plugin Repository Azure::
* Deprecate global `repositories.azure` settings {pull}22856[#22856] (issue: {issue}22800[#22800])

Plugin Repository S3::
* Deprecate repositories.s3 settings {pull}23278[#23278] (issues: {issue}22800[#22800], {issue}23276[#23276])

REST::
* Deprecate ldjson support and document ndjson for bulk/msearch {pull}23051[#23051] (issues: {issue}23025[#23025], {issue}23049[#23049])

Stats::
* Deprecate `_field_stats` endpoint {pull}23914[#23914]

[float]
=== New Features

Analysis::
* Adds pattern keyword marker filter support {pull}23600[#23600] (issue: {issue}4877[#4877])
* Expose WordDelimiterGraphTokenFilter {pull}23327[#23327] (issue: {issue}23104[#23104])

Index APIs::
* Add FieldCapabilities (`_field_caps`) API {pull}23007[#23007] (issue: {issue}22438[#22438])

Search::
* Introduce incremental reduction of TopDocs {pull}23946[#23946]

Similarities::
* Adds boolean similarity to Elasticsearch {pull}23637[#23637] (issue: {issue}6731[#6731])

[float]
=== Enhancements

Aggregations::
* Add BucketMetricValue interface {pull}24188[#24188]
* Move aggs CommonFields and TYPED_KEYS_DELIMITER from InternalAggregation to Aggregation {pull}23987[#23987]
* Use ParseField for aggs CommonFields rather than String {pull}23717[#23717]
* Share XContent rendering code in terms aggs {pull}23680[#23680]
* Add unit tests for ParentToChildAggregator {pull}23305[#23305] (issue: {issue}22278[#22278])
* First step towards incremental reduction of query responses {pull}23253[#23253]

Allocation::
* Trigger replica recovery restarts by master when primary relocation completes {pull}23926[#23926] (issue: {issue}23904[#23904])
* Makes the same_shard host dynamically updatable {pull}23397[#23397] (issue: {issue}22992[#22992])

Analysis::
* Support Keyword type in Analyze API {pull}23161[#23161]

Cluster::
* Prevent nodes from joining if newer indices exist in the cluster {pull}23843[#23843]

Core::
* Detect remnants of path.data/default.path.data bug {pull}24099[#24099] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074], {issue}24093[#24093])
* Await termination after shutting down executors {pull}23889[#23889]
* Add early-access check {pull}23743[#23743] (issue: {issue}23668[#23668])
* Adapter action future should restore interrupts {pull}23618[#23618] (issue: {issue}23617[#23617])
* Disable bootstrap checks for single-node discovery {pull}23598[#23598] (issues: {issue}23585[#23585], {issue}23595[#23595])
* Enable explicitly enforcing bootstrap checks {pull}23585[#23585] (issue: {issue}21864[#21864])
* Add equals/hashcode method to ReplicationResponse {pull}23215[#23215]

Dates::
* Improve error handling for epoch format parser with time zone (#22621) {pull}23689[#23689]

Discovery::
* Introduce single-node discovery {pull}23595[#23595]
* UnicastZenPing shouldn't ping the address of the local node {pull}23567[#23567]
* MasterFaultDetection can start after the initial cluster state has been processed {pull}23037[#23037] (issue: {issue}22828[#22828])

Highlighting::
* Add support for fragment_length in the unified highlighter {pull}23431[#23431]
* Add BreakIteratorBoundaryScanner support {pull}23248[#23248]

Index APIs::
* Wildcard cluster names for cross cluster search {pull}23985[#23985] (issue: {issue}23893[#23893])

Ingest::
* Lazy load the geoip databases {pull}23337[#23337]

Internal::
* Add a dedicated TransportRemoteInfoAction for consistency {pull}24040[#24040] (issue: {issue}23969[#23969])
* Simplify sorted top docs merging in SearchPhaseController {pull}23881[#23881]
* Synchronized CollapseTopFieldDocs with lucenes relatives {pull}23854[#23854]
* Cleanup SearchPhaseController interface {pull}23844[#23844]
* Do not create String instances in 'Strings' methods accepting StringBuilder {pull}22907[#22907]

Java API::
* Added types options to DeleteByQueryRequest {pull}23265[#23265] (issue: {issue}21984[#21984])

Java High Level REST Client::
* Convert suggestion response parsing to use NamedXContentRegistry {pull}23355[#23355]
* UpdateRequest implements ToXContent {pull}23289[#23289]
* Add javadoc for DocWriteResponse.Builders {pull}23267[#23267]
* Expose WriteRequest.RefreshPolicy string representation {pull}23106[#23106]
* Use `typed_keys` parameter to prefix suggester names by type in search responses {pull}23080[#23080] (issue: {issue}22965[#22965])
* Add parsing methods to BulkItemResponse {pull}22859[#22859]

Logging::
* Warn on not enough masters during election {pull}20063[#20063] (issue: {issue}8362[#8362])

Mapping::
* Improve error message for ipv6 on legacy ip fields {pull}23136[#23136] (issue: {issue}23126[#23126])

Nested Docs::
* Avoid adding unnecessary nested filters when ranges are used. {pull}23427[#23427]

Network::
* Adjust default Netty receive predictor size to 64k {pull}23542[#23542] (issue: {issue}23185[#23185])
* Keep the pipeline handler queue small initially {pull}23335[#23335]
* Set network receive predictor size to 32kb {pull}23284[#23284] (issue: {issue}23185[#23185])
* TransportService.connectToNode should validate remote node ID {pull}22828[#22828] (issue: {issue}22194[#22194])

Packaging::
* Introduce Java version check {pull}23194[#23194] (issue: {issue}21102[#21102])
* Cleanup some things after removal of joda-time hack {pull}18959[#18959]

Percolator::
* Allowing range queries with now ranges inside percolator queries {pull}23921[#23921] (issue: {issue}23859[#23859])
* Add term extraction support for MultiPhraseQuery {pull}23176[#23176]

Plugin Discovery EC2::
* Settings: Migrate ec2 discovery sensitive settings to elasticsearch keystore {pull}23961[#23961] (issue: {issue}22475[#22475])

Plugin Lang Painless::
* Allow painless to load stored fields {pull}24290[#24290]
* Start on custom whitelists for Painless {pull}23563[#23563]
* Fix Painless's implementation of interfaces returning primitives {pull}23298[#23298] (issue: {issue}22983[#22983])
* Allow painless to implement more interfaces {pull}22983[#22983]

Plugin Repository Azure::
* Add Backoff policy to azure repository {pull}23387[#23387] (issue: {issue}22728[#22728])

Plugin Repository S3::
* Removes the retry mechanism from the S3 blob store {pull}23952[#23952] (issue: {issue}22845[#22845])
* S3 Repository: Eagerly load static settings {pull}23910[#23910]

Plugins::
* Modify permissions dialog for plugins {pull}23742[#23742]
* Plugins: Add plugin cli specific exit codes {pull}23599[#23599] (issue: {issue}15295[#15295])
* Plugins: Output better error message when existing plugin is incompatible {pull}23562[#23562] (issue: {issue}20691[#20691])

Query DSL::
* Make it possible to validate a query on all shards instead of a single random shard {pull}23697[#23697] (issue: {issue}18254[#18254])

REST::
* Validate top-level keys when parsing mget requests {pull}23746[#23746] (issue: {issue}23720[#23720])
* Cluster stats should not render empty http/transport types {pull}23735[#23735]
* Add parameter to prefix aggs name with type in search responses {pull}22965[#22965]

Search::
* Set shard count limit to unlimited {pull}24012[#24012]
* Streamline shard index availability in all SearchPhaseResults {pull}23788[#23788]
* Search took time should use a relative clock {pull}23662[#23662]
* Prevent negative `from` parameter in SearchSourceBuilder {pull}23358[#23358] (issue: {issue}23324[#23324])
* Remove unnecessary result sorting in SearchPhaseController {pull}23321[#23321]
* Expose `batched_reduce_size` via `_search` {pull}23288[#23288] (issue: {issue}23253[#23253])
* Adding fromXContent to Suggest and Suggestion class {pull}23226[#23226] (issue: {issue}23202[#23202])
* Adding fromXContent to Suggestion.Entry and subclasses {pull}23202[#23202]
* Add CollapseSearchPhase as a successor for the FetchSearchPhase {pull}23165[#23165]
* Integrate IndexOrDocValuesQuery. {pull}23119[#23119]
* Detach SearchPhases from AbstractSearchAsyncAction {pull}23118[#23118]
* Fix GraphQuery expectation after Lucene upgrade to 6.5 {pull}23117[#23117] (issue: {issue}23102[#23102])
* Nested queries should avoid adding unnecessary filters when possible. {pull}23079[#23079] (issue: {issue}20797[#20797])
* Add xcontent parsing to completion suggestion option {pull}23071[#23071]
* Add xcontent parsing to suggestion options {pull}23018[#23018]
* Separate reduce (aggs, suggest and profile) from merging fetched hits {pull}23017[#23017]

Settings::
* Add secure file setting to keystore {pull}24001[#24001]
* Add a setting which specifies a list of setting {pull}23883[#23883]
* Add a property to mark setting as final {pull}23872[#23872]
* Remove obsolete index setting `index.version.minimum_compatible`. {pull}23593[#23593]
* Provide a method to retrieve a closeable char[] from a SecureString {pull}23389[#23389]
* Update indices settings api to support CBOR and SMILE format {pull}23309[#23309] (issues: {issue}23242[#23242], {issue}23245[#23245])
* Improve setting deprecation message {pull}23156[#23156] (issue: {issue}22849[#22849])

Snapshot/Restore::
* Change snapshot status error to use generic SnapshotException {pull}24355[#24355] (issue: {issue}24225[#24225])

Stats::
* Add cross-cluster search remote cluster info API {pull}23969[#23969] (issue: {issue}23925[#23925])

Task Manager::
* Allow task to be unregistered by ClusterStateApplier {pull}23931[#23931]
* Limit IndexRequest toString() length {pull}22832[#22832]

[float]
=== Bug Fixes

Aggregations::
* Align behavior HDR percentiles iterator with percentile() method {pull}24206[#24206]
* The `filter` and `significant_terms` aggregations should parse the `filter` as a filter, not a query. {pull}23797[#23797]
* Completion suggestion should also consider text if prefix/regex is missing {pull}23451[#23451] (issue: {issue}23340[#23340])
* Fixes the per term error in the terms aggregation {pull}23399[#23399]
* Fixes terms error count for multiple reduce phases {pull}23291[#23291] (issue: {issue}23286[#23286])
* Restore support for the `include/pattern` syntax. {pull}23140[#23140] (issue: {issue}22933[#22933])

Bulk::
* Reject empty IDs {pull}24118[#24118] (issue: {issue}24116[#24116])

CRUD::
* Fix backport executing ops as single item bulk {pull}23083[#23083] (issues: {issue}21964[#21964], {issue}23069[#23069])

Cluster::
* Don't set local node on cluster state used for node join validation {pull}23311[#23311] (issues: {issue}21830[#21830], {issue}3[#3], {issue}4[#4], {issue}6[#6], {issue}9[#9])
* Allow a cluster state applier to create an observer and wait for a better state {pull}23132[#23132] (issue: {issue}21817[#21817])
* Cluster allocation explain to never return empty response body {pull}23054[#23054]

Core::
* Check for default.path.data included in path.data {pull}24285[#24285] (issue: {issue}24283[#24283])
* Improve performance of extracting warning value {pull}24114[#24114] (issue: {issue}24018[#24018])
* Reject duplicate settings on the command line {pull}24053[#24053]
* Restrict build info loading to ES jar, not any jar {pull}24049[#24049] (issue: {issue}21955[#21955])

Discovery::
* ZenDiscovery - only validate min_master_nodes values if local node is master {pull}23915[#23915] (issue: {issue}23695[#23695])

Index APIs::
* Fixes restore of a shrunken index when initial recovery node is gone {pull}24322[#24322] (issue: {issue}24257[#24257])
* Honor update request timeout {pull}23825[#23825]

Ingest::
* Improve missing ingest processor error {pull}23379[#23379] (issue: {issue}23392[#23392])
* update _ingest.timestamp to use new ZonedDateTime {pull}23174[#23174] (issue: {issue}23168[#23168])

Inner Hits::
* Replace NestedChildrenQuery with ParentChildrenBlockJoinQuery {pull}24016[#24016] (issue: {issue}24009[#24009])
* Changed DisMaxQueryBuilder to extract inner hits from leaf queries {pull}23512[#23512] (issue: {issue}23482[#23482])

Internal::
* Add infrastructure to mark contexts as system contexts {pull}23830[#23830]
* Always restore the ThreadContext for operations delayed due to a block {pull}23349[#23349]

Java High Level REST Client::
* Correctly parse BulkItemResponse.Failure's status {pull}23432[#23432]

Java REST Client::
* Make buffer limit configurable in HeapBufferedConsumerFactory {pull}23970[#23970] (issue: {issue}23958[#23958])
* RestClient asynchronous execution should not throw exceptions {pull}23307[#23307]

Mapping::
* Preserve response headers when creating an index {pull}23950[#23950] (issue: {issue}23947[#23947])
* Improves disabled fielddata error message {pull}23841[#23841] (issue: {issue}22768[#22768])
* Switch include_in_all in multifield to warning {pull}23656[#23656] (issues: {issue}21971[#21971], {issue}23654[#23654])
* Fix MapperService StackOverflowError {pull}23605[#23605] (issue: {issue}23604[#23604])
* Fix NPE with scaled floats stats when field is not indexed {pull}23528[#23528] (issue: {issue}23487[#23487])

Network::
* Fix possible hang in local transport when nodes get concurrently disconnected {pull}23962[#23962] (issue: {issue}23942[#23942])
* Respect promises on pipelined responses {pull}23317[#23317] (issues: {issue}23310[#23310], {issue}23322[#23322])
* Ensure that releasing listener is called {pull}23310[#23310]

Packaging::
* Fall back to non-atomic move when removing plugins {pull}23548[#23548] (issue: {issue}35[#35])

Percolator::
* Fix memory leak when percolator uses bitset or field data cache {pull}24115[#24115] (issue: {issue}24108[#24108])

Plugin Ingest Attachment::
* Remove support for Visio and potm files {pull}23214[#23214] (issues: {issue}22077[#22077], {issue}22079[#22079], {issue}22963[#22963])

Plugin Lang Painless::
* Fix painless's regex lexer and error messages {pull}23634[#23634]
* Replace Painless's Cast with casting strategies {pull}23369[#23369]
* Fix Bad Casts In Painless {pull}23282[#23282] (issue: {issue}23238[#23238])

Plugin Repository Azure::
* Azure blob store's readBlob() method first checks if the blob exists {pull}23483[#23483] (issue: {issue}23480[#23480])

Plugin Repository S3::
* Handle BlobPath's trailing separator case. Add test cases to BlobPathTests.java {pull}23091[#23091]

Plugins::
* Fix delete of plugin directory on remove plugin {pull}24266[#24266] (issue: {issue}24252[#24252])
* Use a marker file when removing a plugin {pull}24252[#24252] (issue: {issue}24231[#24231])

Query DSL::
* FuzzyQueryBuilder should error when parsing array of values {pull}23762[#23762] (issue: {issue}23759[#23759])

REST::
* [API] change wait_for_completion default according to docs {pull}23672[#23672]
* Deprecate request_cache for clear-cache {pull}23638[#23638] (issue: {issue}22748[#22748])
* HTTP transport stashes the ThreadContext instead of the RestController {pull}23456[#23456]
* Ensure we try to autodetect content type for handlers that support plain text {pull}23452[#23452]
* Fix date format in warning headers {pull}23418[#23418] (issue: {issue}23275[#23275])
* Align REST specs for HEAD requests {pull}23313[#23313] (issue: {issue}21125[#21125])
* Correct warning header to be compliant {pull}23275[#23275] (issue: {issue}22986[#22986])
* Fix get HEAD requests {pull}23186[#23186] (issue: {issue}21125[#21125])
* Fix search scroll request with a plain text body {pull}23183[#23183] (issue: {issue}22691[#22691])
* Handle bad HTTP requests {pull}23153[#23153] (issue: {issue}23034[#23034])
* Fix get source HEAD requests {pull}23151[#23151] (issue: {issue}21125[#21125])
* Properly encode location header {pull}23133[#23133] (issues: {issue}21057[#21057], {issue}23115[#23115])
* Fix template HEAD requests {pull}23130[#23130] (issue: {issue}21125[#21125])
* Fix index HEAD requests {pull}23112[#23112] (issue: {issue}21125[#21125])
* Fix alias HEAD requests {pull}23094[#23094] (issue: {issue}21125[#21125])

Recovery::
* Provide target allocation id as part of start recovery request {pull}24333[#24333] (issue: {issue}24167[#24167])

Reindex API::
* Fix throttled reindex_from_remote {pull}23953[#23953] (issues: {issue}23828[#23828], {issue}23945[#23945])
* Fix reindex with a remote source on a version before 2.0.0 {pull}23805[#23805]
* Make reindex wait for cleanup before responding {pull}23677[#23677] (issue: {issue}23653[#23653])

Scripting::
* Remove unnecessary Groovy deprecation logging {pull}23410[#23410] (issue: {issue}23401[#23401])
* Convert script/template objects to json format internally {pull}23308[#23308] (issue: {issue}23245[#23245])
* Script: Fix value of `ctx._now` to be current epoch time in milliseconds {pull}23175[#23175] (issue: {issue}23169[#23169])

Search::
* Cross Cluster Search: propagate original indices per cluster {pull}24328[#24328]
* Query string default field {pull}24214[#24214]
* Speed up parsing of large `terms` queries. {pull}24210[#24210]
* IndicesQueryCache should delegate the scorerSupplier method. {pull}24209[#24209]
* Fork LRUQueryCache from Lucene to work around LUCENE-7749 {pull}24207[#24207]
* Disable graph analysis at query time for shingle and cjk filters producing tokens of different size {pull}23920[#23920] (issue: {issue}23918[#23918])
* Fix cross-cluster remote node gateway attributes {pull}23863[#23863]
* Use a fixed seed for computing term hashCode in TermsSliceQuery {pull}23795[#23795]
* Honor max concurrent searches in multi-search {pull}23538[#23538] (issue: {issue}23527[#23527])
* Avoid stack overflow in multi-search {pull}23527[#23527] (issue: {issue}23523[#23523])
* Fix query_string_query to transform "foo:*" in an exists query on the field name {pull}23433[#23433] (issue: {issue}23356[#23356])
* Factor out filling of TopDocs in SearchPhaseController {pull}23380[#23380] (issues: {issue}19356[#19356], {issue}23357[#23357])
* Replace blocking calls in ExpandCollapseSearchResponseListener by asynchronous requests {pull}23053[#23053] (issue: {issue}23048[#23048])

Search Templates::
* No longer add illegal content type option to stored search templates {pull}24251[#24251] (issue: {issue}24227[#24227])

Settings::
* Do not set path.data in environment if not set {pull}24132[#24132] (issue: {issue}24099[#24099])
* Correct handling of default and array settings {pull}24074[#24074] (issues: {issue}23981[#23981], {issue}24052[#24052])
* Fix merge scheduler config settings {pull}23391[#23391]
* Settings: Fix keystore cli prompting for yes/no to handle console returning null {pull}23320[#23320]

Similarities::
* Fix similarity upgrade when "default" similarity is overridden {pull}23163[#23163]

Snapshot/Restore::
* Fixes maintaining the shards a snapshot is waiting on {pull}24289[#24289]
* Fixes snapshot status on failed snapshots {pull}23833[#23833] (issue: {issue}23716[#23716])
* Fixes snapshot deletion handling on in-progress snapshot failure {pull}23703[#23703] (issue: {issue}23663[#23663])
* Prioritize listing index-N blobs over index.latest in reading snapshots {pull}23333[#23333]

Stats::
* Avoid overflow when computing total FS stats {pull}23641[#23641]
* Handle existence of cgroup version 2 hierarchy {pull}23493[#23493] (issue: {issue}23486[#23486])
* Handle long overflow when adding paths' totals {pull}23293[#23293] (issue: {issue}23093[#23093])
* Fix control group pattern {pull}23219[#23219] (issue: {issue}23218[#23218])
* Fix total disk bytes returning negative value {pull}23093[#23093]

[float]
=== Regressions

Bulk::
* Fix _bulk response when it can't create an index {pull}24048[#24048] (issues: {issue}22488[#22488], {issue}24028[#24028])

//[float]
//=== Known Issues

[float]
=== Upgrades

Aggregations::
* Upgrade HDRHistogram to 2.1.9 {pull}23254[#23254] (issue: {issue}23239[#23239])

Core::
* Upgrade to Lucene 6.5.0 {pull}23750[#23750]
* Upgrade from JNA 4.2.2 to JNA 4.4.0 {pull}23636[#23636]
* Upgrade to lucene-6.5.0-snapshot-d00c5ca {pull}23385[#23385]
* Upgrade to lucene-6.5.0-snapshot-f919485. {pull}23087[#23087]

Logging::
* Upgrade to Log4j 2.8.2 {pull}23995[#23995]

Network::
* Upgrade to Netty 4.1.9 {pull}23540[#23540] (issues: {issue}23172[#23172], {issue}6308[#6308], {issue}6374[#6374])
* Upgrade to Netty 4.1.8 {pull}23055[#23055]

Plugin Repository Azure::
* Update to Azure Storage 5.0.0 {pull}23517[#23517] (issue: {issue}23448[#23448])

[[release-notes-5.3.3]]
== {es} version 5.3.3

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

//[float]
//[[breaking-5.3.3]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Network::
* Disable the Netty recycler in the client {pull}24793[#24793] (issues: {issue}22452[#22452], {issue}24721[#24721])

[float]
=== Bug Fixes

Index APIs::
* Fix legacy GeoPointField decoding in FieldStats {pull}24534[#24534] (issue: {issue}24275[#24275])

Packaging::
* Handle parentheses in batch file path {pull}24731[#24731] (issue: {issue}24712[#24712])

Search::
* Fix RangeFieldMapper rangeQuery to properly handle relations {pull}24808[#24808] (issue: {issue}24744[#24744])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.3.2]]
== {es} version 5.3.2

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

//[float]
//[[breaking-5.3.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Aggregations::
* Align behavior HDR percentiles iterator with percentile() method {pull}24206[#24206]

Core::
* Check for default.path.data included in path.data {pull}24285[#24285] (issue: {issue}24283[#24283])

Plugin Ingest Attachment::
* Add Fix for java.lang.NoClassDefFoundError: com/graphbuilder/curve/Point fatal error in 5.3 [ISSUE] {pull}24273[#24273]

Plugins::
* Fix delete of plugin directory on remove plugin {pull}24266[#24266] (issue: {issue}24252[#24252])
* Use a marker file when removing a plugin {pull}24252[#24252] (issue: {issue}24231[#24231])

Search Templates::
* No longer add illegal content type option to stored search templates {pull}24251[#24251] (issue: {issue}24227[#24227])

[float]
=== Regressions

Bulk::
* Fix _bulk response when it can't create an index {pull}24048[#24048] (issues: {issue}22488[#22488], {issue}24028[#24028])

//[float]
//=== Known Issues

[[release-notes-5.3.1]]
== {es} version 5.3.1

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

[float]
[[breaking-5.3.1]]
=== Breaking Changes

Settings::
* Remove support for default settings {pull}24093[#24093] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074])

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Core::
* Detect remnants of path.data/default.path.data bug {pull}24099[#24099] (issues: {issue}23981[#23981], {issue}24052[#24052], {issue}24074[#24074], {issue}24093[#24093])

Network::
* Adjust default Netty receive predictor size to 64k {pull}23542[#23542] (issue: {issue}23185[#23185])

REST::
* Cluster stats should not render empty http/transport types {pull}23735[#23735]

[float]
=== Bug Fixes

Aggregations::
* The `filter` and `significant_terms` aggregations should parse the `filter` as a filter, not a query. {pull}23797[#23797]
* Restore support for the `include/pattern` syntax. {pull}23140[#23140] (issue: {issue}22933[#22933])

Bulk::
* Reject empty IDs {pull}24118[#24118] (issue: {issue}24116[#24116])

Core::
* Improve performance of extracting warning value {pull}24114[#24114] (issue: {issue}24018[#24018])
* Restrict build info loading to ES jar, not any jar {pull}24049[#24049] (issue: {issue}21955[#21955])

Discovery::
* ZenDiscovery - only validate min_master_nodes values if local node is master {pull}23915[#23915] (issue: {issue}23695[#23695])

Index APIs::
* Honor update request timeout {pull}23825[#23825]

Inner Hits::
* Replace `NestedChildrenQuery` with `ParentChildrenBlockJoinQuery` {pull}24039[#24039] (issue: {issue}24016[#24016])

Internal::
* Add infrastructure to mark contexts as system contexts {pull}23830[#23830]

Java REST Client::
* Make buffer limit configurable in HeapBufferedConsumerFactory {pull}23970[#23970] (issue: {issue}23958[#23958])

Mapping::
* Preserve response headers when creating an index {pull}23950[#23950] (issue: {issue}23947[#23947])
* Fix NPE with scaled floats stats when field is not indexed {pull}23528[#23528] (issue: {issue}23487[#23487])

Network::
* Fix possible hang in local transport when nodes get concurrently disconnected {pull}23962[#23962] (issue: {issue}23942[#23942])

Plugin Repository Azure::
* Azure blob store's readBlob() method first checks if the blob exists {pull}23483[#23483] (issue: {issue}23480[#23480])

Reindex API::
* Fix reindex with a remote source on a version before 2.0.0 {pull}23805[#23805]

Search::
* Disable graph analysis at query time for shingle and cjk filters producing tokens of different size {pull}23920[#23920] (issue: {issue}23918[#23918])
* Fix cross-cluster remote node gateway attributes {pull}23863[#23863]
* Use a fixed seed for computing term hashCode in TermsSliceQuery {pull}23795[#23795]

Settings::
* Do not set path.data in environment if not set {pull}24132[#24132] (issue: {issue}24099[#24099])
* Correct handling of default and array settings {pull}24074[#24074] (issues: {issue}23981[#23981], {issue}24052[#24052])

Stats::
* Handle existence of cgroup version 2 hierarchy {pull}23493[#23493] (issue: {issue}23486[#23486])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Internal::
* upgrade to Lucene 6.4.2 {pull}23933[#23933]

[[release-notes-5.3.0]]
== {es} version 5.3.0

See https://www.elastic.co/blog/multi-data-path-bug-in-elasticsearch-5-3-0[Multi data path bug in Elasticsearch 5.3.0].

[float]
[[breaking-5.3.0]]
=== Breaking Changes

Query DSL::
* Fix name of `enabled_position_increments` {pull}22895[#22895]

Search::
* Remove DFS_QUERY_AND_FETCH as a search type {pull}22787[#22787]

[float]
=== Breaking Java Changes

CRUD::
* Make index and delete operation execute as single bulk item (backport of #21964) {pull}22812[#22812] (issue: {issue}21964[#21964])

Internal::
* Replace SearchExtRegistry with namedObject {pull}22492[#22492]
* Replace Suggesters with namedObject {pull}22491[#22491]

Network::
* Remove HttpServer and HttpServerAdapter in favor of a simple dispatch method {pull}22636[#22636] (issue: {issue}18482[#18482])

Plugins::
* Deguice rest handlers {pull}22575[#22575]

Search::
* Remove QUERY_AND_FETCH search type {pull}22996[#22996]

[float]
=== Deprecations

Core::
* Deprecate lenient booleans {pull}22716[#22716] (issues: {issue}22200[#22200], {issue}22696[#22696])

Geo::
* Geo distance range deprecation {pull}22835[#22835]

Java API::
* Add BulkProcessor methods with XContentType parameter {pull}23078[#23078] (issue: {issue}22691[#22691])

Mapping::
* Deprecate the include_in_all mapping parameter {pull}22972[#22972] (issue: {issue}22970[#22970])

Network::
* Deprecate Netty 3 {pull}23459[#23459] (issue: {issue}23411[#23411])
* Deprecate Netty 3 {pull}23411[#23411]

Plugin Repository Azure::
* Deprecate auto creation of container for azure repository {pull}22857[#22857] (issues: {issue}22843[#22843], {issue}22856[#22856])

Plugin Repository S3::
* S3 Repository: Deprecate specifying region {pull}22848[#22848] (issue: {issue}22758[#22758])
* S3 Repository: Deprecate auto creation of s3 bucket for repository {pull}22843[#22843] (issue: {issue}22761[#22761])
* Deprecate specifying credentials through env vars, sys props, and remove profile files {pull}22567[#22567] (issues: {issue}21041[#21041], {issue}22479[#22479])

REST::
* Deprecate ldjson support and document ndjson for bulk/msearch {pull}23051[#23051] (issues: {issue}23025[#23025], {issue}23049[#23049])
* Optionally require a valid content type for all rest requests with content {pull}22691[#22691] (issue: {issue}19388[#19388])

Scripting::
* Change Namespace for Stored Script to Only Use Id {pull}22206[#22206]

[float]
=== New Features

Aggregations::
* Initial version of an adjacency matrix using the Filters aggregation {pull}22239[#22239] (issue: {issue}22169[#22169])

CRUD::
* Allow an index to be partitioned with custom routing {pull}22274[#22274] (issue: {issue}21585[#21585])

Highlighting::
* Integrate UnifiedHighlighter {pull}21621[#21621] (issue: {issue}21376[#21376])

Search::
* Add federated cross cluster search capabilities {pull}22502[#22502] (issue: {issue}21473[#21473])
* Add field collapsing for search request {pull}22337[#22337] (issue: {issue}21833[#21833])

Settings::
* Add infrastructure for elasticsearch keystore {pull}22335[#22335]

[float]
=== Enhancements

Allocation::
* Include stale replica shard info when explaining an unassigned primary {pull}22826[#22826]

Analysis::
* Analyze API Position Length Support {pull}22574[#22574]

CRUD::
* Make index and delete operation execute as a single bulk item {pull}21964[#21964]

Circuit Breakers::
* Add used memory amount to CircuitBreakingException message (#22521) {pull}22693[#22693] (issue: {issue}22521[#22521])

Cluster::
* Connect to new nodes concurrently {pull}22984[#22984] (issue: {issue}22828[#22828])

Core::
* Simplify write failure handling (backport of #19105) {pull}22778[#22778] (issue: {issue}19105[#19105])
* Simplify ElasticsearchException rendering as a XContent {pull}22611[#22611]
* Remove setLocalNode from ClusterService and TransportService {pull}22608[#22608]

Engine::
* Replace EngineClosedException with AlreadyClosedExcpetion {pull}22631[#22631]

Index APIs::
* Indexing: Add shard id to indexing operation listener {pull}22606[#22606]
* Better error when can't auto create index  {pull}22488[#22488] (issues: {issue}21448[#21448], {issue}22435[#22435])

Ingest::
* Lazy load the geoip databases {pull}23337[#23337]

Internal::
* Improve connection closing in `RemoteClusterConnection` {pull}22804[#22804] (issue: {issue}22803[#22803])
* Remove some more usages of ParseFieldMatcher {pull}22437[#22437] (issues: {issue}19552[#19552], {issue}22130[#22130])
* Introduce ToXContentObject interface {pull}22387[#22387] (issue: {issue}16347[#16347])

Java API::
* prevent NPE when trying to uncompress a null BytesReference {pull}22386[#22386]

Java High Level REST Client::
* Add parsing from xContent to MainResponse {pull}22934[#22934]
* Parse elasticsearch exception's root causes {pull}22924[#22924]
* Add parsing method to BytesRestResponse's error {pull}22873[#22873]
* Add parsing method for ElasticsearchException.generateThrowableXContent() {pull}22783[#22783]
* Add fromxcontent methods to delete response {pull}22712[#22712] (issue: {issue}22680[#22680])
* Add parsing methods for UpdateResponse {pull}22586[#22586]
* Add parsing from xContent to InternalSearchHit and InternalSearchHits {pull}22429[#22429]
* Add fromxcontent methods to index response {pull}22229[#22229]

Java REST Client::
* move ignore parameter support from yaml test client to low level rest client {pull}22637[#22637]
* Support Preemptive Authentication with RestClient {pull}21336[#21336]

Logging::
* Expose logs base path {pull}22625[#22625]

Mapping::
* Improve error message for ipv6 on legacy ip fields {pull}23136[#23136] (issue: {issue}23126[#23126])

Network::
* Keep the pipeline handler queue small initially {pull}23335[#23335]

Packaging::
* Introduce Java version check {pull}23194[#23194] (issue: {issue}21102[#21102])

Plugin Discovery EC2::
* Read ec2 discovery address from aws instance tags {pull}22819[#22819] (issues: {issue}22566[#22566], {issue}22743[#22743])

Plugin Lang Painless::
* Generate reference links for painless API {pull}22775[#22775]
* Painless: Add augmentation to String for base 64 {pull}22665[#22665] (issue: {issue}22648[#22648])

Plugin Repository S3::
* S3 repository: Add named configurations {pull}22762[#22762] (issues: {issue}22479[#22479], {issue}22520[#22520])

Plugins::
* Add the ability to define search response listeners in search plugin {pull}22682[#22682]

Query DSL::
* QueryString and SimpleQueryString Graph Support {pull}22541[#22541]
* Additional Graph Support in Match Query {pull}22503[#22503] (issue: {issue}22490[#22490])
* RangeQuery WITHIN case now normalises query {pull}22431[#22431] (issue: {issue}22412[#22412])

Reindex API::
* Increase visibility of doExecute so it can be used directly {pull}22614[#22614]
* Improve error message when reindex-from-remote gets bad json {pull}22536[#22536] (issue: {issue}22330[#22330])

Scripting::
* Expose multi-valued dates to scripts and document painless's date functions {pull}22875[#22875] (issue: {issue}22162[#22162])

Search::
* Add a setting to disable remote cluster connections on a node {pull}23005[#23005]
* First step towards separating individual search phases {pull}22802[#22802]
* Add parsing from xContent to SearchProfileShardResults and nested classes {pull}22649[#22649]
* ProfileResult and CollectorResult should print machine readable timing information {pull}22638[#22638]

Settings::
* Improve setting deprecation message {pull}23156[#23156] (issue: {issue}22849[#22849])
* Add secure settings validation on startup {pull}22894[#22894]
* Allow comma delimited array settings to have a space after each entry {pull}22591[#22591] (issue: {issue}22297[#22297])
* Allow affix settings to be dynamic / updatable {pull}22526[#22526]
* Allow affix settings to delegate to actual settings {pull}22523[#22523]
* Make s3 repository sensitive settings use secure settings {pull}22479[#22479]

Snapshot/Restore::
* Duplicate snapshot name throws InvalidSnapshotNameException {pull}22921[#22921] (issue: {issue}18228[#18228])
* Use general cluster state batching mechanism for snapshot state updates {pull}22528[#22528] (issue: {issue}14899[#14899])

Stats::
* Add geo_point to FieldStats {pull}21947[#21947] (issue: {issue}20707[#20707])

[float]
=== Bug Fixes

CRUD::
* Fix backport executing ops as single item bulk {pull}23083[#23083] (issues: {issue}21964[#21964], {issue}23069[#23069])

Cache::
* Invalidate cached query results if query timed out {pull}22807[#22807] (issue: {issue}22789[#22789])

Cluster::
* Don't set local node on cluster state used for node join validation {pull}23311[#23311] (issues: {issue}21830[#21830], {issue}3[#3], {issue}4[#4], {issue}6[#6], {issue}9[#9])
* Allow a cluster state applier to create an observer and wait for a better state {pull}23132[#23132] (issue: {issue}21817[#21817])
* Cluster allocation explain to never return empty response body {pull}23054[#23054]

Exceptions::
* Stop returning "es." internal exception headers as http response headers {pull}22703[#22703] (issue: {issue}17593[#17593])

Ingest::
* Improve missing ingest processor error {pull}23379[#23379] (issue: {issue}23392[#23392])
* fix date-processor to a new default year for every new pipeline execution {pull}22601[#22601] (issue: {issue}22547[#22547])

Internal::
* Always restore the ThreadContext for operations delayed due to a block {pull}23349[#23349]
* Fix handling of document failure exception in InternalEngine (backport #22718) {pull}22910[#22910]

Java REST Client::
* RestClient asynchronous execution should not throw exceptions {pull}23307[#23307]

Mapping::
* Switch include_in_all in multifield to warning {pull}23656[#23656] (issues: {issue}21971[#21971], {issue}23654[#23654])
* Fix MapperService StackOverflowError {pull}23605[#23605] (issue: {issue}23604[#23604])
* Range types causing `GetFieldMappingsIndexRequest` to fail due to `NullPointerException` in `RangeFieldMapper.doXContentBody` when `include_defaults=true` is on the query string {pull}22925[#22925]
* Disallow introducing illegal object mappings (double '..') {pull}22891[#22891] (issue: {issue}22794[#22794])

Network::
* Respect promises on pipelined responses {pull}23317[#23317] (issues: {issue}23310[#23310], {issue}23322[#23322])
* Ensure that releasing listener is called {pull}23310[#23310]

Packaging::
* Fall back to non-atomic move when removing plugins {pull}23548[#23548] (issue: {issue}35[#35])

Parent/Child::
* Add null check in case of orphan child document {pull}22772[#22772] (issue: {issue}22770[#22770])

Plugin Ingest Attachment::
* Remove support for Visio and potm files {pull}23214[#23214] (issues: {issue}22077[#22077], {issue}22079[#22079], {issue}22963[#22963])
* Add missing mime4j library {pull}22799[#22799] (issue: {issue}22764[#22764])

Plugin Lang Painless::
* Fix Bad Casts In Painless {pull}23282[#23282] (issue: {issue}23238[#23238])
* Don't allow casting from void to def in painless {pull}22969[#22969] (issue: {issue}22908[#22908])
* Fix def invoked qualified method refs {pull}22918[#22918]

Plugins::
* Add check for null pluginName in remove command {pull}22930[#22930] (issue: {issue}22922[#22922])

Query DSL::
* Fix parsing for `max_determinized_states` {pull}22749[#22749] (issue: {issue}22722[#22722])

REST::
* [API] change wait_for_completion default according to docs {pull}23672[#23672]
* HTTP transport stashes the ThreadContext instead of the RestController {pull}23456[#23456]
* Ensure we try to autodetect content type for handlers that support plain text {pull}23452[#23452]
* Fix date format in warning headers {pull}23418[#23418] (issue: {issue}23275[#23275])
* Correct warning header to be compliant {pull}23275[#23275] (issue: {issue}22986[#22986])
* Fix search scroll request with a plain text body {pull}23183[#23183] (issue: {issue}22691[#22691])
* Handle bad HTTP requests {pull}23153[#23153] (issue: {issue}23034[#23034])
* Properly encode location header {pull}23133[#23133] (issues: {issue}21057[#21057], {issue}23115[#23115])

Reindex API::
* Reindex: do not log when can't clear old scroll {pull}22942[#22942] (issue: {issue}22937[#22937])
* Fix reindex-from-remote from <2.0 {pull}22931[#22931] (issue: {issue}22893[#22893])

Scripting::
* Remove unnecessary Groovy deprecation logging {pull}23410[#23410] (issue: {issue}23401[#23401])
* Script: Fix value of `ctx._now` to be current epoch time in milliseconds {pull}23175[#23175] (issue: {issue}23169[#23169])

Search::
* Honor max concurrent searches in multi-search {pull}23538[#23538] (issue: {issue}23527[#23527])
* Avoid stack overflow in multi-search {pull}23527[#23527] (issue: {issue}23523[#23523])
* Replace blocking calls in ExpandCollapseSearchResponseListener by asynchronous requests {pull}23053[#23053] (issue: {issue}23048[#23048])
* Ensure fixed serialization order of InnerHitBuilder {pull}22820[#22820] (issue: {issue}22808[#22808])

Settings::
* Fix merge scheduler config settings {pull}23391[#23391]
* Settings: Fix keystore cli prompting for yes/no to handle console returning null {pull}23320[#23320]
* Expose `search.highlight.term_vector_multi_value` as a node level setting {pull}22999[#22999]
* NPE when no setting name passed to elasticsearch-keystore {pull}22609[#22609]

Similarities::
* Fix similarity upgrade when "default" similarity is overridden {pull}23163[#23163]

Stats::
* Avoid overflow when computing total FS stats {pull}23641[#23641]
* Handle long overflow when adding paths' totals {pull}23293[#23293] (issue: {issue}23093[#23093])
* Fix control group pattern {pull}23219[#23219] (issue: {issue}23218[#23218])
* Fix total disk bytes returning negative value {pull}23093[#23093]

Task Manager::
* Fix hanging cancelling task with no children {pull}22796[#22796]
* Fix broken TaskInfo.toString() {pull}22698[#22698] (issue: {issue}22387[#22387])

[float]
=== Regressions

Core::
* Source filtering: only accept array items if the previous include pattern matches {pull}22593[#22593] (issue: {issue}22557[#22557])

//[float]
//=== Known Issues

[float]
=== Upgrades

Internal::
* Upgrade to Lucene 6.4.1. {pull}22978[#22978]

[[release-notes-5.2.2]]
== {es} version 5.2.2

//[float]
//[[breaking-5.2.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

[float]
=== Bug Fixes

Aggregations::
* Restore support for the `include/pattern` syntax. {pull}23140[#23140] (issue: {issue}22933[#22933])

Cluster::
* Don't set local node on cluster state used for node join validation {pull}23311[#23311] (issue: {issue}21830[#21830])
* Cluster allocation explain to never return empty response body {pull}23054[#23054]

Index APIs::
* Ensure shrunk indices carry over version information from its source {pull}22469[#22469] (issue: {issue}22373[#22373])

Internal::
* Always restore the ThreadContext for operations delayed due to a block {pull}23349[#23349]

Java REST Client::
* RestClient asynchronous execution should not throw exceptions {pull}23307[#23307]

Network::
* Respect promises on pipelined responses {pull}23317[#23317] (issues: {issue}23310[#23310], {issue}23322[#23322])
* Ensure that releasing listener is called {pull}23310[#23310]

Plugin Ingest Attachment::
* Remove support for Visio and potm files {pull}23214[#23214] (issues: {issue}22077[#22077], {issue}22079[#22079], {issue}22963[#22963])

REST::
* Properly encode location header {pull}23133[#23133] (issues: {issue}21057[#21057], {issue}23115[#23115])

Stats::
* Fix control group pattern {pull}23219[#23219] (issue: {issue}23218[#23218])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.2.1]]
== {es} version 5.2.1

//[float]
//[[breaking-5.2.1]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

[float]
=== Deprecations

Geo::
* Geo distance range deprecation {pull}22835[#22835]

//[float]
//=== New Features

[float]
=== Enhancements

Allocation::
* Include stale replica shard info when explaining an unassigned primary {pull}22826[#22826]

[float]
=== Bug Fixes

Cache::
* Invalidate cached query results if query timed out {pull}22807[#22807] (issue: {issue}22789[#22789])

Mapping::
* Range types causing `GetFieldMappingsIndexRequest` to fail due to `NullPointerException` in `RangeFieldMapper.doXContentBody` when `include_defaults=true` is on the query string {pull}22925[#22925]
* Disallow introducing illegal object mappings (double '..') {pull}22891[#22891] (issue: {issue}22794[#22794])

Plugin Ingest Attachment::
* Add missing mime4j library {pull}22799[#22799] (issue: {issue}22764[#22764])

Plugin Lang Painless::
* Don't allow casting from void to def in painless {pull}22969[#22969] (issue: {issue}22908[#22908])
* Fix def invoked qualified method refs {pull}22918[#22918]

Reindex API::
* Reindex: do not log when can't clear old scroll {pull}22942[#22942] (issue: {issue}22937[#22937])
* Fix reindex-from-remote from <2.0 {pull}22931[#22931] (issue: {issue}22893[#22893])

Settings::
* Expose `search.highlight.term_vector_multi_value` as a node level setting {pull}22999[#22999]

[float]
=== Regressions

Core::
* Source filtering: only accept array items if the previous include pattern matches {pull}22593[#22593] (issue: {issue}22557[#22557])

//[float]
//=== Known Issues

[float]
=== Upgrades

Internal::
* Upgrade to Lucene 6.4.1. {pull}22978[#22978]

[[release-notes-5.2.0]]
== {es} version 5.2.0

[float]
[[breaking-5.2.0]]
=== Breaking Changes

Core::
* Add system call filter bootstrap check {pull}21940[#21940]

[float]
=== Breaking Java Changes

Allocation::
* Cluster Explain API uses the allocation process to explain shard allocation decisions {pull}22182[#22182] (issues: {issue}20347[#20347], {issue}20634[#20634], {issue}21103[#21103], {issue}21662[#21662], {issue}21691[#21691])

Cluster::
* Remove PROTO-based custom cluster state components {pull}22336[#22336] (issue: {issue}21868[#21868])

Ingest::
* Change type of ingest doc meta-data field 'TIMESTAMP' to `Date` {pull}22234[#22234] (issue: {issue}22074[#22074])

Internal::
* Consolidate the last easy parser construction {pull}22095[#22095]
* Introduce XContentParser#namedObject {pull}22003[#22003]

Plugins::
* Plugins: Replace Rest filters with RestHandler wrapper {pull}21905[#21905]

Query DSL::
* Resolve index names in indices_boost {pull}21393[#21393] (issue: {issue}4756[#4756])

Search::
* Cluster search shards improvements: expose ShardId, adjust visibility of some members {pull}21752[#21752]

[float]
=== Deprecations

Java API::
* Deprecate and remove "minimumNumberShouldMatch" in BoolQueryBuilder {pull}22403[#22403]

Shadow Replicas::
* Add a deprecation notice to shadow replicas  {pull}22647[#22647] (issue: {issue}22024[#22024])

[float]
=== New Features

Analysis::
* Synonym Graph Support (LUCENE-6664) {pull}21517[#21517]

Ingest::
* introduce KV Processor in Ingest Node {pull}22272[#22272] (issue: {issue}22222[#22222])

Mapping::
* Add the ability to set a normalizer on keyword fields. {pull}21919[#21919] (issue: {issue}18064[#18064])
* Add RangeFieldMapper for numeric and date range types {pull}21002[#21002] (issue: {issue}20999[#20999])

[float]
=== Enhancements

Aggregations::
* `value_type` is useful regardless of scripting. {pull}22160[#22160] (issue: {issue}20163[#20163])
* Support for partitioning set of terms  {pull}21626[#21626] (issue: {issue}21487[#21487])

Allocation::
* Adds setting level to allocation decider explanations {pull}22268[#22268] (issue: {issue}21771[#21771])
* Improves allocation decider decision explanation messages {pull}21771[#21771]
* Prepares allocator decision objects for use with the allocation explain API {pull}21691[#21691]

Analysis::
* Expose FlattenGraphTokenFilter {pull}22643[#22643]

CRUD::
* Use correct block levels for TRA subclasses {pull}22224[#22224]

Cluster::
* Keep NodeConnectionsService in sync with current nodes in the cluster state {pull}22509[#22509]
* Add a generic way of checking version before serializing custom cluster object {pull}22376[#22376] (issue: {issue}22313[#22313])
* Add validation for supported index version on node join, restore, upgrade & open index {pull}21830[#21830] (issue: {issue}21670[#21670])
* Let ClusterStateObserver only hold onto state that's needed for change detection {pull}21631[#21631] (issue: {issue}21568[#21568])
* Remove mutable status field from cluster state {pull}21379[#21379]

Core::
* Rename bootstrap.seccomp to bootstrap.system_call_filter {pull}22226[#22226] (issue: {issue}21940[#21940])
* Cleanup random stats serialization code {pull}22223[#22223]
* Avoid corruption when deserializing booleans {pull}22152[#22152]
* Reduce memory pressure when sending large terms queries. {pull}21776[#21776]

Discovery::
* Simplify Unicast Zen Ping {pull}22277[#22277] (issues: {issue}19370[#19370], {issue}21739[#21739], {issue}22120[#22120], {issue}22194[#22194])
* Prefer joining node with conflicting transport address when becoming master {pull}22134[#22134] (issues: {issue}22049[#22049], {issue}22120[#22120])

Ingest::
* add `ignore_missing` flag to ingest plugins {pull}22273[#22273]
* Added ability to remove pipelines via wildcards (#22149) {pull}22191[#22191] (issue: {issue}22149[#22149])
* Enables the ability to inject serialized json fields into root of document {pull}22179[#22179] (issue: {issue}21898[#21898])
* compile ScriptProcessor inline scripts when creating ingest pipelines {pull}21858[#21858] (issue: {issue}21842[#21842])

Internal::
* Remove some more usages of ParseFieldMatcher {pull}22398[#22398] (issues: {issue}19552[#19552], {issue}22130[#22130])
* Remove some more usages of ParseFieldMatcher {pull}22395[#22395] (issues: {issue}19552[#19552], {issue}22130[#22130])
* Remove some ParseFieldMatcher usages {pull}22389[#22389] (issues: {issue}19552[#19552], {issue}22130[#22130])
* Add infrastructure to manage network connections outside of Transport/TransportService {pull}22194[#22194]
* Replace strict parsing mode with response headers assertions {pull}22130[#22130] (issues: {issue}11859[#11859], {issue}19552[#19552], {issue}20993[#20993])
* Start using `ObjectParser` for aggs. {pull}22048[#22048] (issue: {issue}22009[#22009])
* Don't output null source node in RecoveryFailedException {pull}21963[#21963]
* ClusterService should expose "applied" cluster states (i.e., remove ClusterStateStatus) {pull}21817[#21817]

Java High Level REST Client::
* Add fromxcontent methods to index response {pull}22229[#22229]
* Add fromXContent() methods for ReplicationResponse {pull}22196[#22196] (issue: {issue}22082[#22082])
* Add parsing method for ElasticsearchException {pull}22143[#22143]
* Add fromXContent method to GetResponse {pull}22082[#22082]

Java REST Client::
* Warn log deprecation warnings received from server {pull}21895[#21895]

Logging::
* Log deleting indices at info level {pull}22627[#22627] (issue: {issue}22605[#22605])
* Log failure to connect to node at info instead of debug {pull}21809[#21809] (issue: {issue}6468[#6468])

Mapping::
* Atomic mapping updates across types {pull}22220[#22220]
* Only update DocumentMapper if field type changes {pull}22165[#22165]
* Better error message when `_parent` isn't an object {pull}21987[#21987]

Network::
* Disable the Netty recycler {pull}22452[#22452] (issues: {issue}22189[#22189], {issue}22360[#22360], {issue}22406[#22406], {issue}5904[#5904])
* Tell Netty not to be unsafe in transport client {pull}22284[#22284]
* Introduce a low level protocol handshake {pull}22094[#22094]
* Detach handshake from connect to node {pull}22037[#22037]
* Reduce number of connections per node depending on the nodes role {pull}21849[#21849]
* Add a connect timeout to the ConnectionProfile to allow per node connect timeouts {pull}21847[#21847] (issue: {issue}19719[#19719])
* Grant Netty permission to read system somaxconn {pull}21840[#21840]
* Remove connectToNodeLight and replace it with a connection profile {pull}21799[#21799]

Packaging::
* Improve the out-of-the-box experience {pull}21920[#21920] (issues: {issue}18317[#18317], {issue}21783[#21783])

Plugin Discovery EC2::
* Add support for ca-central-1 region to EC2 and S3 plugins {pull}22458[#22458] (issue: {issue}22454[#22454])
* Support for eu-west-2 (London) cloud-aws plugin {pull}22308[#22308] (issue: {issue}22306[#22306])
* Add us-east-2 AWS region {pull}21961[#21961] (issue: {issue}21881[#21881])
* Add setting to set read timeout for EC2 discovery and S3 repository plugins {pull}21956[#21956] (issue: {issue}19078[#19078])

Plugin Ingest GeoIp::
* Cache results of geoip lookups {pull}22231[#22231] (issue: {issue}22074[#22074])

Plugin Lang Painless::
* Improve painless's ScriptException generation {pull}21762[#21762] (issue: {issue}21733[#21733])

Plugins::
* Pass ThreadContext to transport interceptors to allow header modification {pull}22618[#22618] (issue: {issue}22585[#22585])
* Provide helpful error message if a plugin exists {pull}22305[#22305] (issue: {issue}22084[#22084])
* Add shutdown hook for closing CLI commands {pull}22126[#22126] (issue: {issue}22111[#22111])
* Allow plugins to install bootstrap checks {pull}22110[#22110]

Query DSL::
* Un-deprecate fuzzy query {pull}22088[#22088] (issue: {issue}15760[#15760])
* support numeric bounds with decimal parts for long/integer/short/byte datatypes {pull}21972[#21972] (issue: {issue}21600[#21600])

Reindex API::
* Reindex: Better error message for pipeline in wrong place {pull}21985[#21985]
* Timeout improvements for rest client and reindex {pull}21741[#21741] (issue: {issue}21707[#21707])

Scripting::
* Wrap VerifyError in ScriptException {pull}21769[#21769]
* Log ScriptException's xcontent if file script compilation fails {pull}21767[#21767] (issue: {issue}21733[#21733])

Search::
* Move SearchTransportService and SearchPhaseController creation outside of TransportSearchAction constructor {pull}21754[#21754]
* Don't carry ShardRouting around when not needed in AbstractSearchAsyncAction {pull}21753[#21753]
* ShardSearchRequest to take ShardId constructor argument rather than the whole ShardRouting {pull}21750[#21750]
* Use index uuid as key in the alias filter map rather than the index name {pull}21749[#21749]

Settings::
* Speed up filter and prefix settings operations {pull}22249[#22249]

Snapshot/Restore::
* Fixes retrieval of the latest snapshot index blob {pull}22700[#22700]
* Synchronize snapshot deletions on the cluster state {pull}22313[#22313] (issue: {issue}19957[#19957])

Stats::
* Include unindexed field in FieldStats response {pull}21821[#21821] (issue: {issue}21952[#21952])

Task Manager::
* Improve the error message if task and node isn't found {pull}22062[#22062] (issue: {issue}22027[#22027])
* Add descriptions to create snapshot and restore snapshot tasks. {pull}21901[#21901] (issue: {issue}21768[#21768])
* Add proper descriptions to reindex, update-by-query and delete-by-query tasks. {pull}21841[#21841] (issue: {issue}21768[#21768])

[float]
=== Bug Fixes

Aggregations::
* Fix scaled_float numeric type in aggregations {pull}22351[#22351] (issue: {issue}22350[#22350])
* Allow terms aggregations on pure boolean scripts. {pull}22201[#22201] (issue: {issue}20941[#20941])
* Fix numeric terms aggregations with includes/excludes and minDocCount=0 {pull}22141[#22141] (issue: {issue}22140[#22140])
* Fix `missing` on aggs on `boolean` fields. {pull}22135[#22135] (issue: {issue}22009[#22009])
* IP range masks exclude the maximum address of the range. {pull}22018[#22018] (issue: {issue}22005[#22005])
* Fix `other_bucket` on the `filters` agg to be enabled if a key is set. {pull}21994[#21994] (issue: {issue}21951[#21951])

Allocation::
* Cannot force allocate primary to a node where the shard already exists {pull}22031[#22031] (issue: {issue}22021[#22021])
* Promote shadow replica to primary when initializing primary fails {pull}22021[#22021]
* Trim in-sync allocations set only when it grows {pull}21976[#21976] (issue: {issue}21719[#21719])

Analysis::
* AsciiFoldingFilter's multi-term component should never preserve the original token. {pull}21982[#21982]
* Pre-built analysis factories do not implement MultiTermAware correctly. {pull}21981[#21981]

CRUD::
* Reject external versioning and explicit version numbers on create {pull}21998[#21998]

Cluster::
* IndicesService handles all exceptions during index deletion {pull}22433[#22433]

Core::
* Streamline foreign stored context restore and allow to perserve response headers {pull}22677[#22677] (issue: {issue}22647[#22647])
* Support negative numbers in readVLong {pull}22314[#22314]

Discovery::
* Close InputStream when receiving cluster state in PublishClusterStateAction {pull}22711[#22711]
* Do not reply to pings from another cluster {pull}21894[#21894] (issue: {issue}21874[#21874])

Engine::
* Close and flush refresh listeners on shard close {pull}22342[#22342]

Exceptions::
* Fixing shard recovery error message to report the number of docs correctly for each node {pull}22515[#22515] (issue: {issue}21893[#21893])

Highlighting::
* Fix FiltersFunctionScoreQuery highlighting {pull}21827[#21827]

Index APIs::
* Ensure shrunk indices carry over version information from its source {pull}22469[#22469] (issue: {issue}22373[#22373])

Ingest::
* fix index out of bounds error in KV Processor {pull}22288[#22288] (issue: {issue}22272[#22272])
* Fixes GrokProcessor's ignorance of named-captures with same name. {pull}22131[#22131] (issue: {issue}22117[#22117])

Inner Hits::
* Inner hits and ignore unmapped {pull}21693[#21693] (issue: {issue}21620[#21620])

Internal::
* Index creation and setting update may not return deprecation logging {pull}22702[#22702]

Java API::
* Don't output empty ext object in SearchSourceBuilder#toXContent {pull}22093[#22093] (issue: {issue}20969[#20969])

Java REST Client::
* Don't use null charset in RequestLogger {pull}22197[#22197] (issue: {issue}22190[#22190])

Mapping::
* The `_all` default mapper is not completely configured. {pull}22236[#22236]
* Fix MapperService.allEnabled(). {pull}22227[#22227]
* Dynamic `date` fields should use the `format` that was used to detect it is a date. {pull}22174[#22174] (issue: {issue}9410[#9410])
* Sub-fields should not accept `include_in_all` parameter {pull}21971[#21971] (issue: {issue}21710[#21710])
* Mappings: Fix get mapping when no indexes exist to not fail in response generation {pull}21924[#21924] (issue: {issue}21916[#21916])

Nested Docs::
* Fix bug in query builder rewrite that ignores the ignore_unmapped option {pull}22456[#22456]

Network::
* Pass `forceExecution` flag to transport interceptor {pull}22739[#22739]
* Ensure new connections won't be opened if transport is closed or closing {pull}22589[#22589] (issue: {issue}22554[#22554])
* Prevent open channel leaks if handshake times out or is interrupted {pull}22554[#22554]
* Execute low level handshake in #openConnection {pull}22440[#22440]
* Properly configure Netty 3 ClientBootstrap when using custom connection profile {pull}22363[#22363] (issue: {issue}22277[#22277])
* Handle connection close / reset events gracefully during handshake {pull}22178[#22178]
* Do not lose host information when pinging {pull}21939[#21939] (issue: {issue}21828[#21828])
* DiscoveryNode and TransportAddress should preserve host information {pull}21828[#21828]

Packaging::
* Another fix for handling of paths on Windows {pull}22132[#22132] (issue: {issue}21921[#21921])
* Fix handling of spaces in Windows paths {pull}21921[#21921] (issues: {issue}20809[#20809], {issue}21525[#21525])
* Add option to skip kernel parameters on install {pull}21899[#21899] (issue: {issue}21877[#21877])

Percolator::
* Fix NPE in percolator's 'now' range check for percolator queries with range queries {pull}22356[#22356] (issue: {issue}22355[#22355])

Plugin Analysis Stempel::
* Fix thread safety of Stempel's token filter factory {pull}22610[#22610] (issue: {issue}21911[#21911])

Plugin Lang Painless::
* Whitelist some ScriptDocValues in painless {pull}22600[#22600] (issue: {issue}22584[#22584])
* Update Painless Loop Counter to be Higher {pull}22560[#22560] (issue: {issue}22508[#22508])
* Fix some issues with painless's strings {pull}22393[#22393] (issue: {issue}22372[#22372])
* Test fix for def equals in Painless {pull}21945[#21945] (issue: {issue}21801[#21801])
* Fix a VerifyError bug in Painless {pull}21765[#21765]

Plugin Mapper Attachment::
* NPE is raised when defining a non existing type within attachments type {pull}21848[#21848]

Plugin Repository Azure::
* Fixes default chunk size for Azure repositories {pull}22577[#22577] (issue: {issue}22513[#22513])
* readonly on azure repository must be taken into account {pull}22055[#22055] (issues: {issue}22007[#22007], {issue}22053[#22053])

Query DSL::
* Fix script score function that combines `_score` and weight {pull}22713[#22713] (issue: {issue}21483[#21483])

REST::
* Adds percent-encoding for Location headers {pull}21057[#21057] (issue: {issue}21016[#21016])

Recovery::
* Fix primary relocation for shadow replicas {pull}22474[#22474] (issue: {issue}20300[#20300])
* Don't close store under CancellableThreads {pull}22434[#22434] (issue: {issue}22325[#22325])
* Use a fresh recovery id when retrying recoveries {pull}22325[#22325] (issue: {issue}22043[#22043])
* Allow flush/force_merge/upgrade on shard marked as relocated {pull}22078[#22078] (issue: {issue}22043[#22043])

Reindex API::
* Fix reindex from remote clearing scroll {pull}22525[#22525] (issue: {issue}22514[#22514])
* Fix source filtering in reindex-from-remote {pull}22514[#22514] (issue: {issue}22507[#22507])
* Remove content type detection from reindex-from-remote {pull}22504[#22504] (issue: {issue}22329[#22329])
* Don't close rest client from its callback {pull}22061[#22061] (issue: {issue}22027[#22027])
* Keep context during reindex's retries {pull}21941[#21941]

Scripting::
* Expose `ip` fields as strings in scripts. {pull}21997[#21997] (issue: {issue}21977[#21977])

Search::
* Improve concurrency of ShardCoreKeyMap. {pull}22316[#22316]
* Make `-0` compare less than `+0` consistently. {pull}22173[#22173] (issue: {issue}22167[#22167])
* Fix boost_mode propagation when the function score query builder is rewritten {pull}22172[#22172] (issue: {issue}22138[#22138])
* FiltersAggregationBuilder: rewriting filter queries, the same way as in FilterAggregationBuilder {pull}22076[#22076]
* Fix cross_fields type on multi_match query with synonyms {pull}21638[#21638] (issue: {issue}21633[#21633])

Search Templates::
* SearchTemplateRequest to implement CompositeIndicesRequest {pull}21865[#21865] (issue: {issue}21747[#21747])

Settings::
* Handle spaces in `action.auto_create_index` gracefully {pull}21790[#21790] (issue: {issue}21449[#21449])
* Fix settings diff generation for affix and group settings {pull}21788[#21788]

Snapshot/Restore::
* Gracefully handles pre 2.x compressed snapshots {pull}22267[#22267]
* URLRepository should throw NoSuchFileException to correctly adhere to readBlob contract {pull}22069[#22069] (issue: {issue}22004[#22004])
* Fixes shard level snapshot metadata loading when index-N file is missing {pull}21813[#21813]

Stats::
* Implement stats for geo_point and geo_shape field {pull}22391[#22391] (issue: {issue}22384[#22384])
* Use reader for doc stats {pull}22317[#22317] (issue: {issue}22285[#22285])
* Avoid NPE in NodeService#stats if HTTP is disabled {pull}22060[#22060] (issue: {issue}22058[#22058])
* Add support for "include_segment_file_sizes" in indices stats REST handler {pull}21879[#21879] (issue: {issue}21878[#21878])

Term Vectors::
* Fix `_termvectors` with preference to not hit NPE {pull}21959[#21959]
* Return correct term statistics when a field is not found in a shard {pull}21922[#21922] (issue: {issue}21906[#21906])

[float]
=== Regressions

Core::
* Source filtering: only accept array items if the previous include pattern matches {pull}22593[#22593] (issue: {issue}22557[#22557])

Logging::
* Restores the original default format of search slow log {pull}21770[#21770] (issue: {issue}21711[#21711])

Search::
* Handle specialized term queries in MappedFieldType.extractTerm(Query) {pull}21889[#21889] (issue: {issue}21882[#21882])

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.4.0 {pull}22724[#22724]
* Update Jackson to 2.8.6 {pull}22596[#22596] (issue: {issue}22266[#22266])
* Upgrade to lucene-6.4.0-snapshot-084f7a0. {pull}22413[#22413]
* Upgrade to lucene-6.4.0-snapshot-ec38570 {pull}21853[#21853]

Network::
* Upgrade to Netty 4.1.7 {pull}22587[#22587]

[[release-notes-5.1.2]]
== {es} version 5.1.2

//[float]
//[[breaking-5.1.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Internal::
* Don't output null source node in RecoveryFailedException {pull}21963[#21963]

Mapping::
* Only update DocumentMapper if field type changes {pull}22165[#22165]

Network::
* Disable the Netty recycler {pull}22452[#22452] (issues: {issue}22189[#22189], {issue}22360[#22360], {issue}22406[#22406], {issue}5904[#5904])
* Tell Netty not to be unsafe in transport client {pull}22284[#22284]

Plugins::
* Provide helpful error message if a plugin exists {pull}22305[#22305] (issue: {issue}22084[#22084])
* Add shutdown hook for closing CLI commands {pull}22126[#22126] (issue: {issue}22111[#22111])

[float]
=== Bug Fixes

Aggregations::
* Allow terms aggregations on pure boolean scripts. {pull}22201[#22201] (issue: {issue}20941[#20941])
* IP range masks exclude the maximum address of the range. {pull}22018[#22018] (issue: {issue}22005[#22005])
* Fix `other_bucket` on the `filters` agg to be enabled if a key is set. {pull}21994[#21994] (issue: {issue}21951[#21951])

Allocation::
* Promote shadow replica to primary when initializing primary fails {pull}22021[#22021]
* Trim in-sync allocations set only when it grows {pull}21976[#21976] (issue: {issue}21719[#21719])

Analysis::
* Pre-built analysis factories do not implement MultiTermAware correctly. {pull}21981[#21981]

CRUD::
* Reject external versioning and explicit version numbers on create {pull}21998[#21998]

Core::
* Support negative numbers in readVLong {pull}22314[#22314]

Exceptions::
* Fixing shard recovery error message to report the number of docs correctly for each node {pull}22515[#22515] (issue: {issue}21893[#21893])

Index APIs::
* Ensure shrunk indices carry over version information from its source {pull}22469[#22469] (issue: {issue}22373[#22373])

Java REST Client::
* Don't use null charset in RequestLogger {pull}22197[#22197] (issue: {issue}22190[#22190])

Mapping::
* The `_all` default mapper is not completely configured. {pull}22236[#22236]
* Fix MapperService.allEnabled(). {pull}22227[#22227]

Nested Docs::
* Fix bug in query builder rewrite that ignores the ignore_unmapped option {pull}22456[#22456]

Packaging::
* Another fix for handling of paths on Windows {pull}22132[#22132] (issue: {issue}21921[#21921])

Percolator::
* Fix NPE in percolator's 'now' range check for percolator queries with range queries {pull}22356[#22356] (issue: {issue}22355[#22355])

Plugin Lang Painless::
* Update Painless Loop Counter to be Higher {pull}22560[#22560] (issue: {issue}22508[#22508])

Plugin Repository Azure::
* readonly on azure repository must be taken into account {pull}22055[#22055] (issues: {issue}22007[#22007], {issue}22053[#22053])

Recovery::
* Fix primary relocation for shadow replicas {pull}22474[#22474] (issue: {issue}20300[#20300])
* Don't close store under CancellableThreads {pull}22434[#22434] (issue: {issue}22325[#22325])
* Use a fresh recovery id when retrying recoveries {pull}22325[#22325] (issue: {issue}22043[#22043])
* Allow flush/force_merge/upgrade on shard marked as relocated {pull}22078[#22078] (issue: {issue}22043[#22043])

Reindex API::
* Don't close rest client from its callback {pull}22061[#22061] (issue: {issue}22027[#22027])

Search::
* Improve concurrency of ShardCoreKeyMap. {pull}22316[#22316]
* Make `-0` compare less than `+0` consistently. {pull}22173[#22173] (issue: {issue}22167[#22167])
* FiltersAggregationBuilder: rewriting filter queries, the same way as in FilterAggregationBuilder {pull}22076[#22076]

Stats::
* Implement stats for geo_point and geo_shape field {pull}22391[#22391] (issue: {issue}22384[#22384])
* Use reader for doc stats {pull}22317[#22317] (issue: {issue}22285[#22285])
* Avoid NPE in NodeService#stats if HTTP is disabled {pull}22060[#22060] (issue: {issue}22058[#22058])
* Add support for "include_segment_file_sizes" in indices stats REST handler {pull}21879[#21879] (issue: {issue}21878[#21878])

Term Vectors::
* Fix _termvectors with preference to not hit NPE {pull}21959[#21959]
* Return correct term statistics when a field is not found in a shard {pull}21922[#21922] (issue: {issue}21906[#21906])

[float]
=== Regressions

Logging::
* Restores the original default format of search slow log {pull}21770[#21770] (issue: {issue}21711[#21711])

//[float]
//=== Known Issues

[[release-notes-5.1.1]]
== {es} version 5.1.1

[float]
[[breaking-5.1.1]]
=== Breaking Changes

Aliases::
* Validate alias names the same as index names {pull}20771[#20771] (issue: {issue}20748[#20748])

REST::
* Remove lenient stats parsing 5.x {pull}21576[#21576] (issues: {issue}20722[#20722], {issue}21410[#21410], {issue}21417[#21417])

[float]
=== Breaking Java Changes

Discovery::
* Remove pluggability of ElectMasterService {pull}21031[#21031]

Exceptions::
* Remove `IndexTemplateAlreadyExistsException` and `IndexShardAlreadyExistsException` {pull}21539[#21539] (issue: {issue}21494[#21494])
* Replace IndexAlreadyExistsException with ResourceAlreadyExistsException {pull}21494[#21494]
* Backport: Replace IndexAlreadyExistsException with ResourceAlreadyExistsException {pull}21601[#21601] (issue: {issue}21494[#21494])

Internal::
* Pass executor name to request interceptor to support async intercept calls {pull}21089[#21089]

Network::
* Unguice Transport and friends {pull}20526[#20526]

Plugins::
* Plugins: Remove support for onModule {pull}21416[#21416]

[float]
=== Deprecations

Analysis::
* Deprecating request parameters of _analyze API in 5.x {pull}20686[#20686] (issue: {issue}20246[#20246])

CRUD::
* Deprecate VersionType.FORCE {pull}21078[#21078] (issue: {issue}20995[#20995])

Core::
* Add deprecation logging for users that explicitly opt in for the `default` fs type. {pull}21617[#21617]

Mapping::
* Deprecate `timestamp` and `ttl` on index requests. {pull}21826[#21826] (issue: {issue}21670[#21670])

Query DSL::
* Add deprecation logging for lenient boolean queries {pull}21570[#21570] (issue: {issue}21555[#21555])
* Add deprecation logging message for 'fuzzy' query {pull}20993[#20993] (issue: {issue}15760[#15760])

Search::
* Deprecate ignored type parameter in search_shards api {pull}21730[#21730] (issue: {issue}21688[#21688])

Settings::
* Add deprecation logging for the case that store throttling is used. {pull}21618[#21618]

[float]
=== New Features

Analysis::
* Expose Lucenes Ukrainian analyzer {pull}21176[#21176] (issue: {issue}19433[#19433])

CAT API::
* Provides a cat api endpoint for templates. {pull}20545[#20545] (issue: {issue}20467[#20467])

Query DSL::
* Add "all fields" execution mode to simple_query_string query {pull}21341[#21341] (issues: {issue}19784[#19784], {issue}20925[#20925])
* Add support for `quote_field_suffix` to `simple_query_string`. {pull}21060[#21060] (issue: {issue}18641[#18641])
* Add "all field" execution mode to query_string query {pull}20925[#20925] (issue: {issue}19784[#19784])

Reindex API::
* Add automatic parallelization support to reindex and friends {pull}20767[#20767] (issue: {issue}20624[#20624])

[float]
=== Enhancements

Aggregations::
* Rescorer should be applied in the TopHits aggregation {pull}20978[#20978] (issue: {issue}19317[#19317])

Allocation::
* Balance step in BalancedShardsAllocator for a single shard {pull}21103[#21103]
* Process more expensive allocation deciders last {pull}20724[#20724] (issue: {issue}12815[#12815])
* Separates decision making from decision application in BalancedShardsAllocator  {pull}20634[#20634]
* Split allocator decision making from decision application {pull}20431[#20431] (issue: {issue}20347[#20347])

Analysis::
* Remove AnalysisService and reduce it to a simple name to analyzer mapping {pull}20627[#20627] (issues: {issue}19827[#19827], {issue}19828[#19828])

CAT API::
* Adding built-in sorting capability to _cat apis. {pull}20658[#20658] (issue: {issue}16975[#16975])
* Add health status parameter to cat indices API {pull}20393[#20393]

Cache::
* Do not cache term queries. {pull}21566[#21566] (issues: {issue}16031[#16031], {issue}20116[#20116])
* Parse alias filters on the coordinating node {pull}20916[#20916]

Cluster::
* Cache successful shard deletion checks {pull}21438[#21438]

Core::
* Reduce memory pressure when sending large terms queries. {pull}21776[#21776]
* Install a security manager on startup {pull}21716[#21716]
* Log node ID on startup {pull}21673[#21673]
* Ensure source filtering automatons are only compiled once {pull}20857[#20857] (issue: {issue}20839[#20839])
* Improve scheduling fairness when batching cluster state changes with equal priority {pull}20775[#20775] (issue: {issue}20768[#20768])
* Do not log full bootstrap checks exception {pull}19989[#19989]

Exceptions::
* Add BWC layer for Exceptions {pull}21694[#21694] (issue: {issue}21656[#21656])

Geo::
* Optimize geo-distance sorting. {pull}20596[#20596] (issue: {issue}20450[#20450])

Ingest::
* add `ignore_missing` option to SplitProcessor {pull}20982[#20982] (issues: {issue}19995[#19995], {issue}20840[#20840])

Internal::
* Rename ClusterState#lookupPrototypeSafe to `lookupPrototype` and remove "unsafe" unused variant {pull}21686[#21686]
* ShardActiveResponseHandler shouldn't hold to an entire cluster state {pull}21470[#21470] (issue: {issue}21394[#21394])
* Remove unused ClusterService dependency from SearchPhaseController {pull}21421[#21421]
* Remove special case in case no action filters are registered {pull}21251[#21251]
* Use TimveValue instead of long for CacheBuilder methods {pull}20887[#20887]
* Remove SearchContext#current and all it's threadlocals {pull}20778[#20778] (issue: {issue}19341[#19341])

Java REST Client::
* Provide error message when rest request path is null {pull}21233[#21233] (issue: {issue}21232[#21232])

Logging::
* Log failure to connect to node at info instead of debug {pull}21809[#21809] (issue: {issue}6468[#6468])
* Truncate log messages from the end {pull}21609[#21609] (issue: {issue}21602[#21602])
* Logging shutdown hack {pull}20389[#20389] (issue: {issue}20304[#20304])
* Disable console logging {pull}20387[#20387]

Mapping::
* Create the QueryShardContext lazily in DocumentMapperParser. {pull}21287[#21287]

Network::
* Grant Netty permission to read system somaxconn {pull}21840[#21840]
* Lazy resolve unicast hosts {pull}21630[#21630] (issues: {issue}14441[#14441], {issue}16412[#16412])
* Fix handler name on message not fully read {pull}21478[#21478]
* Handle rejected pings on shutdown gracefully {pull}20842[#20842]

Packaging::
* Add empty plugins dir for archive distributions {pull}21204[#21204] (issue: {issue}20342[#20342])
* Make explicit missing settings for Windows service {pull}21200[#21200] (issue: {issue}18317[#18317])
* Change permissions on config files {pull}20966[#20966]

Plugin Lang Painless::
* Add Debug.explain to painless {pull}21723[#21723] (issue: {issue}20263[#20263])
* Implement the ?: operator in painless {pull}21506[#21506]
* In painless suggest a long constant if int won't do {pull}21415[#21415] (issue: {issue}21313[#21313])
* Support decimal constants with trailing [dD] in painless {pull}21412[#21412] (issue: {issue}21116[#21116])
* Implement reading from null safe dereferences {pull}21239[#21239]
* Painless negative offsets {pull}21080[#21080] (issue: {issue}20870[#20870])

Plugin Repository S3::
* Make the default S3 buffer size depend on the available memory. {pull}21299[#21299]

Plugins::
* Clarify that plugins can be closed {pull}21669[#21669]
* Plugins: Convert custom discovery to pull based plugin {pull}21398[#21398]
* Removing plugin that isn't installed shouldn't trigger usage information {pull}21272[#21272] (issue: {issue}21250[#21250])
* Remove pluggability of ZenPing {pull}21049[#21049]
* Make UnicastHostsProvider extension pull based {pull}21036[#21036]

Query DSL::
* Using ObjectParser in MatchAllQueryBuilder and IdsQueryBuilder {pull}21273[#21273]
* Expose splitOnWhitespace in `Query String Query` {pull}20965[#20965] (issue: {issue}20841[#20841])
* Throw error if query element doesn't end with END_OBJECT {pull}20528[#20528] (issue: {issue}20515[#20515])
* Remove `lowercase_expanded_terms` and `locale` from query-parser options. {pull}20208[#20208] (issue: {issue}9978[#9978])

Reindex API::
* Make reindex-from-remote ignore unknown fields {pull}20591[#20591] (issue: {issue}20504[#20504])

Scripting::
* Wrap VerifyError in ScriptException {pull}21769[#21769]
* Support binary field type in script values {pull}21484[#21484] (issue: {issue}14469[#14469])
* Mustache: Add {{#url}}{{/url}} function to URL encode strings {pull}20838[#20838]
* Expose `ctx._now` in update scripts {pull}20835[#20835] (issue: {issue}17895[#17895])

Search::
* Add indices and filter information to search shards api output {pull}21738[#21738] (issue: {issue}20916[#20916])
* remove pointless catch exception in TransportSearchAction {pull}21689[#21689]
* Optimize query with types filter in the URL (t/t/_search) {pull}20979[#20979]
* Makes search action cancelable by task management API {pull}20405[#20405]

Search Templates::
* Add profile and explain parameters to template API {pull}20451[#20451]

Snapshot/Restore::
* Abort snapshots on a node that leaves the cluster {pull}21084[#21084] (issue: {issue}20876[#20876])

Stats::
* Remove load average leniency {pull}21380[#21380]
* Strengthen handling of unavailable cgroup stats {pull}21094[#21094] (issue: {issue}21029[#21029])
* Add basic cgroup CPU metrics {pull}21029[#21029]

Task Manager::
* Add search task descriptions {pull}21740[#21740]

Tribe Node::
* Add support for merging custom meta data in tribe node {pull}21552[#21552] (issues: {issue}20544[#20544], {issue}20791[#20791], {issue}9372[#9372])

[float]
=== Bug Fixes

Aggregations::
* Rewrite Queries/Filter in FilterAggregationBuilder and ensure client usage marks query as non-cachable {pull}21303[#21303] (issue: {issue}21301[#21301])
* Percentiles bucket fails for 100th percentile {pull}21218[#21218]
* Thread safety for scripted significance heuristics {pull}21113[#21113] (issue: {issue}18120[#18120])

Allocation::
* Allow master to assign primary shard to node that has shard store locked during shard state fetching {pull}21656[#21656] (issue: {issue}19416[#19416])

Analysis::
* Can load non-PreBuiltTokenFilter in Analyze API {pull}20396[#20396]

CAT API::
* Consume `full_id` request parameter early {pull}21270[#21270] (issue: {issue}21266[#21266])

Cache::
* Fix the request cache keys to not hold references to the SearchContext. {pull}21284[#21284]

Circuit Breakers::
* ClusterState publishing shouldn't trigger circuit breakers {pull}20986[#20986] (issues: {issue}20827[#20827], {issue}20960[#20960])

Cluster::
* Remove cluster update task when task times out {pull}21578[#21578] (issue: {issue}21568[#21568])

Core::
* Add a StreamInput#readArraySize method that ensures sane array sizes {pull}21697[#21697]
* Use a buffer to do character to byte conversion in StreamOutput#writeString {pull}21680[#21680] (issue: {issue}21660[#21660])
* Fix ShardInfo#toString {pull}21319[#21319]
* Protect BytesStreamOutput against overflows of the current number of written bytes. {pull}21174[#21174] (issue: {issue}21159[#21159])
* Return target index name even if _rollover conditions are not met {pull}21138[#21138]
* .es_temp_file remains after system crash, causing it not to start again {pull}21007[#21007] (issue: {issue}20992[#20992])

Dates::
* Fix time zone rounding edge case for DST overlaps {pull}21550[#21550] (issue: {issue}20833[#20833])

Engine::
* Die with dignity on the Lucene layer {pull}21721[#21721] (issue: {issue}19272[#19272])
* Fix `InternalEngine#isThrottled` to not always return `false`. {pull}21592[#21592]
* Retrying replication requests on replica doesn't call `onRetry` {pull}21189[#21189] (issue: {issue}20211[#20211])

Highlighting::
* Fix FiltersFunctionScoreQuery highlighting {pull}21827[#21827]
* Fix highlighting on a stored keyword field {pull}21645[#21645] (issue: {issue}21636[#21636])

Index APIs::
* Validate the `_rollover` target index name early to also fail if dry_run=true {pull}21330[#21330] (issue: {issue}21149[#21149])

Index Templates::
* Fix integer overflows when dealing with templates. {pull}21628[#21628] (issue: {issue}21622[#21622])

Ingest::
* fix trace_match behavior for when there is only one grok pattern {pull}21413[#21413] (issue: {issue}21371[#21371])
* Stored scripts and ingest node configurations should be included into a snapshot {pull}21227[#21227] (issue: {issue}21184[#21184])

Inner Hits::
* Skip adding a parent field to nested documents. {pull}21522[#21522] (issue: {issue}21503[#21503])

Internal::
* Rethrow ExecutionException from the loader to concurrent callers of Cache#computeIfAbsent {pull}21549[#21549]
* Restore thread's original context before returning to the ThreadPool {pull}21411[#21411]
* Fix NPE in SearchContext.toString() {pull}21069[#21069]
* Source filtering should treat dots in field names as sub objects. {pull}20736[#20736] (issue: {issue}20719[#20719])

Java API::
* Transport client: Fix remove address to actually work {pull}21743[#21743]
* Add a HostFailureListener to notify client code if a node got disconnected {pull}21709[#21709] (issue: {issue}21424[#21424])
* Fix InternalSearchHit#hasSource to return the proper boolean value {pull}21441[#21441] (issue: {issue}21419[#21419])
* Null checked for source when calling sourceRef {pull}21431[#21431] (issue: {issue}19279[#19279])
* ClusterAdminClient.prepareDeletePipeline method should accept pipeline id to delete {pull}21228[#21228]

Java REST Client::
* Rest client: don't reuse the same HttpAsyncResponseConsumer across multiple retries {pull}21378[#21378]

Logging::
* Do not prematurely shutdown Log4j {pull}21519[#21519] (issue: {issue}21514[#21514])
* Assert status logger does not warn on Log4j usage {pull}21339[#21339]
* Fix logger names for Netty {pull}21223[#21223] (issue: {issue}20457[#20457])

Mapping::
* Fail to index fields with dots in field names when one of the intermediate objects is nested. {pull}21787[#21787] (issue: {issue}21726[#21726])
* Uncommitted mapping updates should not efect existing indices {pull}21306[#21306] (issue: {issue}21189[#21189])

Network::
* DiscoveryNode and TransportAddress should preserve host information {pull}21828[#21828]
* Die with dignity on the network layer {pull}21720[#21720] (issue: {issue}19272[#19272])
* Prevent double release in TcpTransport if send listener throws an exception {pull}20880[#20880]

Packaging::
* Set vm.max_map_count on systemd package install {pull}21507[#21507]
* Export ES_JVM_OPTIONS for SysV init {pull}21445[#21445] (issue: {issue}21255[#21255])
* Debian: configure start-stop-daemon to not go into background {pull}21343[#21343] (issues: {issue}12716[#12716], {issue}21300[#21300])
* Generate POM files with non-wildcard excludes {pull}21234[#21234] (issue: {issue}21170[#21170])

Plugin Lang Painless::
* Test fix for def equals in Painless {pull}21945[#21945] (issue: {issue}21801[#21801])
* Fix a VerifyError bug in Painless {pull}21765[#21765]
* Fix Lambdas in Painless to be Able to Use Top-Level Variables Such as params and doc {pull}21635[#21635] (issues: {issue}20869[#20869], {issue}21479[#21479])

Plugin Mapper Attachment::
* NPE is raised when defining a non existing type within attachments type {pull}21848[#21848]

Query DSL::
* Fixes date range query using epoch with timezone {pull}21542[#21542] (issue: {issue}21501[#21501])
* Allow overriding all-field leniency when `lenient` option is specified {pull}21504[#21504] (issues: {issue}20925[#20925], {issue}21341[#21341])
* Max score should be updated when a rescorer is used {pull}20977[#20977] (issue: {issue}20651[#20651])

REST::
* Strict level parsing for indices stats {pull}21577[#21577] (issue: {issue}21024[#21024])
* The routing query string param is supported by mget but was missing from the rest spec {pull}21357[#21357]
* fix thread_pool_patterns path variable definition {pull}21332[#21332]
* ensure the XContentBuilder is always closed in RestBuilderListener {pull}21124[#21124]
* XContentBuilder: Avoid building self-referencing objects {pull}20550[#20550] (issues: {issue}19475[#19475], {issue}20540[#20540])

Reindex API::
* Ignore IllegalArgumentException with assertVersionSerializable {pull}21409[#21409] (issues: {issue}20767[#20767], {issue}21350[#21350])
* Bump reindex-from-remote's buffer to 200mb {pull}21222[#21222] (issue: {issue}21185[#21185])
* Fix reindex-from-remote for parent/child from <2.0 {pull}21070[#21070] (issue: {issue}21044[#21044])

Search::
* Fix match_phrase_prefix on boosted fields {pull}21623[#21623] (issue: {issue}21613[#21613])
* Respect default search timeout {pull}21599[#21599] (issues: {issue}12211[#12211], {issue}21595[#21595])
* Remove LateParsingQuery to prevent timestamp access after context is frozen {pull}21328[#21328] (issue: {issue}21295[#21295])

Search Templates::
* SearchTemplateRequest to implement CompositeIndicesRequest {pull}21865[#21865] (issue: {issue}21747[#21747])

Settings::
* Handle spaces in `action.auto_create_index` gracefully {pull}21790[#21790] (issue: {issue}21449[#21449])
* Fix settings diff generation for affix and group settings {pull}21788[#21788]
* Don't reset non-dynamic settings unless explicitly requested {pull}21646[#21646] (issue: {issue}21593[#21593])

Snapshot/Restore::
* Fixes shard level snapshot metadata loading when index-N file is missing {pull}21813[#21813]
* Ensures cleanup of temporary index-* generational blobs during snapshotting {pull}21469[#21469] (issue: {issue}21462[#21462])
* Fixes get snapshot duplicates when asking for _all {pull}21340[#21340] (issue: {issue}21335[#21335])
* Keep snapshot restore state and routing table in sync (5.x backport) {pull}21131[#21131] (issue: {issue}20836[#20836])

Task Manager::
* Task cancellation command should wait for all child nodes to receive cancellation request before returning {pull}21397[#21397] (issue: {issue}21126[#21126])

Tribe Node::
* Add socket permissions for tribe nodes {pull}21546[#21546] (issues: {issue}16392[#16392], {issue}21122[#21122])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to lucene-6.3.0. {pull}21464[#21464]

Dates::
* Update Joda Time to version 2.9.5 {pull}21468[#21468] (issues: {issue}20911[#20911], {issue}332[#332], {issue}373[#373], {issue}378[#378], {issue}379[#379], {issue}386[#386], {issue}394[#394], {issue}396[#396], {issue}397[#397], {issue}404[#404], {issue}69[#69])

Logging::
* Upgrade Log4j 2 to version 2.7 {pull}20805[#20805] (issue: {issue}20304[#20304])

Network::
* Upgrade to Netty 4.1.6 {pull}21051[#21051]

Plugin Ingest Attachment::
* Update to Tika 1.14 {pull}21663[#21663] (issues: {issue}20710[#20710], {issue}21591[#21591])

[[release-notes-5.1.0]]
== {es} version 5.1.0

Version 5.1.0 doesn't exist because, for a short period of time, the Elastic
Yum and Apt repositories included unreleased binaries labeled 5.1.0. To avoid
confusion and upgrade issues for the people that have installed these without
realizing, we decided to skip the 5.1.0 version and release 5.1.1 instead.

//[float]
//[[breaking-5.1.0]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

//[float]
//=== Enhancements

//[float]
//=== Bug Fixes

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.0.2]]
== {es} version 5.0.2

//[float]
//[[breaking-5.0.2]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Core::
* Install a security manager on startup {pull}21716[#21716]

Exceptions::
* Add BWC layer for Exceptions {pull}21694[#21694] (issue: {issue}21656[#21656])

Logging::
* Truncate log messages from the end {pull}21609[#21609] (issue: {issue}21602[#21602])

Scripting::
* Wrap VerifyError in ScriptException {pull}21769[#21769]

Snapshot/Restore::
* Abort snapshots on a node that leaves the cluster {pull}21084[#21084] (issue: {issue}20876[#20876])

[float]
=== Bug Fixes

Allocation::
* Allow master to assign primary shard to node that has shard store locked during shard state fetching {pull}21656[#21656] (issue: {issue}19416[#19416])

Cluster::
* Remove cluster update task when task times out {pull}21578[#21578] (issue: {issue}21568[#21568])

Core::
* Add a StreamInput#readArraySize method that ensures sane array sizes {pull}21697[#21697]
* Use a buffer to do character to byte conversion in StreamOutput#writeString {pull}21680[#21680] (issue: {issue}21660[#21660])

Engine::
* Die with dignity on the Lucene layer {pull}21721[#21721] (issue: {issue}19272[#19272])
* Fix `InternalEngine#isThrottled` to not always return `false`. {pull}21592[#21592]

Index Templates::
* Fix integer overflows when dealing with templates. {pull}21628[#21628] (issue: {issue}21622[#21622])

Ingest::
* fix trace_match behavior for when there is only one grok pattern {pull}21413[#21413] (issue: {issue}21371[#21371])

Internal::
* Rethrow ExecutionException from the loader to concurrent callers of Cache#computeIfAbsent {pull}21549[#21549]
* Fixes potential NullPointerException on shard closing {pull}21515[#21515] (issue: {issue}21084[#21084])

Java API::
* Transport client: Fix remove address to actually work {pull}21743[#21743]
* Add a HostFailureListener to notify client code if a node got disconnected {pull}21709[#21709] (issue: {issue}21424[#21424])

Logging::
* Do not prematurely shutdown Log4j {pull}21519[#21519] (issue: {issue}21514[#21514])

Network::
* Die with dignity on the network layer {pull}21720[#21720] (issue: {issue}19272[#19272])

Plugin Lang Painless::
* Fix a VerifyError bug in Painless {pull}21765[#21765]
* Fix Lambdas in Painless to be Able to Use Top-Level Variables Such as params and doc {pull}21635[#21635] (issues: {issue}20869[#20869], {issue}21479[#21479])

Search::
* Respect default search timeout {pull}21599[#21599] (issues: {issue}12211[#12211], {issue}21595[#21595])

Settings::
* Don't reset non-dynamic settings unless explicitly requested {pull}21646[#21646] (issue: {issue}21593[#21593])

Tribe Node::
* Add socket permissions for tribe nodes {pull}21546[#21546] (issues: {issue}16392[#16392], {issue}21122[#21122])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.0.1]]
== {es} version 5.0.1

//[float]
//[[breaking-5.0.1]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

[float]
=== Deprecations

CRUD::
* Deprecate VersionType.FORCE {pull}21078[#21078] (issue: {issue}20995[#20995])

//[float]
//=== New Features

[float]
=== Enhancements

Aggregations::
* Rescorer should be applied in the TopHits aggregation {pull}20978[#20978] (issue: {issue}19317[#19317])

Internal::
* ShardActiveResponseHandler shouldn't hold to an entire cluster state {pull}21470[#21470] (issue: {issue}21394[#21394])

Network::
* Fix handler name on message not fully read {pull}21478[#21478]

Packaging::
* Add empty plugins dir for archive distributions {pull}21204[#21204] (issue: {issue}20342[#20342])
* Make explicit missing settings for Windows service {pull}21200[#21200] (issue: {issue}18317[#18317])
* Change permissions on config files {pull}20966[#20966]

Search::
* Optimize query with types filter in the URL (t/t/_search) {pull}20979[#20979]

[float]
=== Bug Fixes

Aggregations::
* Rewrite Queries/Filter in FilterAggregationBuilder and ensure client usage marks query as non-cachable {pull}21303[#21303] (issue: {issue}21301[#21301])
* Thread safety for scripted significance heuristics {pull}21113[#21113] (issue: {issue}18120[#18120])
* `ip_range` aggregation should accept null bounds. {pull}21043[#21043] (issue: {issue}21006[#21006])

CAT API::
* Consume `full_id` request parameter early {pull}21270[#21270] (issue: {issue}21266[#21266])

Cache::
* Fix the request cache keys to not hold references to the SearchContext. {pull}21284[#21284]

Circuit Breakers::
* ClusterState publishing shouldn't trigger circuit breakers {pull}20986[#20986] (issues: {issue}20827[#20827], {issue}20960[#20960])

Core::
* Fix ShardInfo#toString {pull}21319[#21319]
* Protect BytesStreamOutput against overflows of the current number of written bytes. {pull}21174[#21174] (issue: {issue}21159[#21159])
* Return target index name even if _rollover conditions are not met {pull}21138[#21138]

Engine::
* Retrying replication requests on replica doesn't call `onRetry` {pull}21189[#21189] (issue: {issue}20211[#20211])

Index APIs::
* Validate the `_rollover` target index name early to also fail if dry_run=true {pull}21330[#21330] (issue: {issue}21149[#21149])

Ingest::
* Stored scripts and ingest node configurations should be included into a snapshot {pull}21227[#21227] (issue: {issue}21184[#21184])

Internal::
* Restore thread's original context before returning to the ThreadPool {pull}21411[#21411]

Java API::
* Fix InternalSearchHit#hasSource to return the proper boolean value {pull}21441[#21441] (issue: {issue}21419[#21419])
* Null checked for source when calling sourceRef {pull}21431[#21431] (issue: {issue}19279[#19279])
* ClusterAdminClient.prepareDeletePipeline method should accept pipeline id to delete {pull}21228[#21228]

Java REST Client::
* Rest client: don't reuse the same HttpAsyncResponseConsumer across multiple retries {pull}21378[#21378]

Logging::
* Assert status logger does not warn on Log4j usage {pull}21339[#21339]
* Fix logger names for Netty {pull}21223[#21223] (issue: {issue}20457[#20457])

Packaging::
* Set vm.max_map_count on systemd package install {pull}21507[#21507]
* Export ES_JVM_OPTIONS for SysV init {pull}21445[#21445] (issue: {issue}21255[#21255])
* Debian: configure start-stop-daemon to not go into background {pull}21343[#21343] (issues: {issue}12716[#12716], {issue}21300[#21300])
* Generate POM files with non-wildcard excludes {pull}21234[#21234] (issue: {issue}21170[#21170])

Query DSL::
* Max score should be updated when a rescorer is used {pull}20977[#20977] (issue: {issue}20651[#20651])

REST::
* The routing query string param is supported by mget but was missing from the rest spec {pull}21357[#21357]
* fix thread_pool_patterns path variable definition {pull}21332[#21332]
* ensure the XContentBuilder is always closed in RestBuilderListener {pull}21124[#21124]

Reindex API::
* Bump reindex-from-remote's buffer to 200mb {pull}21222[#21222] (issue: {issue}21185[#21185])
* Fix reindex-from-remote for parent/child from <2.0 {pull}21070[#21070] (issue: {issue}21044[#21044])

Search::
* Fixes cachability problems with fetching TTL values when searching {pull}21493[#21493] (issue: {issue}21457[#21457])
* Remove LateParsingQuery to prevent timestamp access after context is frozen {pull}21328[#21328] (issue: {issue}21295[#21295])

Snapshot/Restore::
* Ensures cleanup of temporary index-* generational blobs during snapshotting {pull}21469[#21469] (issue: {issue}21462[#21462])
* Fixes get snapshot duplicates when asking for _all {pull}21340[#21340] (issue: {issue}21335[#21335])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.2.1 {pull}21207[#21207]

Dates::
* Update Joda Time to version 2.9.5 {pull}21468[#21468] (issue: {issue}20911[#20911])


[[release-notes-5.0.0]]
== {es} version 5.0.0 Combined

The list below covers all changes from 5.0.0-alpha1 to 5.0.0 GA excluding 
changes which were already released in the 2.x series, which can be found in 
<<release-notes-5.0.0-alpha1-2x>>.

[float]
[[breaking-5.0.0]]
=== Breaking Changes

Aggregations::
* Remove size 0 options in aggregations {pull}18854[#18854] (issue: {issue}18838[#18838])

Aliases::
* make get alias expand to open and closed indices by default {pull}15954[#15954] (issue: {issue}14982[#14982])
* Remove deprecated indices.get_aliases {pull}13906[#13906]

Allocation::
* Remove DisableAllocationDecider {pull}13313[#13313]

Analysis::
* Remove `token_filter` in _analyze API {pull}20285[#20285] (issue: {issue}20283[#20283])
* Removes support for adding aliases to analyzers {pull}19994[#19994] (issue: {issue}18244[#18244])
* Analyze API : Rename filters/token_filters/char_filter in Analyze API in master {pull}17843[#17843] (issue: {issue}15189[#15189])

CAT API::
* Improve cat thread pool API {pull}19721[#19721] (issue: {issue}19590[#19590])
* Row-centric output for _cat/fielddata {pull}18068[#18068] (issue: {issue}10249[#10249])
* Add raw recovery progress to cat recovery API {pull}17064[#17064] (issue: {issue}17022[#17022])
* Remove host from cat nodes API {pull}16656[#16656] (issues: {issue}12959[#12959], {issue}16575[#16575])
* Using the accept header in the request instead of content-type in _cat API. {pull}14421[#14421] (issue: {issue}14195[#14195])

CRUD::
* Fixed naming inconsistency for fields/stored_fields in the APIs {pull}20166[#20166] (issues: {issue}18943[#18943], {issue}20155[#20155])
* Disallow creating indices starting with '-' or '+' {pull}20033[#20033] (issue: {issue}19800[#19800])
* Wait for changes to be visible by search {pull}17986[#17986] (issue: {issue}1063[#1063])
* Remove object notation for core types. {pull}15684[#15684] (issue: {issue}15388[#15388])

Cache::
* Remove deprecated query cache settings {pull}15592[#15592]

Cluster::
* Persistent Node Ids {pull}19140[#19140] (issue: {issue}17811[#17811])
* Remove validation errors from cluster health response {pull}17773[#17773] (issue: {issue}16979[#16979])
* Remove memory section {pull}17278[#17278] (issues: {issue}12049[#12049], {issue}16756[#16756])

Core::
* Remove ignore system bootstrap checks {pull}20511[#20511]
* Remove minimum master nodes bootstrap check {pull}20082[#20082]
* Keep input time unit when parsing TimeValues {pull}19102[#19102]
* Remove cluster name from data path {pull}18554[#18554] (issue: {issue}17810[#17810])
* Add max number of processes check {pull}16919[#16919]
* Add mlockall bootstrap check {pull}16909[#16909]
* One log {pull}16703[#16703] (issue: {issue}16585[#16585])

Engine::
* Optimize indexing for the autogenerated ID append-only case {pull}20211[#20211] (issue: {issue}19813[#19813])
* Remove `index.compound_on_flush` setting and default to `true` {pull}15594[#15594] (issue: {issue}10778[#10778])

Exceptions::
* Die with dignity {pull}19272[#19272] (issue: {issue}19231[#19231])

Fielddata::
* Remove "uninverted" and "binary" fielddata support for numeric and boolean fields. {pull}14082[#14082] (issue: {issue}14113[#14113])

Geo::
* Deprecate GeoDistance enums and remove geo distance script helpers {pull}19783[#19783]

Index APIs::
* Removes write consistency level across replication action APIs in favor of wait_for_active_shards {pull}19454[#19454] (issue: {issue}18985[#18985])
* Remove `GET` option for /_forcemerge {pull}15223[#15223] (issue: {issue}15165[#15165])
* Remove /_optimize REST API endpoint {pull}14226[#14226] (issue: {issue}13778[#13778])

Indexed Scripts/Templates::
* Store indexed scripts in the cluster state instead of the `.scripts` index {pull}17650[#17650] (issue: {issue}16651[#16651])

Inner Hits::
* Also do not serialize `_index` key in search response for parent/child inner hits {pull}19011[#19011]
* Don't include `_id`, `_type` and `_index` keys in search response for inner hits {pull}18995[#18995] (issue: {issue}18091[#18091])
* Nested inner hits shouldn't use relative paths {pull}18567[#18567] (issue: {issue}16653[#16653])
* Drop top level inner hits in favour of inner hits defined in the query dsl {pull}17816[#17816] (issue: {issue}11118[#11118])

Internal::
* `_flush` should block by default {pull}20597[#20597] (issue: {issue}20569[#20569])
* Actually bound the generic thread pool {pull}17017[#17017]
* Remove support for pre 2.0 indices {pull}13799[#13799]

Logging::
* Introduce Log4j 2 {pull}20235[#20235] (issues: {issue}16030[#16030], {issue}17697[#17697])

Mapping::
* Remove `_timestamp` and `_ttl` on 5.x indices. {pull}18980[#18980] (issue: {issue}18280[#18280])
* Add a soft limit on the mapping depth. {pull}17400[#17400]
* Disable fielddata on text fields by defaults. {pull}17386[#17386]
* Add limit to total number of fields in mapping {pull}17357[#17357]
* Change the field mapping index time boost into a query time boost. {pull}16900[#16900]
* Deprecate string in favor of text/keyword. {pull}16877[#16877]
* Term vector APIs should no longer update mappings {pull}16285[#16285]
* Remove the `format` option of the `_source` field. {pull}15398[#15398]
* Remove transform {pull}13657[#13657] (issue: {issue}12674[#12674])

Packaging::
* Rename service.bat to elasticsearch-service.bat {pull}20496[#20496] (issue: {issue}17528[#17528])
* Remove -D handling in args for windows plugin script {pull}20378[#20378] (issue: {issue}18207[#18207])
* Set default min heap equal to default max heap {pull}20080[#20080] (issues: {issue}16334[#16334], {issue}17728[#17728], {issue}18311[#18311])
* Remove allow running as root {pull}18694[#18694] (issue: {issue}18688[#18688])
* Require /bin/bash in packaging {pull}18259[#18259] (issue: {issue}18251[#18251])
* Remove plugin script parsing of system properties {pull}18207[#18207] (issue: {issue}18140[#18140])
* Add JVM options configuration file {pull}17675[#17675] (issue: {issue}17121[#17121])

Parent/Child::
* Removed `total` score mode in favour for `sum` score mode. {pull}17174[#17174] (issues: {issue}13470[#13470], {issue}17083[#17083])
* Removed pre 2.x parent child implementation {pull}13376[#13376]

Percolator::
* Remove `.percolator` type in favour of `percolator` field type {pull}17560[#17560]
* Change the percolate api to not dynamically add fields to mapping {pull}16077[#16077] (issue: {issue}15751[#15751])

Plugin Delete By Query::
* Remove Delete-By-Query plugin {pull}18516[#18516] (issue: {issue}18469[#18469])

Plugin Lang Painless::
* Remove all date 'now' methods from Painless {pull}20766[#20766] (issue: {issue}20762[#20762])
* Make Painless the Default Language {pull}20017[#20017] (issue: {issue}19960[#19960])

Plugins::
* Plugins cleanup {pull}18594[#18594] (issue: {issue}18588[#18588])
* Rename bin/plugin in bin/elasticsearch-plugin {pull}16454[#16454]
* Change the inner structure of the plugins zip {pull}16453[#16453]
* Remove multicast plugin {pull}16326[#16326] (issue: {issue}16310[#16310])
* Plugins: Remove site plugins {pull}16038[#16038]

Query DSL::
* Lessen leniency of the query dsl. {pull}18276[#18276]
* Function score query: remove deprecated support for boost_factor {pull}13510[#13510]
* Remove support for deprecated queries. {pull}13418[#13418] (issue: {issue}13326[#13326])

REST::
* Change separator for shards preference {pull}20786[#20786] (issues: {issue}20722[#20722], {issue}20769[#20769])
* Parameter improvements to Cluster Health API wait for shards {pull}20223[#20223] (issue: {issue}20216[#20216])
* Switch indices.exists_type from `{index}/{type}` to `{index}/_mapping/{type}`. {pull}20055[#20055] (issue: {issue}15613[#15613])
* Only use `PUT` for index creation, not POST. {pull}20001[#20001] (issues: {issue}15613[#15613], {issue}18160[#18160])
* Remove camelCase support {pull}17933[#17933] (issue: {issue}8988[#8988])
* Remove 'case' parameter from rest apis {pull}17774[#17774] (issue: {issue}8988[#8988])
* Disallow unquoted field names {pull}15351[#15351] (issue: {issue}9800[#9800])
* Limit the accepted length of the _id {pull}16036[#16036] (issue: {issue}16034[#16034])

Scripting::
* Hardcode painless as the default scripting lang and add legacy script default for stored scripts {pull}20310[#20310] (issue: {issue}20122[#20122])
* Remove deprecated 1.x script and template syntax {pull}19387[#19387] (issue: {issue}13729[#13729])
* Allow only a single extension for a scripting engine {pull}18332[#18332] (issue: {issue}10598[#10598])
* Remove 'sandbox' option for script settings, allow only registering a single language. {pull}18226[#18226] (issues: {issue}10598[#10598], {issue}17114[#17114])

Search::
* Rename `fields` to `stored_fields` and add `docvalue_fields` {pull}18992[#18992] (issue: {issue}18943[#18943])
* Remove only node preference {pull}18875[#18875] (issue: {issue}18822[#18822])
* Add search preference to prefer multiple nodes {pull}18872[#18872] (issue: {issue}18822[#18822])
* Add a soft limit on the number of shards that can be queried in a single search request. {pull}17396[#17396]
* Remove deprecated reverse option from sorting {pull}17282[#17282] (issue: {issue}17047[#17047])
* Remove some deprecations {pull}14331[#14331]
* Remove search exists api {pull}13911[#13911] (issues: {issue}13682[#13682], {issue}13910[#13910])
* Remove the scan and count search types. {pull}13310[#13310]

Search Refactoring::
* Remove deprecated parameter from field sort builder. {pull}16573[#16573] (issue: {issue}16127[#16127])
* Remove "query" query and fix related parsing bugs {pull}14304[#14304] (issue: {issue}13326[#13326])

Settings::
* Default max local storage nodes to one {pull}19964[#19964] (issues: {issue}19679[#19679], {issue}19748[#19748])
* Persistent Node Names {pull}19456[#19456] (issue: {issue}19140[#19140])
* Remove support for properties {pull}19398[#19398] (issues: {issue}19388[#19388], {issue}19391[#19391])
* Rename boostrap.mlockall to bootstrap.memory_lock {pull}18669[#18669]
* Register `indices.query.bool.max_clause_count` setting {pull}18341[#18341] (issue: {issue}18336[#18336])
* Remove settings and system properties entanglement {pull}18198[#18198] (issue: {issue}18197[#18197])
* Remove `action.get.realtime` setting {pull}17857[#17857] (issue: {issue}12543[#12543])
* Remove ability to specify arbitrary node attributes with `node.` prefix {pull}17402[#17402] (issue: {issue}17280[#17280])
* Enforce `discovery.zen.minimum_master_nodes` is set when bound to a public ip {pull}17288[#17288]
* Prevent index level setting from being configured on a node level {pull}17144[#17144] (issue: {issue}16799[#16799])
* Remove support for node.client setting {pull}16963[#16963] (issue: {issue}16565[#16565])
* Remove es.max-open-files flag {pull}16757[#16757] (issues: {issue}16506[#16506], {issue}483[#483])
* Enforce node level limits if node is started in production env {pull}16733[#16733] (issue: {issue}16727[#16727])
* Make settings validation strict {pull}16365[#16365]
* Remove the ability to fsync on every operation and only schedule fsync task if really needed {pull}16257[#16257] (issue: {issue}16152[#16152])
* Script settings {pull}16197[#16197]
* Remove index.flush_on_close entirely {pull}15977[#15977]
* Restore chunksize of 512kb on recovery and remove configurability {pull}15235[#15235] (issue: {issue}15161[#15161])
* Remove ancient deprecated and alternative recovery settings {pull}15234[#15234]

Similarities::
* Renames `default` similarity into `classic` {pull}15446[#15446] (issue: {issue}15102[#15102])

Snapshot/Restore::
* Change the default of `include_global_state` from true to false for snapshot restores {pull}18773[#18773] (issue: {issue}18569[#18569])
* Fail closing or deleting indices during a full snapshot {pull}17021[#17021] (issue: {issue}16321[#16321])

Stats::
* Modify load average format {pull}15932[#15932] (issue: {issue}15907[#15907])
* Reintroduce five-minute and fifteen-minute load averages on Linux {pull}15907[#15907] (issues: {issue}12049[#12049], {issue}14741[#14741])
* Add system CPU percent to OS stats {pull}14741[#14741]

Term Vectors::
* Remove DFS support from TermVector API {pull}16452[#16452]

Translog::
* Drop support for simple translog and hard-wire buffer to 8kb {pull}15574[#15574]
* Simplify translog-based flush settings {pull}15573[#15573]

Warmers::
* Remove query warmers and the warmer API. {pull}15614[#15614] (issue: {issue}15607[#15607])

[float]
=== Breaking Java Changes

Aggregations::
* getKeyAsString and key_as_string should be the same for terms aggregation on boolean field {pull}15393[#15393]

Allocation::
* Move parsing of allocation commands into REST and remove support for plugins to register allocation commands {pull}17802[#17802] (issue: {issue}17894[#17894])
* Simplify shard balancer interface {pull}17028[#17028] (issue: {issue}8954[#8954])

Analysis::
* Simplify Analysis registration and configuration {pull}14355[#14355]

CRUD::
* Removing isCreated and isFound from the Java API {pull}19645[#19645] (issues: {issue}19566[#19566], {issue}19631[#19631])

Cache::
* Refactor IndicesRequestCache to make it testable. {pull}16610[#16610]
* Fold IndexCacheModule into IndexModule {pull}14293[#14293]

Core::
* Remove ability to plug-in TransportService {pull}20505[#20505]
* Register thread pool settings {pull}18674[#18674] (issues: {issue}18613[#18613], {issue}9216[#9216])
* Bootstrap does not set system properties {pull}17088[#17088] (issues: {issue}16579[#16579], {issue}16791[#16791])
* Remove es.useLinkedTransferQueue {pull}16786[#16786]

Discovery::
* Introduce node handshake {pull}15971[#15971] (issue: {issue}9061[#9061])
* Include pings from client nodes in master election {pull}17329[#17329] (issue: {issue}17325[#17325])

Highlighting::
* Register Highlighter instances instead of classes {pull}18859[#18859]

Internal::
* Remove TransportService#registerRequestHandler leniency {pull}20469[#20469] (issue: {issue}20468[#20468])
* Consolidate search parser registries {pull}20000[#20000]
* Move all FetchSubPhases to o.e.search.fetch.subphase {pull}19702[#19702]
* Squash the rest of o.e.rest.action {pull}19698[#19698]
* Clean up BytesReference {pull}19196[#19196]
* Cleanup ClusterService dependencies and detached from Guice {pull}18941[#18941]
* Simplify SubFetchPhase interface {pull}18881[#18881]
* Simplify FetchSubPhase registration and detach it from Guice {pull}18862[#18862]
* Remove duplicate getters from DiscoveryNode and DiscoveryNodes {pull}17410[#17410] (issue: {issue}16963[#16963])
* Cli: Switch to jopt-simple {pull}17024[#17024] (issue: {issue}11564[#11564])
* Replace ContextAndHeaders with a ThreadPool based ThreadLocal implementation {pull}15776[#15776]
* Remove NodeBuilder {pull}15354[#15354]
* Fix IndexSearcherWrapper interface to not depend on the EngineConfig {pull}14654[#14654]
* Cleanup query parsing and remove IndexQueryParserService {pull}14452[#14452]
* Remove circular dependency between IndicesService and IndicesStore {pull}14285[#14285]
* Remove guice injection from IndexStore and friends {pull}14279[#14279]
* Replace IndicesLifecycle with a per-index IndexEventListener {pull}14217[#14217] (issue: {issue}13259[#13259])
* Simplify similarity module and friends {pull}13942[#13942]
* Refactor SearchRequest to be parsed on the coordinating node {pull}13859[#13859]

Java API::
* Add a dedicated client/transport project for transport-client {pull}19435[#19435] (issue: {issue}19412[#19412])
* Remove setRefresh {pull}18752[#18752] (issue: {issue}1063[#1063])
* Remove the count api {pull}14166[#14166] (issue: {issue}13928[#13928])
* IdsQueryBuilder to accept only non null ids and types {pull}13937[#13937]

Mapping::
* [Mapping] Several MappingService cleanups {pull}16133[#16133] (issue: {issue}15924[#15924])

Network::
* Factor out abstract TCPTransport* classes to reduce the netty footprint {pull}19096[#19096]
* Remove ability to disable Netty gathering writes {pull}16774[#16774] (issue: {issue}7811[#7811])

Parent/Child::
* Cleanup ParentFieldMapper {pull}16045[#16045]
* Several other parent/child cleanups {pull}13470[#13470]

Percolator::
* Move the percolator from core to its own module {pull}18511[#18511]
* Remove percolator cache {pull}18434[#18434]

Plugins::
* Cleanup sub fetch phase extension point {pull}20382[#20382]
* Remove IndexTemplateFilter {pull}20072[#20072]
* Switch custom ShardsAllocators to pull based model {pull}20071[#20071]
* Make custom allocation deciders use pull based extensions {pull}20040[#20040]
* Migrate query registration from push to pull {pull}19376[#19376]
* Add components getter as bridge between guice and new plugin init world {pull}19371[#19371]
* Remove CustomNodeAttributes extension point {pull}19348[#19348]
* Add RepositoryPlugin interface for registering snapshot repositories {pull}19324[#19324]
* Simplified repository api for snapshot/restore {pull}19292[#19292]
* Switch most search extensions from push to pull {pull}19238[#19238]
* Move RestHandler registration to ActionModule and ActionPlugin {pull}19165[#19165]
* Pull actions from plugins {pull}19108[#19108]
* Switch analysis from push to pull {pull}19073[#19073]
* Remove guice from Mapper plugins {pull}19018[#19018]
* Fail to start if plugin tries broken onModule {pull}19025[#19025]
* Simplify ScriptModule and script registration {pull}18903[#18903]
* Cut over settings registration to a pull model {pull}18890[#18890]
* Enforce isolated mode for all plugins {pull}17276[#17276]
* Don't use guice for QueryParsers {pull}15761[#15761]
* Remove guice from the index level {pull}14518[#14518]
* Remove shard-level injector {pull}13881[#13881]

Query DSL::
* Remove the MissingQueryBuilder which was deprecated in 2.2.0. {pull}15364[#15364] (issue: {issue}14112[#14112])
* Remove NotQueryBuilder {pull}14204[#14204] (issue: {issue}13761[#13761])

Scripting::
* Remove o.e.script.Template class and move template query to lang-mustache module {pull}19425[#19425] (issue: {issue}16314[#16314])
* Move search template to lang-mustache module {pull}18765[#18765] (issue: {issue}17906[#17906])
* Remove LeafSearchScript.runAsFloat(): Nothing calls it. {pull}18364[#18364]

Search::
* Remove FetchSubPhaseParseElement {pull}20350[#20350]
* Refactor of query profile classes to make way for other profile implementations {pull}18370[#18370] (issue: {issue}10538[#10538])
* Query refactoring: split parse phase into fromXContent and toQuery for all queries {pull}13788[#13788] (issue: {issue}10217[#10217])

Search Refactoring::
* Refactored inner hits parsing and intoduced InnerHitBuilder {pull}17291[#17291]
* Remove support for query_binary and filter_binary {pull}14433[#14433] (issue: {issue}14308[#14308])
* Validate query api: move query parsing to the coordinating node {pull}14384[#14384]

Settings::
* Remove `node.mode` and `node.local` settings {pull}19428[#19428]
* Remove Settings.settingsBuilder. {pull}17619[#17619]
* Move remaining settings in NettyHttpServerTransport to the new infra {pull}16531[#16531]
* Replace IndexSettings annotation with a full-fledged class {pull}14251[#14251]
* Fix ping timeout settings inconsistencies {pull}13701[#13701] (issue: {issue}6579[#6579])

Snapshot/Restore::
* Removes extra writeBlob method in BlobContainer {pull}19727[#19727] (issue: {issue}18528[#18528])

Store::
* Standardize state format type for global and index level metadata {pull}17123[#17123]

Suggesters::
* Remove suggest threadpool {pull}17304[#17304] (issue: {issue}17198[#17198])
* Remove suggest transport action {pull}17198[#17198] (issue: {issue}10217[#10217])

[float]
=== Deprecations

CRUD::
* Deprecate found and created in delete and index rest responses {pull}19633[#19633]

Plugin Discovery Azure Classic::
* Deprecate discovery-azure and rename it to discovery-azure-classic {pull}19186[#19186] (issue: {issue}19144[#19144])

Plugin Mapper Attachment::
* Deprecate mapper-attachments plugin {pull}16948[#16948] (issue: {issue}16910[#16910])

Query DSL::
* Deprecate Indices query {pull}17710[#17710] (issue: {issue}12017[#12017])
* Deprecate mlt, in and geo_bbox query name shortcuts {pull}17507[#17507]

Query Refactoring::
* Splits `phrase` and `phrase_prefix` in match query into `MatchPhraseQueryBuilder` and `MatchPhrasePrefixQueryBuilder` {pull}17508[#17508]

Scripting::
* Deprecate Groovy, Python, and Javascript {pull}20244[#20244] (issue: {issue}20129[#20129])

Search::
* Deprecate fuzzy query {pull}16211[#16211] (issues: {issue}15760[#15760], {issue}16121[#16121])

Templates::
* Deprecate template query {pull}19607[#19607] (issue: {issue}19390[#19390])

[float]
=== New Features

Aggregations::
* Split regular histograms from date histograms. {pull}19551[#19551] (issues: {issue}4847[#4847], {issue}8082[#8082])
* Adds aggregation profiling to the profile API {pull}18414[#18414] (issue: {issue}10538[#10538])
* New Matrix Stats Aggregation module {pull}18300[#18300] (issue: {issue}16826[#16826])

Aliases::
* Add an alias action to delete an index {pull}20184[#20184] (issue: {issue}20064[#20064])

Allocation::
* Add API to explain why a shard is or isn't assigned {pull}17305[#17305] (issue: {issue}14593[#14593])

Analysis::
* Exposing lucene 6.x minhash filter. {pull}20206[#20206] (issue: {issue}20149[#20149])
* Add `fingerprint` token filter and `fingerprint` analyzer {pull}17873[#17873] (issue: {issue}13325[#13325])

Circuit Breakers::
* Circuit break on aggregation bucket numbers with request breaker {pull}19394[#19394] (issue: {issue}14046[#14046])

Discovery::
* Add two phased commit to Cluster State publishing {pull}13062[#13062]

Geo::
* Cut over geo_point field and queries to new LatLonPoint type {pull}20315[#20315] (issue: {issue}20314[#20314])

Index APIs::
* Add rollover API to switch index aliases given some predicates {pull}18732[#18732] (issue: {issue}18647[#18647])

Ingest::
* ingest-useragent plugin {pull}19074[#19074]
* Add a Sort ingest processor {pull}17999[#17999]
* Add date_index_name processor {pull}17973[#17973] (issue: {issue}17814[#17814])
* Merge feature/ingest branch into master branch {pull}16049[#16049] (issue: {issue}14049[#14049])

Java REST Client::
* Introduce async performRequest method {pull}19400[#19400]
* Low level Rest Client {pull}18735[#18735] (issue: {issue}7743[#7743])

Mapping::
* Add `scaled_float`. {pull}19264[#19264] (issues: {issue}15939[#15939], {issue}1941[#1941])
* Expose half-floats. {pull}18887[#18887]
* Add a text field. {pull}16637[#16637]
* Add a new `keyword` field. {pull}16589[#16589] (issue: {issue}14113[#14113])

Percolator::
* index the query terms from the percolator query {pull}13646[#13646] (issue: {issue}12664[#12664])

Plugin Analysis ICU::
* Adding support for customizing the rule file in ICU tokenizer {pull}13651[#13651] (issue: {issue}13146[#13146])

Plugin Discovery File::
* File-based discovery plugin {pull}20394[#20394] (issue: {issue}20323[#20323])

Plugin Ingest Attachment::
* Ingest: Add attachment processor {pull}16490[#16490] (issue: {issue}16303[#16303])

Plugin Mapper Attachment::
* Migrate mapper attachments plugin to main repository {pull}14605[#14605]

Plugin Repository HDFS::
* HDFS Snapshot/Restore plugin {pull}15192[#15192] (issue: {issue}15191[#15191])

Plugin Repository S3::
* Add support for path_style_access {pull}15114[#15114]

Query DSL::
* Adds a rewrite phase to queries on the shard level {pull}16870[#16870] (issue: {issue}9526[#9526])

Reindex API::
* Reindex from remote {pull}18585[#18585] (issue: {issue}17447[#17447])
* Port Delete By Query to Reindex infrastructure {pull}18329[#18329] (issue: {issue}16883[#16883])
* Merge reindex to master {pull}16861[#16861]

Scripting::
* Exceptions and Infinite Loop Checking {pull}15936[#15936]
* Added a new scripting language (PlanA) {pull}15136[#15136] (issue: {issue}13084[#13084])

Scroll::
* Add the ability to partition a scroll in multiple slices. {pull}18237[#18237] (issue: {issue}13494[#13494])

Search::
* Add the ability to disable the retrieval of the stored fields entirely {pull}20026[#20026]
* Add `search_after` parameter in the SearchAPI {pull}16125[#16125] (issue: {issue}8192[#8192])

Settings::
* Add infrastructure to transactionally apply and reset dynamic settings {pull}15278[#15278]

Snapshot/Restore::
* Add Google Cloud Storage repository plugin {pull}13578[#13578] (issue: {issue}12880[#12880])

Stats::
* Extend field stats to report searchable/aggregatable fields {pull}17980[#17980] (issue: {issue}17750[#17750])
* API for listing index file sizes {pull}16661[#16661] (issue: {issue}16131[#16131])

Store::
* Expose MMapDirectory.preLoad(). {pull}18880[#18880]
* Add primitive to shrink an index into a single shard {pull}18270[#18270]

Suggesters::
* Add support for returning documents with completion suggester {pull}19536[#19536] (issue: {issue}10746[#10746])
* Add document-oriented completion suggester {pull}14410[#14410] (issue: {issue}10746[#10746])

Task Manager::
* Add task cancellation mechanism {pull}16320[#16320]
* Make the Task object available to the action caller {pull}16033[#16033]
* Task Management: Add framework for registering and communicating with tasks {pull}15347[#15347] (issue: {issue}15117[#15117])

Translog::
* Add `elasticsearch-translog` CLI tool with `truncate` command {pull}19342[#19342] (issue: {issue}19123[#19123])

[float]
=== Enhancements

Aggregations::
* Make the heuristic to compute the default shard size less aggressive. {pull}19659[#19659]
* Add _bucket_count option to buckets_path {pull}19571[#19571] (issue: {issue}19553[#19553])
* Remove AggregationStreams {pull}19507[#19507]
* Migrate serial_diff aggregation to NamedWriteable {pull}19483[#19483]
* Migrate most remaining pipeline aggregations to NamedWriteable {pull}19480[#19480]
* Migrate moving_avg pipeline aggregation to NamedWriteable {pull}19420[#19420]
* Migrate matrix_stats to NamedWriteable {pull}19418[#19418]
* Migrate derivative pipeline aggregation to NamedWriteable {pull}19407[#19407]
* Migrate top_hits, histogram, and ip_range aggregations to NamedWriteable {pull}19375[#19375]
* Migrate nested, reverse_nested, and children aggregations to NamedWriteable {pull}19374[#19374]
* Migrate geohash_grid and geo_bounds aggregations to NamedWriteable {pull}19372[#19372]
* Clean up significant terms aggregation results {pull}19365[#19365]
* Migrate range, date_range, and geo_distance aggregations to NamedWriteable {pull}19321[#19321]
* Migrate terms aggregation to NamedWriteable {pull}19277[#19277]
* Migrate sampler and missing aggregations to NamedWriteable {pull}19259[#19259]
* Migrate global, filter, and filters aggregation to NamedWriteable {pull}19220[#19220]
* Migrate the cardinality, scripted_metric, and geo_centroid aggregations to NamedWriteable {pull}19219[#19219]
* Use a static default precision for the cardinality aggregation. {pull}19215[#19215]
* Migrate more aggregations to NamedWriteable {pull}19199[#19199]
* Migrate stats and extended stats to NamedWriteable {pull}19198[#19198]
* Migrate sum, min, and max aggregations over to NamedWriteable {pull}19194[#19194]
* Start migration away from aggregation streams {pull}19097[#19097]
* Automatically set the collection mode to breadth_first in the terms aggregation when the cardinality of the field is unknown or smaller than the requested size. {pull}18779[#18779] (issue: {issue}9825[#9825])
* Rename PipelineAggregatorBuilder to PipelineAggregationBuilder. {pull}18677[#18677] (issue: {issue}18377[#18377])
* AggregatorBuilder and PipelineAggregatorBuilder do not need generics. {pull}18368[#18368] (issue: {issue}18133[#18133])
* Rename AggregatorBuilder to AggregationBuilder {pull}18377[#18377] (issue: {issue}18367[#18367])
* Add the ability to use the breadth_first mode with nested aggregations (such as `top_hits`) which require access to score information. {pull}18127[#18127] (issue: {issue}9825[#9825])
* Make significant terms work on fields that are indexed with points. {pull}18031[#18031]
* Add tests and documentation for using `time_zone` in date range aggregation {pull}16955[#16955] (issue: {issue}10130[#10130])
* Fixes serialisation of Ranges {pull}16674[#16674]

Allocation::
* Verify AllocationIDs in replication actions {pull}20320[#20320]
* Mark shard as stale on non-replicated write, not on node shutdown {pull}20023[#20023] (issue: {issue}18919[#18919])
* Add routing changes API to RoutingAllocation {pull}19992[#19992]
* Primary shard allocator observes limits in forcing allocation {pull}19811[#19811] (issue: {issue}19446[#19446])
* Use primary terms as authority to fail shards {pull}19715[#19715]
* Add recovery source to ShardRouting {pull}19516[#19516]
* Allow `_shrink` to N shards if source shards is a multiple of N {pull}18699[#18699]
* Only filter intial recovery (post API) when shrinking an index {pull}18661[#18661]
* Estimate shard size for shrinked indices {pull}18659[#18659]
* Only fail relocation target shard if failing source shard is a primary {pull}18574[#18574] (issue: {issue}16144[#16144])
* Simplify delayed shard allocation {pull}18351[#18351] (issue: {issue}18293[#18293])
* Limit retries of failed allocations per index {pull}18467[#18467] (issue: {issue}18417[#18417])
* Immutable ShardRouting {pull}17821[#17821]
* Add the shard's store status to the explain API {pull}17689[#17689] (issue: {issue}17372[#17372])
* Write shard state metadata as soon as shard is created / initializing {pull}16625[#16625] (issue: {issue}14739[#14739])
* Reuse existing allocation id for primary shard allocation {pull}16530[#16530] (issue: {issue}14739[#14739])
* Remove version in ShardRouting (now obsolete) {pull}16243[#16243] (issue: {issue}14739[#14739])
* Prefer nodes that previously held primary shard for primary shard allocation {pull}16096[#16096] (issue: {issue}14739[#14739])
* Extend reroute with an option to force assign stale primary shard copies {pull}15708[#15708] (issue: {issue}14739[#14739])
* Allocate primary shards based on allocation IDs {pull}15281[#15281] (issue: {issue}14739[#14739])
* Persist currently started allocation IDs to index metadata {pull}14964[#14964] (issue: {issue}14739[#14739])
* Use ObjectParser to parse AllocationID {pull}14962[#14962] (issue: {issue}14831[#14831])
* Persist allocation ID with shard state metadata on nodes {pull}14831[#14831] (issue: {issue}14739[#14739])

Analysis::
* Stop using cached component in _analyze API {pull}19929[#19929] (issue: {issue}19827[#19827])
* Specify custom char_filters/tokenizer/token_filters in the analyze API {pull}15671[#15671] (issue: {issue}8878[#8878])
* Add a MultiTermAwareComponent marker interface to analysis factories. {pull}19028[#19028] (issues: {issue}18064[#18064], {issue}9978[#9978])
* Add Flags Parameter for Char Filter {pull}18363[#18363] (issue: {issue}18362[#18362])
* Core: better error message when analyzer created without tokenizer or… {pull}18455[#18455] (issue: {issue}15492[#15492])
* Move AsciiFolding earlier in FingerprintAnalyzer filter chain {pull}18281[#18281] (issue: {issue}18266[#18266])
* Improve error message if resource files have illegal encoding {pull}17237[#17237] (issue: {issue}17212[#17212])

Benchmark::
* Add client-benchmark-noop-api-plugin to stress clients even more in benchmarks {pull}20103[#20103]

CAT API::
* Add health status parameter to cat indices API {pull}20393[#20393]
* Includes the index UUID in the _cat/indices API {pull}19204[#19204] (issue: {issue}19132[#19132])
* Add node name to Cat Recovery {pull}18187[#18187] (issue: {issue}8041[#8041])
* Add support for documented byte/size units and for micros as a time unit in _cat API {pull}17779[#17779]
* Add _cat/tasks {pull}17551[#17551]
* Cat health supports ts=0 option {pull}13508[#13508] (issue: {issue}10109[#10109])
* Expose http address in cat/nodes {pull}16770[#16770]
* [cat/recovery] Make recovery time a TimeValue() {pull}16743[#16743] (issue: {issue}9209[#9209])
* :CAT API: remove space at the end of a line {pull}15250[#15250] (issue: {issue}9464[#9464])

CRUD::
* Renaming operation to result and reworking responses  {pull}19704[#19704] (issue: {issue}19664[#19664])
* Adding _operation field to index, update, delete response. {pull}19566[#19566] (issues: {issue}19267[#19267], {issue}9642[#9642], {issue}9736[#9736])
* CRUD: Allow to get and set ttl as a time value/string {pull}15047[#15047]

Cache::
* Enable option to use request cache for size > 0 {pull}19472[#19472]
* Cache FieldStats in the request cache {pull}18768[#18768] (issue: {issue}18717[#18717])
* Allow the query cache to be disabled. {pull}16268[#16268] (issue: {issue}15802[#15802])
* Enable the indices request cache by default {pull}17162[#17162] (issues: {issue}16870[#16870], {issue}17134[#17134])

Circuit Breakers::
* Cluster Settings Updates should not trigger circuit breakers. {pull}20827[#20827]
* Circuit break the number of inline scripts compiled per minute {pull}19694[#19694] (issue: {issue}19396[#19396])

Cluster::
* Add clusterUUID to RestMainAction output {pull}20503[#20503]
* Batch process node left and node failure {pull}19289[#19289] (issue: {issue}19282[#19282])
* Index creation waits for write consistency shards {pull}18985[#18985]
* Inline reroute with process of node join/master election {pull}18938[#18938] (issue: {issue}17270[#17270])
* Index creation does not cause the cluster health to go RED {pull}18737[#18737] (issues: {issue}9106[#9106], {issue}9126[#9126])
* Cluster Health class improvements {pull}18673[#18673]
* Adds tombstones to cluster state for index deletions {pull}17265[#17265] (issues: {issue}16358[#16358], {issue}17435[#17435])
* Enable acked indexing {pull}17038[#17038] (issue: {issue}7572[#7572])
* Cluster Health should run on applied states, even if waitFor=0 {pull}17440[#17440]
* Resolve index names to Index instances early {pull}17048[#17048]
* Remove DiscoveryNode#shouldConnectTo method {pull}16898[#16898] (issue: {issue}16815[#16815])
* Fail demoted primary shards and retry request {pull}16415[#16415] (issue: {issue}14252[#14252])
* Illegal shard failure requests {pull}16275[#16275]
* Shard failure requests for non-existent shards {pull}16089[#16089] (issue: {issue}14252[#14252])
* Add handling of channel failures when starting a shard {pull}16041[#16041] (issue: {issue}15895[#15895])
* Wait for new master when failing shard {pull}15748[#15748] (issue: {issue}14252[#14252])
* Master should wait on cluster state publication when failing a shard {pull}15468[#15468] (issue: {issue}14252[#14252])
* Split cluster state update tasks into roles {pull}14899[#14899] (issue: {issue}13627[#13627])
* Add timeout mechanism for sending shard failures {pull}14707[#14707] (issue: {issue}14252[#14252])
* Add listener mechanism for failures to send shard failed {pull}14295[#14295] (issue: {issue}14252[#14252])

Core::
* Add production warning for pre-release builds {pull}20674[#20674]
* Add serial collector bootstrap check {pull}20558[#20558]
* Rename Netty TCP transports thread factories from http_* to transport_* {pull}20207[#20207]
* Do not log full bootstrap checks exception {pull}19989[#19989]
* Mark halting the virtual machine as privileged {pull}19923[#19923] (issues: {issue}19272[#19272], {issue}19806[#19806])
* Makes index creation more friendly {pull}19450[#19450] (issue: {issue}9126[#9126])
* Clearer error when handling fractional time values {pull}19158[#19158] (issue: {issue}19102[#19102])
* Read Elasticsearch manifest via URL {pull}18999[#18999] (issue: {issue}18996[#18996])
* Throw if the local node is not set {pull}18963[#18963] (issue: {issue}18962[#18962])
* Bootstrap check for OnOutOfMemoryError and seccomp {pull}18756[#18756] (issue: {issue}18736[#18736])
* Log OS and JVM on startup {pull}18557[#18557]
* Add GC overhead logging {pull}18419[#18419]
* Refactor JvmGcMonitorService for testing {pull}18378[#18378]
* Default to server VM and add client VM check {pull}18155[#18155]
* Add system bootstrap checks escape hatch {pull}18088[#18088]
* Avoid sliced locked contention in internal engine {pull}18060[#18060] (issue: {issue}18053[#18053])
* Add heap size bootstrap check {pull}17728[#17728] (issue: {issue}17490[#17490])
* Remove hostname from NetworkAddress.format {pull}17601[#17601] (issue: {issue}17604[#17604])
* Bootstrapping bootstrap checks {pull}17595[#17595] (issues: {issue}17474[#17474], {issue}17570[#17570])
* Add max map count check {pull}16944[#16944]
* Remove PROTOTYPE from BulkItemResponse.Failure {pull}17433[#17433] (issue: {issue}17086[#17086])
* Throw an exception if Writeable.Reader reads null {pull}17332[#17332]
* Remove PROTOTYPE from RescorerBuilders {pull}17330[#17330]
* Port Primary Terms to master {pull}17044[#17044] (issues: {issue}14062[#14062], {issue}14651[#14651], {issue}17038[#17038])
* Use index UUID to lookup indices on IndicesService {pull}17001[#17001]
* Add -XX+AlwaysPreTouch JVM flag {pull}16937[#16937]
* Add max size virtual memory check {pull}16935[#16935]
* Use and test relative time in TransportBulkAction {pull}16916[#16916]
* Bump Elasticsearch version to 5.0.0-SNAPSHOT {pull}16862[#16862]
* Assert that we can write in all data-path on startup {pull}16745[#16745]
* Add G1GC check on startup {pull}16737[#16737] (issue: {issue}10740[#10740])
* Shards with heavy indexing should get more of the indexing buffer {pull}14121[#14121]
* Remove and ban ImmutableMap {pull}13939[#13939] (issue: {issue}13224[#13224])
* Finish banning ImmutableSet {pull}13820[#13820] (issue: {issue}13224[#13224])
* Removes and bans ImmutableSet {pull}13754[#13754] (issue: {issue}13224[#13224])
* Remove and ban ImmutableMap#entrySet {pull}13724[#13724]
* Forbid ForwardingSet {pull}13720[#13720] (issue: {issue}13224[#13224])

Dates::
* Improve TimeZoneRoundingTests error messages {pull}18895[#18895]
* Support full range of Java Long for epoch DateTime {pull}18509[#18509] (issue: {issue}17936[#17936])

Discovery::
* Do not log cluster service errors at after joining a master {pull}19705[#19705]
* Log warning if minimum_master_nodes set to less than quorum {pull}15625[#15625]
* Add a dedicate queue for incoming ClusterStates {pull}13303[#13303] (issue: {issue}13062[#13062])

Engine::
* Only try to read new segments info if we really flushed the index {pull}20474[#20474]
* Use _refresh instead of reading from Translog in the RT GET case {pull}20102[#20102]
* Remove writeLockTimeout from InternalEngine {pull}16930[#16930]
* Don't guard IndexShard#refresh calls by a check to isRefreshNeeded {pull}16118[#16118]
* Never call a listerner under lock in InternalEngine {pull}15786[#15786]
* Use System.nanoTime() to initialize Engine.lastWriteNanos {pull}14321[#14321]
* Flush big merges automatically if shard is inactive {pull}14275[#14275]
* Remove Engine.Create {pull}13955[#13955]
* Remove the disabled autogenerated id optimization from InternalEngine {pull}13857[#13857]

Exceptions::
* Improve startup exception {pull}20083[#20083]
* Make NotMasterException a first class citizen {pull}19385[#19385]
* Do not catch throwable {pull}19231[#19231]
* Make the index-too-old exception more explicit {pull}18438[#18438]
* Add index name in IndexAlreadyExistsException default message {pull}18274[#18274]
* Fix typos in exception/assert/log messages in core module. {pull}16649[#16649]
* Add field names to several mapping errors {pull}16508[#16508] (issue: {issue}16378[#16378])
* Add serialization support for more important IOExceptions {pull}15766[#15766]
* Adds exception objects to log messages. {pull}14827[#14827] (issue: {issue}10021[#10021])
* Add stack traces to logged exceptions where missing {pull}13825[#13825] (issue: {issue}10021[#10021])
* Remove reflection hacks from ElasticsearchException {pull}13796[#13796]
* Rename QueryParsingException to a more generic ParsingException {pull}13631[#13631]
* Add *Exception(Throwable cause) constructors/ call where appropriate {pull}13544[#13544] (issue: {issue}10021[#10021])

Expressions::
* improve date api for expressions/painless fields {pull}18658[#18658]
* Support geo_point fields in lucene expressions {pull}18096[#18096]
* Add support for .empty to expressions, and some docs improvements {pull}18077[#18077]

Geo::
* GeoBoundingBoxQueryBuilder should throw IAE when topLeft and bottomRight are the same coordinate {pull}18668[#18668] (issues: {issue}18458[#18458], {issue}18631[#18631])
* Enhanced lat/long error handling {pull}16833[#16833] (issue: {issue}16137[#16137])
* Fix a potential parsing problem in GeoDistanceSortParser {pull}17111[#17111]
* Geo: Add validation of shapes to ShapeBuilders {pull}15551[#15551] (issue: {issue}14416[#14416])
* Make remaining ShapeBuilders implement Writeable {pull}15010[#15010] (issue: {issue}14416[#14416])
* Geo: Remove internal `translated` flag from LineStringBuilder {pull}14969[#14969]
* Make PointBuilder, CircleBuilder & EnvelopeBuilder implement Writable  {pull}14933[#14933] (issue: {issue}14416[#14416])
* Merging BaseLineString and BasePolygonBuilder with subclass {pull}14887[#14887] (issue: {issue}14482[#14482])
* Moving static factory methods to ShapeBuilders {pull}14529[#14529]
* Remove InternalLineStringBuilder and InternalPolygonBuilder {pull}14482[#14482] (issue: {issue}14416[#14416])

Highlighting::
* Switch Highlighting to ObjectParser  {pull}17363[#17363]
* Use HighlightBuilder in SearchSourceBuilder {pull}15376[#15376] (issue: {issue}15044[#15044])
* Joint parsing of common global Hightlighter and subfield parameters {pull}15368[#15368] (issue: {issue}15285[#15285])
* Enable HighlightBuilder to create SearchContextHighlight {pull}15324[#15324]
*  Add fromXContent method to HighlightBuilder {pull}15157[#15157]

Index APIs::
* Add date-math support to `_rollover` {pull}20709[#20709]
* Add Shrink request source parser to parse create index request body {pull}18802[#18802]
* Fail hot_threads in a better way if unsupported by JDK {pull}15909[#15909]

Index Templates::
* Add "version" field to Templates {pull}20353[#20353] (issue: {issue}20171[#20171])
* Parse and validate mappings on index template creation {pull}8802[#8802] (issue: {issue}2415[#2415])

Ingest::
* Add "version" field to Pipelines {pull}20343[#20343] (issue: {issue}20171[#20171])
* Make it possible for Ingest Processors to access AnalysisRegistry {pull}20233[#20233]
* add ignore_missing option to convert,trim,lowercase,uppercase,grok,rename {pull}20194[#20194] (issue: {issue}19995[#19995])
* Add support for parameters to the script ingest processor {pull}20136[#20136]
* introduce the JSON Processor {pull}20128[#20128] (issue: {issue}20052[#20052])
* Allow rename processor to turn leaf fields into branch fields {pull}20053[#20053] (issue: {issue}19892[#19892])
* remove ability to set field value in script-processor configuration {pull}19981[#19981]
* Add REST _ingest/pipeline to get all pipelines {pull}19603[#19603] (issue: {issue}19585[#19585])
* Show ignored errors in verbose simulate result {pull}19404[#19404] (issue: {issue}19319[#19319])
* update foreach processor to only support one applied processor. {pull}19402[#19402] (issue: {issue}19345[#19345])
* Skip the execution of an empty pipeline {pull}19200[#19200] (issue: {issue}19192[#19192])
* Add `ignore_failure` option to all ingest processors {pull}18650[#18650] (issue: {issue}18493[#18493])
* new ScriptProcessor for Ingest {pull}18193[#18193]
* Expose underlying processor to blame for thrown exception within CompoundProcessor {pull}18342[#18342] (issue: {issue}17823[#17823])
* Avoid string concatentation in IngestDocument.FieldPath {pull}18108[#18108]
* add ability to specify multiple grok patterns {pull}18074[#18074] (issue: {issue}17903[#17903])
* add ability to disable ability to override values of existing fields in set processor {pull}17902[#17902] (issue: {issue}17659[#17659])
* Streamline option naming for several processors {pull}17892[#17892] (issue: {issue}17835[#17835])
* add automatic type conversion support to ConvertProcessor {pull}17263[#17263] (issue: {issue}17139[#17139])
* Give the foreach processor access to the rest of the document {pull}17172[#17172] (issue: {issue}17147[#17147])
* Added ingest statistics to node stats API {pull}16915[#16915]
* Add `ingest_took` to bulk response {pull}16876[#16876]
* Add ingest info to node info API, which contains a list of available processors {pull}16865[#16865]
* Use diffs for ingest metadata in cluster state {pull}16847[#16847]
* hide null-valued metadata fields from WriteableIngestDocument#toXContent {pull}16557[#16557]
* Ingest: use bulk thread pool for bulk request processing (was index before) {pull}16539[#16539] (issue: {issue}16503[#16503])
* Add foreach processor {pull}16432[#16432]
* revert PipelineFactoryError handling with throwing ElasticsearchParseException in ingest pipeline creation {pull}16355[#16355]
* Add processor tags to on_failure metadata in ingest pipeline {pull}16324[#16324] (issue: {issue}16202[#16202])
* catch processor/pipeline factory exceptions and return structured error responses {pull}16276[#16276] (issue: {issue}16010[#16010])
* Ingest: move get/put/delete pipeline methods to ClusterAdminClient {pull}16242[#16242]
* Geoip processor: remove redundant latitude and longitude fields and make location an object with lat and lon subfields {pull}16173[#16173]

Inner Hits::
* Change scriptFields member in InnerHitBuilder to set {pull}18092[#18092] (issue: {issue}5831[#5831])

Internal::
* Remove poor-mans compression in InternalSearchHit and friends {pull}20472[#20472]
* Don't register SearchTransportService handlers more than once {pull}20468[#20468]
* Unguice SearchModule {pull}20456[#20456]
* Deguice SearchService and friends {pull}20423[#20423]
* NodeStats classes to implement Writeable rather then Streamable {pull}20327[#20327]
* More info classes to implement Writeable rather than Streamable {pull}20288[#20288] (issue: {issue}20255[#20255])
* Internal: Split disk threshold monitoring from decider {pull}20018[#20018]
* Switching LockObtainFailedException over to ShardLockObtainFailedException {pull}19991[#19991] (issue: {issue}19978[#19978])
* update and delete by query requests to implement IndicesRequest.Replaceable {pull}19961[#19961]
* VersionFetchSubPhase should not use Versions#loadDocIdAndVersion {pull}19944[#19944]
* Remove useless PK lookup in IndicesTTLService {pull}19945[#19945]
* ignore some docker craziness in seccomp environment checks {pull}19754[#19754]
* Make Priority an enum {pull}19448[#19448]
* Snapshot UUIDs in blob names {pull}19421[#19421] (issues: {issue}18156[#18156], {issue}18815[#18815], {issue}19002[#19002], {issue}7540[#7540])
* Add RestController method for deprecating in one step {pull}19343[#19343]
* Tighten ensure atomic move cleanup {pull}19309[#19309] (issue: {issue}19036[#19036])
* Enable checkstyle ModifierOrder {pull}19214[#19214]
* Expose task information from NodeClient {pull}19189[#19189]
* Changed rest handler interface to take NodeClient {pull}19170[#19170]
* Deprecate ExceptionsHelper.detailedMessage {pull}19160[#19160] (issue: {issue}19069[#19069])
* Factor out ChannelBuffer from BytesReference {pull}19129[#19129]
* Cleanup Compressor interface {pull}19125[#19125]
* Hot methods redux {pull}19016[#19016] (issue: {issue}16725[#16725])
* Remove forked joda time BaseDateTime class {pull}18953[#18953]
* Support optional ctor args in ConstructingObjectParser {pull}18725[#18725]
* Remove thread pool from page cache recycler {pull}18664[#18664] (issue: {issue}18613[#18613])
* Do not automatically close XContent objects/arrays {pull}18549[#18549] (issue: {issue}18433[#18433])
* Remove use of a Fields class in snapshot responses {pull}18497[#18497]
* Removes multiple toXContent entry points for SnapshotInfo {pull}18494[#18494]
* Removes unused methods in the o/e/common/Strings class {pull}18346[#18346]
* Determine content length eagerly in HttpServer {pull}18203[#18203]
* Consolidate query generation in QueryShardContext {pull}18129[#18129]
* Make reset in QueryShardContext private {pull}18113[#18113]
* Remove Strings#splitStringToArray {pull}18110[#18110]
* Add toString() to GetResponse {pull}18102[#18102]
* ConstructingObjectParser adapts ObjectParser for ctor args {pull}17596[#17596] (issue: {issue}17352[#17352])
* Makes Script type writeable {pull}17908[#17908] (issue: {issue}17753[#17753])
* FiltersAggregatorBuilder: Don't create new context for inner parsing {pull}17851[#17851]
* Clean up serialization on some stats {pull}17832[#17832] (issue: {issue}17085[#17085])
* 	Normalize registration for SignificanceHeuristics {pull}17830[#17830] (issue: {issue}17085[#17085])
* Make (read|write)NamedWriteable public {pull}17829[#17829] (issue: {issue}17682[#17682])
* Use try-with-resource when creating new parser instances where possible {pull}17822[#17822]
* Don't pass XContentParser to ParseFieldRegistry#lookup {pull}17794[#17794]
* Internal: Remove threadlocal from document parser {pull}17764[#17764]
* Cut range aggregations to registerAggregation {pull}17757[#17757] (issue: {issue}17085[#17085])
* Remove ParseFieldMatcher from AbstractXContentParser {pull}17756[#17756] (issue: {issue}17417[#17417])
* Remove parser argument from methods where we already pass in a parse context {pull}17738[#17738]
* Switch SearchAfterBuilder to writeGenericValue {pull}17735[#17735] (issue: {issue}17085[#17085])
* Remove StreamableReader {pull}17729[#17729] (issue: {issue}17085[#17085])
* Cleanup nested, has_child & has_parent query builders for inner hits construction {pull}17719[#17719] (issue: {issue}11118[#11118])
* Make AllocationCommands NamedWriteables {pull}17661[#17661]
* Isolate StreamableReader {pull}17656[#17656] (issue: {issue}17085[#17085])
* Create registration methods for aggregations similar to those for queries {pull}17653[#17653] (issues: {issue}17085[#17085], {issue}17389[#17389])
* Remove PROTOTYPEs from QueryBuilders {pull}17632[#17632] (issue: {issue}17085[#17085])
* Remove registerQueryParser {pull}17608[#17608]
* ParseField#getAllNamesIncludedDeprecated to not return duplicate names {pull}17504[#17504]
* Rework a query parser and improve registration {pull}17458[#17458]
* Clean up QueryParseContext and don't hold it inside QueryRewrite/ShardContext {pull}17417[#17417]
* Remove PROTOTYPE from MLT.Item {pull}17481[#17481] (issue: {issue}17085[#17085])
* Remove PROTOTYPE from VersionType {pull}17480[#17480] (issue: {issue}17085[#17085])
* Remove PROTOTYPEs from highlighting {pull}17466[#17466] (issue: {issue}17085[#17085])
* Remove PROTOTYPEs from ingest {pull}17434[#17434] (issue: {issue}17085[#17085])
* Start to rework query registration {pull}17424[#17424]
* Factor out slow logs into Search and IndexingOperationListeners {pull}17398[#17398]
* Remove PROTOTYPE from Suggesters {pull}17370[#17370]
* Remove PROTOTYPE from SortBuilders {pull}17337[#17337] (issue: {issue}17085[#17085])
* Remove PROTOTYPE from ShapeBuilders {pull}17336[#17336] (issue: {issue}17085[#17085])
* Replace FieldStatsProvider with a method on MappedFieldType. {pull}17334[#17334]
* Stop using PROTOTYPE in NamedWriteableRegistry {pull}17284[#17284] (issue: {issue}17085[#17085])
* Support scheduled commands in current context {pull}17077[#17077]
* Thread limits {pull}17003[#17003]
* Remove leniency from segments info integrity checks {pull}16985[#16985] (issue: {issue}16973[#16973])
* Rename SearchServiceTransportAction to SearchTransportService {pull}16880[#16880]
* Decouple the TransportService and ClusterService {pull}16872[#16872] (issue: {issue}16788[#16788])
* Refactor bootstrap checks {pull}16844[#16844] (issues: {issue}16733[#16733], {issue}16835[#16835])
* Add LifecycleRunnable {pull}16752[#16752]
* Hot inlined methods in your area {pull}16725[#16725]
* Move IndicesQueryCache and IndicesRequestCache into IndicesService {pull}16603[#16603]
* Forbid use of java.security.MessageDigest#clone() {pull}16543[#16543] (issue: {issue}16479[#16479])
* Make IndicesWarmer a private class of IndexService {pull}16470[#16470]
* Simplify IndicesFieldDataCache and detach from guice {pull}16469[#16469]
* Uppercase ells ('L') in long literals {pull}16329[#16329] (issue: {issue}16279[#16279])
* ShardId equality and hash code inconsistency {pull}16319[#16319] (issue: {issue}16217[#16217])
* Ensure all resources are closed on Node#close() {pull}16316[#16316] (issue: {issue}13685[#13685])
* Make index uuid available in Index, ShardRouting & ShardId {pull}16217[#16217]
* Move RefreshTask into IndexService and use since task per index {pull}15933[#15933]
* Make IndexingMemoryController private to IndicesService {pull}15877[#15877]
* Cleanup IndexingOperationListeners infrastructure {pull}15875[#15875]
* Remove and forbid use of j.u.c.ThreadLocalRandom {pull}15862[#15862] (issue: {issue}15294[#15294])
* Fix IntelliJ query builder type inference issues {pull}15429[#15429]
* Remove and forbid use of Collections#shuffle(List) and Random#<init>() {pull}15299[#15299] (issue: {issue}15287[#15287])
* Remove and forbid use of the type-unsafe empty Collections fields {pull}15187[#15187]
* Move IndicesService.canDeleteShardContent to use IndexSettings {pull}15150[#15150] (issue: {issue}15059[#15059])
* Simplify MonitorService construction and detach from guice {pull}15035[#15035]
* Use Supplier for StreamInput#readOptionalStreamable {pull}14806[#14806]
* Add variable-length long encoding {pull}14780[#14780]
* Extend usage of IndexSetting class {pull}14731[#14731] (issue: {issue}14251[#14251])
* Fold SimilarityModule into IndexModule {pull}14284[#14284]
* Move to lucene BoostQuery {pull}14264[#14264]
* Use built-in method for computing hash code of longs {pull}14213[#14213]
* Refactor ShardFailure listener infrastructure {pull}14206[#14206]
* Add methods for variable-length encoding integral arrays {pull}14087[#14087]
* Fold IndexAliasesService into IndexService {pull}14044[#14044]
* Remove unneeded Module abstractions {pull}13944[#13944]
* Query refactoring: simplify IndexQueryParserService parse methods {pull}13938[#13938] (issue: {issue}13859[#13859])
* Remove and forbid use of com.google.common.collect.Iterators {pull}13916[#13916] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.ImmutableCollection {pull}13909[#13909] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.io.Resources {pull}13908[#13908] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.hash.* {pull}13907[#13907] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.net.InetAddresses {pull}13905[#13905] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.EvictingQueue {pull}13903[#13903] (issue: {issue}13224[#13224])
* Replace Guava cache with simple concurrent LRU cache {pull}13879[#13879]
* Remove ClusterSerivce and IndexSettingsService dependency from IndexShard {pull}13853[#13853]
* Start making RecoverySourceHandler unittestable {pull}13840[#13840]
* Remove IndexService dep. from IndexShard {pull}13797[#13797]
* Remove ES internal deletion policies in favour of Lucenes implementations {pull}13794[#13794]
* Move ShardTermVectorService to be on indices level as TermVectorService {pull}13786[#13786]
* Move ShardPercolateService creation into IndexShard {pull}13777[#13777]
* Remove `ExpressionScriptCompilationException` and `ExpressionScriptExecutionException` {pull}13742[#13742]
* Reduced the number of ClusterStateUpdateTask variants {pull}13735[#13735]
* Add a BaseParser helper for stream parsing {pull}13615[#13615]
* Remove and forbid use of com.google.common.primitives.Ints {pull}13596[#13596] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.math.LongMath {pull}13575[#13575] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.base.Joiner {pull}13572[#13572] (issue: {issue}13224[#13224])
* Replace and ban next batch of Guava classes {pull}13562[#13562] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Iterables {pull}13559[#13559] (issue: {issue}13224[#13224])
* Replace LoadingCache usage with a simple ConcurrentHashMap {pull}13552[#13552] (issue: {issue}13224[#13224])
* Use Supplier instead of Reflection {pull}13545[#13545]
* Remove and forbid use of com.google.common.base.Preconditions {pull}13540[#13540] (issue: {issue}13224[#13224])
* Remove and forbid use of guava Function, Charsets, Collections2 {pull}13533[#13533] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.ImmutableSortedMap {pull}13525[#13525] (issue: {issue}13224[#13224])
* Remove and forbid use of several com.google.common.util. classes {pull}13524[#13524] (issue: {issue}13224[#13224])
* Cleanup SearchRequest & SearchRequestBuilder {pull}13518[#13518]
* Remove and forbid use of com.google.common.collect.Queues {pull}13498[#13498] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.base.Preconditions#checkNotNull {pull}13493[#13493] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Sets {pull}13463[#13463] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Maps {pull}13438[#13438] (issue: {issue}13224[#13224])
* Remove use of underscore as an identifier {pull}13353[#13353]
* Remove and forbid the use of com.google.common.base.Predicate(s)? {pull}13349[#13349] (issues: {issue}13224[#13224], {issue}13314[#13314])
* This commit removes com.google.common.io {pull}13302[#13302] (issue: {issue}13224[#13224])

Java API::
* Ensure PutMappingRequest.buildFromSimplifiedDef input are pairs {pull}19837[#19837] (issue: {issue}19836[#19836])
* Start from a random node number so that clients do not overload the first node configured {pull}14143[#14143]
* Switch QueryBuilders to new MatchPhraseQueryBuilder {pull}18753[#18753]
* Improve adding clauses to `span_near` and `span_or` query {pull}18485[#18485] (issue: {issue}18478[#18478])
* QueryBuilder does not need generics. {pull}18133[#18133]
* Remove copy constructors from request classes and TransportMessage type {pull}16640[#16640] (issue: {issue}15776[#15776])

Java REST Client::
* Add support for a RestClient path prefix {pull}20190[#20190]
* Add "Async" to the end of each Async RestClient method {pull}20172[#20172] (issue: {issue}20168[#20168])
* Allow RestClient to send array-based headers {pull}20151[#20151]
* Add response body to ResponseException error message {pull}19653[#19653] (issue: {issue}19653[#19653])
* Simplify Sniffer initialization and automatically create the default HostsSniffer {pull}19599[#19599]
* Remove duplicate dependency declaration for http client {pull}19580[#19580] (issue: {issue}19281[#19281])
* Add callback to customize http client settings {pull}19373[#19373]
* Rest Client: add short performRequest method variants without params and/or body {pull}19340[#19340] (issue: {issue}19312[#19312])

Logging::
* Ensure logging is initialized in CLI tools {pull}20575[#20575]
* Give useful error message if log config is missing {pull}20493[#20493]
* Complete Elasticsearch logger names {pull}20457[#20457] (issue: {issue}20326[#20326])
* Add node name to decider trace logging  {pull}20437[#20437] (issue: {issue}20379[#20379])
* Logging shutdown hack {pull}20389[#20389] (issue: {issue}20304[#20304])
* Disable console logging {pull}20387[#20387]
* Skip loading of jansi from log4j2 {pull}20334[#20334]
* Configure AWS SDK logging configuration {pull}20313[#20313] (issue: {issue}20294[#20294])
* Warn if unsupported logging configuration present {pull}20309[#20309]
* Size limit deprecation logs {pull}20287[#20287] (issues: {issue}20235[#20235], {issue}20254[#20254])
* Increase visibility of deprecation logger {pull}20254[#20254] (issue: {issue}11033[#11033])
* Add log message about enforcing bootstrap checks {pull}19451[#19451]
* Improve logging for batched cluster state updates {pull}19255[#19255]
* Send HTTP Warning Header(s) for any Deprecation Usage from a REST request {pull}17804[#17804] (issue: {issue}17687[#17687])
* Throw IllegalStateException when handshake fails due to version or cluster mismatch {pull}18676[#18676]

Mapping::
* Automatically downgrade text and keyword to string on indexes imported from 2.x {pull}20177[#20177]
* Do not parse numbers as both strings and numbers when not included in `_all`. {pull}20167[#20167]
* Don't index the `_version` field {pull}20132[#20132]
* The root object mapper should support updating `numeric_detection`, `date_detection` and `dynamic_date_formats`. {pull}20119[#20119] (issue: {issue}20111[#20111])
* Automatically upgrade analyzed string fields that have `index_options` or `position_increment_gap` set. {pull}20002[#20002] (issue: {issue}19974[#19974])
* Mappings: Support dots in field names in mapping parsing {pull}19899[#19899] (issue: {issue}19443[#19443])
* Save one utf8 conversion in KeywordFieldMapper. {pull}19867[#19867]
* Do not parse the created version from the settings every time a field is parsed. {pull}19824[#19824]
* Elasticsearch should reject dynamic templates with unknown `match_mapping_type`. {pull}17285[#17285] (issue: {issue}16945[#16945])
* Upgrade `string` fields to `text`/`keyword` even if `include_in_all` is set. {pull}19004[#19004] (issue: {issue}18974[#18974])
* Adds a methods to find (and dynamically create) the mappers for the parents of a field with dots in the field name {pull}18106[#18106] (issue: {issue}15951[#15951])
* Automatically upgrade analyzed strings with an analyzer to `text`. {pull}17861[#17861]
* Support dots in field names when mapping already exists {pull}17759[#17759] (issue: {issue}15951[#15951])
* Use the new points API to index numeric fields. {pull}17746[#17746] (issues: {issue}11513[#11513], {issue}16751[#16751], {issue}17007[#17007], {issue}17700[#17700])
* Simplify AllEntries, AllField and AllFieldMapper: {pull}17613[#17613]
* Make `parseMultiField` part of `parseField`. {pull}17313[#17313]
* Automatically add a sub keyword field to string dynamic mappings. {pull}17188[#17188]
* Remove friction from the mapping changes in 5.0. {pull}16991[#16991]
* Rework norms parameters for 5.0. {pull}16987[#16987]
* Moved dynamic field handling in doc parsing to end of parsing {pull}16798[#16798]
* Remove the MapperBuilders utility class. {pull}16609[#16609]
* Make the `index` property a boolean. {pull}16161[#16161]
* Remove the ability to enable doc values with the `fielddata.format` setting. {pull}16147[#16147]
* Be stricter about parsing boolean values in mappings. {pull}16146[#16146]
* Fix default doc values to be enabled when a field is not indexed. {pull}16141[#16141]
* Dynamically map floating-point numbers as floats instead of doubles. {pull}15319[#15319] (issue: {issue}13851[#13851])
* Simplify MetaDataMappingService. {pull}15217[#15217]
* Remove MergeMappingException. {pull}15177[#15177]

Network::
* Avoid early initializing Netty {pull}19819[#19819] (issue: {issue}5644[#5644])
* Network: Allow to listen on virtual interfaces. {pull}19568[#19568] (issues: {issue}17473[#17473], {issue}19537[#19537])
* Explicitly tell Netty to not use unsafe {pull}19786[#19786] (issues: {issue}19562[#19562], {issue}5624[#5624])
* Enable Netty 4 extensions {pull}19767[#19767] (issue: {issue}19526[#19526])
* Modularize netty {pull}19392[#19392]
* Simplify TcpTransport interface by reducing send code to a single send method {pull}19223[#19223]
* Do not start scheduled pings until transport start {pull}18702[#18702]

Packaging::
* Add quiet option to disable console logging {pull}20422[#20422] (issues: {issue}15315[#15315], {issue}16159[#16159], {issue}17220[#17220])
* Explicitly disable Netty key set replacement {pull}20249[#20249]
* Remove explicit parallel new GC flag {pull}18767[#18767]
* Use JAVA_HOME or java.exe in PATH like the Linux scripts do {pull}18685[#18685] (issue: {issue}4913[#4913])
* Don't mkdir directly in deb init script {pull}18503[#18503] (issue: {issue}18307[#18307])
* Increase default heap size to 2g {pull}18311[#18311] (issues: {issue}16334[#16334], {issue}17686[#17686], {issue}18309[#18309])
* Switch init.d scripts to use bash {pull}18308[#18308] (issue: {issue}18259[#18259])
* Switch scripts to use bash {pull}18251[#18251] (issue: {issue}14002[#14002])
* Further simplifications of plugin script {pull}18239[#18239] (issue: {issue}18207[#18207])
* Pass ES_JAVA_OPTS to JVM for plugins script {pull}18140[#18140] (issue: {issue}16790[#16790])
* Remove unnecessary sleep from init script restart {pull}17966[#17966]
* Explicitly set packaging permissions {pull}17912[#17912] (issue: {issue}17634[#17634])
* rpm uses non-portable `--system` flag to `useradd` {pull}14596[#14596] (issue: {issue}14211[#14211])
* Adding JAVA_HOME to documents and env config file {pull}11338[#11338] (issue: {issue}11291[#11291])
* Added RPM metadata {pull}17477[#17477]
* Elasticsearch ownership for data, logs, and configs {pull}17197[#17197] (issue: {issue}12688[#12688])
* Fail early on JDK with compiler bug {pull}16418[#16418] (issues: {issue}16097[#16097], {issue}16362[#16362])
* Make security non-optional {pull}16176[#16176]
* Remove RuntimePermission("accessDeclaredMembers") {pull}15378[#15378]
* Remove Guava as a dependency {pull}14055[#14055] (issue: {issue}13224[#13224])
* Remove Guava as a dependency {pull}14054[#14054] (issue: {issue}13224[#13224])

Percolator::
* Also support query term extract for queries wrapped inside a FunctionScoreQuery {pull}19184[#19184]
* Add support for synonym query to percolator query term extraction {pull}19066[#19066]
* Add percolator query extraction support for dismax query {pull}18845[#18845]
* Improve percolate query performance by not verifying certain candidate matches {pull}18696[#18696]
* Improve percolator query term extraction {pull}18610[#18610]
* PercolatorQueryBuilder cleanup by using MemoryIndex#fromDocument(...) helper {pull}17669[#17669] (issue: {issue}9386[#9386])
* Add scoring support to the percolator query {pull}17385[#17385] (issue: {issue}13827[#13827])
* Add query extract support for the blended term query and the common terms query {pull}17347[#17347]
* Add support for several span queries in ExtractQueryTermsService {pull}17323[#17323]
* Add support for TermsQuery in ExtractQueryTermsService {pull}17316[#17316]
* Replace percolate APIs with a percolator query {pull}16349[#16349] (issues: {issue}10741[#10741], {issue}11264[#11264], {issue}13176[#13176], {issue}13978[#13978], {issue}4317[#4317], {issue}7297[#7297])

Plugin Analysis Kuromoji::
* Add nbest options and NumberFilter {pull}17173[#17173]

Plugin Discovery EC2::
* Use `DefaultAWSCredentialsProviderChain` AWS SDK class for credentials {pull}19561[#19561] (issue: {issue}19556[#19556])
* Support new Asia Pacific (Mumbai) ap-south-1 AWS region {pull}19112[#19112] (issue: {issue}19110[#19110])
* Add support for proxy authentication for s3 and ec2 {pull}15293[#15293] (issue: {issue}15268[#15268])

Plugin Discovery GCE::
* Allow `_gce_` network when not using discovery gce {pull}15765[#15765] (issue: {issue}15724[#15724])

Plugin Ingest Attachment::
* Minor attachment processor improvements {pull}16574[#16574]

Plugin Lang Painless::
* Disable regexes by default in painless {pull}20427[#20427] (issue: {issue}20397[#20397])
* Catch OutOfMemory and StackOverflow errors in Painless {pull}19936[#19936]
* Change Painless Tree Structure for Variable/Method Chains {pull}19459[#19459]
* Add replaceAll and replaceFirst {pull}19070[#19070]
* Painless Initializers {pull}19012[#19012]
* Add augmentation {pull}19003[#19003]
* Infer lambda arguments/return type {pull}18983[#18983]
* Fix explicit casts and improve tests. {pull}18958[#18958]
* Add lambda captures {pull}18954[#18954]
* improve Debugger to print code even if it hits exception {pull}18932[#18932] (issue: {issue}1[#1])
* Move semicolon hack into lexer {pull}18931[#18931]
* Add flag support to regexes {pull}18927[#18927]
* improve lambda syntax (allow single expression) {pull}18924[#18924]
* Remove useless dropArguments in megamorphic cache {pull}18913[#18913]
* non-capturing lambda support {pull}18911[#18911] (issue: {issue}18824[#18824])
* fix bugs in operators and more improvements for the dynamic case {pull}18899[#18899]
* improve unary operators and cleanup tests {pull}18867[#18867] (issue: {issue}18849[#18849])
* Add support for the find operator (=~) and the match operator (==~) {pull}18858[#18858]
* Remove casts and boxing for dynamic math {pull}18849[#18849] (issue: {issue}18847[#18847])
* Refactor def math {pull}18847[#18847]
* Add support for /regex/ {pull}18842[#18842]
* Array constructor references {pull}18831[#18831]
* Method references to user functions {pull}18828[#18828]
* Add } as a delimiter.  {pull}18827[#18827] (issue: {issue}18821[#18821])
* Add Lambda Stub Node {pull}18824[#18824]
* Add capturing method references {pull}18818[#18818] (issue: {issue}18748[#18748])
* Add Functions to Painless {pull}18810[#18810]
* Add Method to Get New MethodWriters {pull}18771[#18771]
* Static For Each {pull}18757[#18757]
* Method reference support {pull}18748[#18748] (issue: {issue}18578[#18578])
* Add support for the new Java 9 MethodHandles#arrayLength() factory {pull}18734[#18734]
* Improve painless compile-time exceptions {pull}18711[#18711] (issue: {issue}18600[#18600])
* add java.time packages to painless whitelist {pull}18621[#18621]
* Add Function Reference Stub to Painless {pull}18578[#18578]
* improve painless whitelist coverage of java api {pull}18533[#18533]
* Definition cleanup {pull}18463[#18463]
* Made def variable casting consistent with invokedynamic rules {pull}18425[#18425]
* Use Java 9 Indy String Concats, if available {pull}18400[#18400] (issue: {issue}18398[#18398])
* Add method overloading based on arity {pull}18385[#18385]
* Refactor WriterUtils to extend ASM GeneratorAdapter {pull}18382[#18382]
* Whitelist expansion {pull}18372[#18372]
* Remove boxing when loading and storing values in "def" fields/arrays, remove boxing onsimple method calls of "def" methods {pull}18359[#18359]
* Some cleanups {pull}18352[#18352]
* Use isAssignableFrom instead of relying on ClassCastException {pull}18350[#18350]
* Build descriptor of array and field load/store in code {pull}18338[#18338]
* Rename the dynamic call site factory to DefBootstrap {pull}18335[#18335]
* Cleanup of DynamicCallSite {pull}18323[#18323]
* Improve exception stacktraces {pull}18319[#18319]
* Make Line Number Available in Painless {pull}18298[#18298]
* Remove input, support params instead {pull}18287[#18287]
* Decouple ANTLR AST from Painless {pull}18286[#18286]
* _value support in painess? {pull}18284[#18284]
* Long priority over Float {pull}18282[#18282]
* _score as double, not float {pull}18277[#18277]
* Add 'ctx' keyword to painless. {pull}18264[#18264]
* Painless doc access {pull}18262[#18262]
* Retrieve _score directly from Scorer {pull}18258[#18258]
* Implement needsScore() correctly. {pull}18247[#18247]
* Add synthetic length property as alias to Lists, so they can be used like arrays {pull}18241[#18241]
* Use better typing for dynamic method calls {pull}18234[#18234]
* Array load/store and length with invokedynamic {pull}18232[#18232] (issue: {issue}18201[#18201])
* Switch painless dynamic calls to invokedynamic, remove perf hack/cheat {pull}18201[#18201]
* Add fielddata accessors (.value/.values/.distance()/etc) {pull}18169[#18169]
* painless: optimize/simplify dynamic field and method access {pull}18151[#18151]
* Painless: Single-Quoted Strings {pull}18150[#18150]
* Painless Clean Up {pull}17428[#17428]
* Make Painless a Module {pull}16755[#16755]
* Minor Clean up {pull}16457[#16457]
* Remove Extra String Concat Token {pull}16382[#16382]

Plugin Mapper Attachment::
* minor attachments cleanups: IDE test support and EPUB format {pull}14626[#14626]

Plugin Mapper Size::
* Add doc values support to the _size field in the mapper-size plugin {pull}19217[#19217] (issue: {issue}18334[#18334])

Plugin Repository Azure::
* Support global `repositories.azure.` settings {pull}15141[#15141] (issue: {issue}13776[#13776])
* Add timeout settings (default to 5 minutes) {pull}15080[#15080] (issue: {issue}14277[#14277])
* Remove AbstractLegacyBlobContainer {pull}14650[#14650] (issue: {issue}13434[#13434])

Plugin Repository HDFS::
* merge current hdfs improvements to master {pull}15588[#15588]

Plugin Repository S3::
* Extract AWS Key from KeyChain instead of using potential null value {pull}19560[#19560] (issues: {issue}18703[#18703], {issue}19557[#19557])
* Check that S3 setting `buffer_size` is always lower than `chunk_size` {pull}17274[#17274] (issue: {issue}17244[#17244])

Plugins::
* Revert "Display plugins versions" {pull}20807[#20807] (issues: {issue}18683[#18683], {issue}20668[#20668])
* Provide error message when plugin id is missing {pull}20660[#20660]
* Print message when removing plugin with config {pull}20338[#20338]
* Plugins: Update official plugin location with unified release {pull}19996[#19996]
* Allow plugins to upgrade global custom metadata on startup {pull}19962[#19962]
* Switch aggregations from push to pull {pull}19839[#19839]
* Display plugins versions {pull}18683[#18683]
* Add ScriptService to dependencies available for plugin components {pull}19770[#19770]
* Make NamedWriteableRegistry immutable and add extension point for named writeables {pull}19764[#19764]
* Log one plugin info per line {pull}19441[#19441]
* Make rest headers registration pull based {pull}19440[#19440]
* Add resource watcher to services available for plugin components {pull}19401[#19401]
* Add some basic services to createComponents for plugins {pull}19380[#19380]
* Make plugins closeable {pull}19137[#19137]
* Plugins: Add status bar on download {pull}18695[#18695]
* Add did-you-mean for plugin cli {pull}18942[#18942] (issue: {issue}18896[#18896])
* Plugins: Remove name() and description() from api {pull}18906[#18906]
* Emit nicer error message when trying to install unknown plugin {pull}18876[#18876] (issue: {issue}17226[#17226])
* Add plugin information for Verbose mode {pull}18051[#18051] (issue: {issue}16375[#16375])
* Cli: Improve output for usage errors {pull}17938[#17938]
* Cli: Add verbose output with zip url when installing plugin {pull}17662[#17662] (issue: {issue}17529[#17529])
* PluginManager: Add xpack as official plugin {pull}17227[#17227]
* CliTool: Cleanup and document Terminal {pull}16443[#16443]
* Plugin cli: Improve maven coordinates detection {pull}16384[#16384] (issue: {issue}16376[#16376])
* Enforce plugin zip does not contain zip entries outside of the plugin dir {pull}16361[#16361]
* CliTool: Allow unexpected exceptions to propagate {pull}16359[#16359]
* Reduce complexity of plugin cli {pull}16336[#16336]
* Remove Plugin.onIndexService. {pull}15029[#15029] (issue: {issue}14896[#14896])
* Open up QueryCache and SearcherWrapper extension points {pull}14303[#14303]

Query DSL::
* Throw exception when multiple field names are provided as part of query short syntax {pull}19871[#19871] (issue: {issue}19791[#19791])
* Query parsers to throw exception when multiple field names are provided {pull}19791[#19791] (issue: {issue}19547[#19547])
* Allow empty json object in request body in `_count` API {pull}19595[#19595] (issue: {issue}19422[#19422])
* Treat zero token in `common` terms query as MatchNoDocsQuery {pull}18656[#18656]
* Handle empty query bodies at parse time and remove EmptyQueryBuilder {pull}17624[#17624] (issues: {issue}17540[#17540], {issue}17541[#17541])
* Enforce MatchQueryBuilder#maxExpansions() to be strictly positive {pull}18464[#18464]
* Don't allow `fuzziness` for `multi_match` types `cross_fields`, `phrase` and `phrase_prefix` {pull}18322[#18322] (issues: {issue}6866[#6866], {issue}7764[#7764])
* Add MatchNoDocsQuery, a query that matches no documents and prints the reason why in the toString method. {pull}17780[#17780]
* Adds `ignore_unmapped` option to geo queries {pull}17751[#17751]
* Adds `ignore_unmapped` option to nested and P/C queries {pull}17748[#17748]
* SimpleQueryParser should call MappedFieldType.termQuery when appropriate. {pull}17678[#17678]
* An `exists` query on an object should query a single term. {pull}17186[#17186] (issue: {issue}17131[#17131])
* Function Score Query: make parsing stricter {pull}16617[#16617] (issue: {issue}16583[#16583])
* Parsers should throw exception on unknown objects {pull}14255[#14255] (issue: {issue}10974[#10974])
* UNICODE_CHARACTER_CLASS fix {pull}11598[#11598] (issue: {issue}10146[#10146])

Query Refactoring::
* Add infrastructure to rewrite query builders {pull}16599[#16599]
* Switch geo validation to enum {pull}13672[#13672] (issue: {issue}13608[#13608])

REST::
* Add a REST spec for the create API {pull}20924[#20924]
* Add response params to REST params did you mean {pull}20753[#20753] (issues: {issue}20722[#20722], {issue}20747[#20747])
* Add did you mean to strict REST params {pull}20747[#20747] (issue: {issue}20722[#20722])
* Add exclusion support to response filtering {pull}19865[#19865]
* Only write forced_refresh if we forced a refresh {pull}19669[#19669] (issue: {issue}19629[#19629])
* Add Location header to the index, update, and create APIs {pull}19509[#19509] (issue: {issue}19079[#19079])
* Add support for `wait_for_events` to the `_cluster/health` REST endpoint {pull}19432[#19432] (issue: {issue}19419[#19419])
* Rename Search Template REST spec names {pull}19178[#19178]
* Adding status field in _msearch error request bodies {pull}18586[#18586] (issue: {issue}18013[#18013])
* Add semicolon query string parameter delimiter {pull}18186[#18186] (issue: {issue}18175[#18175])
* Enable HTTP compression by default with compression level 3 {pull}18066[#18066] (issue: {issue}7309[#7309])
* Allow JSON with unquoted field names by enabling system property {pull}17801[#17801] (issue: {issue}17674[#17674])
* More robust handling of CORS HTTP Access Control {pull}16092[#16092]
* Add option to exclude based on paths in XContent {pull}16017[#16017]

Recovery::
* Pass on maxUnsafeAutoIdTimestamp on recovery / relocation {pull}20300[#20300]
* Non-blocking primary relocation hand-off {pull}19013[#19013] (issues: {issue}15900[#15900], {issue}18553[#18553])
* index shard should be able to cancel check index on close. {pull}18839[#18839] (issue: {issue}12011[#12011])
* TransportNodesListGatewayStartedShards should fall back to disk based index metadata if not found in cluster state {pull}17663[#17663] (issue: {issue}17630[#17630])
* Recover broken IndexMetaData as closed {pull}17187[#17187]
* Relocation source should be marked as relocating before starting recovery to primary relocation target {pull}16500[#16500]
* Operation counter for IndexShard {pull}15956[#15956] (issue: {issue}15900[#15900])
* Primary relocation handoff {pull}15900[#15900] (issues: {issue}15532[#15532], {issue}16274[#16274], {issue}19013[#19013])
* Remove recovery threadpools and throttle outgoing recoveries on the master {pull}15372[#15372]
* Refactor StoreRecoveryService to be a simple package private util class {pull}13766[#13766]

Reindex API::
* Only ask for `_version` we need it {pull}19693[#19693] (issue: {issue}19135[#19135])
* Use fewer threads when reindexing-from-remote {pull}19636[#19636]
* Support authentication with reindex-from-remote {pull}19310[#19310]
* Support requests_per_second=-1 to mean no throttling in reindex {pull}19101[#19101] (issue: {issue}19089[#19089])
* Implement ctx.op = "delete" on _update_by_query and _reindex {pull}18614[#18614] (issue: {issue}18043[#18043])
* Make Reindex cancellation tests more uniform {pull}18498[#18498]
* Makes DeleteByQueryRequest implements IndicesRequest {pull}18466[#18466]
* Teach reindex to retry on search failures {pull}18331[#18331] (issue: {issue}18059[#18059])
* Remove ReindexResponse in favor of BulkIndexByScrollResponse {pull}18205[#18205]
* Stricter validation of Reindex's requests_per_second {pull}18028[#18028]
* Properly mark reindex's child tasks as child tasks {pull}17770[#17770]
* Make reindex throttling dynamic {pull}17262[#17262]
* Throttling support for reindex {pull}17039[#17039]
* Add ingest pipeline support to reindex {pull}16932[#16932]

Scripting::
* Parse script on storage instead of on retrieval {pull}20356[#20356]
* Migrate elasticsearch native script examples to the main repo {pull}19334[#19334] (issue: {issue}14662[#14662])
* Remove ClusterState from compile api {pull}19136[#19136]
* Mustache: Render Map as JSON {pull}18856[#18856] (issue: {issue}18970[#18970])
*  Compile each Groovy script in its own classloader {pull}18918[#18918] (issue: {issue}18572[#18572])
* Include script field even if it value is null {pull}18384[#18384] (issue: {issue}16408[#16408])
* Skipping hidden files compilation for script service {pull}16286[#16286] (issue: {issue}15269[#15269])
* Rename Plan A to Painless {pull}16245[#16245]
* Add plumbing for script compile-time parameters {pull}15464[#15464]
* Factor mustache -> modules/lang-mustache {pull}15328[#15328]

Scroll::
* Add an index setting to limit the maximum number of slices allowed in a scroll request. {pull}18782[#18782]

Search::
* Limit batch size when scrolling {pull}19367[#19367] (issue: {issue}19249[#19249])
* Record method counts while profiling query components {pull}18302[#18302]
* Change default similarity to BM25 {pull}18948[#18948] (issue: {issue}18944[#18944])
* Add a parameter to cap the number of searches the msearch api will concurrently execute {pull}18721[#18721]
* Introduces GeoValidationMethod to GeoDistanceSortBuilder {pull}18036[#18036]
* Switches from empty boolean query to matchNoDocs {pull}18007[#18007] (issue: {issue}17981[#17981])
* Allow binary sort values. {pull}17959[#17959] (issues: {issue}17971[#17971], {issue}6077[#6077])
* Fail query if it contains very large rescores {pull}17917[#17917] (issue: {issue}17522[#17522])
* Type filters should not have a performance impact when there is a single type. {pull}17350[#17350]
* Store _all payloads on 1 byte instead of 4. {pull}16899[#16899]
* Refuse to load fields from _source when using the `fields` option and support wildcards.  {pull}15017[#15017] (issues: {issue}10783[#10783], {issue}14489[#14489])
* Add response into ClearScrollResponse {pull}13835[#13835] (issue: {issue}13817[#13817])
* Shuffle shards for _only_nodes + support multiple specifications like cluster API  {pull}12575[#12575] (issues: {issue}12546[#12546], {issue}12700[#12700])

Search Refactoring::
* Removes the now obsolete SearchParseElement implementations {pull}18233[#18233]
* Remove RescoreParseElement {pull}17441[#17441]
* Remove HighlighterParseElement {pull}17303[#17303]
* Move top level parsing of sort element to SortBuilder {pull}17248[#17248]
* Switch to using refactored SortBuilder instead of using BytesReference in serialization {pull}17205[#17205] (issues: {issue}17146[#17146], {issue}17257[#17257])
* Add build() method to SortBuilder implementations {pull}17146[#17146] (issue: {issue}10217[#10217])
* Refactoring of Suggestions {pull}17096[#17096] (issue: {issue}10217[#10217])
* Move sort `order` field up into SortBuilder {pull}17035[#17035]
* Moves SortParser:parse(...) to only require QueryShardContext {pull}16999[#16999] (issue: {issue}15178[#15178])
* Change internal representation of suggesters  {pull}16873[#16873]
* Make GeoDistanceSortBuilder serializable, 2nd try {pull}16572[#16572] (issues: {issue}15178[#15178], {issue}16151[#16151])
* Move missing() from SortBuilder interface to class {pull}16225[#16225] (issues: {issue}15178[#15178], {issue}16151[#16151])
* Remove deprecated parameters from ScriptSortBuilder {pull}16153[#16153] (issue: {issue}15178[#15178])
* Refactor GeoSortBuilder {pull}16151[#16151] (issue: {issue}15178[#15178])
* Refactor FieldSortBuilder {pull}16127[#16127] (issue: {issue}15178[#15178])
* Make sort order enum writable. {pull}16124[#16124] (issue: {issue}15178[#15178])
* Make DistanceUnit writable. {pull}16122[#16122] (issue: {issue}15178[#15178])
* RescoreBuilder: Add parsing and creating of RescoreSearchContext {pull}16014[#16014] (issue: {issue}15559[#15559])
* Make RescoreBuilder and nested QueryRescorer Writable {pull}15953[#15953] (issue: {issue}15559[#15559])
* Explain api: move query parsing to the coordinating node {pull}14270[#14270]
* Switch query parsers to use ParseField  {pull}14249[#14249] (issue: {issue}8964[#8964])
* Refactoring of Aggregations {pull}14136[#14136]

Sequence IDs::
* Persist sequence number checkpoints {pull}18949[#18949] (issue: {issue}10708[#10708])
* Add sequence numbers to cat shards API {pull}18772[#18772]

Settings::
* Add precise logging on unknown or invalid settings {pull}20951[#20951] (issue: {issue}20946[#20946])
* Make `action.auto_create_index` setting a dynamic cluster setting {pull}20274[#20274] (issue: {issue}7513[#7513])
* Removes space between # and the setting in elasticsearch.yml {pull}20094[#20094] (issue: {issue}20090[#20090])
* Validates new dynamic settings from the current state {pull}19122[#19122] (issue: {issue}19046[#19046])
* Improve error message if a setting is not found {pull}18920[#18920] (issue: {issue}18663[#18663])
* Cleanup placeholder replacement {pull}17335[#17335]
* Switch to registered Settings for all IndexingMemoryController settings {pull}17778[#17778] (issue: {issue}17442[#17442])
* Add guard against null-valued settings {pull}17310[#17310] (issue: {issue}17292[#17292])
* Useful error message for null property placeholder {pull}17293[#17293] (issue: {issue}17292[#17292])
* Archive cluster level settings if unknown or broken {pull}17246[#17246]
* Improve error message if setting is not found {pull}17230[#17230]
* Improve upgrade experience of node level index settings {pull}17223[#17223] (issue: {issue}17187[#17187])
* Settings with complex matchers should not overlap {pull}16754[#16754]
* Moves GCE settings to the new infra {pull}16722[#16722] (issue: {issue}16720[#16720])
* Add filtering support within Setting class {pull}16629[#16629] (issue: {issue}16598[#16598])
* Migrate AWS settings to new settings infrastructure {pull}16602[#16602] (issue: {issue}16293[#16293])
* Remove `gateway.initial_meta` and always rely on min master nodes {pull}16446[#16446]
* Rewrite SettingsFilter to be immutable {pull}16425[#16425]
* Simplify azure settings {pull}16363[#16363]
* Convert PageCacheRecycler settings {pull}16341[#16341]
* Monitor settings {pull}16313[#16313]
* Cut over tribe node settings to new settings infra {pull}16311[#16311]
* Convert multcast plugin settings to the new infra {pull}16295[#16295]
* Convert `request.headers.*` to the new settings infra {pull}16292[#16292]
* Migrate Azure settings to new settings infrastructure {pull}16291[#16291]
* Validate logger settings and allow them to be reset via API {pull}16289[#16289]
* Switch NodeEnvironment's settings to new settings {pull}16273[#16273]
* Simplify AutoCreateIndex and add more tests {pull}16270[#16270]
* Convert several pending settings {pull}16269[#16269]
* Migrate query caching settings to the new settings infra. {pull}16267[#16267]
* Convert `action.auto_create_index` and `action.master.force_local` to the new settings infra {pull}16263[#16263]
* Convert `cluster.routing.allocation.type` and `processors` to the new settings infra. {pull}16238[#16238]
* Validate tribe node settings on startup {pull}16237[#16237]
* Move node.client, node.data, node.master, node.local and node.mode to new settings infra {pull}16230[#16230]
* Moved http settings to the new settings infrastructure {pull}16188[#16188]
* Migrate network service to the new infra {pull}16187[#16187]
* Convert client.transport settings to new infra {pull}16183[#16183]
* Move discovery.* settings to new Setting infrastructure {pull}16182[#16182]
* Change over to o.e.common.settings.Setting for http settings {pull}16181[#16181]
* Convert "path.*" and "pidfile" to new settings infra {pull}16180[#16180]
* Migrate repository settings to the new settings API {pull}16178[#16178]
* Convert "indices.*" settings to new infra. {pull}16177[#16177]
* Migrate gateway settings to the new settings API. {pull}16175[#16175]
* Convert several node and test level settings {pull}16172[#16172]
* Run Metadata upgrade tool on every version {pull}16168[#16168]
* Check for invalid index settings on metadata upgrade {pull}16156[#16156]
* Validate the settings key if it's simple chars separated by `.` {pull}16120[#16120]
* Validate known global settings on startup {pull}16091[#16091]
* Cut over all index scope settings to the new setting infrastrucuture {pull}16054[#16054] (issues: {issue}12790[#12790], {issue}12854[#12854], {issue}16032[#16032], {issue}6732[#6732])
* Remove updatability of `index.flush_on_close` {pull}15964[#15964] (issue: {issue}15955[#15955])
* Move all dynamic settings and their config classes to the index level {pull}15955[#15955] (issue: {issue}6732[#6732])
* Always require units for bytes and time settings {pull}15948[#15948] (issue: {issue}11437[#11437])
* Make MetaData parsing less lenient. {pull}15828[#15828]
* Move async translog sync logic into IndexService {pull}15584[#15584]
* Remove `index.merge.scheduler.notify_on_failure` and default to `true` {pull}15572[#15572] (issue: {issue}15570[#15570])
* Remove cache concurrency level settings that no longer apply {pull}14210[#14210] (issues: {issue}13224[#13224], {issue}13717[#13717], {issue}7836[#7836])

Similarities::
* Defining a global default similarity {pull}16682[#16682] (issue: {issue}16594[#16594])

Snapshot/Restore::
* Delete differing files in the store before restoring {pull}20220[#20220] (issue: {issue}20148[#20148])
* Adds ignoreUnavailable option to the snapshot status API {pull}20066[#20066] (issue: {issue}18522[#18522])
* Check restores in progress before deleting a snapshot {pull}19853[#19853]
* Snapshot repository cleans up empty index folders {pull}19751[#19751]
* BlobContainer#writeBlob no longer can overwrite a blob {pull}19749[#19749] (issue: {issue}15579[#15579])
* More resilient blob handling in snapshot repositories {pull}19706[#19706] (issues: {issue}18156[#18156], {issue}18815[#18815], {issue}19421[#19421], {issue}7540[#7540])
* Adding repository index generational files {pull}19002[#19002] (issue: {issue}18156[#18156])
* Raised IOException on deleteBlob {pull}18815[#18815] (issue: {issue}18530[#18530])
* Adds UUIDs to snapshots {pull}18228[#18228] (issue: {issue}18156[#18156])
* Clarify the semantics of the BlobContainer interface {pull}18157[#18157] (issue: {issue}15580[#15580])
* Change BlobPath.buildAsString() method {pull}18461[#18461]
* Remove the Snapshot class in favor of using SnapshotInfo {pull}18167[#18167] (issue: {issue}18156[#18156])

Stats::
* Add mem section back to cluster stats {pull}20255[#20255] (issue: {issue}17278[#17278])
* Add network types to cluster stats {pull}20144[#20144]
* Add missing field type in the FieldStats response. {pull}19241[#19241] (issue: {issue}17750[#17750])
* Expose the ClusterInfo object in the allocation explain output {pull}19106[#19106] (issue: {issue}14405[#14405])
* Add total_indexing_buffer/_in_bytes to nodes info API {pull}18914[#18914] (issue: {issue}18651[#18651])
* Allow FieldStatsRequest to disable cache {pull}18900[#18900]
* Remove index_writer_max_memory stat from segment stats {pull}18651[#18651] (issues: {issue}14121[#14121], {issue}7440[#7440])
* Move DocStats under Engine to get more accurate numbers {pull}18587[#18587]
* Do not return fieldstats information for fields that exist in the mapping but not in the index. {pull}18212[#18212] (issue: {issue}17980[#17980])
* Add whether the shard state fetch is pending to the allocation explain API {pull}18119[#18119] (issue: {issue}17372[#17372])
* Add Failure Details to every NodesResponse {pull}17964[#17964] (issue: {issue}3740[#3740])
* Add I/O statistics on Linux {pull}15915[#15915] (issue: {issue}15296[#15296])
* Add points to SegmentStats. {pull}17775[#17775] (issue: {issue}16974[#16974])
* Remove FieldStats.Float. {pull}17749[#17749]
* Show configured and remaining delay for an unassigned shard. {pull}17515[#17515] (issue: {issue}17372[#17372])
* indexing stats now contain indexing ops from recovery  [ISSUE] {pull}17412[#17412]
* Normalize unavailable load average {pull}16061[#16061] (issues: {issue}12049[#12049], {issue}14741[#14741], {issue}15907[#15907], {issue}15932[#15932], {issue}15934[#15934])
* Add load averages to OS stats on FreeBSD {pull}15934[#15934] (issue: {issue}15917[#15917])
* Expose pending cluster state queue size in node stats {pull}14040[#14040] (issue: {issue}13610[#13610])

Store::
* Use `mmapfs` by default. {pull}17616[#17616] (issue: {issue}16983[#16983])
* Remove support for legacy checksums {pull}16931[#16931]
* Rename index folder to index_uuid {pull}16442[#16442] (issues: {issue}13264[#13264], {issue}13265[#13265], {issue}14512[#14512], {issue}14932[#14932], {issue}15853[#15853])

Suggesters::
* Move SuggestUtils methods to their respective caller classes {pull}19914[#19914] (issue: {issue}19906[#19906])
* Remove payload option from completion suggester {pull}19877[#19877] (issue: {issue}19536[#19536])
* Add bwc support for reading  pre-5.0 completion index {pull}17602[#17602]

Task Manager::
* Rename Task Persistence into Storing Task Results {pull}19982[#19982]
* Fetch result when wait_for_completion {pull}18905[#18905]
* Create get task API that falls back to the .tasks index {pull}18682[#18682]
* Add ability to store results for long running tasks {pull}17928[#17928]
* Move parentTaskId into TransportRequest  {pull}17872[#17872]
* Shorten the serialization of the empty TaskId {pull}17870[#17870]
* Expose whether a task is cancellable in the _tasks list API {pull}17464[#17464] (issue: {issue}17369[#17369])
* Add ability to group tasks by common parent {pull}17341[#17341]
* Add start time and duration to tasks {pull}16829[#16829]
* Combine node name and task id into single string task id {pull}16744[#16744]
* Add task status {pull}16356[#16356] (issue: {issue}16344[#16344])
* Extend tracking of parent tasks to master node, replication and broadcast actions {pull}15931[#15931]

Translog::
* Fsync documents in an async fashion {pull}20145[#20145]
* Add checksumming and versions to the Translog's Checkpoint files {pull}19797[#19797]
* Beef up Translog testing with random channel exceptions {pull}18997[#18997]
* Do not replay into translog on local recovery {pull}18547[#18547]
* FSync translog outside of the writers global lock {pull}18360[#18360]
* Remove ChannelReference and simplify Views {pull}15898[#15898]
* Simplify TranslogWriter to always write to a stream {pull}15771[#15771]
* Remove TranslogService and fold it into synchronous IndexShard API {pull}13707[#13707]

[float]
=== Bug Fixes

Aggregations::
* Fixed writeable name from range to geo_distance {pull}20860[#20860]
* Fix date_range aggregation to not cache if now is used {pull}20740[#20740]
* The `top_hits` aggregation should compile scripts only once. {pull}20738[#20738]
* Fix agg profiling when using breadth_first collect mode {pull}20156[#20156]
* Throw exception when maxBounds greater than minBounds {pull}19855[#19855] (issue: {issue}19833[#19833])
* Undeprecates `aggs` in the search request {pull}19674[#19674] (issue: {issue}19504[#19504])
* Change how `nested` and `reverse_nested` aggs know about their nested depth level {pull}19550[#19550] (issues: {issue}11749[#11749], {issue}12410[#12410])
* Make ExtendedBounds immutable {pull}19490[#19490] (issue: {issue}19481[#19481])
* Aggregations fix: support include/exclude strings for IP and dates {pull}18408[#18408] (issue: {issue}17705[#17705])
* Fix xcontent rendering of ip terms aggs. {pull}18003[#18003] (issue: {issue}17971[#17971])
* Improving parsing of sigma param for Extended Stats Bucket Aggregation {pull}17562[#17562] (issue: {issue}17499[#17499])
* Fixes NPE when no window is specified in moving average request {pull}17556[#17556] (issue: {issue}17516[#17516])
* Fixes Filter and FiltersAggregation to work with empty query {pull}17542[#17542] (issue: {issue}17518[#17518])
* Fixes the defaults for `keyed` in the percentiles aggregations {pull}17217[#17217]
* Correct typo in class name of StatsAggregator {pull}15264[#15264] (issue: {issue}14730[#14730])

Allocation::
* Keep a shadow replicas' allocation id when it is promoted to primary {pull}20863[#20863] (issue: {issue}20650[#20650])
* IndicesClusterStateService should clean local started when re-assigns an initializing shard with the same aid {pull}20687[#20687]
* IndexRoutingTable.initializeEmpty shouldn't override supplied primary RecoverySource {pull}20638[#20638] (issue: {issue}20637[#20637])
* Update incoming recoveries stats when shadow replica is reinitialized {pull}20612[#20612]
* `index.routing.allocation.initial_recovery` limits replica allocation {pull}20589[#20589]
* Upon being elected as master, prefer joins' node info to existing cluster state {pull}19743[#19743]
* Fix NPE when initializing replica shard has no UnassignedInfo {pull}19491[#19491] (issue: {issue}19488[#19488])
* Make shard store fetch less dependent on the current cluster state, both on master and non data nodes {pull}19044[#19044] (issue: {issue}18938[#18938])
* Fix recovery throttling to properly handle relocating non-primary shards {pull}18701[#18701] (issue: {issue}18640[#18640])
* Replica shards must be failed before primary shards {pull}15686[#15686]

Analysis::
* Named analyzer should close the analyzer that it wraps {pull}20197[#20197]
* Can load non-PreBuiltTokenFilter in Analyze API {pull}20396[#20396]
* Fix analyzer alias processing {pull}19506[#19506] (issue: {issue}19163[#19163])

Bulk::
* Add not-null precondition check in BulkRequest {pull}18347[#18347] (issue: {issue}12038[#12038])

CAT API::
* Fixes cat tasks operation in detailed mode {pull}19759[#19759] (issue: {issue}19755[#19755])
* Add index pattern wildcards support to _cat/shards {pull}19655[#19655] (issue: {issue}19634[#19634])

CRUD::
* GET operations should not extract fields from `_source`. {pull}20158[#20158] (issues: {issue}15017[#15017], {issue}20102[#20102])
* Squash a race condition in RefreshListeners {pull}18806[#18806]
* Prevent TransportReplicationAction to route request based on stale local routing table {pull}16274[#16274] (issues: {issue}12573[#12573], {issue}12574[#12574])
* Resolves the conflict between alias routing and parent routing by applying the alias routing and ignoring the parent routing. {pull}15371[#15371] (issue: {issue}3068[#3068])

Cache::
* Prevent requests that use scripts or now() from being cached {pull}20750[#20750] (issue: {issue}20645[#20645])
* Serialize index boost and phrase suggest collation keys in a consistent order {pull}20081[#20081] (issue: {issue}19986[#19986])

Circuit Breakers::
* Never trip circuit breaker in liveness request {pull}18627[#18627] (issue: {issue}17951[#17951])
* Free bytes reserved on request breaker {pull}18204[#18204] (issue: {issue}18144[#18144])

Cluster::
* Fixes issue with dangling index being deleted instead of re-imported {pull}19666[#19666]
* Allow routing table to be filtered by index pattern {pull}19688[#19688]
* Use executor's describeTasks method to log task information in cluster service {pull}19531[#19531]
* Acknowledge index deletion requests based on standard cluster state acknowledgment {pull}18602[#18602] (issues: {issue}16442[#16442], {issue}18558[#18558])
* Dangling indices are not imported if a tombstone for the index exists {pull}18250[#18250] (issue: {issue}18249[#18249])
* Fix issue with tombstones matching active indices in cluster state {pull}18058[#18058] (issue: {issue}18054[#18054])
* Shard state action channel exceptions {pull}16057[#16057] (issue: {issue}15748[#15748])

Core::
* Makes `m` case sensitive in TimeValue {pull}19649[#19649] (issue: {issue}19619[#19619])
* Guard against negative result from FileStore.getUsableSpace when picking data path for a new shard {pull}19554[#19554]
* Handle rejected execution exception on reschedule {pull}19505[#19505]
* Fix concurrency bug in IMC that could cause it to check too infrequently {pull}18357[#18357]
* Iterables.flatten should not pre-cache the first iterator {pull}18355[#18355] (issue: {issue}18353[#18353])
* Avoid race while retiring executors {pull}18333[#18333]
* Refactor UUID-generating methods out of Strings {pull}17837[#17837] (issue: {issue}17819[#17819])
* Node names cleanup {pull}17723[#17723] (issue: {issue}17718[#17718])
* NullPointerException from IndexingMemoryController when a version conflict happens during recovery {pull}17569[#17569]
* Handle RejectedExecution gracefully in TransportService during shutdown {pull}16965[#16965]

Discovery::
* Update discovery nodes after cluster state is published {pull}20409[#20409]
* Add current cluster state version to zen pings and use them in master election {pull}20384[#20384] (issue: {issue}20348[#20348])

Engine::
* Take refresh IOExceptions into account when catching ACE in InternalEngine {pull}20546[#20546] (issue: {issue}19975[#19975])
* Don't suppress AlreadyClosedException {pull}19975[#19975] (issue: {issue}19861[#19861])

Expressions::
* replace ScriptException with a better one {pull}18600[#18600]

Geo::
* Incomplete results when using geo_distance for large distances [ISSUE] {pull}17578[#17578]
* Fix multi-field support for GeoPoint types {pull}15702[#15702] (issue: {issue}15701[#15701])
* Enforce distance in distance query is > 0 [ISSUE] {pull}15135[#15135]

Highlighting::
* Enable BoostingQuery with FVH highlighter {pull}19984[#19984] (issue: {issue}19985[#19985])

Index APIs::
* Fixes active shard count check in the case of `all` shards {pull}19760[#19760]
* Add zero-padding to auto-generated rollover index name increment {pull}19610[#19610] (issue: {issue}19484[#19484])

Ingest::
* no null values in ingest configuration error messages {pull}20616[#20616]
* JSON Processor was not properly added {pull}20613[#20613]
* Don't rebuild pipeline on every cluster state update {pull}20189[#20189]
* Add dotexpander processor {pull}20078[#20078]
* Fix NPE when simulating a pipeline with no id {pull}19650[#19650]
* Change foreach processor to use ingest metadata for array element {pull}19609[#19609] (issue: {issue}19592[#19592])
* No other processors should be executed after on_failure is called {pull}19545[#19545]
* rethrow script compilation exceptions into ingest configuration exceptions {pull}19318[#19318]
* Rename from `ingest-useragent` plugin to `ingest-user-agent` and its processor from `useragent` to `user_agent` {pull}19261[#19261]
* Fix ignore_failure behavior in _simulate?verbose and more cleanup {pull}18987[#18987]
* Pipeline Stats: Fix concurrent modification exception {pull}18177[#18177] (issue: {issue}18126[#18126])
* Validate properties values according to database type {pull}17940[#17940] (issue: {issue}17683[#17683])
* Ingest does not close its factories {pull}17626[#17626] (issue: {issue}17625[#17625])
* Handle regex parsing errors in Gsub and Grok Processors {pull}17260[#17260]
* add on_failure exception metadata to ingest document for verbose simulate {pull}16562[#16562]
* The IngestDocument copy constructor should make a deep copy {pull}16248[#16248] (issue: {issue}16246[#16246])

Inner Hits::
* Ensure that that InnerHitBuilder uses rewritten queries {pull}19360[#19360] (issue: {issue}19353[#19353])

Internal::
* Prevent AbstractArrays from release bytes more than once {pull}20819[#20819]
* IndicesAliasesRequest should not implement CompositeIndicesRequest {pull}20726[#20726]
* Ensure elasticsearch doesn't start with unuspported indices {pull}20514[#20514] (issue: {issue}20512[#20512])
* Remove ListTasksResponse#setDiscoveryNodes() {pull}19773[#19773] (issue: {issue}19772[#19772])
* Priority values should be unmodifiable {pull}19447[#19447]
* Extract AbstractBytesReferenceTestCase {pull}19141[#19141]
* Add XPointValues {pull}18011[#18011] (issue: {issue}18010[#18010])
* Fix BulkItemResponse.Failure.toString {pull}17871[#17871]
* Enable unmap hack for java 9 {pull}16986[#16986] (issue: {issue}1[#1])
* Fix issues with failed cache loads {pull}14315[#14315]
* Allow parser to move on the START_OBJECT token when parsing search source {pull}14145[#14145]
* Ensure searcher is release if wrapping fails {pull}14107[#14107]
* Avoid deadlocks in Cache#computeIfAbsent {pull}14091[#14091] (issue: {issue}14090[#14090])

Java API::
* fix IndexResponse#toString to print out shards info {pull}20562[#20562]
* Add NamedWriteables from plugins to TransportClient {pull}19825[#19825] (issue: {issue}19764[#19764])
* Fix potential NPE in SearchSourceBuilder {pull}16905[#16905] (issue: {issue}16902[#16902])

Java REST Client::
* Rest Client: add slash to log line when missing between host and uri {pull}19325[#19325] (issue: {issue}19314[#19314])
* Rest Client: HostsSniffer to set http as default scheme {pull}19306[#19306]

Logging::
* Fix logger when you can not create an azure storage client {pull}20670[#20670] (issues: {issue}20633[#20633], {issue}20669[#20669])
* Avoid unnecessary creation of prefix loggers {pull}20571[#20571] (issue: {issue}20570[#20570])
* Fix logging hierarchy configs {pull}20463[#20463]
* Fix prefix logging {pull}20429[#20429]
* Hack around Log4j bug rendering exceptions {pull}20306[#20306] (issue: {issue}20304[#20304])
* Avoid prematurely triggering logger initialization {pull}20170[#20170]
* Only log running out of slots when out of slots {pull}19637[#19637]

Mapping::
* Allow position_gap_increment for fields in indices created prior to 5.0 {pull}20806[#20806] (issues: {issue}19510[#19510], {issue}20413[#20413])
* Validate blank field name {pull}19860[#19860] (issue: {issue}19251[#19251])
* Better error message when mapping configures null {pull}18809[#18809] (issue: {issue}18803[#18803])
* Make doc_values accessible for _type {pull}18220[#18220]
* Fix and test handling of `null_value`. {pull}18090[#18090] (issue: {issue}18085[#18085])
* Fail automatic string upgrade if the value of `index` is not recognized. {pull}18082[#18082] (issue: {issue}18062[#18062])
* Fix dynamic check to properly handle parents {pull}17864[#17864] (issues: {issue}17644[#17644], {issue}17854[#17854])
* Fix array parsing to remove its context when finished parsing {pull}17768[#17768]
* Disallow fielddata loading on text fields that are not indexed. {pull}17747[#17747]
* Make dynamic template parsing less lenient. {pull}17249[#17249]
* Fix dynamic mapper when its parent already has an update {pull}17065[#17065]
* Fix copy_to when the target is a dynamic object field. {pull}15216[#15216] (issues: {issue}111237[#111237], {issue}11237[#11237])
* Preserve existing mappings on batch mapping updates {pull}15130[#15130] (issues: {issue}14899[#14899], {issue}15129[#15129])

Network::
* Fix connection close header handling {pull}20956[#20956] (issue: {issue}20938[#20938])
* Ensure port range is readable in the exception message {pull}20893[#20893]
* Fix expect 100 continue header handling {pull}19904[#19904] (issue: {issue}19834[#19834])
* Fixes netty4 module's CORS config to use defaults  {pull}19874[#19874]
* Fix various concurrency issues in transport {pull}19675[#19675]
* Verify lower level transport exceptions don't bubble up on disconnects {pull}19518[#19518] (issue: {issue}19096[#19096])

Packaging::
* [Packaging] Do not remove scripts directory on upgrade {pull}20452[#20452]
* [Package] Remove bin/lib/modules directories on RPM uninstall/upgrade {pull}20448[#20448]
* Fix handling of spaces for jvm.options on Windows {pull}19951[#19951] (issue: {issue}19941[#19941])
* Disable service in pre-uninstall {pull}19328[#19328]
* Remove extra bin/ directory in bin folder {pull}18630[#18630]
* Filter client/server VM options from jvm.options {pull}18473[#18473]
* Preserve config files from RPM install {pull}18188[#18188] (issue: {issue}18158[#18158])
* Fix typo in message for variable setup ES_MAX_MEM {pull}18168[#18168]
* Don't run `mkdir` when $DATA_DIR contains a comma-separated list {pull}17419[#17419] (issue: {issue}16992[#16992])
* Fix exit code {pull}17082[#17082]
* Set MAX_OPEN_FILES to 65536 {pull}17431[#17431] (issue: {issue}17430[#17430])
* [windows] Service command still had positional start command {pull}17391[#17391]
* Do not pass double-dash arguments on startup {pull}17087[#17087] (issue: {issue}17084[#17084])

Parent/Child::
*  Make sure that no `_parent#null` gets introduces as default _parent mapping {pull}19470[#19470] (issue: {issue}19389[#19389])

Percolator::
* Fail indexing percolator queries containing either a has_child or has_parent query {pull}20229[#20229] (issue: {issue}2960[#2960])
* Add support for MatchNoDocsQuery in percolator's query terms extract service {pull}18492[#18492]
* Let PercolatorQuery's explain use the two phase iterator {pull}17315[#17315] (issue: {issue}17314[#17314])

Plugin Discovery Azure Classic::
* Make discovery-azure plugin work again {pull}19062[#19062] (issues: {issue}15630[#15630], {issue}18637[#18637])

Plugin Discovery EC2::
* Fix EC2 discovery settings {pull}18690[#18690] (issues: {issue}18652[#18652], {issue}18662[#18662])
* Add TAG_SETTING to list of allowed tags for the ec2 discovery plugin. {pull}18257[#18257]
* Fix EC2 Discovery settings {pull}17651[#17651] (issue: {issue}16602[#16602])

Plugin Discovery GCE::
* Fix NPE when GCE region is empty {pull}19176[#19176] (issue: {issue}16967[#16967])

Plugin Ingest Attachment::
* Adds content-length as number {pull}19927[#19927] (issue: {issue}19924[#19924])

Plugin Ingest GeoIp::
* [ingest-geoip] update geoip to not include null-valued results from  {pull}20455[#20455]

Plugin Lang Painless::
* Fix String Concatenation Bug In Painless {pull}20623[#20623]
* Fix break bug in for/foreach loops. {pull}20146[#20146]
* Fix compound assignment with string concats {pull}18933[#18933] (issue: {issue}18929[#18929])
* Fix horrible capture {pull}18907[#18907] (issue: {issue}18899[#18899])
* Fix Casting Bug {pull}18871[#18871]
* Remove Grammar Ambiguities {pull}18531[#18531]
* Remove if/else ANTLR ambiguity. {pull}18428[#18428]
* Fix insanely slow compilation {pull}18410[#18410] (issue: {issue}18398[#18398])
* Fix Bug in Painless Assignment {pull}18379[#18379]
* Fix bracket shortcuts {pull}18263[#18263]

Plugin Repository Azure::
* Register group setting for repository-azure accounts {pull}19086[#19086]
* Fix azure files removal {pull}18451[#18451] (issues: {issue}16472[#16472], {issue}18436[#18436])

Plugin Repository S3::
* Fixes leading forward slash in S3 repository base_path {pull}20861[#20861]
* Add missing permission to repository-s3 {pull}19128[#19128] (issues: {issue}18539[#18539], {issue}19121[#19121])
* Fix repository S3 Settings and add more tests {pull}18703[#18703] (issues: {issue}18662[#18662], {issue}18690[#18690])

Plugin Store SMB::
* Fix calling ensureOpen() on the wrong directory (master forwardport) {pull}16395[#16395] (issue: {issue}16383[#16383])

Plugins::
* Use sysprop like with es.path.home to pass conf dir {pull}18870[#18870] (issue: {issue}18689[#18689])
* Quote path to java binary {pull}17496[#17496] (issue: {issue}17495[#17495])
* CliTool: Messages printed in Terminal should have percent char escaped {pull}16367[#16367]

Query DSL::
* Fixes MultiMatchQuery so that it doesn't provide a null context {pull}20882[#20882]
* Fix silently accepting malformed queries {pull}20515[#20515] (issue: {issue}20500[#20500])
* query_string_query should take term length into consideration when fuzziness is auto {pull}20299[#20299] (issue: {issue}15972[#15972])
* Throw ParsingException if a query is wrapped in an array {pull}19750[#19750] (issue: {issue}12887[#12887])
* Restore parameter name auto_generate_phrase_queries {pull}19514[#19514] (issue: {issue}19512[#19512])
* Resolve string dates and date math to millis before evaluating for rewrite in range query {pull}17239[#17239]
* `constant_score` query should throw error on more than one filter {pull}17135[#17135] (issue: {issue}17126[#17126])
* Single IPv4 addresses in IP field term queries {pull}16068[#16068] (issue: {issue}16058[#16058])
* Make strategy optional in GeoShapeQueryBuilder readFrom and writeTo {pull}13963[#13963]

Query Refactoring::
* Query refactoring: set has_parent & has_child types context properly {pull}13863[#13863]
* Make sure equivalent geohashCellQueries are equal after toQuery called {pull}13792[#13792]

REST::
* Remove lenient URL parameter parsing {pull}20722[#20722] (issue: {issue}14719[#14719])
* Fixes CORS handling so that it uses the defaults {pull}19522[#19522] (issue: {issue}19520[#19520])
* Get XContent params from request in Nodes rest actions {pull}18860[#18860] (issue: {issue}18794[#18794])
* Fixes reading of CORS pre-flight headers and methods {pull}17523[#17523] (issue: {issue}17483[#17483])

Recovery::
* Fix concurrency issues between cancelling a relocation and marking shard as relocated {pull}20443[#20443]
* Move `reset recovery` into RecoveriesCollection {pull}19466[#19466] (issue: {issue}19473[#19473])
* Fix replica-primary inconsistencies when indexing during primary relocation with ongoing replica recoveries {pull}19287[#19287] (issue: {issue}19248[#19248])
* Invoke `IndexingOperationListeners` also when recovering from store or remote {pull}17406[#17406]
* Prevent interruption while store checks lucene files for consistency {pull}16308[#16308]
* Mark shard as recovering on the cluster state thread {pull}14276[#14276] (issues: {issue}13766[#13766], {issue}14115[#14115])

Reindex API::
* Fix reindex with transport client {pull}19997[#19997] (issues: {issue}19773[#19773], {issue}19979[#19979])
* Fix a race condition in reindex's rethrottle {pull}18731[#18731] (issue: {issue}18744[#18744])
* Reindex should never report negative throttled_until {pull}17799[#17799] (issue: {issue}17783[#17783])
* Reindex should gracefully handle when _source is disabled {pull}17667[#17667] (issue: {issue}17666[#17666])

Scripting::
* Add support for booleans in scripts {pull}20950[#20950] (issue: {issue}20949[#20949])
* Fix Javascript OOM build Failure {pull}20307[#20307]
* Fix propagating the default value for script settings {pull}20183[#20183] (issue: {issue}20159[#20159])
* Catch and wrap AssertionError and NoClassDefFoundError in groovy scripts {pull}19958[#19958] (issues: {issue}19806[#19806], {issue}19923[#19923])

Search::
* Do not cache script queries. {pull}20799[#20799] (issue: {issue}20763[#20763])
* Throw error when trying to fetch fields from source and source is disabled {pull}20424[#20424] (issues: {issue}20093[#20093], {issue}20408[#20408])
* Source filtering should keep working when the source contains numbers greater than `Long.MAX_VALUE`. {pull}20278[#20278] (issue: {issue}11508[#11508])
* Fix NPE when running a range query on a `scaled_float` with no upper bound. {pull}20253[#20253]
* Fix NPE during search with source filtering if the source is disabled. {pull}20093[#20093] (issue: {issue}7758[#7758])
* Restore assignment of time value when deserializing a scroll instance {pull}19977[#19977] (issue: {issue}18820[#18820])
* Fix explain output for dfs query {pull}19972[#19972] (issue: {issue}15369[#15369])
* Don't recursively count children profile timings {pull}19397[#19397] (issue: {issue}18693[#18693])
* fix explain in function_score if no function filter matches {pull}19185[#19185]
* Fix NPEs due to disabled source {pull}18957[#18957]
* Require timeout units when parsing query body {pull}19077[#19077] (issue: {issue}19075[#19075])
* Close SearchContext if query rewrite failed {pull}18727[#18727]
* Fix parsing single `rescore` element in SearchSourceBuilder {pull}18440[#18440] (issue: {issue}18439[#18439])
* Fail queries on not indexed fields. {pull}18014[#18014]
* Fix for search after {pull}16271[#16271]
* Do not be lenient when parsing CIDRs {pull}14874[#14874] (issue: {issue}14862[#14862])

Settings::
* Fix Setting.timeValue() method {pull}20696[#20696] (issue: {issue}20662[#20662])
* Add a hard limit for `index.number_of_shard` {pull}20682[#20682]
* Include complex settings in settings requests {pull}20622[#20622]
* Fix filter cache setting to allow percentages {pull}20335[#20335] (issue: {issue}20330[#20330])
* Move cluster.routing.allocation.same_shard.host setting to new settings infrastructure {pull}20046[#20046] (issue: {issue}20045[#20045])
* Validate settings against dynamic updaters on the master {pull}19088[#19088] (issue: {issue}19046[#19046])
* Register "cloud.node.auto_attributes" setting in EC2 discovery plugin {pull}18678[#18678]
* Use object equality to compare versions in IndexSettings {pull}18103[#18103]
* fix exists method for list settings when using numbered setting format {pull}17949[#17949]
* convert settings for ResourceWatcherService to new infrastructure {pull}17948[#17948]
* Register bootstrap settings {pull}16513[#16513]
* Add settings filtering to node info requests {pull}16445[#16445]
* Ban write access to system properties {pull}14914[#14914]

Snapshot/Restore::
* Better handling of an empty shard's segments_N file {pull}18784[#18784] (issue: {issue}18707[#18707])
* Fix race condition in snapshot initialization {pull}18426[#18426] (issue: {issue}18121[#18121])
* Fix the semantics for the BlobContainer interface {pull}17878[#17878] (issues: {issue}15579[#15579], {issue}15580[#15580])

Stats::
* Fix FieldStats deserialization of `ip` field {pull}20522[#20522] (issue: {issue}20516[#20516])
* Fix serialization bug in allocation explain API. {pull}19494[#19494]
* Allocation explain: Also serialize `includeDiskInfo` field {pull}19492[#19492]
* Add missing builder.endObject() in FsInfo {pull}18443[#18443] (issues: {issue}15915[#15915], {issue}18433[#18433])

Store::
* Tighten up concurrent store metadata listing and engine writes {pull}19684[#19684] (issue: {issue}19416[#19416])
* Make static Store access shard lock aware {pull}19416[#19416] (issue: {issue}18938[#18938])
* Catch assertion errors on commit and turn it into a real exception {pull}19357[#19357] (issue: {issue}19356[#19356])

Task Manager::
* Shard level tasks in Bulk Action lose reference to their parent tasks {pull}17743[#17743]
* Take filterNodeIds into consideration while sending task requests to nodes {pull}17081[#17081]

Term Vectors::
* Fix calculation of took time of term vectors request {pull}17817[#17817] (issue: {issue}12565[#12565])

Translog::
* Fix RAM usage estimation of LiveVersionMap. {pull}20123[#20123] (issue: {issue}19787[#19787])
* Fix translog replay multiple operations same doc {pull}18611[#18611] (issues: {issue}18547[#18547], {issue}18623[#18623])
* Snapshotting and sync could cause a dead lock TranslogWriter {pull}18481[#18481] (issues: {issue}1[#1], {issue}18360[#18360], {issue}2[#2])
* Move translog recover outside of the engine {pull}17422[#17422]
* Mark shard active during recovery; push settings after engine finally inits {pull}16250[#16250] (issues: {issue}14121[#14121], {issue}16209[#16209])

[float]
=== Regressions

Highlighting::
* Handle SynonymQuery extraction for the FastVectorHighlighter {pull}20829[#20829] (issue: {issue}20781[#20781])

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.2.0 {pull}20147[#20147] (issue: {issue}20092[#20092])
* Update to jackson 2.8.1 {pull}18939[#18939] (issue: {issue}18076[#18076])
* Upgrade to Lucene 6.1.0. {pull}18926[#18926]
* Upgrade to lucene-6.1.0-snapshot-3a57bea. {pull}18786[#18786]
* Upgrade to Lucene 6.0.1. {pull}18648[#18648] (issues: {issue}17535[#17535], {issue}28[#28])
* Upgrade to lucene 6 release {pull}17657[#17657]
* Upgrade to lucene-6.0.0-f0aa4fc. {pull}17075[#17075]
* upgrade to lucene 6.0.0-snapshot-bea235f {pull}16964[#16964]
* Upgrade to Jackson 2.7.1 {pull}16801[#16801] (issue: {issue}16294[#16294])

Ingest::
* Update MaxMind geoip2 version to 2.6 {pull}16837[#16837] (issue: {issue}16801[#16801])

Internal::
* Bump master (3.0-snapshot) to java 8 {pull}13314[#13314]

Network::
* Upgrade to Netty 4.1.5 {pull}20222[#20222] (issue: {issue}19786[#19786])
* Dependencies: Upgrade to netty 4.1.4 {pull}19689[#19689]
* Introduce Netty 4 {pull}19526[#19526] (issue: {issue}3226[#3226])

Packaging::
* Upgrade JNA to 4.2.2 and remove optionality {pull}19045[#19045] (issue: {issue}13245[#13245])

Plugin Discovery EC2::
* Update aws sdk to 1.10.69 and add use_throttle_retries repository setting {pull}17784[#17784] (issues: {issue}538[#538], {issue}586[#586], {issue}589[#589])

Scripting::
* Dependencies: Updates to mustache 0.9.3 {pull}20337[#20337]

Search Templates::
* Update mustache.java to version 0.9.1 {pull}14053[#14053] (issue: {issue}13224[#13224])

[[release-notes-5.0.0-GA]]
== {es} version 5.0.0 GA

The list below cover changes between 5.0.0-rc1 and 5.0.0 GA only.

//[float]
//[[breaking-5.0.0-GA]]
//=== Breaking Changes

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Circuit Breakers::
* Cluster Settings Updates should not trigger circuit breakers. {pull}20827[#20827]

Plugins::
* Revert "Display plugins versions" {pull}20807[#20807] (issues: {issue}18683[#18683], {issue}20668[#20668])

REST::
* Add a REST spec for the create API {pull}20924[#20924]

Settings::
* Add precise logging on unknown or invalid settings {pull}20951[#20951] (issue: {issue}20946[#20946])

[float]
=== Bug Fixes

Aggregations::
* Fixed writeable name from range to geo_distance {pull}20860[#20860]

Allocation::
* Keep a shadow replicas' allocation id when it is promoted to primary {pull}20863[#20863] (issue: {issue}20650[#20650])

Index APIs::
* Only negate index expression on all indices with preceding wildcard {pull}20898[#20898] (issues: {issue}19800[#19800], {issue}20033[#20033])

Internal::
* Prevent AbstractArrays from release bytes more than once {pull}20819[#20819]

Mapping::
* Allow position_gap_increment for fields in indices created prior to 5.0 {pull}20806[#20806] (issues: {issue}19510[#19510], {issue}20413[#20413])

Network::
* Fix connection close header handling {pull}20956[#20956] (issue: {issue}20938[#20938])
* Ensure port range is readable in the exception message {pull}20893[#20893]

Plugin Repository S3::
* Fixes leading forward slash in S3 repository base_path {pull}20861[#20861]

Query DSL::
* Fixes MultiMatchQuery so that it doesn't provide a null context {pull}20882[#20882]
* Fix match_phrase_prefix query with single term on _all field {pull}20471[#20471] (issue: {issue}20470[#20470])

Scripting::
* Add support for booleans in scripts {pull}20950[#20950] (issue: {issue}20949[#20949])

Search::
* Do not cache script queries. {pull}20799[#20799] (issue: {issue}20763[#20763])

[float]
=== Regressions

Highlighting::
* Handle SynonymQuery extraction for the FastVectorHighlighter {pull}20829[#20829] (issue: {issue}20781[#20781])

//[float]
//=== Known Issues

[[release-notes-5.0.0-rc1]]
== {es} version 5.0.0-rc1

IMPORTANT: This is a release candidate and is intended for _testing purposes only_ and should not be deployed in production.

[float]
[[breaking-5.0.0-rc1]]
=== Breaking Changes

Core::
* Remove ignore system bootstrap checks {pull}20511[#20511]

Internal::
* `_flush` should block by default {pull}20597[#20597] (issue: {issue}20569[#20569])

Plugin Lang Painless::
* Remove all date 'now' methods from Painless {pull}20766[#20766] (issue: {issue}20762[#20762])

//[float]
//=== Breaking Java Changes

//[float]
//=== Deprecations

//[float]
//=== New Features

[float]
=== Enhancements

Cluster::
* Skip shard management code when updating cluster state on client/tribe nodes {pull}20731[#20731]

Core::
* Add production warning for pre-release builds {pull}20674[#20674]

Index APIs::
* Add date-math support to `_rollover` {pull}20709[#20709]

Plugins::
* Provide error message when plugin id is missing {pull}20660[#20660]

REST::
* Add response params to REST params did you mean {pull}20753[#20753] (issues: {issue}20722[#20722], {issue}20747[#20747])
* Add did you mean to strict REST params {pull}20747[#20747] (issue: {issue}20722[#20722])

Tribe Node::
* Fail fast when executing master level write operations via a tribe node {pull}15441[#15441] (issue: {issue}13290[#13290])

[float]
=== Bug Fixes

Aggregations::
* Fix date_range aggregation to not cache if now is used {pull}20740[#20740]
* The `top_hits` aggregation should compile scripts only once. {pull}20738[#20738]

Allocation::
* IndicesClusterStateService should clean local started when re-assigns an initializing shard with the same aid {pull}20687[#20687]
* IndexRoutingTable.initializeEmpty shouldn't override supplied primary RecoverySource {pull}20638[#20638] (issue: {issue}20637[#20637])
* Update incoming recoveries stats when shadow replica is reinitialized {pull}20612[#20612]
* `index.routing.allocation.initial_recovery` limits replica allocation {pull}20589[#20589]

Analysis::
* Named analyzer should close the analyzer that it wraps {pull}20197[#20197]

Cache::
* Prevent requests that use scripts or now() from being cached {pull}20750[#20750] (issue: {issue}20645[#20645])

Core::
* StoreStatsCache should also ignore AccessDeniedException when checking file size {pull}20790[#20790] (issue: {issue}17580[#17580])

Ingest::
* no null values in ingest configuration error messages {pull}20616[#20616]
* JSON Processor was not properly added {pull}20613[#20613]

Internal::
* IndicesAliasesRequest should not implement CompositeIndicesRequest {pull}20726[#20726]

Logging::
* Fix logger when you can not create an azure storage client {pull}20670[#20670] (issues: {issue}20633[#20633], {issue}20669[#20669])

Plugin Lang Painless::
* Fix String Concatenation Bug In Painless {pull}20623[#20623]

REST::
* Change separator for shards preference {pull}20786[#20786] (issues: {issue}20722[#20722], {issue}20769[#20769])
* Remove lenient URL parameter parsing {pull}20722[#20722] (issue: {issue}14719[#14719])

Scripting::
* Native scripts should be created once per index, not per segment. {pull}20609[#20609]

Search::
* Make range queries round up upper bounds again. {pull}20582[#20582] (issues: {issue}20579[#20579], {issue}8889[#8889])

Settings::
* Fix Setting.timeValue() method {pull}20696[#20696] (issue: {issue}20662[#20662])
* Add a hard limit for `index.number_of_shard` {pull}20682[#20682]
* Include complex settings in settings requests {pull}20622[#20622]

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.0.0-beta1]]
== {es} version 5.0.0-beta1

IMPORTANT: This is a beta release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-beta1 to any other version is not supported.

[float]
[[breaking-5.0.0-beta1]]
=== Breaking Changes

Analysis::
* Remove `token_filter` in _analyze API {pull}20285[#20285] (issue: {issue}20283[#20283])
* Removes support for adding aliases to analyzers {pull}19994[#19994] (issue: {issue}18244[#18244])

CRUD::
* Fixed naming inconsistency for fields/stored_fields in the APIs {pull}20166[#20166] (issues: {issue}18943[#18943], {issue}20155[#20155])
* Disallow creating indices starting with '-' or '+' {pull}20033[#20033] (issue: {issue}19800[#19800])

Core::
* Remove minimum master nodes bootstrap check {pull}20082[#20082]

Engine::
* Optimize indexing for the autogenerated ID append-only case {pull}20211[#20211] (issue: {issue}19813[#19813])

Geo::
* Deprecate GeoDistance enums and remove geo distance script helpers {pull}19783[#19783]

Logging::
* Introduce Log4j 2 {pull}20235[#20235] (issues: {issue}16030[#16030], {issue}17697[#17697])

Packaging::
* Rename service.bat to elasticsearch-service.bat {pull}20496[#20496] (issue: {issue}17528[#17528])
* Remove -D handling in args for windows plugin script {pull}20378[#20378] (issue: {issue}18207[#18207])
* Set default min heap equal to default max heap {pull}20080[#20080] (issues: {issue}16334[#16334], {issue}17728[#17728], {issue}18311[#18311])

Plugin Lang Painless::
* Make Painless the Default Language {pull}20017[#20017] (issue: {issue}19960[#19960])

REST::
* Parameter improvements to Cluster Health API wait for shards {pull}20223[#20223] (issue: {issue}20216[#20216])
* Switch indices.exists_type from `{index}/{type}` to `{index}/_mapping/{type}`. {pull}20055[#20055] (issue: {issue}15613[#15613])
* Only use `PUT` for index creation, not POST. {pull}20001[#20001] (issues: {issue}15613[#15613], {issue}18160[#18160])

Scripting::
* Hardcode painless as the default scripting lang and add legacy script default for stored scripts {pull}20310[#20310] (issue: {issue}20122[#20122])

Settings::
* Default max local storage nodes to one {pull}19964[#19964] (issues: {issue}19679[#19679], {issue}19748[#19748])

[float]
=== Breaking Java Changes

Core::
* Remove ability to plug-in TransportService {pull}20505[#20505]

Internal::
* Remove TransportService#registerRequestHandler leniency {pull}20469[#20469] (issue: {issue}20468[#20468])
* Consolidate search parser registries {pull}20000[#20000]
* Move all FetchSubPhases to o.e.search.fetch.subphase {pull}19702[#19702]
* Squash the rest of o.e.rest.action {pull}19698[#19698]

Plugins::
* Cleanup sub fetch phase extension point {pull}20382[#20382]
* Remove IndexTemplateFilter {pull}20072[#20072]
* Switch custom ShardsAllocators to pull based model {pull}20071[#20071]
* Make custom allocation deciders use pull based extensions {pull}20040[#20040]

Search::
* Remove FetchSubPhaseParseElement {pull}20350[#20350]

[float]
=== Deprecations

Geo::
* Deprecate optimize_bbox on geodistance queries {pull}20032[#20032] (issue: {issue}20014[#20014])
* Deprecate geohash parameters for geo_point parser {pull}20030[#20030] (issue: {issue}20009[#20009])

Scripting::
* Deprecate Groovy, Python, and Javascript {pull}20244[#20244] (issue: {issue}20129[#20129])

[float]
=== New Features

Aliases::
* Add an alias action to delete an index {pull}20184[#20184] (issue: {issue}20064[#20064])

Analysis::
* Exposing lucene 6.x minhash filter. {pull}20206[#20206] (issue: {issue}20149[#20149])

Geo::
* Cut over geo_point field and queries to new LatLonPoint type {pull}20315[#20315] (issue: {issue}20314[#20314])

Plugin Discovery File::
* File-based discovery plugin {pull}20394[#20394] (issue: {issue}20323[#20323])

Search::
* Add the ability to disable the retrieval of the stored fields entirely {pull}20026[#20026]

Suggesters::
* Add support for returning documents with completion suggester {pull}19536[#19536] (issue: {issue}10746[#10746])

[float]
=== Enhancements

Allocation::
* Change DiskThresholdDecider's behavior when factoring in leaving shards {pull}20349[#20349]
* Verify AllocationIDs in replication actions {pull}20320[#20320]
* Mark shard as stale on non-replicated write, not on node shutdown {pull}20023[#20023] (issue: {issue}18919[#18919])
* Add routing changes API to RoutingAllocation {pull}19992[#19992]
* Primary shard allocator observes limits in forcing allocation {pull}19811[#19811] (issue: {issue}19446[#19446])
* Use primary terms as authority to fail shards {pull}19715[#19715]
* Add recovery source to ShardRouting {pull}19516[#19516]

Analysis::
* Stop using cached component in _analyze API {pull}19929[#19929] (issue: {issue}19827[#19827])

Benchmark::
* Add client-benchmark-noop-api-plugin to stress clients even more in benchmarks {pull}20103[#20103]

CAT API::
* Add health status parameter to cat indices API {pull}20393[#20393]

Circuit Breakers::
* Circuit break the number of inline scripts compiled per minute {pull}19694[#19694] (issue: {issue}19396[#19396])

Cluster::
* Add clusterUUID to RestMainAction output {pull}20503[#20503]

Core::
* Add serial collector bootstrap check {pull}20558[#20558]
* Rename Netty TCP transports thread factories from http_* to transport_* {pull}20207[#20207]
* Do not log full bootstrap checks exception {pull}19989[#19989]
* Mark halting the virtual machine as privileged {pull}19923[#19923] (issues: {issue}19272[#19272], {issue}19806[#19806])

Engine::
* Only try to read new segments info if we really flushed the index {pull}20474[#20474]
* Use _refresh instead of reading from Translog in the RT GET case {pull}20102[#20102]

Exceptions::
* Improve startup exception {pull}20083[#20083]

Index Templates::
* Add "version" field to Templates {pull}20353[#20353] (issue: {issue}20171[#20171])

Ingest::
* Add "version" field to Pipelines {pull}20343[#20343] (issue: {issue}20171[#20171])
* Make it possible for Ingest Processors to access AnalysisRegistry {pull}20233[#20233]
* add ignore_missing option to convert,trim,lowercase,uppercase,grok,rename {pull}20194[#20194] (issue: {issue}19995[#19995])
* Add support for parameters to the script ingest processor {pull}20136[#20136]
* introduce the JSON Processor {pull}20128[#20128] (issue: {issue}20052[#20052])
* Allow rename processor to turn leaf fields into branch fields {pull}20053[#20053] (issue: {issue}19892[#19892])
* remove ability to set field value in script-processor configuration {pull}19981[#19981]

Internal::
* Remove poor-mans compression in InternalSearchHit and friends {pull}20472[#20472]
* Don't register SearchTransportService handlers more than once {pull}20468[#20468]
* Unguice SearchModule {pull}20456[#20456]
* Deguice SearchService and friends {pull}20423[#20423]
* NodeStats classes to implement Writeable rather then Streamable {pull}20327[#20327]
* More info classes to implement Writeable rather than Streamable {pull}20288[#20288] (issue: {issue}20255[#20255])
* Internal: Split disk threshold monitoring from decider {pull}20018[#20018]
* Switching LockObtainFailedException over to ShardLockObtainFailedException {pull}19991[#19991] (issue: {issue}19978[#19978])
* update and delete by query requests to implement IndicesRequest.Replaceable {pull}19961[#19961]
* VersionFetchSubPhase should not use Versions#loadDocIdAndVersion {pull}19944[#19944]

Java API::
* Ensure PutMappingRequest.buildFromSimplifiedDef input are pairs {pull}19837[#19837] (issue: {issue}19836[#19836])

Java REST Client::
* Add support for a RestClient path prefix {pull}20190[#20190]
* Add "Async" to the end of each Async RestClient method {pull}20172[#20172] (issue: {issue}20168[#20168])
* Allow RestClient to send array-based headers {pull}20151[#20151]

Logging::
* Ensure logging is initialized in CLI tools {pull}20575[#20575]
* Give useful error message if log config is missing {pull}20493[#20493]
* Complete Elasticsearch logger names {pull}20457[#20457] (issue: {issue}20326[#20326])
* Add node name to decider trace logging  {pull}20437[#20437] (issue: {issue}20379[#20379])
* Logging shutdown hack {pull}20389[#20389] (issue: {issue}20304[#20304])
* Disable console logging {pull}20387[#20387]
* Skip loading of jansi from log4j2 {pull}20334[#20334]
* Configure AWS SDK logging configuration {pull}20313[#20313] (issue: {issue}20294[#20294])
* Warn if unsupported logging configuration present {pull}20309[#20309]
* Size limit deprecation logs {pull}20287[#20287] (issues: {issue}20235[#20235], {issue}20254[#20254])
* Increase visibility of deprecation logger {pull}20254[#20254] (issue: {issue}11033[#11033])
* Add shardId and node name in search slow log {pull}19949[#19949] (issue: {issue}19735[#19735])

Mapping::
* Automatically downgrade text and keyword to string on indexes imported from 2.x {pull}20177[#20177]
* Do not parse numbers as both strings and numbers when not included in `_all`. {pull}20167[#20167]
* Don't index the `_version` field {pull}20132[#20132]
* The root object mapper should support updating `numeric_detection`, `date_detection` and `dynamic_date_formats`. {pull}20119[#20119] (issue: {issue}20111[#20111])
* Automatically upgrade analyzed string fields that have `index_options` or `position_increment_gap` set. {pull}20002[#20002] (issue: {issue}19974[#19974])
* Mappings: Support dots in field names in mapping parsing {pull}19899[#19899] (issue: {issue}19443[#19443])
* Save one utf8 conversion in KeywordFieldMapper. {pull}19867[#19867]
* Do not parse the created version from the settings every time a field is parsed. {pull}19824[#19824]

Network::
* Avoid early initializing Netty {pull}19819[#19819] (issue: {issue}5644[#5644])
* Network: Allow to listen on virtual interfaces. {pull}19568[#19568] (issues: {issue}17473[#17473], {issue}19537[#19537])

Packaging::
* Add quiet option to disable console logging {pull}20422[#20422] (issues: {issue}15315[#15315], {issue}16159[#16159], {issue}17220[#17220])
* Explicitly disable Netty key set replacement {pull}20249[#20249]

Plugin Lang Painless::
* Disable regexes by default in painless {pull}20427[#20427] (issue: {issue}20397[#20397])
* Catch OutOfMemory and StackOverflow errors in Painless {pull}19936[#19936]

Plugin Repository S3::
* Extract AWS Key from KeyChain instead of using potential null value {pull}19560[#19560] (issues: {issue}18703[#18703], {issue}19557[#19557])

Plugins::
* Print message when removing plugin with config {pull}20338[#20338]
* Plugins: Update official plugin location with unified release {pull}19996[#19996]
* Allow plugins to upgrade global custom metadata on startup {pull}19962[#19962]
* Switch aggregations from push to pull {pull}19839[#19839]
* Display plugins versions {pull}18683[#18683]

Query DSL::
* Throw exception when multiple field names are provided as part of query short syntax {pull}19871[#19871] (issue: {issue}19791[#19791])
* Query parsers to throw exception when multiple field names are provided {pull}19791[#19791] (issue: {issue}19547[#19547])

REST::
* Add exclusion support to response filtering {pull}19865[#19865]

Recovery::
* Pass on maxUnsafeAutoIdTimestamp on recovery / relocation {pull}20300[#20300]

Scripting::
* Parse script on storage instead of on retrieval {pull}20356[#20356]
* Migrate elasticsearch native script examples to the main repo {pull}19334[#19334] (issue: {issue}14662[#14662])

Settings::
* Make `action.auto_create_index` setting a dynamic cluster setting {pull}20274[#20274] (issue: {issue}7513[#7513])
* Removes space between # and the setting in elasticsearch.yml {pull}20094[#20094] (issue: {issue}20090[#20090])

Snapshot/Restore::
* Delete differing files in the store before restoring {pull}20220[#20220] (issue: {issue}20148[#20148])
* Adds ignoreUnavailable option to the snapshot status API {pull}20066[#20066] (issue: {issue}18522[#18522])
* Check restores in progress before deleting a snapshot {pull}19853[#19853]
* Snapshot repository cleans up empty index folders {pull}19751[#19751]

Stats::
* Add mem section back to cluster stats {pull}20255[#20255] (issue: {issue}17278[#17278])
* Add network types to cluster stats {pull}20144[#20144]

Suggesters::
* Move SuggestUtils methods to their respective caller classes {pull}19914[#19914] (issue: {issue}19906[#19906])
* Remove payload option from completion suggester {pull}19877[#19877] (issue: {issue}19536[#19536])

Task Manager::
* Rename Task Persistence into Storing Task Results {pull}19982[#19982]

Translog::
* Fsync documents in an async fashion {pull}20145[#20145]
* Add checksumming and versions to the Translog's Checkpoint files {pull}19797[#19797]

[float]
=== Bug Fixes

Aggregations::
* Fix agg profiling when using breadth_first collect mode {pull}20156[#20156]
* Throw exception when maxBounds greater than minBounds {pull}19855[#19855] (issue: {issue}19833[#19833])

Allocation::
* Upon being elected as master, prefer joins' node info to existing cluster state {pull}19743[#19743]

Analysis::
* Can load non-PreBuiltTokenFilter in Analyze API {pull}20396[#20396]

CRUD::
* GET operations should not extract fields from `_source`. {pull}20158[#20158] (issues: {issue}15017[#15017], {issue}20102[#20102])

Cache::
* Serialize index boost and phrase suggest collation keys in a consistent order {pull}20081[#20081] (issue: {issue}19986[#19986])

Cluster::
* Fixes issue with dangling index being deleted instead of re-imported {pull}19666[#19666]

Discovery::
* Update discovery nodes after cluster state is published {pull}20409[#20409]
* Add current cluster state version to zen pings and use them in master election {pull}20384[#20384] (issue: {issue}20348[#20348])

Engine::
* Take refresh IOExceptions into account when catching ACE in InternalEngine {pull}20546[#20546] (issue: {issue}19975[#19975])
* Don't suppress AlreadyClosedException {pull}19975[#19975] (issue: {issue}19861[#19861])

Highlighting::
* Fix highlighting of MultiTermQuery within a FunctionScoreQuery {pull}20400[#20400] (issue: {issue}20392[#20392])
* Enable BoostingQuery with FVH highlighter {pull}19984[#19984] (issue: {issue}19985[#19985])

Index APIs::
* Fix IndexNotFoundException in multi index search request. {pull}20188[#20188] (issue: {issue}3839[#3839])

Ingest::
* Don't rebuild pipeline on every cluster state update {pull}20189[#20189]
* Add dotexpander processor {pull}20078[#20078]

Internal::
* Ensure elasticsearch doesn't start with unuspported indices {pull}20514[#20514] (issue: {issue}20512[#20512])
* Remove ListTasksResponse#setDiscoveryNodes() {pull}19773[#19773] (issue: {issue}19772[#19772])

Java API::
* fix IndexResponse#toString to print out shards info {pull}20562[#20562]
* Add NamedWriteables from plugins to TransportClient {pull}19825[#19825] (issue: {issue}19764[#19764])

Logging::
* Avoid unnecessary creation of prefix loggers {pull}20571[#20571] (issue: {issue}20570[#20570])
* Fix logging hierarchy configs {pull}20463[#20463]
* Fix prefix logging {pull}20429[#20429]
* Hack around Log4j bug rendering exceptions {pull}20306[#20306] (issue: {issue}20304[#20304])
* Avoid prematurely triggering logger initialization {pull}20170[#20170]

Mapping::
* Mapping updates on objects should propagate `include_an_all`. {pull}20051[#20051]
* Validate blank field name {pull}19860[#19860] (issue: {issue}19251[#19251])

Network::
* Fix expect 100 continue header handling {pull}19904[#19904] (issue: {issue}19834[#19834])
* Fixes netty4 module's CORS config to use defaults  {pull}19874[#19874]
* Fix various concurrency issues in transport {pull}19675[#19675]

Packaging::
* [Packaging] Do not remove scripts directory on upgrade {pull}20452[#20452]
* [Package] Remove bin/lib/modules directories on RPM uninstall/upgrade {pull}20448[#20448]
* RESTART_ON_UPGRADE incorrectly named ES_RESTART_ON_UPGRADE in sysconfig {pull}19976[#19976] (issue: {issue}19950[#19950])
* Fix handling of spaces for jvm.options on Windows {pull}19951[#19951] (issue: {issue}19941[#19941])

Percolator::
* Fail indexing percolator queries containing either a has_child or has_parent query {pull}20229[#20229] (issue: {issue}2960[#2960])

Plugin Ingest Attachment::
* Adds content-length as number {pull}19927[#19927] (issue: {issue}19924[#19924])

Plugin Ingest GeoIp::
* [ingest-geoip] update geoip to not include null-valued results from  {pull}20455[#20455]

Plugin Lang Painless::
* Fix break bug in for/foreach loops. {pull}20146[#20146]

Plugins::
* Use sysprop like with es.path.home to pass conf dir {pull}18870[#18870] (issue: {issue}18689[#18689])

Query DSL::
* Fix silently accepting malformed queries {pull}20515[#20515] (issue: {issue}20500[#20500])
* query_string_query should take term length into consideration when fuzziness is auto {pull}20299[#20299] (issue: {issue}15972[#15972])

Recovery::
* Fix concurrency issues between cancelling a relocation and marking shard as relocated {pull}20443[#20443]

Reindex API::
* Fix reindex with transport client {pull}19997[#19997] (issues: {issue}19773[#19773], {issue}19979[#19979])
* Make reindex and lang-javascript compatible {pull}19933[#19933]

Scripting::
* Fix Javascript OOM build Failure {pull}20307[#20307]
* Fix propagating the default value for script settings {pull}20183[#20183] (issue: {issue}20159[#20159])
* Catch and wrap AssertionError and NoClassDefFoundError in groovy scripts {pull}19958[#19958] (issues: {issue}19806[#19806], {issue}19923[#19923])

Search::
* Throw error when trying to fetch fields from source and source is disabled {pull}20424[#20424] (issues: {issue}20093[#20093], {issue}20408[#20408])
* Source filtering should keep working when the source contains numbers greater than `Long.MAX_VALUE`. {pull}20278[#20278] (issue: {issue}11508[#11508])
* Fix NPE when running a range query on a `scaled_float` with no upper bound. {pull}20253[#20253]
* Add ref-counting to SearchContext to prevent accessing already closed readers {pull}20095[#20095] (issue: {issue}20008[#20008])
* Fix NPE during search with source filtering if the source is disabled. {pull}20093[#20093] (issue: {issue}7758[#7758])
* Restore assignment of time value when deserializing a scroll instance {pull}19977[#19977] (issue: {issue}18820[#18820])
* Fix explain output for dfs query {pull}19972[#19972] (issue: {issue}15369[#15369])

Settings::
* Validate max thread/merge settings {pull}20383[#20383] (issue: {issue}20380[#20380])
* Fix filter cache setting to allow percentages {pull}20335[#20335] (issue: {issue}20330[#20330])
* Move cluster.routing.allocation.same_shard.host setting to new settings infrastructure {pull}20046[#20046] (issue: {issue}20045[#20045])

Stats::
* Fix FieldStats deserialization of `ip` field {pull}20522[#20522] (issue: {issue}20516[#20516])

Translog::
* Fix RAM usage estimation of LiveVersionMap. {pull}20123[#20123] (issue: {issue}19787[#19787])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.2.0 {pull}20147[#20147] (issue: {issue}20092[#20092])
* Update to jackson 2.8.1 {pull}18939[#18939] (issue: {issue}18076[#18076])

Network::
* Upgrade to Netty 4.1.5 {pull}20222[#20222] (issue: {issue}19786[#19786])

Scripting::
* Dependencies: Updates to mustache 0.9.3 {pull}20337[#20337]

[[release-notes-5.0.0-alpha5]]
== {es} version 5.0.0-alpha5

IMPORTANT: This is an alpha release and is intended for _testing purposes only_. 
Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. 
Upgrading 5.0.0-alpha5 to any other version is not supported.

[IMPORTANT]
.Known networking bug in 5.0.0-alpha5
======================================================

There is a major bug in the new Netty4 implementation in this release which
affects any REST requests greater than 1024 bytes in size, and which will
generate an exception similar to the following:

[source,txt]
----
[WARN ][http.netty4] [wtOV9Vb] caught exception while handling client http traffic, closing connection [id: 0x1320b717, L:/0:0:0:0:0:0:0:1:9200 - R:/0:0:0:0:0:0:0:1:54732]
java.lang.UnsupportedOperationException: unsupported message type: DefaultFullHttpResponse (expected: ByteBuf, FileRegion)
----

This is due to incorrect handling of the `Expect` HTTP header, and it can be
worked around in one of three ways:

* Use a client which does not add `Expect` headers (including the official clients).

* Pass a blank `Except` header, e.g.
+
[source,sh]
----
curl -H 'Expect:' ...
----

* Use Netty3 for the HTTP layer by passing the following setting at startup:
+
[source,sh]
----
./bin/elasticsearch -Ehttp.type=netty3
----

======================================================

[float]
[[breaking-5.0.0-alpha5]]
=== Breaking Changes

CAT API::
* Improve cat thread pool API {pull}19721[#19721] (issue: {issue}19590[#19590])

Cluster::
* Persistent Node Ids {pull}19140[#19140] (issue: {issue}17811[#17811])

Core::
* Keep input time unit when parsing TimeValues {pull}19102[#19102]

Exceptions::
* Die with dignity {pull}19272[#19272] (issue: {issue}19231[#19231])

Index APIs::
* Removes write consistency level across replication action APIs in favor of wait_for_active_shards {pull}19454[#19454] (issue: {issue}18985[#18985])

Scripting::
* Remove deprecated 1.x script and template syntax {pull}19387[#19387] (issue: {issue}13729[#13729])

Search::
* Rename `fields` to `stored_fields` and add `docvalue_fields` {pull}18992[#18992] (issue: {issue}18943[#18943])

Settings::
* Persistent Node Names {pull}19456[#19456] (issue: {issue}19140[#19140])
* Remove support for properties {pull}19398[#19398] (issues: {issue}19388[#19388], {issue}19391[#19391])

[float]
=== Breaking Java Changes

CRUD::
* Removing isCreated and isFound from the Java API {pull}19645[#19645] (issues: {issue}19566[#19566], {issue}19631[#19631])

Internal::
* Clean up BytesReference {pull}19196[#19196]

Java API::
* Add a dedicated client/transport project for transport-client {pull}19435[#19435] (issue: {issue}19412[#19412])

Network::
* Factor out abstract TCPTransport* classes to reduce the netty footprint {pull}19096[#19096]

Plugins::
* Migrate query registration from push to pull {pull}19376[#19376]
* Add components getter as bridge between guice and new plugin init world {pull}19371[#19371]
* Remove CustomNodeAttributes extension point {pull}19348[#19348]
* Add RepositoryPlugin interface for registering snapshot repositories {pull}19324[#19324]
* Simplified repository api for snapshot/restore {pull}19292[#19292]
* Switch most search extensions from push to pull {pull}19238[#19238]
* Move RestHandler registration to ActionModule and ActionPlugin {pull}19165[#19165]
* Pull actions from plugins {pull}19108[#19108]
* Switch analysis from push to pull {pull}19073[#19073]
* Remove guice from Mapper plugins {pull}19018[#19018]

Scripting::
* Remove o.e.script.Template class and move template query to lang-mustache module {pull}19425[#19425] (issue: {issue}16314[#16314])

Settings::
* Remove `node.mode` and `node.local` settings {pull}19428[#19428]

Snapshot/Restore::
* Removes extra writeBlob method in BlobContainer {pull}19727[#19727] (issue: {issue}18528[#18528])

[float]
=== Deprecations

CRUD::
* Deprecate found and created in delete and index rest responses {pull}19633[#19633]

Plugin Discovery Azure Classic::
* Deprecate discovery-azure and rename it to discovery-azure-classic {pull}19186[#19186] (issue: {issue}19144[#19144])

Templates::
* Deprecate template query {pull}19607[#19607] (issue: {issue}19390[#19390])

[float]
=== New Features

Aggregations::
* Split regular histograms from date histograms. {pull}19551[#19551] (issues: {issue}4847[#4847], {issue}8082[#8082])

Circuit Breakers::
* Circuit break on aggregation bucket numbers with request breaker {pull}19394[#19394] (issue: {issue}14046[#14046])

Ingest::
* ingest-useragent plugin {pull}19074[#19074]

Java REST Client::
* Introduce async performRequest method {pull}19400[#19400]

Mapping::
* Add `scaled_float`. {pull}19264[#19264] (issues: {issue}15939[#15939], {issue}1941[#1941])

Plugin Repository S3::
* Add support for path_style_access {pull}15114[#15114]

Reindex API::
* Reindex from remote {pull}18585[#18585] (issue: {issue}17447[#17447])

Translog::
* Add `elasticsearch-translog` CLI tool with `truncate` command {pull}19342[#19342] (issue: {issue}19123[#19123])

[float]
=== Enhancements

Aggregations::
* Make the heuristic to compute the default shard size less aggressive. {pull}19659[#19659]
* Add _bucket_count option to buckets_path {pull}19571[#19571] (issue: {issue}19553[#19553])
* Remove AggregationStreams {pull}19507[#19507]
* Migrate serial_diff aggregation to NamedWriteable {pull}19483[#19483]
* Migrate most remaining pipeline aggregations to NamedWriteable {pull}19480[#19480]
* Migrate moving_avg pipeline aggregation to NamedWriteable {pull}19420[#19420]
* Migrate matrix_stats to NamedWriteable {pull}19418[#19418]
* Migrate derivative pipeline aggregation to NamedWriteable {pull}19407[#19407]
* Migrate top_hits, histogram, and ip_range aggregations to NamedWriteable {pull}19375[#19375]
* Migrate nested, reverse_nested, and children aggregations to NamedWriteable {pull}19374[#19374]
* Migrate geohash_grid and geo_bounds aggregations to NamedWriteable {pull}19372[#19372]
* Clean up significant terms aggregation results {pull}19365[#19365]
* Migrate range, date_range, and geo_distance aggregations to NamedWriteable {pull}19321[#19321]
* Migrate terms aggregation to NamedWriteable {pull}19277[#19277]
* Migrate sampler and missing aggregations to NamedWriteable {pull}19259[#19259]
* Migrate global, filter, and filters aggregation to NamedWriteable {pull}19220[#19220]
* Migrate the cardinality, scripted_metric, and geo_centroid aggregations to NamedWriteable {pull}19219[#19219]
* Use a static default precision for the cardinality aggregation. {pull}19215[#19215]
* Migrate more aggregations to NamedWriteable {pull}19199[#19199]
* Migrate stats and extended stats to NamedWriteable {pull}19198[#19198]
* Migrate sum, min, and max aggregations over to NamedWriteable {pull}19194[#19194]
* Start migration away from aggregation streams {pull}19097[#19097]

Analysis::
* Specify custom char_filters/tokenizer/token_filters in the analyze API {pull}15671[#15671] (issue: {issue}8878[#8878])

CAT API::
* Includes the index UUID in the _cat/indices API {pull}19204[#19204] (issue: {issue}19132[#19132])

CRUD::
* #19664 Renaming operation to result and reworking responses  {pull}19704[#19704] (issue: {issue}19664[#19664])
* Adding _operation field to index, update, delete response. {pull}19566[#19566] (issues: {issue}19267[#19267], {issue}9642[#9642], {issue}9736[#9736])

Cache::
* Enable option to use request cache for size > 0 {pull}19472[#19472]

Cluster::
* Batch process node left and node failure {pull}19289[#19289] (issue: {issue}19282[#19282])
* Index creation waits for write consistency shards {pull}18985[#18985]
* Inline reroute with process of node join/master election {pull}18938[#18938] (issue: {issue}17270[#17270])

Core::
* Makes index creation more friendly {pull}19450[#19450] (issue: {issue}9126[#9126])
* Clearer error when handling fractional time values {pull}19158[#19158] (issue: {issue}19102[#19102])

Discovery::
* Do not log cluster service errors at after joining a master {pull}19705[#19705]

Exceptions::
* Make NotMasterException a first class citizen {pull}19385[#19385]
* Do not catch throwable {pull}19231[#19231]

Geo::
* GeoBoundingBoxQueryBuilder should throw IAE when topLeft and bottomRight are the same coordinate {pull}18668[#18668] (issues: {issue}18458[#18458], {issue}18631[#18631])

Ingest::
* Add REST _ingest/pipeline to get all pipelines {pull}19603[#19603] (issue: {issue}19585[#19585])
* Show ignored errors in verbose simulate result {pull}19404[#19404] (issue: {issue}19319[#19319])
* update foreach processor to only support one applied processor. {pull}19402[#19402] (issue: {issue}19345[#19345])
* Skip the execution of an empty pipeline {pull}19200[#19200] (issue: {issue}19192[#19192])

Internal::
* Make Priority an enum {pull}19448[#19448]
* Snapshot UUIDs in blob names {pull}19421[#19421] (issues: {issue}18156[#18156], {issue}18815[#18815], {issue}19002[#19002], {issue}7540[#7540])
* Add RestController method for deprecating in one step {pull}19343[#19343]
* Tighten ensure atomic move cleanup {pull}19309[#19309] (issue: {issue}19036[#19036])
* Enable checkstyle ModifierOrder {pull}19214[#19214]
* Expose task information from NodeClient {pull}19189[#19189]
* Changed rest handler interface to take NodeClient {pull}19170[#19170]
* Deprecate ExceptionsHelper.detailedMessage {pull}19160[#19160] (issue: {issue}19069[#19069])
* Factor out ChannelBuffer from BytesReference {pull}19129[#19129]
* Cleanup Compressor interface {pull}19125[#19125]
* Require executor name when calling scheduleWithFixedDelay {pull}17538[#17538]

Java API::
* Start from a random node number so that clients do not overload the first node configured {pull}14143[#14143]

Java REST Client::
* Add response body to ResponseException error message {pull}19653[#19653] (issue: {issue}19653[#19653])
* Simplify Sniffer initialization and automatically create the default HostsSniffer {pull}19599[#19599]
* Remove duplicate dependency declaration for http client {pull}19580[#19580] (issue: {issue}19281[#19281])
* Add callback to customize http client settings {pull}19373[#19373]
* Rest Client: add short performRequest method variants without params and/or body {pull}19340[#19340] (issue: {issue}19312[#19312])

Logging::
* Add log message about enforcing bootstrap checks {pull}19451[#19451]
* Improve logging for batched cluster state updates {pull}19255[#19255]
* Send HTTP Warning Header(s) for any Deprecation Usage from a REST request {pull}17804[#17804] (issue: {issue}17687[#17687])

Mapping::
* Elasticsearch should reject dynamic templates with unknown `match_mapping_type`. {pull}17285[#17285] (issue: {issue}16945[#16945])

Network::
* Explicitly tell Netty to not use unsafe {pull}19786[#19786] (issues: {issue}19562[#19562], {issue}5624[#5624])
* Enable Netty 4 extensions {pull}19767[#19767] (issue: {issue}19526[#19526])
* Modularize netty {pull}19392[#19392]
* Simplify TcpTransport interface by reducing send code to a single send method {pull}19223[#19223]

Percolator::
* Also support query term extract for queries wrapped inside a FunctionScoreQuery {pull}19184[#19184]
* Add support for synonym query to percolator query term extraction {pull}19066[#19066]

Plugin Discovery EC2::
* Use `DefaultAWSCredentialsProviderChain` AWS SDK class for credentials {pull}19561[#19561] (issue: {issue}19556[#19556])
* Support new Asia Pacific (Mumbai) ap-south-1 AWS region {pull}19112[#19112] (issue: {issue}19110[#19110])

Plugin Discovery GCE::
* Allow `_gce_` network when not using discovery gce {pull}15765[#15765] (issue: {issue}15724[#15724])

Plugin Lang Painless::
* Change Painless Tree Structure for Variable/Method Chains {pull}19459[#19459]
* Add replaceAll and replaceFirst {pull}19070[#19070]

Plugin Mapper Size::
* Add doc values support to the _size field in the mapper-size plugin {pull}19217[#19217] (issue: {issue}18334[#18334])

Plugins::
* Add ScriptService to dependencies available for plugin components {pull}19770[#19770]
* Log one plugin info per line {pull}19441[#19441]
* Make rest headers registration pull based {pull}19440[#19440]
* Add resource watcher to services available for plugin components {pull}19401[#19401]
* Add some basic services to createComponents for plugins {pull}19380[#19380]
* Make plugins closeable {pull}19137[#19137]
* Plugins: Add status bar on download {pull}18695[#18695]

Query DSL::
* Allow empty json object in request body in `_count` API {pull}19595[#19595] (issue: {issue}19422[#19422])

REST::
* Add Location header to the index, update, and create APIs {pull}19509[#19509] (issue: {issue}19079[#19079])
* Add support for `wait_for_events` to the `_cluster/health` REST endpoint {pull}19432[#19432] (issue: {issue}19419[#19419])
* Rename Search Template REST spec names {pull}19178[#19178]

Recovery::
* Non-blocking primary relocation hand-off {pull}19013[#19013] (issues: {issue}15900[#15900], {issue}18553[#18553])

Reindex API::
* Only ask for `_version` we need it {pull}19693[#19693] (issue: {issue}19135[#19135])
* Use fewer threads when reindexing-from-remote {pull}19636[#19636]
* Support authentication with reindex-from-remote {pull}19310[#19310]
* Support requests_per_second=-1 to mean no throttling in reindex {pull}19101[#19101] (issue: {issue}19089[#19089])

Scripting::
* Remove ClusterState from compile api {pull}19136[#19136]
* Mustache: Render Map as JSON {pull}18856[#18856] (issue: {issue}18970[#18970])

Search::
* Limit batch size when scrolling {pull}19367[#19367] (issue: {issue}19249[#19249])
* Record method counts while profiling query components {pull}18302[#18302]

Settings::
* Validates new dynamic settings from the current state {pull}19122[#19122] (issue: {issue}19046[#19046])

Snapshot/Restore::
* BlobContainer#writeBlob no longer can overwrite a blob {pull}19749[#19749] (issue: {issue}15579[#15579])
* More resilient blob handling in snapshot repositories {pull}19706[#19706] (issues: {issue}18156[#18156], {issue}18815[#18815], {issue}19421[#19421], {issue}7540[#7540])
* Adding repository index generational files {pull}19002[#19002] (issue: {issue}18156[#18156])
* Raised IOException on deleteBlob {pull}18815[#18815] (issue: {issue}18530[#18530])

Stats::
* Add missing field type in the FieldStats response. {pull}19241[#19241] (issue: {issue}17750[#17750])
* Expose the ClusterInfo object in the allocation explain output {pull}19106[#19106] (issue: {issue}14405[#14405])

[float]
=== Bug Fixes

Aggregations::
* Undeprecates `aggs` in the search request {pull}19674[#19674] (issue: {issue}19504[#19504])
* Change how `nested` and `reverse_nested` aggs know about their nested depth level {pull}19550[#19550] (issues: {issue}11749[#11749], {issue}12410[#12410])
* Make ExtendedBounds immutable {pull}19490[#19490] (issue: {issue}19481[#19481])
* Fix potential AssertionError with include/exclude on terms aggregations. {pull}19252[#19252] (issue: {issue}18575[#18575])
* Pass resolved extended bounds to unmapped histogram aggregator {pull}19085[#19085] (issue: {issue}19009[#19009])
* Fix "key_as_string" for date histogram and epoch_millis/epoch_second format with time zone {pull}19043[#19043] (issue: {issue}19038[#19038])

Allocation::
* Fix NPE when initializing replica shard has no UnassignedInfo {pull}19491[#19491] (issue: {issue}19488[#19488])
* Make shard store fetch less dependent on the current cluster state, both on master and non data nodes {pull}19044[#19044] (issue: {issue}18938[#18938])

Analysis::
* Fix analyzer alias processing {pull}19506[#19506] (issue: {issue}19163[#19163])

CAT API::
* Fixes cat tasks operation in detailed mode {pull}19759[#19759] (issue: {issue}19755[#19755])
* Add index pattern wildcards support to _cat/shards {pull}19655[#19655] (issue: {issue}19634[#19634])

Cluster::
* Allow routing table to be filtered by index pattern {pull}19688[#19688]
* Use executor's describeTasks method to log task information in cluster service {pull}19531[#19531]

Core::
* Makes `m` case sensitive in TimeValue {pull}19649[#19649] (issue: {issue}19619[#19619])
* Guard against negative result from FileStore.getUsableSpace when picking data path for a new shard {pull}19554[#19554]
* Handle rejected execution exception on reschedule {pull}19505[#19505]

Dates::
* Make sure TimeIntervalRounding is monotonic for increasing dates {pull}19020[#19020]

Geo::
* Incomplete results when using geo_distance for large distances {pull}17578[#17578]

Highlighting::
* Plain highlighter should ignore parent/child queries {pull}19616[#19616] (issue: {issue}14999[#14999])
* Let fast vector highlighter also extract terms from the nested query's inner query. {pull}19337[#19337] (issue: {issue}19265[#19265])

Index APIs::
* Fixes active shard count check in the case of `all` shards {pull}19760[#19760]
* Add zero-padding to auto-generated rollover index name increment {pull}19610[#19610] (issue: {issue}19484[#19484])

Ingest::
* Fix NPE when simulating a pipeline with no id {pull}19650[#19650]
* Change foreach processor to use ingest metadata for array element {pull}19609[#19609] (issue: {issue}19592[#19592])
* No other processors should be executed after on_failure is called {pull}19545[#19545]
* rethrow script compilation exceptions into ingest configuration exceptions {pull}19318[#19318]
* Rename from `ingest-useragent` plugin to `ingest-user-agent` and its processor from `useragent` to `user_agent` {pull}19261[#19261]

Inner Hits::
* Ensure that that InnerHitBuilder uses rewritten queries {pull}19360[#19360] (issue: {issue}19353[#19353])

Internal::
* Priority values should be unmodifiable {pull}19447[#19447]
* Extract AbstractBytesReferenceTestCase {pull}19141[#19141]

Java REST Client::
* Rest Client: add slash to log line when missing between host and uri {pull}19325[#19325] (issue: {issue}19314[#19314])
* Rest Client: HostsSniffer to set http as default scheme {pull}19306[#19306]

Logging::
* Only log running out of slots when out of slots {pull}19637[#19637]

Mapping::
* Mappings: Fix detection of metadata fields in documents {pull}19765[#19765]
* Fix not_analyzed string fields to error when position_increment_gap is set {pull}19510[#19510]
* Automatically created indices should honor `index.mapper.dynamic`. {pull}19478[#19478] (issue: {issue}17592[#17592])

Network::
* Verify lower level transport exceptions don't bubble up on disconnects {pull}19518[#19518] (issue: {issue}19096[#19096])

Packaging::
* Disable service in pre-uninstall {pull}19328[#19328]

Parent/Child::
*  Make sure that no `_parent#null` gets introduces as default _parent mapping {pull}19470[#19470] (issue: {issue}19389[#19389])

Plugin Discovery Azure Classic::
* Make discovery-azure plugin work again {pull}19062[#19062] (issues: {issue}15630[#15630], {issue}18637[#18637])

Plugin Discovery EC2::
* Fix EC2 discovery settings {pull}18690[#18690] (issues: {issue}18652[#18652], {issue}18662[#18662])

Plugin Discovery GCE::
* Fix NPE when GCE region is empty {pull}19176[#19176] (issue: {issue}16967[#16967])

Plugin Repository Azure::
* Register group setting for repository-azure accounts {pull}19086[#19086]

Plugin Repository S3::
* Add missing permission to repository-s3 {pull}19128[#19128] (issues: {issue}18539[#18539], {issue}19121[#19121])
* Fix repository S3 Settings and add more tests {pull}18703[#18703] (issues: {issue}18662[#18662], {issue}18690[#18690])

Query DSL::
* Throw ParsingException if a query is wrapped in an array {pull}19750[#19750] (issue: {issue}12887[#12887])
* Restore parameter name auto_generate_phrase_queries {pull}19514[#19514] (issue: {issue}19512[#19512])

REST::
* Fixes CORS handling so that it uses the defaults {pull}19522[#19522] (issue: {issue}19520[#19520])

Recovery::
* Move `reset recovery` into RecoveriesCollection {pull}19466[#19466] (issue: {issue}19473[#19473])
* Fix replica-primary inconsistencies when indexing during primary relocation with ongoing replica recoveries {pull}19287[#19287] (issue: {issue}19248[#19248])

Search::
* Don't recursively count children profile timings {pull}19397[#19397] (issue: {issue}18693[#18693])
* fix explain in function_score if no function filter matches {pull}19185[#19185]
* Fix NPEs due to disabled source {pull}18957[#18957]

Settings::
* Validate settings against dynamic updaters on the master {pull}19088[#19088] (issue: {issue}19046[#19046])

Stats::
* Fix serialization bug in allocation explain API. {pull}19494[#19494]
* Allocation explain: Also serialize `includeDiskInfo` field {pull}19492[#19492]

Store::
* Tighten up concurrent store metadata listing and engine writes {pull}19684[#19684] (issue: {issue}19416[#19416])
* Make static Store access shard lock aware {pull}19416[#19416] (issue: {issue}18938[#18938])
* Catch assertion errors on commit and turn it into a real exception {pull}19357[#19357] (issue: {issue}19356[#19356])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Network::
* Dependencies: Upgrade to netty 4.1.4 {pull}19689[#19689]
* Introduce Netty 4 {pull}19526[#19526] (issue: {issue}3226[#3226])
* Upgrade to netty 3.10.6.Final {pull}19235[#19235]

[[release-notes-5.0.0-alpha4]]
== {es} version 5.0.0-alpha4

IMPORTANT: This is an alpha release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-alpha4 to any other version is not supported.

[float]
[[breaking-5.0.0-alpha4]]
=== Breaking Changes

ggregations::
* Remove size 0 options in aggregations {pull}18854[#18854] (issue: {issue}18838[#18838])

CRUD::
* Wait for changes to be visible by search {pull}17986[#17986] (issue: {issue}1063[#1063])

Core::
* Remove cluster name from data path {pull}18554[#18554] (issue: {issue}17810[#17810])

Inner Hits::
* Also do not serialize `_index` key in search response for parent/child inner hits {pull}19011[#19011]
* Don't include `_id`, `_type` and `_index` keys in search response for inner hits {pull}18995[#18995] (issue: {issue}18091[#18091])
* Nested inner hits shouldn't use relative paths {pull}18567[#18567] (issue: {issue}16653[#16653])

Mapping::
* Remove `_timestamp` and `_ttl` on 5.x indices. {pull}18980[#18980] (issue: {issue}18280[#18280])

Packaging::
* Remove allow running as root {pull}18694[#18694] (issue: {issue}18688[#18688])

Search::
* Remove only node preference {pull}18875[#18875] (issue: {issue}18822[#18822])
* Add search preference to prefer multiple nodes {pull}18872[#18872] (issue: {issue}18822[#18822])

Settings::
* Rename boostrap.mlockall to bootstrap.memory_lock {pull}18669[#18669]

Snapshot/Restore::
* Change the default of `include_global_state` from true to false for snapshot restores {pull}18773[#18773] (issue: {issue}18569[#18569])

[float]
=== Breaking Java Changes

Core::
* Register thread pool settings {pull}18674[#18674] (issues: {issue}18613[#18613], {issue}9216[#9216])

Highlighting::
* Register Highlighter instances instead of classes {pull}18859[#18859]

Internal::
* Cleanup ClusterService dependencies and detached from Guice {pull}18941[#18941]
* Simplify SubFetchPhase interface {pull}18881[#18881]
* Simplify FetchSubPhase registration and detach it from Guice {pull}18862[#18862]

Java API::
* Remove setRefresh {pull}18752[#18752] (issue: {issue}1063[#1063])

Plugins::
* Fail to start if plugin tries broken onModule {pull}19025[#19025]
* Simplify ScriptModule and script registration {pull}18903[#18903]
* Cut over settings registration to a pull model {pull}18890[#18890]
* Plugins cleanup {pull}18594[#18594] (issue: {issue}18588[#18588])

Scripting::
* Move search template to lang-mustache module {pull}18765[#18765] (issue: {issue}17906[#17906])

//[float]
//=== Deprecations

[float]
=== New Features

Aggregations::
* Adds aggregation profiling to the profile API {pull}18414[#18414] (issue: {issue}10538[#10538])
* New Matrix Stats Aggregation module {pull}18300[#18300] (issue: {issue}16826[#16826])

Index APIs::
* Add rollover API to switch index aliases given some predicates {pull}18732[#18732] (issue: {issue}18647[#18647])

Java REST Client::
* Low level Rest Client {pull}18735[#18735] (issue: {issue}7743[#7743])

Mapping::
* Expose half-floats. {pull}18887[#18887]

Scroll::
* Add the ability to partition a scroll in multiple slices. {pull}18237[#18237] (issue: {issue}13494[#13494])

Store::
* Expose MMapDirectory.preLoad(). {pull}18880[#18880]
* Add primitive to shrink an index into a single shard {pull}18270[#18270]

[float]
=== Enhancements

Aggregations::
* Automatically set the collection mode to breadth_first in the terms aggregation when the cardinality of the field is unknown or smaller than the requested size. {pull}18779[#18779] (issue: {issue}9825[#9825])
* Rename PipelineAggregatorBuilder to PipelineAggregationBuilder. {pull}18677[#18677] (issue: {issue}18377[#18377])
* AggregatorBuilder and PipelineAggregatorBuilder do not need generics. {pull}18368[#18368] (issue: {issue}18133[#18133])

Allocation::
* Allow `_shrink` to N shards if source shards is a multiple of N {pull}18699[#18699]
* Only filter intial recovery (post API) when shrinking an index {pull}18661[#18661]
* Estimate shard size for shrinked indices {pull}18659[#18659]
* Only fail relocation target shard if failing source shard is a primary {pull}18574[#18574] (issue: {issue}16144[#16144])
* Simplify delayed shard allocation {pull}18351[#18351] (issue: {issue}18293[#18293])

Analysis::
* Add a MultiTermAwareComponent marker interface to analysis factories. {pull}19028[#19028] (issues: {issue}18064[#18064], {issue}9978[#9978])
* Add Flags Parameter for Char Filter {pull}18363[#18363] (issue: {issue}18362[#18362])

Cache::
* Cache FieldStats in the request cache {pull}18768[#18768] (issue: {issue}18717[#18717])

Cluster::
* Index creation does not cause the cluster health to go RED {pull}18737[#18737] (issues: {issue}9106[#9106], {issue}9126[#9126])
* Cluster Health class improvements {pull}18673[#18673]

Core::
* Read Elasticsearch manifest via URL {pull}18999[#18999] (issue: {issue}18996[#18996])
* Throw if the local node is not set {pull}18963[#18963] (issue: {issue}18962[#18962])
* Improve performance of applyDeletedShards {pull}18788[#18788] (issue: {issue}18776[#18776])
* Bootstrap check for OnOutOfMemoryError and seccomp {pull}18756[#18756] (issue: {issue}18736[#18736])

Dates::
* Improve TimeZoneRoundingTests error messages {pull}18895[#18895]
* Improve TimeUnitRounding for edge cases and DST transitions {pull}18589[#18589]

Expressions::
* improve date api for expressions/painless fields {pull}18658[#18658]

Index APIs::
* Add Shrink request source parser to parse create index request body {pull}18802[#18802]

Index Templates::
* Parse and validate mappings on index template creation {pull}8802[#8802] (issue: {issue}2415[#2415])

Ingest::
* Add `ignore_failure` option to all ingest processors {pull}18650[#18650] (issue: {issue}18493[#18493])
* new ScriptProcessor for Ingest {pull}18193[#18193]

Internal::
* Hot methods redux {pull}19016[#19016] (issue: {issue}16725[#16725])
* Remove forked joda time BaseDateTime class {pull}18953[#18953]
* Support optional ctor args in ConstructingObjectParser {pull}18725[#18725]
* Remove thread pool from page cache recycler {pull}18664[#18664] (issue: {issue}18613[#18613])

Java API::
* Switch QueryBuilders to new MatchPhraseQueryBuilder {pull}18753[#18753]

Logging::
* Throw IllegalStateException when handshake fails due to version or cluster mismatch {pull}18676[#18676]

Mapping::
* Upgrade `string` fields to `text`/`keyword` even if `include_in_all` is set. {pull}19004[#19004] (issue: {issue}18974[#18974])

Network::
* Exclude admin / diagnostic requests from HTTP request limiting {pull}18833[#18833] (issues: {issue}17951[#17951], {issue}18145[#18145])
* Do not start scheduled pings until transport start {pull}18702[#18702]

Packaging::
* Remove explicit parallel new GC flag {pull}18767[#18767]
* Use JAVA_HOME or java.exe in PATH like the Linux scripts do {pull}18685[#18685] (issue: {issue}4913[#4913])

Percolator::
* Add percolator query extraction support for dismax query {pull}18845[#18845]
* Improve percolate query performance by not verifying certain candidate matches {pull}18696[#18696]
* Improve percolator query term extraction {pull}18610[#18610]

Plugin Lang Painless::
* Painless Initializers {pull}19012[#19012]
* Add augmentation {pull}19003[#19003]
* Infer lambda arguments/return type {pull}18983[#18983]
* Fix explicit casts and improve tests. {pull}18958[#18958]
* Add lambda captures {pull}18954[#18954]
* improve Debugger to print code even if it hits exception {pull}18932[#18932] (issue: {issue}1[#1])
* Move semicolon hack into lexer {pull}18931[#18931]
* Add flag support to regexes {pull}18927[#18927]
* improve lambda syntax (allow single expression) {pull}18924[#18924]
* Remove useless dropArguments in megamorphic cache {pull}18913[#18913]
* non-capturing lambda support {pull}18911[#18911] (issue: {issue}18824[#18824])
* fix bugs in operators and more improvements for the dynamic case {pull}18899[#18899]
* improve unary operators and cleanup tests {pull}18867[#18867] (issue: {issue}18849[#18849])
* Add support for the find operator (=~) and the match operator (==~) {pull}18858[#18858]
* Remove casts and boxing for dynamic math {pull}18849[#18849] (issue: {issue}18847[#18847])
* Refactor def math {pull}18847[#18847]
* Add support for /regex/ {pull}18842[#18842]
* Array constructor references {pull}18831[#18831]
* Method references to user functions {pull}18828[#18828]
* Add } as a delimiter.  {pull}18827[#18827] (issue: {issue}18821[#18821])
* Add Lambda Stub Node {pull}18824[#18824]
* Add capturing method references {pull}18818[#18818] (issue: {issue}18748[#18748])
* Add Functions to Painless {pull}18810[#18810]
* Add Method to Get New MethodWriters {pull}18771[#18771]
* Static For Each {pull}18757[#18757]
* Method reference support {pull}18748[#18748] (issue: {issue}18578[#18578])
* Add support for the new Java 9 MethodHandles#arrayLength() factory {pull}18734[#18734]
* Improve painless compile-time exceptions {pull}18711[#18711] (issue: {issue}18600[#18600])
* add java.time packages to painless whitelist {pull}18621[#18621]
* Add Function Reference Stub to Painless {pull}18578[#18578]

Plugins::
* Add did-you-mean for plugin cli {pull}18942[#18942] (issue: {issue}18896[#18896])
* Plugins: Remove name() and description() from api {pull}18906[#18906]
* Emit nicer error message when trying to install unknown plugin {pull}18876[#18876] (issue: {issue}17226[#17226])

Query DSL::
* Treat zero token in `common` terms query as MatchNoDocsQuery {pull}18656[#18656]
* Handle empty query bodies at parse time and remove EmptyQueryBuilder {pull}17624[#17624] (issues: {issue}17540[#17540], {issue}17541[#17541])

REST::
* Adding status field in _msearch error request bodies {pull}18586[#18586] (issue: {issue}18013[#18013])

Recovery::
* index shard should be able to cancel check index on close. {pull}18839[#18839] (issue: {issue}12011[#12011])

Reindex API::
* Implement ctx.op = "delete" on _update_by_query and _reindex {pull}18614[#18614] (issue: {issue}18043[#18043])

Scripting::
*  Compile each Groovy script in its own classloader {pull}18918[#18918] (issue: {issue}18572[#18572])
* Include script field even if it value is null {pull}18384[#18384] (issue: {issue}16408[#16408])

Scroll::
* Add an index setting to limit the maximum number of slices allowed in a scroll request. {pull}18782[#18782]

Search::
* Change default similarity to BM25 {pull}18948[#18948] (issue: {issue}18944[#18944])
* Add a parameter to cap the number of searches the msearch api will concurrently execute {pull}18721[#18721]

Sequence IDs::
* Persist sequence number checkpoints {pull}18949[#18949] (issue: {issue}10708[#10708])
* Add sequence numbers to cat shards API {pull}18772[#18772]

Settings::
* Improve error message if a setting is not found {pull}18920[#18920] (issue: {issue}18663[#18663])
* Cleanup placeholder replacement {pull}17335[#17335]

Snapshot/Restore::
* Adds UUIDs to snapshots {pull}18228[#18228] (issue: {issue}18156[#18156])
* Clarify the semantics of the BlobContainer interface {pull}18157[#18157] (issue: {issue}15580[#15580])

Stats::
* Add total_indexing_buffer/_in_bytes to nodes info API {pull}18914[#18914] (issue: {issue}18651[#18651])
* Allow FieldStatsRequest to disable cache {pull}18900[#18900]
* Remove index_writer_max_memory stat from segment stats {pull}18651[#18651] (issues: {issue}14121[#14121], {issue}7440[#7440])
* Move DocStats under Engine to get more accurate numbers {pull}18587[#18587]

Task Manager::
* Fetch result when wait_for_completion {pull}18905[#18905]
* Create get task API that falls back to the .tasks index {pull}18682[#18682]
* Add ability to store results for long running tasks {pull}17928[#17928]

Translog::
* Beef up Translog testing with random channel exceptions {pull}18997[#18997]
* Do not replay into translog on local recovery {pull}18547[#18547]

[float]
=== Bug Fixes

Allocation::
* Fix recovery throttling to properly handle relocating non-primary shards {pull}18701[#18701] (issue: {issue}18640[#18640])

CAT API::
* Fix merge stats rendering in RestIndicesAction {pull}18720[#18720]

CRUD::
* Squash a race condition in RefreshListeners {pull}18806[#18806]

Circuit Breakers::
* Never trip circuit breaker in liveness request {pull}18627[#18627] (issue: {issue}17951[#17951])

Cluster::
* Fix block checks when no indices are specified {pull}19047[#19047] (issue: {issue}8105[#8105])
* Acknowledge index deletion requests based on standard cluster state acknowledgment {pull}18602[#18602] (issues: {issue}16442[#16442], {issue}18558[#18558])

Core::
* Throw exception if using a closed transport client {pull}18722[#18722] (issue: {issue}18708[#18708])

Dates::
* Fix invalid rounding value for TimeIntervalRounding close to DST transitions {pull}18800[#18800]
* Fix problem with TimeIntervalRounding on DST end {pull}18780[#18780]

Expressions::
* replace ScriptException with a better one {pull}18600[#18600]

Ingest::
* Fix ignore_failure behavior in _simulate?verbose and more cleanup {pull}18987[#18987]

Internal::
* Fix filtering of node ids for TransportNodesAction {pull}18634[#18634] (issue: {issue}18618[#18618])

Mapping::
* Better error message when mapping configures null {pull}18809[#18809] (issue: {issue}18803[#18803])
* Process dynamic templates in order. {pull}18638[#18638] (issues: {issue}18625[#18625], {issue}2401[#2401])

Packaging::
* Remove extra bin/ directory in bin folder {pull}18630[#18630]

Plugin Lang Painless::
* Fix compound assignment with string concats {pull}18933[#18933] (issue: {issue}18929[#18929])
* Fix horrible capture {pull}18907[#18907] (issue: {issue}18899[#18899])
* Fix Casting Bug {pull}18871[#18871]

Query DSL::
* Make parsing of bool queries stricter {pull}19052[#19052] (issue: {issue}19034[#19034])

REST::
* Get XContent params from request in Nodes rest actions {pull}18860[#18860] (issue: {issue}18794[#18794])

Reindex API::
* Fix a race condition in reindex's rethrottle {pull}18731[#18731] (issue: {issue}18744[#18744])

Search::
* Require timeout units when parsing query body {pull}19077[#19077] (issue: {issue}19075[#19075])
* Close SearchContext if query rewrite failed {pull}18727[#18727]

Settings::
* Register "cloud.node.auto_attributes" setting in EC2 discovery plugin {pull}18678[#18678]

Snapshot/Restore::
* Better handling of an empty shard's segments_N file {pull}18784[#18784] (issue: {issue}18707[#18707])

Stats::
* Fix sync flush total shards statistics {pull}18766[#18766]

Translog::
* Fix translog replay multiple operations same doc {pull}18611[#18611] (issues: {issue}18547[#18547], {issue}18623[#18623])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 6.1.0. {pull}18926[#18926]
* Upgrade to lucene-6.1.0-snapshot-3a57bea. {pull}18786[#18786]
* Upgrade to Lucene 6.0.1. {pull}18648[#18648] (issues: {issue}17535[#17535], {issue}28[#28])

Dates::
* Upgrade joda-time to 2.9.4 {pull}18609[#18609] (issues: {issue}14524[#14524], {issue}18017[#18017])

Packaging::
* Upgrade JNA to 4.2.2 and remove optionality {pull}19045[#19045] (issue: {issue}13245[#13245])

Plugin Discovery EC2::
* Update aws sdk to 1.10.69 and add use_throttle_retries repository setting {pull}17784[#17784] (issues: {issue}538[#538], {issue}586[#586], {issue}589[#589])

[[release-notes-5.0.0-alpha3]]
== {es} version 5.0.0-alpha3

IMPORTANT: This is an alpha release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-alpha3 to any other version is not supported.

[float]
[[breaking-5.0.0-alpha3]]
=== Breaking Changes

CAT API::
* Row-centric output for _cat/fielddata {pull}18068[#18068] (issue: {issue}10249[#10249])

Inner Hits::
* Drop top level inner hits in favour of inner hits defined in the query dsl {pull}17816[#17816] (issue: {issue}11118[#11118])

Internal::
* Actually bound the generic thread pool {pull}17017[#17017]

Packaging::
* Require /bin/bash in packaging {pull}18259[#18259] (issue: {issue}18251[#18251])
* Remove plugin script parsing of system properties {pull}18207[#18207] (issue: {issue}18140[#18140])

Plugin Delete By Query::
* Remove Delete-By-Query plugin {pull}18516[#18516] (issue: {issue}18469[#18469])

Query DSL::
* Lessen leniency of the query dsl. {pull}18276[#18276]

Scripting::
* Allow only a single extension for a scripting engine {pull}18332[#18332] (issue: {issue}10598[#10598])
* Remove 'sandbox' option for script settings, allow only registering a single language. {pull}18226[#18226] (issues: {issue}10598[#10598], {issue}17114[#17114])

Settings::
* Register `indices.query.bool.max_clause_count` setting {pull}18341[#18341] (issue: {issue}18336[#18336])
* Remove settings and system properties entanglement {pull}18198[#18198] (issue: {issue}18197[#18197])

[float]
=== Breaking Java Changes

Allocation::
* Move parsing of allocation commands into REST and remove support for plugins to register allocation commands {pull}17802[#17802] (issue: {issue}17894[#17894])

Discovery::
* Introduce node handshake {pull}15971[#15971] (issue: {issue}9061[#9061])

Percolator::
* Move the percolator from core to its own module {pull}18511[#18511]
* Remove percolator cache {pull}18434[#18434]

Scripting::
* Remove LeafSearchScript.runAsFloat(): Nothing calls it. {pull}18364[#18364]

Search::
* Refactor of query profile classes to make way for other profile implementations {pull}18370[#18370] (issue: {issue}10538[#10538])

//[float]
//=== Deprecations

[float]
=== New Features

Ingest::
* Add a Sort ingest processor {pull}17999[#17999]
* Add date_index_name processor {pull}17973[#17973] (issue: {issue}17814[#17814])

Reindex API::
* Port Delete By Query to Reindex infrastructure {pull}18329[#18329] (issue: {issue}16883[#16883])

Snapshot/Restore::
* Add Google Cloud Storage repository plugin {pull}13578[#13578] (issue: {issue}12880[#12880])

Stats::
* Extend field stats to report searchable/aggregatable fields {pull}17980[#17980] (issue: {issue}17750[#17750])

[float]
=== Enhancements

Aggregations::
* Rename AggregatorBuilder to AggregationBuilder {pull}18377[#18377] (issue: {issue}18367[#18367])
* Add the ability to use the breadth_first mode with nested aggregations (such as `top_hits`) which require access to score information. {pull}18127[#18127] (issue: {issue}9825[#9825])
* Make significant terms work on fields that are indexed with points. {pull}18031[#18031]

Allocation::
* Limit retries of failed allocations per index {pull}18467[#18467] (issue: {issue}18417[#18417])
* Immutable ShardRouting {pull}17821[#17821]
* Add the shard's store status to the explain API {pull}17689[#17689] (issue: {issue}17372[#17372])

Analysis::
* Core: better error message when analyzer created without tokenizer or… {pull}18455[#18455] (issue: {issue}15492[#15492])
* Move AsciiFolding earlier in FingerprintAnalyzer filter chain {pull}18281[#18281] (issue: {issue}18266[#18266])

CAT API::
* Add node name to Cat Recovery {pull}18187[#18187] (issue: {issue}8041[#8041])
* Add support for documented byte/size units and for micros as a time unit in _cat API {pull}17779[#17779]

Core::
* Log OS and JVM on startup {pull}18557[#18557]
* Add GC overhead logging {pull}18419[#18419]
* Refactor JvmGcMonitorService for testing {pull}18378[#18378]
* Default to server VM and add client VM check {pull}18155[#18155]
* Add system bootstrap checks escape hatch {pull}18088[#18088]
* Avoid sliced locked contention in internal engine {pull}18060[#18060] (issue: {issue}18053[#18053])

Dates::
* Support full range of Java Long for epoch DateTime {pull}18509[#18509] (issue: {issue}17936[#17936])

Discovery::
* Log warning if minimum_master_nodes set to less than quorum {pull}15625[#15625]

Exceptions::
* Make the index-too-old exception more explicit {pull}18438[#18438]
* Add index name in IndexAlreadyExistsException default message {pull}18274[#18274]

Expressions::
* Support geo_point fields in lucene expressions {pull}18096[#18096]
* Add support for .empty to expressions, and some docs improvements {pull}18077[#18077]

Ingest::
* Expose underlying processor to blame for thrown exception within CompoundProcessor {pull}18342[#18342] (issue: {issue}17823[#17823])
* Avoid string concatentation in IngestDocument.FieldPath {pull}18108[#18108]
* add ability to specify multiple grok patterns {pull}18074[#18074] (issue: {issue}17903[#17903])
* add ability to disable ability to override values of existing fields in set processor {pull}17902[#17902] (issue: {issue}17659[#17659])

Inner Hits::
* Change scriptFields member in InnerHitBuilder to set {pull}18092[#18092] (issue: {issue}5831[#5831])

Internal::
* Do not automatically close XContent objects/arrays {pull}18549[#18549] (issue: {issue}18433[#18433])
* Remove use of a Fields class in snapshot responses {pull}18497[#18497]
* Removes multiple toXContent entry points for SnapshotInfo {pull}18494[#18494]
* Removes unused methods in the o/e/common/Strings class {pull}18346[#18346]
* Determine content length eagerly in HttpServer {pull}18203[#18203]
* Consolidate query generation in QueryShardContext {pull}18129[#18129]
* Make reset in QueryShardContext private {pull}18113[#18113]
* Remove Strings#splitStringToArray {pull}18110[#18110]
* Add toString() to GetResponse {pull}18102[#18102]
* ConstructingObjectParser adapts ObjectParser for ctor args {pull}17596[#17596] (issue: {issue}17352[#17352])

Java API::
* Improve adding clauses to `span_near` and `span_or` query {pull}18485[#18485] (issue: {issue}18478[#18478])
* QueryBuilder does not need generics. {pull}18133[#18133]

Mapping::
* Adds a methods to find (and dynamically create) the mappers for the parents of a field with dots in the field name {pull}18106[#18106] (issue: {issue}15951[#15951])

Network::
* Netty request/response tracer should wait for send {pull}18500[#18500]
* Exclude specific transport actions from request size limit check {pull}17951[#17951]

Packaging::
* Don't mkdir directly in deb init script {pull}18503[#18503] (issue: {issue}18307[#18307])
* Increase default heap size to 2g {pull}18311[#18311] (issues: {issue}16334[#16334], {issue}17686[#17686], {issue}18309[#18309])
* Switch init.d scripts to use bash {pull}18308[#18308] (issue: {issue}18259[#18259])
* Switch scripts to use bash {pull}18251[#18251] (issue: {issue}14002[#14002])
* Further simplifications of plugin script {pull}18239[#18239] (issue: {issue}18207[#18207])
* Pass ES_JAVA_OPTS to JVM for plugins script {pull}18140[#18140] (issue: {issue}16790[#16790])

Parent/Child::
* Allow adding additional child types that point to an existing parent type {pull}18446[#18446] (issue: {issue}17956[#17956])

Plugin Lang Painless::
* improve painless whitelist coverage of java api {pull}18533[#18533]
* Definition cleanup {pull}18463[#18463]
* Made def variable casting consistent with invokedynamic rules {pull}18425[#18425]
* Use Java 9 Indy String Concats, if available {pull}18400[#18400] (issue: {issue}18398[#18398])
* Add method overloading based on arity {pull}18385[#18385]
* Refactor WriterUtils to extend ASM GeneratorAdapter {pull}18382[#18382]
* Whitelist expansion {pull}18372[#18372]
* Remove boxing when loading and storing values in "def" fields/arrays, remove boxing onsimple method calls of "def" methods {pull}18359[#18359]
* Some cleanups {pull}18352[#18352]
* Use isAssignableFrom instead of relying on ClassCastException {pull}18350[#18350]
* Build descriptor of array and field load/store in code {pull}18338[#18338]
* Rename the dynamic call site factory to DefBootstrap {pull}18335[#18335]
* Cleanup of DynamicCallSite {pull}18323[#18323]
* Improve exception stacktraces {pull}18319[#18319]
* Make Line Number Available in Painless {pull}18298[#18298]
* Remove input, support params instead {pull}18287[#18287]
* Decouple ANTLR AST from Painless {pull}18286[#18286]
* _value support in painess? {pull}18284[#18284]
* Long priority over Float {pull}18282[#18282]
* _score as double, not float {pull}18277[#18277]
* Add 'ctx' keyword to painless. {pull}18264[#18264]
* Painless doc access {pull}18262[#18262]
* Retrieve _score directly from Scorer {pull}18258[#18258]
* Implement needsScore() correctly. {pull}18247[#18247]
* Add synthetic length property as alias to Lists, so they can be used like arrays {pull}18241[#18241]
* Use better typing for dynamic method calls {pull}18234[#18234]
* Array load/store and length with invokedynamic {pull}18232[#18232] (issue: {issue}18201[#18201])
* Switch painless dynamic calls to invokedynamic, remove perf hack/cheat {pull}18201[#18201]
* Add fielddata accessors (.value/.values/.distance()/etc) {pull}18169[#18169]
* painless: optimize/simplify dynamic field and method access {pull}18151[#18151]
* Painless: Single-Quoted Strings {pull}18150[#18150]

Plugins::
* Add plugin information for Verbose mode {pull}18051[#18051] (issue: {issue}16375[#16375])

Query DSL::
* Enforce MatchQueryBuilder#maxExpansions() to be strictly positive {pull}18464[#18464]
* Don't allow `fuzziness` for `multi_match` types `cross_fields`, `phrase` and `phrase_prefix` {pull}18322[#18322] (issues: {issue}6866[#6866], {issue}7764[#7764])

REST::
* CORS handling triggered whether User-Agent is a browser or not {pull}18283[#18283]
* Add semicolon query string parameter delimiter {pull}18186[#18186] (issue: {issue}18175[#18175])
* Enable HTTP compression by default with compression level 3 {pull}18066[#18066] (issue: {issue}7309[#7309])

Reindex API::
* Make Reindex cancellation tests more uniform {pull}18498[#18498]
* Makes DeleteByQueryRequest implements IndicesRequest {pull}18466[#18466]
* Switch default batch size for reindex to 1000 {pull}18340[#18340]
* Teach reindex to retry on search failures {pull}18331[#18331] (issue: {issue}18059[#18059])
* Remove ReindexResponse in favor of BulkIndexByScrollResponse {pull}18205[#18205]
* Stricter validation of Reindex's requests_per_second {pull}18028[#18028]

Search::
* Introduces GeoValidationMethod to GeoDistanceSortBuilder {pull}18036[#18036]
* Switches from empty boolean query to matchNoDocs {pull}18007[#18007] (issue: {issue}17981[#17981])
* Allow binary sort values. {pull}17959[#17959] (issue: {issue}6077[#6077])

Search Refactoring::
* Removes the now obsolete SearchParseElement implementations {pull}18233[#18233]

Snapshot/Restore::
* Change BlobPath.buildAsString() method {pull}18461[#18461]
* Remove the Snapshot class in favor of using SnapshotInfo {pull}18167[#18167] (issue: {issue}18156[#18156])

Stats::
* Do not return fieldstats information for fields that exist in the mapping but not in the index. {pull}18212[#18212] (issue: {issue}17980[#17980])
* Add whether the shard state fetch is pending to the allocation explain API {pull}18119[#18119] (issue: {issue}17372[#17372])
* Add Failure Details to every NodesResponse {pull}17964[#17964] (issue: {issue}3740[#3740])
* Add I/O statistics on Linux {pull}15915[#15915] (issue: {issue}15296[#15296])

Translog::
* FSync translog outside of the writers global lock {pull}18360[#18360]

[float]
=== Bug Fixes

Aggregations::
* Fix TimeUnitRounding for hour, minute and second units {pull}18415[#18415] (issue: {issue}18326[#18326])
* Aggregations fix: support include/exclude strings for IP and dates {pull}18408[#18408] (issue: {issue}17705[#17705])
* Fix xcontent rendering of ip terms aggs. {pull}18003[#18003] (issue: {issue}17971[#17971])
* Improving parsing of sigma param for Extended Stats Bucket Aggregation {pull}17562[#17562] (issue: {issue}17499[#17499])

Analysis::
* Add `Character.MODIFIER_SYMBOL` to the list of symbol categories. {pull}18402[#18402] (issue: {issue}18388[#18388])

Bulk::
* Add not-null precondition check in BulkRequest {pull}18347[#18347] (issue: {issue}12038[#12038])

CAT API::
* Expand wildcards to closed indices in /_cat/indices {pull}18545[#18545] (issues: {issue}16419[#16419], {issue}17395[#17395])

Circuit Breakers::
* Free bytes reserved on request breaker {pull}18204[#18204] (issue: {issue}18144[#18144])

Cluster::
* Dangling indices are not imported if a tombstone for the index exists {pull}18250[#18250] (issue: {issue}18249[#18249])
* Fix issue with tombstones matching active indices in cluster state {pull}18058[#18058] (issue: {issue}18054[#18054])

Core::
* Fix concurrency bug in IMC that could cause it to check too infrequently {pull}18357[#18357]
* Iterables.flatten should not pre-cache the first iterator {pull}18355[#18355] (issue: {issue}18353[#18353])
* Avoid race while retiring executors {pull}18333[#18333]
* Don't try to compute completion stats on a reader after we already closed it {pull}18094[#18094]

Highlighting::
* Skip all geo point queries in plain highlighter {pull}18495[#18495] (issue: {issue}17537[#17537])
* Exclude all but string fields from highlighting if wildcards are used… {pull}18183[#18183] (issue: {issue}17537[#17537])

Ingest::
* Pipeline Stats: Fix concurrent modification exception {pull}18177[#18177] (issue: {issue}18126[#18126])
* Validate properties values according to database type {pull}17940[#17940] (issue: {issue}17683[#17683])

Internal::
* Add XPointValues {pull}18011[#18011] (issue: {issue}18010[#18010])

Mapping::
* Make doc_values accessible for _type {pull}18220[#18220]
* Fix and test handling of `null_value`. {pull}18090[#18090] (issue: {issue}18085[#18085])
* Fail automatic string upgrade if the value of `index` is not recognized. {pull}18082[#18082] (issue: {issue}18062[#18062])

Packaging::
* Filter client/server VM options from jvm.options {pull}18473[#18473]
* Preserve config files from RPM install {pull}18188[#18188] (issue: {issue}18158[#18158])
* Fix typo in message for variable setup ES_MAX_MEM {pull}18168[#18168]
* Don't run `mkdir` when $DATA_DIR contains a comma-separated list {pull}17419[#17419] (issue: {issue}16992[#16992])

Percolator::
* Add support for MatchNoDocsQuery in percolator's query terms extract service {pull}18492[#18492]

Plugin Discovery EC2::
* Add TAG_SETTING to list of allowed tags for the ec2 discovery plugin. {pull}18257[#18257]

Plugin Lang Painless::
* Remove Grammar Ambiguities {pull}18531[#18531]
* Remove if/else ANTLR ambiguity. {pull}18428[#18428]
* Fix insanely slow compilation {pull}18410[#18410] (issue: {issue}18398[#18398])
* Fix Bug in Painless Assignment {pull}18379[#18379]
* Fix bracket shortcuts {pull}18263[#18263]

Plugin Repository Azure::
* Fix azure files removal {pull}18451[#18451] (issues: {issue}16472[#16472], {issue}18436[#18436])

REST::
* Do not decode path when sending error {pull}18477[#18477] (issue: {issue}18476[#18476])
* CORS should permit same origin requests {pull}18278[#18278] (issue: {issue}18256[#18256])

Search::
* Fix _only_nodes preferences {pull}18483[#18483] (issues: {issue}12546[#12546], {issue}12700[#12700])
* Speed up named queries. {pull}18470[#18470]
* Fix parsing single `rescore` element in SearchSourceBuilder {pull}18440[#18440] (issue: {issue}18439[#18439])
* Fail queries on not indexed fields. {pull}18014[#18014]

Settings::
* Use object equality to compare versions in IndexSettings {pull}18103[#18103]
* fix exists method for list settings when using numbered setting format {pull}17949[#17949]

Snapshot/Restore::
* Fix race condition in snapshot initialization {pull}18426[#18426] (issue: {issue}18121[#18121])
* Handle indices=["_all"] when restoring a snapshot {pull}18025[#18025]

Stats::
* Add missing builder.endObject() in FsInfo {pull}18443[#18443] (issues: {issue}15915[#15915], {issue}18433[#18433])

Translog::
* Snapshotting and sync could cause a dead lock TranslogWriter {pull}18481[#18481] (issues: {issue}1[#1], {issue}18360[#18360], {issue}2[#2])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[[release-notes-5.0.0-alpha2]]
== {es} version 5.0.0-alpha2

IMPORTANT: This is an alpha release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-alpha2 to any other version is not supported.

[float]
[[breaking-5.0.0-alpha2]]
=== Breaking Changes

Analysis::
* Analyze API : Rename filters/token_filters/char_filter in Analyze API in master {pull}17843[#17843] (issue: {issue}15189[#15189])

Cluster::
* Remove validation errors from cluster health response {pull}17773[#17773] (issue: {issue}16979[#16979])

Indexed Scripts/Templates::
* Store indexed scripts in the cluster state instead of the `.scripts` index {pull}17650[#17650] (issue: {issue}16651[#16651])

Packaging::
* Add JVM options configuration file {pull}17675[#17675] (issue: {issue}17121[#17121])

Percolator::
* Remove `.percolator` type in favour of `percolator` field type {pull}17560[#17560]

REST::
* Remove camelCase support {pull}17933[#17933] (issue: {issue}8988[#8988])
* Remove 'case' parameter from rest apis {pull}17774[#17774] (issue: {issue}8988[#8988])
* Disallow unquoted field names {pull}15351[#15351] (issue: {issue}9800[#9800])

Settings::
* Remove `action.get.realtime` setting {pull}17857[#17857] (issue: {issue}12543[#12543])

[float]
=== Breaking Java Changes

Settings::
* Remove Settings.settingsBuilder. {pull}17619[#17619]

[float]
=== Deprecations

Query DSL::
* Deprecate Indices query {pull}17710[#17710] (issue: {issue}12017[#12017])
* Deprecate mlt, in and geo_bbox query name shortcuts {pull}17507[#17507]

Query Refactoring::
* Splits `phrase` and `phrase_prefix` in match query into `MatchPhraseQueryBuilder` and `MatchPhrasePrefixQueryBuilder` {pull}17508[#17508]

[float]
=== New Features

Analysis::
* Add `fingerprint` token filter and `fingerprint` analyzer {pull}17873[#17873] (issue: {issue}13325[#13325])

Plugin Analysis ICU::
* Adding support for customizing the rule file in ICU tokenizer {pull}13651[#13651] (issue: {issue}13146[#13146])



[[enhancement-5.0.0-alpha2]]
[float]
=== Enhancements

CAT API::
* Add _cat/tasks {pull}17551[#17551]
* Cat health supports ts=0 option {pull}13508[#13508] (issue: {issue}10109[#10109])

Cache::
* Allow the query cache to be disabled. {pull}16268[#16268] (issue: {issue}15802[#15802])

Circuit Breakers::
* Limit request size {pull}17133[#17133] (issue: {issue}16011[#16011])

Cluster::
* Adds tombstones to cluster state for index deletions {pull}17265[#17265] (issues: {issue}16358[#16358], {issue}17435[#17435])
* Enable acked indexing {pull}17038[#17038] (issue: {issue}7572[#7572])

Core::
* Kill thread local leak {pull}17921[#17921] (issues: {issue}283[#283], {issue}630[#630])
* Add heap size bootstrap check {pull}17728[#17728] (issue: {issue}17490[#17490])
* Remove hostname from NetworkAddress.format {pull}17601[#17601] (issue: {issue}17604[#17604])
* Bootstrapping bootstrap checks {pull}17595[#17595] (issues: {issue}17474[#17474], {issue}17570[#17570])
* Add max map count check {pull}16944[#16944]

Geo::
* Enhanced lat/long error handling {pull}16833[#16833] (issue: {issue}16137[#16137])

Index APIs::
* Fail hot_threads in a better way if unsupported by JDK {pull}15909[#15909]

Ingest::
* Streamline option naming for several processors {pull}17892[#17892] (issue: {issue}17835[#17835])

Internal::
* Makes Script type writeable {pull}17908[#17908] (issue: {issue}17753[#17753])
* FiltersAggregatorBuilder: Don't create new context for inner parsing {pull}17851[#17851]
* Clean up serialization on some stats {pull}17832[#17832] (issue: {issue}17085[#17085])
* 	Normalize registration for SignificanceHeuristics {pull}17830[#17830] (issue: {issue}17085[#17085])
* Make (read|write)NamedWriteable public {pull}17829[#17829] (issue: {issue}17682[#17682])
* Use try-with-resource when creating new parser instances where possible {pull}17822[#17822]
* Don't pass XContentParser to ParseFieldRegistry#lookup {pull}17794[#17794]
* Internal: Remove threadlocal from document parser {pull}17764[#17764]
* Cut range aggregations to registerAggregation {pull}17757[#17757] (issue: {issue}17085[#17085])
* Remove ParseFieldMatcher from AbstractXContentParser {pull}17756[#17756] (issue: {issue}17417[#17417])
* Remove parser argument from methods where we already pass in a parse context {pull}17738[#17738]
* Switch SearchAfterBuilder to writeGenericValue {pull}17735[#17735] (issue: {issue}17085[#17085])
* Remove StreamableReader {pull}17729[#17729] (issue: {issue}17085[#17085])
* Cleanup nested, has_child & has_parent query builders for inner hits construction {pull}17719[#17719] (issue: {issue}11118[#11118])
* Make AllocationCommands NamedWriteables {pull}17661[#17661]
* Isolate StreamableReader {pull}17656[#17656] (issue: {issue}17085[#17085])
* Create registration methods for aggregations similar to those for queries {pull}17653[#17653] (issues: {issue}17085[#17085], {issue}17389[#17389])
* Turn RestChannel into an interface {pull}17643[#17643] (issue: {issue}17133[#17133])
* Remove PROTOTYPEs from QueryBuilders {pull}17632[#17632] (issue: {issue}17085[#17085])
* Remove registerQueryParser {pull}17608[#17608]
* ParseField#getAllNamesIncludedDeprecated to not return duplicate names {pull}17504[#17504]
* Rework a query parser and improve registration {pull}17458[#17458]
* Clean up QueryParseContext and don't hold it inside QueryRewrite/ShardContext {pull}17417[#17417]

Mapping::
* Automatically upgrade analyzed strings with an analyzer to `text`. {pull}17861[#17861]
* Support dots in field names when mapping already exists {pull}17759[#17759] (issue: {issue}15951[#15951])
* Use the new points API to index numeric fields. {pull}17746[#17746] (issues: {issue}11513[#11513], {issue}16751[#16751], {issue}17007[#17007], {issue}17700[#17700])
* Simplify AllEntries, AllField and AllFieldMapper: {pull}17613[#17613]

Network::
* Limit request size {pull}17133[#17133] (issue: {issue}16011[#16011])

Packaging::
* Remove unnecessary sleep from init script restart {pull}17966[#17966]
* Explicitly set packaging permissions {pull}17912[#17912] (issue: {issue}17634[#17634])
* Allow configuring Windows service name, description and user {pull}17312[#17312]
* rpm uses non-portable `--system` flag to `useradd` {pull}14596[#14596] (issue: {issue}14211[#14211])

Percolator::
* PercolatorQueryBuilder cleanup by using MemoryIndex#fromDocument(...) helper {pull}17669[#17669] (issue: {issue}9386[#9386])

Plugins::
* Cli: Improve output for usage errors {pull}17938[#17938]
* Cli: Add verbose output with zip url when installing plugin {pull}17662[#17662] (issue: {issue}17529[#17529])

Query DSL::
* Add MatchNoDocsQuery, a query that matches no documents and prints the reason why in the toString method. {pull}17780[#17780]
* Adds `ignore_unmapped` option to geo queries {pull}17751[#17751]
* Adds `ignore_unmapped` option to nested and P/C queries {pull}17748[#17748]
* SimpleQueryParser should call MappedFieldType.termQuery when appropriate. {pull}17678[#17678]

REST::
* Allow JSON with unquoted field names by enabling system property {pull}17801[#17801] (issue: {issue}17674[#17674])

Recovery::
* TransportNodesListGatewayStartedShards should fall back to disk based index metadata if not found in cluster state {pull}17663[#17663] (issue: {issue}17630[#17630])

Reindex API::
* Properly mark reindex's child tasks as child tasks {pull}17770[#17770]

Search::
* Fail query if it contains very large rescores {pull}17917[#17917] (issue: {issue}17522[#17522])

Settings::
* Switch to registered Settings for all IndexingMemoryController settings {pull}17778[#17778] (issue: {issue}17442[#17442])

Stats::
* Add points to SegmentStats. {pull}17775[#17775] (issue: {issue}16974[#16974])
* Remove FieldStats.Float. {pull}17749[#17749]
* Show configured and remaining delay for an unassigned shard. {pull}17515[#17515] (issue: {issue}17372[#17372])

Store::
* Use `mmapfs` by default. {pull}17616[#17616] (issue: {issue}16983[#16983])

Suggesters::
* Add bwc support for reading  pre-5.0 completion index {pull}17602[#17602]

Task Manager::
* Move parentTaskId into TransportRequest  {pull}17872[#17872]
* Shorten the serialization of the empty TaskId {pull}17870[#17870]
* Expose whether a task is cancellable in the _tasks list API {pull}17464[#17464] (issue: {issue}17369[#17369])

//[float]
//=== Enhancements

[float]
=== Bug Fixes


Aggregations::
* Adds serialisation of sigma to extended_stats_bucket pipeline aggregation {pull}17703[#17703] (issue: {issue}17701[#17701])
* Fixes NPE when no window is specified in moving average request {pull}17556[#17556] (issue: {issue}17516[#17516])
* Fixes Filter and FiltersAggregation to work with empty query {pull}17542[#17542] (issue: {issue}17518[#17518])
* ExtendedStatsAggregator should also pass sigma to emtpy aggs. {pull}17388[#17388] (issue: {issue}17362[#17362])

Allocation::
* Rebalancing policy shouldn't prevent hard allocation decisions {pull}17698[#17698] (issues: {issue}14057[#14057], {issue}14259[#14259])
* When considering the size of shadow replica shards, set size to 0 {pull}17509[#17509] (issue: {issue}17460[#17460])

Core::
* Refactor UUID-generating methods out of Strings {pull}17837[#17837] (issue: {issue}17819[#17819])
* Node names cleanup {pull}17723[#17723] (issue: {issue}17718[#17718])
* NullPointerException from IndexingMemoryController when a version conflict happens during recovery {pull}17569[#17569]

Ingest::
* Ingest does not close its factories {pull}17626[#17626] (issue: {issue}17625[#17625])

Internal::
* Fix BulkItemResponse.Failure.toString {pull}17871[#17871]

Logging::
* Add missing index name to search slow log. {pull}17818[#17818] (issue: {issue}17025[#17025])

Mapping::
* Fix cross type mapping updates for `boolean` fields. {pull}17882[#17882] (issue: {issue}17879[#17879])
* Fix dynamic check to properly handle parents {pull}17864[#17864] (issues: {issue}17644[#17644], {issue}17854[#17854])
* Fix array parsing to remove its context when finished parsing {pull}17768[#17768]
* Disallow fielddata loading on text fields that are not indexed. {pull}17747[#17747]
* Fail if an object is added after a field with the same name. {pull}17568[#17568] (issue: {issue}17567[#17567])

Packaging::
* Fix exit code {pull}17082[#17082]

Plugin Discovery EC2::
* Fix EC2 Discovery settings {pull}17651[#17651] (issue: {issue}16602[#16602])

Plugins::
* Quote path to java binary {pull}17496[#17496] (issue: {issue}17495[#17495])

Query DSL::
* Apply the default operator on analyzed wildcard in simple_query_string builder {pull}17776[#17776]
* Apply the default operator on analyzed wildcard in query_string builder: {pull}17711[#17711] (issue: {issue}2183[#2183])

REST::
* Fixes reading of CORS pre-flight headers and methods {pull}17523[#17523] (issue: {issue}17483[#17483])
* index is a required url part for update by query {pull}17503[#17503]

Reindex API::
* Reindex should never report negative throttled_until {pull}17799[#17799] (issue: {issue}17783[#17783])
* Reindex should gracefully handle when _source is disabled {pull}17667[#17667] (issue: {issue}17666[#17666])

Settings::
* convert settings for ResourceWatcherService to new infrastructure {pull}17948[#17948]

Snapshot/Restore::
* Fix the semantics for the BlobContainer interface {pull}17878[#17878] (issues: {issue}15579[#15579], {issue}15580[#15580])
* On restore, selecting concrete indices can select wrong index {pull}17715[#17715]

Task Manager::
* Shard level tasks in Bulk Action lose reference to their parent tasks {pull}17743[#17743]

Term Vectors::
* Fix calculation of took time of term vectors request {pull}17817[#17817] (issue: {issue}12565[#12565])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to lucene 6 release {pull}17657[#17657]

[[release-notes-5.0.0-alpha1]]
== {es} version 5.0.0-alpha1

The changes listed below have been released for the first time in
Elasticsearch 5.0.0-alpha1.  Changes in this release which were first released
in the 2.x series are listed in <<release-notes-5.0.0-alpha1-2x>>.

IMPORTANT: This is an alpha release and is intended for _testing purposes only_. Indices created in this version will *not be compatible with Elasticsearch 5.0.0 GA*. Upgrading 5.0.0-alpha1 to any other version is not supported.

[float]
[[breaking-5.0.0-alpha1]]
=== Breaking Changes

Aliases::
* make get alias expand to open and closed indices by default {pull}15954[#15954] (issue: {issue}14982[#14982])
* Remove deprecated indices.get_aliases {pull}13906[#13906]

Allocation::
* Remove DisableAllocationDecider {pull}13313[#13313]

CAT API::
* Add raw recovery progress to cat recovery API {pull}17064[#17064] (issue: {issue}17022[#17022])
* Remove host from cat nodes API {pull}16656[#16656] (issues: {issue}12959[#12959], {issue}16575[#16575])
* Using the accept header in the request instead of content-type in _cat API. {pull}14421[#14421] (issue: {issue}14195[#14195])

CRUD::
* Remove object notation for core types. {pull}15684[#15684] (issue: {issue}15388[#15388])

Cache::
* Remove deprecated query cache settings {pull}15592[#15592]

Cluster::
* Remove memory section {pull}17278[#17278] (issues: {issue}12049[#12049], {issue}16756[#16756])

Core::
* Bootstrap does not set system properties {pull}17088[#17088] (issues: {issue}16579[#16579], {issue}16791[#16791])
* Add max number of processes check {pull}16919[#16919]
* Add mlockall bootstrap check {pull}16909[#16909]
* One log {pull}16703[#16703] (issue: {issue}16585[#16585])

Engine::
* Remove `index.compound_on_flush` setting and default to `true` {pull}15594[#15594] (issue: {issue}10778[#10778])

Fielddata::
* Remove "uninverted" and "binary" fielddata support for numeric and boolean fields. {pull}14082[#14082]

Index APIs::
* Remove `GET` option for /_forcemerge {pull}15223[#15223] (issue: {issue}15165[#15165])
* Remove /_optimize REST API endpoint {pull}14226[#14226] (issue: {issue}13778[#13778])

Internal::
* Remove support for pre 2.0 indices {pull}13799[#13799]

Mapping::
* Change the field mapping index time boost into a query time boost. {pull}16900[#16900]
* Deprecate string in favor of text/keyword. {pull}16877[#16877]
* Term vector APIs should no longer update mappings {pull}16285[#16285]
* Remove the `format` option of the `_source` field. {pull}15398[#15398]
* Remove transform {pull}13657[#13657] (issue: {issue}12674[#12674])

Parent/Child::
* Removed `total` score mode in favour for `sum` score mode. {pull}17174[#17174] (issues: {issue}13470[#13470], {issue}17083[#17083])
* Removed pre 2.x parent child implementation {pull}13376[#13376]

Percolator::
* Change the percolate api to not dynamically add fields to mapping {pull}16077[#16077] (issue: {issue}15751[#15751])

Plugins::
* Rename bin/plugin in bin/elasticsearch-plugin {pull}16454[#16454]
* Remove multicast plugin {pull}16326[#16326] (issue: {issue}16310[#16310])
* Plugins: Remove site plugins {pull}16038[#16038]

Query DSL::
* Function score query: remove deprecated support for boost_factor {pull}13510[#13510]
* Remove support for deprecated queries. {pull}13418[#13418] (issue: {issue}13326[#13326])

REST::
* Limit the accepted length of the _id {pull}16036[#16036] (issue: {issue}16034[#16034])

Search::
* Remove deprecated reverse option from sorting {pull}17282[#17282] (issue: {issue}17047[#17047])
* Remove some deprecations {pull}14331[#14331]
* Remove search exists api {pull}13911[#13911] (issues: {issue}13682[#13682], {issue}13910[#13910])
* Remove the scan and count search types. {pull}13310[#13310]

Search Refactoring::
* Remove "query" query and fix related parsing bugs {pull}14304[#14304] (issue: {issue}13326[#13326])

Settings::
* Remove ability to specify arbitrary node attributes with `node.` prefix {pull}17402[#17402] (issue: {issue}17280[#17280])
* Enforce `discovery.zen.minimum_master_nodes` is set when bound to a public ip {pull}17288[#17288]
* Prevent index level setting from being configured on a node level {pull}17144[#17144] (issue: {issue}16799[#16799])
* Remove support for node.client setting {pull}16963[#16963] (issue: {issue}16565[#16565])
* Remove es.max-open-files flag {pull}16757[#16757] (issues: {issue}16506[#16506], {issue}483[#483])
* Enforce node level limits if node is started in production env {pull}16733[#16733] (issue: {issue}16727[#16727])
* Make settings validation strict {pull}16365[#16365]
* Remove the ability to fsync on every operation and only schedule fsync task if really needed {pull}16257[#16257] (issue: {issue}16152[#16152])
* Script settings {pull}16197[#16197]
* Remove index.flush_on_close entirely {pull}15977[#15977]
* Restore chunksize of 512kb on recovery and remove configurability {pull}15235[#15235] (issue: {issue}15161[#15161])
* Remove ancient deprecated and alternative recovery settings {pull}15234[#15234]
* Fix ping timeout settings inconsistencies {pull}13701[#13701] (issue: {issue}6579[#6579])

Similarities::
* Renames `default` similarity into `classic` {pull}15446[#15446] (issue: {issue}15102[#15102])

Snapshot/Restore::
* Fail closing or deleting indices during a full snapshot {pull}17021[#17021] (issue: {issue}16321[#16321])

Stats::
* Modify load average format {pull}15932[#15932] (issue: {issue}15907[#15907])
* Reintroduce five-minute and fifteen-minute load averages on Linux {pull}15907[#15907] (issues: {issue}12049[#12049], {issue}14741[#14741])
* Add system CPU percent to OS stats {pull}14741[#14741]

Term Vectors::
* Remove DFS support from TermVector API {pull}16452[#16452]

Translog::
* Drop support for simple translog and hard-wire buffer to 8kb {pull}15574[#15574]
* Simplify translog-based flush settings {pull}15573[#15573]

Warmers::
* Remove query warmers and the warmer API. {pull}15614[#15614] (issue: {issue}15607[#15607])

[float]
=== Breaking Java Changes

Aggregations::
* getKeyAsString and key_as_string should be the same for terms aggregation on boolean field {pull}15393[#15393]

Allocation::
* Simplify shard balancer interface {pull}17028[#17028] (issue: {issue}8954[#8954])

Analysis::
* Simplify Analysis registration and configuration {pull}14355[#14355]

Cache::
* Refactor IndicesRequestCache to make it testable. {pull}16610[#16610]
* Fold IndexCacheModule into IndexModule {pull}14293[#14293]

Core::
* Remove es.useLinkedTransferQueue {pull}16786[#16786]

Discovery::
* Include pings from client nodes in master election {pull}17329[#17329] (issue: {issue}17325[#17325])

Internal::
* Remove duplicate getters from DiscoveryNode and DiscoveryNodes {pull}17410[#17410] (issue: {issue}16963[#16963])
* Cli: Switch to jopt-simple {pull}17024[#17024] (issue: {issue}11564[#11564])
* Replace ContextAndHeaders with a ThreadPool based ThreadLocal implementation {pull}15776[#15776]
* Remove NodeBuilder {pull}15354[#15354]
* Fix IndexSearcherWrapper interface to not depend on the EngineConfig {pull}14654[#14654]
* Cleanup query parsing and remove IndexQueryParserService {pull}14452[#14452]
* Remove circular dependency between IndicesService and IndicesStore {pull}14285[#14285]
* Remove guice injection from IndexStore and friends {pull}14279[#14279]
* Replace IndicesLifecycle with a per-index IndexEventListener {pull}14217[#14217] (issue: {issue}13259[#13259])
* Simplify similarity module and friends {pull}13942[#13942]
* Refactor SearchRequest to be parsed on the coordinating node {pull}13859[#13859]

Java API::
* Remove the count api {pull}14166[#14166] (issue: {issue}13928[#13928])
* IdsQueryBuilder to accept only non null ids and types {pull}13937[#13937]

Mapping::
* [Mapping] Several MappingService cleanups {pull}16133[#16133] (issue: {issue}15924[#15924])

Network::
* Remove ability to disable Netty gathering writes {pull}16774[#16774] (issue: {issue}7811[#7811])

Parent/Child::
* Cleanup ParentFieldMapper {pull}16045[#16045]
* Several other parent/child cleanups {pull}13470[#13470]

Plugins::
* Enforce isolated mode for all plugins {pull}17276[#17276]
* Change the inner structure of the plugins zip {pull}16453[#16453]
* Don't use guice for QueryParsers {pull}15761[#15761]
* Remove guice from the index level {pull}14518[#14518]
* Remove shard-level injector {pull}13881[#13881]

Query DSL::
* Remove the MissingQueryBuilder which was deprecated in 2.2.0. {pull}15364[#15364] (issue: {issue}14112[#14112])
* Remove NotQueryBuilder {pull}14204[#14204] (issue: {issue}13761[#13761])

Search::
* Query refactoring: split parse phase into fromXContent and toQuery for all queries {pull}13788[#13788] (issue: {issue}10217[#10217])

Search Refactoring::
* Refactored inner hits parsing and intoduced InnerHitBuilder {pull}17291[#17291]
* Remove deprecated parameter from field sort builder. {pull}16573[#16573] (issue: {issue}16127[#16127])
* Remove support for query_binary and filter_binary {pull}14433[#14433] (issue: {issue}14308[#14308])
* Validate query api: move query parsing to the coordinating node {pull}14384[#14384]

Settings::
* Move remaining settings in NettyHttpServerTransport to the new infra {pull}16531[#16531]
* Replace IndexSettings annotation with a full-fledged class {pull}14251[#14251]

Store::
* Standardize state format type for global and index level metadata {pull}17123[#17123]

Suggesters::
* Remove suggest threadpool {pull}17304[#17304] (issue: {issue}17198[#17198])
* Remove suggest transport action {pull}17198[#17198] (issue: {issue}10217[#10217])

[float]
=== Deprecations

Plugin Mapper Attachment::
* Deprecate mapper-attachments plugin {pull}16948[#16948] (issue: {issue}16910[#16910])

Search::
* Deprecate fuzzy query {pull}16211[#16211] (issues: {issue}15760[#15760], {issue}16121[#16121])

[float]
=== New Features


Allocation::
* Add API to explain why a shard is or isn't assigned {pull}17305[#17305] (issue: {issue}14593[#14593])

Discovery::
* Add two phased commit to Cluster State publishing {pull}13062[#13062]

Ingest::
* Merge feature/ingest branch into master branch {pull}16049[#16049] (issue: {issue}14049[#14049])

Mapping::
* Add a text field. {pull}16637[#16637]
* Add a new `keyword` field. {pull}16589[#16589]

Percolator::
* index the query terms from the percolator query {pull}13646[#13646] (issue: {issue}12664[#12664])

Plugin Ingest Attachment::
* Ingest: Add attachment processor {pull}16490[#16490] (issue: {issue}16303[#16303])

Plugin Mapper Attachment::
* Migrate mapper attachments plugin to main repository {pull}14605[#14605]

Plugin Repository HDFS::
* HDFS Snapshot/Restore plugin {pull}15192[#15192] (issue: {issue}15191[#15191])

Query DSL::
* Adds a rewrite phase to queries on the shard level {pull}16870[#16870] (issue: {issue}9526[#9526])

Reindex API::
* Merge reindex to master {pull}16861[#16861]

Scripting::
* Exceptions and Infinite Loop Checking {pull}15936[#15936]
* Added a new scripting language (PlanA) {pull}15136[#15136] (issue: {issue}13084[#13084])

Search::
* Add `search_after` parameter in the SearchAPI {pull}16125[#16125] (issue: {issue}8192[#8192])

Settings::
* Add infrastructure to transactionally apply and reset dynamic settings {pull}15278[#15278]

Stats::
* API for listing index file sizes {pull}16661[#16661] (issue: {issue}16131[#16131])

Suggesters::
* Add document-oriented completion suggester {pull}14410[#14410] (issue: {issue}10746[#10746])

Task Manager::
* Add task cancellation mechanism {pull}16320[#16320]
* Make the Task object available to the action caller {pull}16033[#16033]
* Task Management: Add framework for registering and communicating with tasks {pull}15347[#15347] (issue: {issue}15117[#15117])

[float]
=== Enhancements


Aggregations::
* Add tests and documentation for using `time_zone` in date range aggregation {pull}16955[#16955] (issue: {issue}10130[#10130])
* Fixes serialisation of Ranges {pull}16674[#16674]

Allocation::
* Write shard state metadata as soon as shard is created / initializing {pull}16625[#16625] (issue: {issue}14739[#14739])
* Reuse existing allocation id for primary shard allocation {pull}16530[#16530] (issue: {issue}14739[#14739])
* Remove version in ShardRouting (now obsolete) {pull}16243[#16243] (issue: {issue}14739[#14739])
* Prefer nodes that previously held primary shard for primary shard allocation {pull}16096[#16096] (issue: {issue}14739[#14739])
* Extend reroute with an option to force assign stale primary shard copies {pull}15708[#15708] (issue: {issue}14739[#14739])
* Allocate primary shards based on allocation IDs {pull}15281[#15281] (issue: {issue}14739[#14739])
* Persist currently started allocation IDs to index metadata {pull}14964[#14964] (issue: {issue}14739[#14739])
* Use ObjectParser to parse AllocationID {pull}14962[#14962] (issue: {issue}14831[#14831])
* Persist allocation ID with shard state metadata on nodes {pull}14831[#14831] (issue: {issue}14739[#14739])

Analysis::
* Improve error message if resource files have illegal encoding {pull}17237[#17237] (issue: {issue}17212[#17212])

CAT API::
* Expose http address in cat/nodes {pull}16770[#16770]
* [cat/recovery] Make recovery time a TimeValue() {pull}16743[#16743] (issue: {issue}9209[#9209])
* :CAT API: remove space at the end of a line {pull}15250[#15250] (issue: {issue}9464[#9464])

CRUD::
* CRUD: Allow to get and set ttl as a time value/string {pull}15047[#15047]

Cache::
* Enable the indices request cache by default {pull}17162[#17162] (issues: {issue}16870[#16870], {issue}17134[#17134])

Cluster::
* Cluster Health should run on applied states, even if waitFor=0 {pull}17440[#17440]
* Resolve index names to Index instances early {pull}17048[#17048]
* Remove DiscoveryNode#shouldConnectTo method {pull}16898[#16898] (issue: {issue}16815[#16815])
* Fail demoted primary shards and retry request {pull}16415[#16415] (issue: {issue}14252[#14252])
* Illegal shard failure requests {pull}16275[#16275]
* Shard failure requests for non-existent shards {pull}16089[#16089] (issue: {issue}14252[#14252])
* Add handling of channel failures when starting a shard {pull}16041[#16041] (issue: {issue}15895[#15895])
* Wait for new master when failing shard {pull}15748[#15748] (issue: {issue}14252[#14252])
* Master should wait on cluster state publication when failing a shard {pull}15468[#15468] (issue: {issue}14252[#14252])
* Split cluster state update tasks into roles {pull}14899[#14899] (issue: {issue}13627[#13627])
* Add timeout mechanism for sending shard failures {pull}14707[#14707] (issue: {issue}14252[#14252])
* Add listener mechanism for failures to send shard failed {pull}14295[#14295] (issue: {issue}14252[#14252])

Core::
* Remove PROTOTYPE from BulkItemResponse.Failure {pull}17433[#17433] (issue: {issue}17086[#17086])
* Throw an exception if Writeable.Reader reads null {pull}17332[#17332]
* Remove PROTOTYPE from RescorerBuilders {pull}17330[#17330]
* Port Primary Terms to master {pull}17044[#17044] (issues: {issue}14062[#14062], {issue}14651[#14651], {issue}17038[#17038])
* Use index UUID to lookup indices on IndicesService {pull}17001[#17001]
* Add -XX+AlwaysPreTouch JVM flag {pull}16937[#16937]
* Add max size virtual memory check {pull}16935[#16935]
* Use and test relative time in TransportBulkAction {pull}16916[#16916]
* Bump Elasticsearch version to 5.0.0-SNAPSHOT {pull}16862[#16862]
* Assert that we can write in all data-path on startup {pull}16745[#16745]
* Add G1GC check on startup {pull}16737[#16737] (issue: {issue}10740[#10740])
* Shards with heavy indexing should get more of the indexing buffer {pull}14121[#14121]
* Remove and ban ImmutableMap {pull}13939[#13939] (issue: {issue}13224[#13224])
* Finish banning ImmutableSet {pull}13820[#13820] (issue: {issue}13224[#13224])
* Removes and bans ImmutableSet {pull}13754[#13754] (issue: {issue}13224[#13224])
* Remove and ban ImmutableMap#entrySet {pull}13724[#13724]
* Forbid ForwardingSet {pull}13720[#13720] (issue: {issue}13224[#13224])

Discovery::
* Add a dedicate queue for incoming ClusterStates {pull}13303[#13303] (issue: {issue}13062[#13062])

Engine::
* Remove writeLockTimeout from InternalEngine {pull}16930[#16930]
* Don't guard IndexShard#refresh calls by a check to isRefreshNeeded {pull}16118[#16118]
* Never call a listerner under lock in InternalEngine {pull}15786[#15786]
* Use System.nanoTime() to initialize Engine.lastWriteNanos {pull}14321[#14321]
* Flush big merges automatically if shard is inactive {pull}14275[#14275]
* Remove Engine.Create {pull}13955[#13955]
* Remove the disabled autogenerated id optimization from InternalEngine {pull}13857[#13857]

Exceptions::
* Fix typos in exception/assert/log messages in core module. {pull}16649[#16649]
* Add field names to several mapping errors {pull}16508[#16508] (issue: {issue}16378[#16378])
* Add serialization support for more important IOExceptions {pull}15766[#15766]
* Adds exception objects to log messages. {pull}14827[#14827] (issue: {issue}10021[#10021])
* Add stack traces to logged exceptions where missing {pull}13825[#13825] (issue: {issue}10021[#10021])
* Remove reflection hacks from ElasticsearchException {pull}13796[#13796]
* Rename QueryParsingException to a more generic ParsingException {pull}13631[#13631]
* Add *Exception(Throwable cause) constructors/ call where appropriate {pull}13544[#13544] (issue: {issue}10021[#10021])

Geo::
* Fix a potential parsing problem in GeoDistanceSortParser {pull}17111[#17111]
* Geo: Add validation of shapes to ShapeBuilders {pull}15551[#15551] (issue: {issue}14416[#14416])
* Make remaining ShapeBuilders implement Writeable {pull}15010[#15010] (issue: {issue}14416[#14416])
* Geo: Remove internal `translated` flag from LineStringBuilder {pull}14969[#14969]
* Make PointBuilder, CircleBuilder & EnvelopeBuilder implement Writable  {pull}14933[#14933] (issue: {issue}14416[#14416])
* Merging BaseLineString and BasePolygonBuilder with subclass {pull}14887[#14887] (issue: {issue}14482[#14482])
* Moving static factory methods to ShapeBuilders {pull}14529[#14529]
* Remove InternalLineStringBuilder and InternalPolygonBuilder {pull}14482[#14482] (issue: {issue}14416[#14416])

Highlighting::
* Switch Highlighting to ObjectParser  {pull}17363[#17363]
* Use HighlightBuilder in SearchSourceBuilder {pull}15376[#15376] (issue: {issue}15044[#15044])
* Joint parsing of common global Hightlighter and subfield parameters {pull}15368[#15368] (issue: {issue}15285[#15285])
* Enable HighlightBuilder to create SearchContextHighlight {pull}15324[#15324]
*  Add fromXContent method to HighlightBuilder {pull}15157[#15157]

Ingest::
* add automatic type conversion support to ConvertProcessor {pull}17263[#17263] (issue: {issue}17139[#17139])
* Give the foreach processor access to the rest of the document {pull}17172[#17172] (issue: {issue}17147[#17147])
* Added ingest statistics to node stats API {pull}16915[#16915]
* Add `ingest_took` to bulk response {pull}16876[#16876]
* Add ingest info to node info API, which contains a list of available processors {pull}16865[#16865]
* Use diffs for ingest metadata in cluster state {pull}16847[#16847]
* hide null-valued metadata fields from WriteableIngestDocument#toXContent {pull}16557[#16557]
* Ingest: use bulk thread pool for bulk request processing (was index before) {pull}16539[#16539] (issue: {issue}16503[#16503])
* Add foreach processor {pull}16432[#16432]
* revert PipelineFactoryError handling with throwing ElasticsearchParseException in ingest pipeline creation {pull}16355[#16355]
* Add processor tags to on_failure metadata in ingest pipeline {pull}16324[#16324] (issue: {issue}16202[#16202])
* catch processor/pipeline factory exceptions and return structured error responses {pull}16276[#16276] (issue: {issue}16010[#16010])
* Ingest: move get/put/delete pipeline methods to ClusterAdminClient {pull}16242[#16242]
* Geoip processor: remove redundant latitude and longitude fields and make location an object with lat and lon subfields {pull}16173[#16173]

Internal::
* Remove PROTOTYPE from MLT.Item {pull}17481[#17481] (issue: {issue}17085[#17085])
* Remove PROTOTYPE from VersionType {pull}17480[#17480] (issue: {issue}17085[#17085])
* Remove PROTOTYPEs from highlighting {pull}17466[#17466] (issue: {issue}17085[#17085])
* Remove PROTOTYPEs from ingest {pull}17434[#17434] (issue: {issue}17085[#17085])
* Start to rework query registration {pull}17424[#17424]
* Factor out slow logs into Search and IndexingOperationListeners {pull}17398[#17398]
* Remove PROTOTYPE from Suggesters {pull}17370[#17370]
* Remove PROTOTYPE from SortBuilders {pull}17337[#17337] (issue: {issue}17085[#17085])
* Remove PROTOTYPE from ShapeBuilders {pull}17336[#17336] (issue: {issue}17085[#17085])
* Replace FieldStatsProvider with a method on MappedFieldType. {pull}17334[#17334]
* Stop using PROTOTYPE in NamedWriteableRegistry {pull}17284[#17284] (issue: {issue}17085[#17085])
* Support scheduled commands in current context {pull}17077[#17077]
* Thread limits {pull}17003[#17003]
* Remove leniency from segments info integrity checks {pull}16985[#16985] (issue: {issue}16973[#16973])
* Rename SearchServiceTransportAction to SearchTransportService {pull}16880[#16880]
* Decouple the TransportService and ClusterService {pull}16872[#16872] (issue: {issue}16788[#16788])
* Refactor bootstrap checks {pull}16844[#16844] (issues: {issue}16733[#16733], {issue}16835[#16835])
* Add LifecycleRunnable {pull}16752[#16752]
* Hot inlined methods in your area {pull}16725[#16725]
* Move IndicesQueryCache and IndicesRequestCache into IndicesService {pull}16603[#16603]
* Forbid use of java.security.MessageDigest#clone() {pull}16543[#16543] (issue: {issue}16479[#16479])
* Make IndicesWarmer a private class of IndexService {pull}16470[#16470]
* Simplify IndicesFieldDataCache and detach from guice {pull}16469[#16469]
* Uppercase ells ('L') in long literals {pull}16329[#16329] (issue: {issue}16279[#16279])
* ShardId equality and hash code inconsistency {pull}16319[#16319] (issue: {issue}16217[#16217])
* Ensure all resources are closed on Node#close() {pull}16316[#16316] (issue: {issue}13685[#13685])
* Make index uuid available in Index, ShardRouting & ShardId {pull}16217[#16217]
* Move RefreshTask into IndexService and use since task per index {pull}15933[#15933]
* Make IndexingMemoryController private to IndicesService {pull}15877[#15877]
* Cleanup IndexingOperationListeners infrastructure {pull}15875[#15875]
* Remove and forbid use of j.u.c.ThreadLocalRandom {pull}15862[#15862] (issue: {issue}15294[#15294])
* Fix IntelliJ query builder type inference issues {pull}15429[#15429]
* Remove and forbid use of Collections#shuffle(List) and Random#<init>() {pull}15299[#15299] (issue: {issue}15287[#15287])
* Remove and forbid use of the type-unsafe empty Collections fields {pull}15187[#15187]
* Move IndicesService.canDeleteShardContent to use IndexSettings {pull}15150[#15150] (issue: {issue}15059[#15059])
* Simplify MonitorService construction and detach from guice {pull}15035[#15035]
* Use Supplier for StreamInput#readOptionalStreamable {pull}14806[#14806]
* Add variable-length long encoding {pull}14780[#14780]
* Extend usage of IndexSetting class {pull}14731[#14731] (issue: {issue}14251[#14251])
* Fold SimilarityModule into IndexModule {pull}14284[#14284]
* Move to lucene BoostQuery {pull}14264[#14264]
* Use built-in method for computing hash code of longs {pull}14213[#14213]
* Refactor ShardFailure listener infrastructure {pull}14206[#14206]
* Add methods for variable-length encoding integral arrays {pull}14087[#14087]
* Fold IndexAliasesService into IndexService {pull}14044[#14044]
* Remove unneeded Module abstractions {pull}13944[#13944]
* Query refactoring: simplify IndexQueryParserService parse methods {pull}13938[#13938] (issue: {issue}13859[#13859])
* Remove and forbid use of com.google.common.collect.Iterators {pull}13916[#13916] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.ImmutableCollection {pull}13909[#13909] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.io.Resources {pull}13908[#13908] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.hash.* {pull}13907[#13907] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.net.InetAddresses {pull}13905[#13905] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.EvictingQueue {pull}13903[#13903] (issue: {issue}13224[#13224])
* Replace Guava cache with simple concurrent LRU cache {pull}13879[#13879]
* Remove ClusterSerivce and IndexSettingsService dependency from IndexShard {pull}13853[#13853]
* Start making RecoverySourceHandler unittestable {pull}13840[#13840]
* Remove IndexService dep. from IndexShard {pull}13797[#13797]
* Remove ES internal deletion policies in favour of Lucenes implementations {pull}13794[#13794]
* Move ShardTermVectorService to be on indices level as TermVectorService {pull}13786[#13786]
* Move ShardPercolateService creation into IndexShard {pull}13777[#13777]
* Remove `ExpressionScriptCompilationException` and `ExpressionScriptExecutionException` {pull}13742[#13742]
* Reduced the number of ClusterStateUpdateTask variants {pull}13735[#13735]
* Add a BaseParser helper for stream parsing {pull}13615[#13615]
* Remove and forbid use of com.google.common.primitives.Ints {pull}13596[#13596] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.math.LongMath {pull}13575[#13575] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.base.Joiner {pull}13572[#13572] (issue: {issue}13224[#13224])
* Replace and ban next batch of Guava classes {pull}13562[#13562] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Iterables {pull}13559[#13559] (issue: {issue}13224[#13224])
* Replace LoadingCache usage with a simple ConcurrentHashMap {pull}13552[#13552] (issue: {issue}13224[#13224])
* Use Supplier instead of Reflection {pull}13545[#13545]
* Remove and forbid use of com.google.common.base.Preconditions {pull}13540[#13540] (issue: {issue}13224[#13224])
* Remove and forbid use of guava Function, Charsets, Collections2 {pull}13533[#13533] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.ImmutableSortedMap {pull}13525[#13525] (issue: {issue}13224[#13224])
* Remove and forbid use of several com.google.common.util. classes {pull}13524[#13524] (issue: {issue}13224[#13224])
* Cleanup SearchRequest & SearchRequestBuilder {pull}13518[#13518]
* Remove and forbid use of com.google.common.collect.Queues {pull}13498[#13498] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.base.Preconditions#checkNotNull {pull}13493[#13493] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Sets {pull}13463[#13463] (issue: {issue}13224[#13224])
* Remove and forbid use of com.google.common.collect.Maps {pull}13438[#13438] (issue: {issue}13224[#13224])
* Remove use of underscore as an identifier {pull}13353[#13353]
* Remove and forbid the use of com.google.common.base.Predicate(s)? {pull}13349[#13349] (issues: {issue}13224[#13224], {issue}13314[#13314])
* This commit removes com.google.common.io {pull}13302[#13302] (issue: {issue}13224[#13224])

Java API::
* Remove copy constructors from request classes and TransportMessage type {pull}16640[#16640] (issue: {issue}15776[#15776])

Mapping::
* Add a soft limit on the mapping depth. {pull}17400[#17400]
* Disable fielddata on text fields by defaults. {pull}17386[#17386]
* Add limit to total number of fields in mapping {pull}17357[#17357]
* Make `parseMultiField` part of `parseField`. {pull}17313[#17313]
* Automatically add a sub keyword field to string dynamic mappings. {pull}17188[#17188]
* Remove friction from the mapping changes in 5.0. {pull}16991[#16991]
* Rework norms parameters for 5.0. {pull}16987[#16987]
* Moved dynamic field handling in doc parsing to end of parsing {pull}16798[#16798]
* Remove the MapperBuilders utility class. {pull}16609[#16609]
* Make the `index` property a boolean. {pull}16161[#16161]
* Remove the ability to enable doc values with the `fielddata.format` setting. {pull}16147[#16147]
* Be stricter about parsing boolean values in mappings. {pull}16146[#16146]
* Fix default doc values to be enabled when a field is not indexed. {pull}16141[#16141]
* Dynamically map floating-point numbers as floats instead of doubles. {pull}15319[#15319] (issue: {issue}13851[#13851])
* Simplify MetaDataMappingService. {pull}15217[#15217]
* Remove MergeMappingException. {pull}15177[#15177]

Packaging::
* Added RPM metadata {pull}17477[#17477]
* Elasticsearch ownership for data, logs, and configs {pull}17197[#17197] (issue: {issue}12688[#12688])
* Fail early on JDK with compiler bug {pull}16418[#16418] (issues: {issue}16097[#16097], {issue}16362[#16362])
* Make security non-optional {pull}16176[#16176]
* Remove RuntimePermission("accessDeclaredMembers") {pull}15378[#15378]
* Remove Guava as a dependency {pull}14055[#14055] (issue: {issue}13224[#13224])
* Remove Guava as a dependency {pull}14054[#14054] (issue: {issue}13224[#13224])

Percolator::
* Add scoring support to the percolator query {pull}17385[#17385] (issue: {issue}13827[#13827])
* Add query extract support for the blended term query and the common terms query {pull}17347[#17347]
* Add support for several span queries in ExtractQueryTermsService {pull}17323[#17323]
* Add support for TermsQuery in ExtractQueryTermsService {pull}17316[#17316]
* Replace percolate APIs with a percolator query {pull}16349[#16349] (issues: {issue}10741[#10741], {issue}11264[#11264], {issue}13176[#13176], {issue}13978[#13978], {issue}4317[#4317], {issue}7297[#7297])

Plugin Analysis Kuromoji::
* Add nbest options and NumberFilter {pull}17173[#17173]

Plugin Discovery EC2::
* Add support for proxy authentication for s3 and ec2 {pull}15293[#15293] (issue: {issue}15268[#15268])

Plugin Ingest Attachment::
* Minor attachment processor improvements {pull}16574[#16574]

Plugin Lang Painless::
* Painless Clean Up {pull}17428[#17428]
* Make Painless a Module {pull}16755[#16755]
* Minor Clean up {pull}16457[#16457]
* Remove Extra String Concat Token {pull}16382[#16382]

Plugin Mapper Attachment::
* minor attachments cleanups: IDE test support and EPUB format {pull}14626[#14626]

Plugin Repository Azure::
* Support global `repositories.azure.` settings {pull}15141[#15141] (issue: {issue}13776[#13776])
* Add timeout settings (default to 5 minutes) {pull}15080[#15080] (issue: {issue}14277[#14277])
* Remove AbstractLegacyBlobContainer {pull}14650[#14650] (issue: {issue}13434[#13434])

Plugin Repository HDFS::
* merge current hdfs improvements to master {pull}15588[#15588]

Plugin Repository S3::
* Check that S3 setting `buffer_size` is always lower than `chunk_size` {pull}17274[#17274] (issue: {issue}17244[#17244])

Plugins::
* PluginManager: Add xpack as official plugin {pull}17227[#17227]
* CliTool: Cleanup and document Terminal {pull}16443[#16443]
* Plugin cli: Improve maven coordinates detection {pull}16384[#16384] (issue: {issue}16376[#16376])
* Enforce plugin zip does not contain zip entries outside of the plugin dir {pull}16361[#16361]
* CliTool: Allow unexpected exceptions to propagate {pull}16359[#16359]
* Reduce complexity of plugin cli {pull}16336[#16336]
* Remove Plugin.onIndexService. {pull}15029[#15029] (issue: {issue}14896[#14896])
* Open up QueryCache and SearcherWrapper extension points {pull}14303[#14303]

Query DSL::
* An `exists` query on an object should query a single term. {pull}17186[#17186] (issue: {issue}17131[#17131])
* Function Score Query: make parsing stricter {pull}16617[#16617] (issue: {issue}16583[#16583])
* Parsers should throw exception on unknown objects {pull}14255[#14255] (issue: {issue}10974[#10974])
* UNICODE_CHARACTER_CLASS fix {pull}11598[#11598] (issue: {issue}10146[#10146])

Query Refactoring::
* Add infrastructure to rewrite query builders {pull}16599[#16599]
* Switch geo validation to enum {pull}13672[#13672] (issue: {issue}13608[#13608])

REST::
* More robust handling of CORS HTTP Access Control {pull}16092[#16092]
* Add option to exclude based on paths in XContent {pull}16017[#16017]

Recovery::
* Recover broken IndexMetaData as closed {pull}17187[#17187]
* Relocation source should be marked as relocating before starting recovery to primary relocation target {pull}16500[#16500]
* Operation counter for IndexShard {pull}15956[#15956] (issue: {issue}15900[#15900])
* Primary relocation handoff {pull}15900[#15900] (issue: {issue}15532[#15532])
* Remove recovery threadpools and throttle outgoing recoveries on the master {pull}15372[#15372]
* Refactor StoreRecoveryService to be a simple package private util class {pull}13766[#13766]

Reindex API::
* Make reindex throttling dynamic {pull}17262[#17262]
* Throttling support for reindex {pull}17039[#17039]
* Add ingest pipeline support to reindex {pull}16932[#16932]

Scripting::
* Skipping hidden files compilation for script service {pull}16286[#16286] (issue: {issue}15269[#15269])
* Rename Plan A to Painless {pull}16245[#16245]
* Add plumbing for script compile-time parameters {pull}15464[#15464]
* Factor mustache -> modules/lang-mustache {pull}15328[#15328]

Search::
* Add a soft limit on the number of shards that can be queried in a single search request. {pull}17396[#17396]
* Type filters should not have a performance impact when there is a single type. {pull}17350[#17350]
* Store _all payloads on 1 byte instead of 4. {pull}16899[#16899]
* Refuse to load fields from _source when using the `fields` option and support wildcards.  {pull}15017[#15017] (issues: {issue}10783[#10783], {issue}14489[#14489])
* Add response into ClearScrollResponse {pull}13835[#13835] (issue: {issue}13817[#13817])
* Shuffle shards for _only_nodes + support multiple specifications like cluster API  {pull}12575[#12575] (issues: {issue}12546[#12546], {issue}12700[#12700])

Search Refactoring::
* Remove RescoreParseElement {pull}17441[#17441]
* Remove HighlighterParseElement {pull}17303[#17303]
* Move top level parsing of sort element to SortBuilder {pull}17248[#17248]
* Switch to using refactored SortBuilder instead of using BytesReference in serialization {pull}17205[#17205] (issues: {issue}17146[#17146], {issue}17257[#17257])
* Add build() method to SortBuilder implementations {pull}17146[#17146] (issue: {issue}10217[#10217])
* Refactoring of Suggestions {pull}17096[#17096] (issue: {issue}10217[#10217])
* Move sort `order` field up into SortBuilder {pull}17035[#17035]
* Moves SortParser:parse(...) to only require QueryShardContext {pull}16999[#16999] (issue: {issue}15178[#15178])
* Change internal representation of suggesters  {pull}16873[#16873]
* Make GeoDistanceSortBuilder serializable, 2nd try {pull}16572[#16572] (issues: {issue}15178[#15178], {issue}16151[#16151])
* Move missing() from SortBuilder interface to class {pull}16225[#16225] (issues: {issue}15178[#15178], {issue}16151[#16151])
* Remove deprecated parameters from ScriptSortBuilder {pull}16153[#16153] (issue: {issue}15178[#15178])
* Refactor GeoSortBuilder {pull}16151[#16151] (issue: {issue}15178[#15178])
* Refactor FieldSortBuilder {pull}16127[#16127] (issue: {issue}15178[#15178])
* Make sort order enum writable. {pull}16124[#16124] (issue: {issue}15178[#15178])
* Make DistanceUnit writable. {pull}16122[#16122] (issue: {issue}15178[#15178])
* RescoreBuilder: Add parsing and creating of RescoreSearchContext {pull}16014[#16014] (issue: {issue}15559[#15559])
* Make RescoreBuilder and nested QueryRescorer Writable {pull}15953[#15953] (issue: {issue}15559[#15559])
* Explain api: move query parsing to the coordinating node {pull}14270[#14270]
* Switch query parsers to use ParseField  {pull}14249[#14249] (issue: {issue}8964[#8964])
* Refactoring of Aggregations {pull}14136[#14136]

Settings::
* Add guard against null-valued settings {pull}17310[#17310] (issue: {issue}17292[#17292])
* Useful error message for null property placeholder {pull}17293[#17293] (issue: {issue}17292[#17292])
* Archive cluster level settings if unknown or broken {pull}17246[#17246]
* Improve error message if setting is not found {pull}17230[#17230]
* Improve upgrade experience of node level index settings {pull}17223[#17223] (issue: {issue}17187[#17187])
* Settings with complex matchers should not overlap {pull}16754[#16754]
* Moves GCE settings to the new infra {pull}16722[#16722] (issue: {issue}16720[#16720])
* Add filtering support within Setting class {pull}16629[#16629] (issue: {issue}16598[#16598])
* Migrate AWS settings to new settings infrastructure {pull}16602[#16602] (issue: {issue}16293[#16293])
* Remove `gateway.initial_meta` and always rely on min master nodes {pull}16446[#16446]
* Rewrite SettingsFilter to be immutable {pull}16425[#16425]
* Simplify azure settings {pull}16363[#16363]
* Convert PageCacheRecycler settings {pull}16341[#16341]
* Monitor settings {pull}16313[#16313]
* Cut over tribe node settings to new settings infra {pull}16311[#16311]
* Convert multcast plugin settings to the new infra {pull}16295[#16295]
* Convert `request.headers.*` to the new settings infra {pull}16292[#16292]
* Migrate Azure settings to new settings infrastructure {pull}16291[#16291]
* Validate logger settings and allow them to be reset via API {pull}16289[#16289]
* Switch NodeEnvironment's settings to new settings {pull}16273[#16273]
* Simplify AutoCreateIndex and add more tests {pull}16270[#16270]
* Convert several pending settings {pull}16269[#16269]
* Migrate query caching settings to the new settings infra. {pull}16267[#16267]
* Convert `action.auto_create_index` and `action.master.force_local` to the new settings infra {pull}16263[#16263]
* Convert `cluster.routing.allocation.type` and `processors` to the new settings infra. {pull}16238[#16238]
* Validate tribe node settings on startup {pull}16237[#16237]
* Move node.client, node.data, node.master, node.local and node.mode to new settings infra {pull}16230[#16230]
* Moved http settings to the new settings infrastructure {pull}16188[#16188]
* Migrate network service to the new infra {pull}16187[#16187]
* Convert client.transport settings to new infra {pull}16183[#16183]
* Move discovery.* settings to new Setting infrastructure {pull}16182[#16182]
* Change over to o.e.common.settings.Setting for http settings {pull}16181[#16181]
* Convert "path.*" and "pidfile" to new settings infra {pull}16180[#16180]
* Migrate repository settings to the new settings API {pull}16178[#16178]
* Convert "indices.*" settings to new infra. {pull}16177[#16177]
* Migrate gateway settings to the new settings API. {pull}16175[#16175]
* Convert several node and test level settings {pull}16172[#16172]
* Run Metadata upgrade tool on every version {pull}16168[#16168]
* Check for invalid index settings on metadata upgrade {pull}16156[#16156]
* Validate the settings key if it's simple chars separated by `.` {pull}16120[#16120]
* Validate known global settings on startup {pull}16091[#16091]
* Cut over all index scope settings to the new setting infrastrucuture {pull}16054[#16054] (issues: {issue}12790[#12790], {issue}12854[#12854], {issue}16032[#16032], {issue}6732[#6732])
* Remove updatability of `index.flush_on_close` {pull}15964[#15964] (issue: {issue}15955[#15955])
* Move all dynamic settings and their config classes to the index level {pull}15955[#15955] (issue: {issue}6732[#6732])
* Always require units for bytes and time settings {pull}15948[#15948] (issue: {issue}11437[#11437])
* Make MetaData parsing less lenient. {pull}15828[#15828]
* Move async translog sync logic into IndexService {pull}15584[#15584]
* Remove `index.merge.scheduler.notify_on_failure` and default to `true` {pull}15572[#15572] (issue: {issue}15570[#15570])
* Remove cache concurrency level settings that no longer apply {pull}14210[#14210] (issues: {issue}13224[#13224], {issue}13717[#13717], {issue}7836[#7836])

Similarities::
* Defining a global default similarity {pull}16682[#16682] (issue: {issue}16594[#16594])

Stats::
* Normalize unavailable load average {pull}16061[#16061] (issues: {issue}12049[#12049], {issue}14741[#14741], {issue}15907[#15907], {issue}15932[#15932], {issue}15934[#15934])
* Add load averages to OS stats on FreeBSD {pull}15934[#15934] (issue: {issue}15917[#15917])
* Expose pending cluster state queue size in node stats {pull}14040[#14040] (issue: {issue}13610[#13610])

Store::
* Remove support for legacy checksums {pull}16931[#16931]
* Rename index folder to index_uuid {pull}16442[#16442] (issues: {issue}13264[#13264], {issue}13265[#13265], {issue}14512[#14512], {issue}14932[#14932], {issue}15853[#15853])

Task Manager::
* Add ability to group tasks by common parent {pull}17341[#17341]
* Add start time and duration to tasks {pull}16829[#16829]
* Combine node name and task id into single string task id {pull}16744[#16744]
* Add task status {pull}16356[#16356] (issue: {issue}16344[#16344])
* Extend tracking of parent tasks to master node, replication and broadcast actions {pull}15931[#15931]

Translog::
* Remove ChannelReference and simplify Views {pull}15898[#15898]
* Simplify TranslogWriter to always write to a stream {pull}15771[#15771]
* Remove TranslogService and fold it into synchronous IndexShard API {pull}13707[#13707]

[float]
=== Bug Fixes


Aggregations::
* Fixes the defaults for `keyed` in the percentiles aggregations {pull}17217[#17217]
* Correct typo in class name of StatsAggregator {pull}15264[#15264] (issue: {issue}14730[#14730])

Allocation::
* Replica shards must be failed before primary shards {pull}15686[#15686]

CRUD::
* Prevent TransportReplicationAction to route request based on stale local routing table {pull}16274[#16274] (issues: {issue}12573[#12573], {issue}12574[#12574])
* Resolves the conflict between alias routing and parent routing by applying the alias routing and ignoring the parent routing. {pull}15371[#15371] (issue: {issue}3068[#3068])

Cluster::
* Shard state action channel exceptions {pull}16057[#16057] (issue: {issue}15748[#15748])

Core::
* Handle RejectedExecution gracefully in TransportService during shutdown {pull}16965[#16965]

Geo::
* Fix multi-field support for GeoPoint types {pull}15702[#15702] (issue: {issue}15701[#15701])
* Enforce distance in distance query is > 0 [ISSUE] {pull}15135[#15135]

Ingest::
* Handle regex parsing errors in Gsub and Grok Processors {pull}17260[#17260]
* add on_failure exception metadata to ingest document for verbose simulate {pull}16562[#16562]
* The IngestDocument copy constructor should make a deep copy {pull}16248[#16248] (issue: {issue}16246[#16246])

Internal::
* Enable unmap hack for java 9 {pull}16986[#16986] (issue: {issue}1[#1])
* Fix issues with failed cache loads {pull}14315[#14315]
* Allow parser to move on the START_OBJECT token when parsing search source {pull}14145[#14145]
* Ensure searcher is release if wrapping fails {pull}14107[#14107]
* Avoid deadlocks in Cache#computeIfAbsent {pull}14091[#14091] (issue: {issue}14090[#14090])

Java API::
* Fix potential NPE in SearchSourceBuilder {pull}16905[#16905] (issue: {issue}16902[#16902])

Mapping::
* Make dynamic template parsing less lenient. {pull}17249[#17249]
* Fix dynamic mapper when its parent already has an update {pull}17065[#17065]
* Fix copy_to when the target is a dynamic object field. {pull}15216[#15216] (issues: {issue}111237[#111237], {issue}11237[#11237])
* Preserve existing mappings on batch mapping updates {pull}15130[#15130] (issues: {issue}14899[#14899], {issue}15129[#15129])

Packaging::
* Set MAX_OPEN_FILES to 65536 {pull}17431[#17431] (issue: {issue}17430[#17430])
* [windows] Service command still had positional start command {pull}17391[#17391]
* Do not pass double-dash arguments on startup {pull}17087[#17087] (issue: {issue}17084[#17084])

Percolator::
* Let PercolatorQuery's explain use the two phase iterator {pull}17315[#17315] (issue: {issue}17314[#17314])

Plugin Store SMB::
* Fix calling ensureOpen() on the wrong directory (master forwardport) {pull}16395[#16395] (issue: {issue}16383[#16383])

Plugins::
* CliTool: Messages printed in Terminal should have percent char escaped {pull}16367[#16367]

Query DSL::
* Resolve string dates and date math to millis before evaluating for rewrite in range query {pull}17239[#17239]
* `constant_score` query should throw error on more than one filter {pull}17135[#17135] (issue: {issue}17126[#17126])
* Single IPv4 addresses in IP field term queries {pull}16068[#16068] (issue: {issue}16058[#16058])
* Make strategy optional in GeoShapeQueryBuilder readFrom and writeTo {pull}13963[#13963]

Query Refactoring::
* Query refactoring: set has_parent & has_child types context properly {pull}13863[#13863]
* Make sure equivalent geohashCellQueries are equal after toQuery called {pull}13792[#13792]

Recovery::
* Invoke `IndexingOperationListeners` also when recovering from store or remote {pull}17406[#17406]
* Prevent interruption while store checks lucene files for consistency {pull}16308[#16308]
* Mark shard as recovering on the cluster state thread {pull}14276[#14276] (issues: {issue}13766[#13766], {issue}14115[#14115])

Search::
* Fix for search after {pull}16271[#16271]
* Do not be lenient when parsing CIDRs {pull}14874[#14874] (issue: {issue}14862[#14862])

Settings::
* Register bootstrap settings {pull}16513[#16513]
* Add settings filtering to node info requests {pull}16445[#16445]
* Ban write access to system properties {pull}14914[#14914]

Task Manager::
* Take filterNodeIds into consideration while sending task requests to nodes {pull}17081[#17081]

Translog::
* Move translog recover outside of the engine {pull}17422[#17422]
* Mark shard active during recovery; push settings after engine finally inits {pull}16250[#16250] (issues: {issue}14121[#14121], {issue}16209[#16209])

//[float]
//=== Regressions

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to lucene-6.0.0-f0aa4fc. {pull}17075[#17075]
* upgrade to lucene 6.0.0-snapshot-bea235f {pull}16964[#16964]
* Upgrade to Jackson 2.7.1 {pull}16801[#16801] (issue: {issue}16294[#16294])

Ingest::
* Update MaxMind geoip2 version to 2.6 {pull}16837[#16837] (issue: {issue}16801[#16801])

Internal::
* Bump master (3.0-snapshot) to java 8 {pull}13314[#13314]

Search Templates::
* Update mustache.java to version 0.9.1 {pull}14053[#14053] (issue: {issue}13224[#13224])

[[release-notes-5.0.0-alpha1-2x]]
== {es} version 5.0.0-alpha1 (Changes previously released in 2.x)

The changes listed below were first released in the 2.x series. Changes
released for the first time in Elasticsearch 5.0.0-alpha1 are listed in
<<release-notes-5.0.0-alpha1>>.

[float]
[[breaking-5.0.0-alpha1-2x]]
=== Breaking Changes

Index APIs::
* Change Field stats API response to include both number and string based min and max values {pull}14674[#14674] (issue: {issue}14404[#14404])
* Add Force Merge API, deprecate Optimize API {pull}13778[#13778]

Internal::
* Forbid changing thread pool types {pull}14367[#14367] (issues: {issue}14294[#14294], {issue}2509[#2509], {issue}2858[#2858], {issue}5152[#5152])

Logging::
* Log cluster health status changes {pull}14557[#14557] (issue: {issue}11657[#11657])

Mapping::
* Add per-index setting to limit number of nested fields {pull}15989[#15989] (issue: {issue}14983[#14983])

Nested Docs::
* If sorting by nested field then the `nested_path` should always be specified {pull}13429[#13429] (issue: {issue}13420[#13420])

Scripting::
* Filter classes loaded by scripts {pull}15262[#15262]
* Lock down javascript and python script engines better {pull}13924[#13924]

Search::
* Limit the size of the result window to a dynamic property {pull}13188[#13188] (issue: {issue}9311[#9311])

[float]
=== Breaking Java Changes

Allocation::
* Speed up shard balancer by reusing shard model while moving shards that can no longer be allocated to a node {pull}16926[#16926]

//[float]
//=== Deprecations

[float]
=== New Features

Aggregations::
* Adds geo_centroid metric aggregator {pull}13846[#13846] (issue: {issue}13621[#13621])
* Add `percentiles_bucket` pipeline aggregation {pull}13186[#13186]
* Add `stats_bucket` / `extended_stats_bucket` pipeline aggs {pull}13128[#13128]

Geo::
* Add CONTAINS relation to geo_shape query {pull}14810[#14810] (issue: {issue}14713[#14713])
* Add support for Lucene 5.4 GeoPoint queries {pull}14537[#14537]
* Add GeoPointV2 Field Mapping {pull}14536[#14536]

Network::
* Allow binding to multiple addresses. {pull}13954[#13954] (issue: {issue}13592[#13592])

Plugin Analysis Phonetic::
* Add support for `daitch_mokotoff` {pull}14834[#14834]

Plugin Cloud AWS::
* Add support for S3 storage class {pull}13656[#13656] (issue: {issue}13655[#13655])

Plugins::
* Decentralize plugin security {pull}14108[#14108]

Search::
* Add query profiler {pull}14889[#14889] (issues: {issue}12974[#12974], {issue}6699[#6699])

[float]
=== Enhancements

Aliases::
* Add support to _aliases endpoint to specify multiple indices and aliases in one action {pull}15305[#15305] (issue: {issue}15186[#15186])

Allocation::
* Skip capturing least/most FS info for an FS with no total {pull}16001[#16001] (issue: {issue}15919[#15919])
* Speed improvements for BalancedShardsAllocator {pull}15678[#15678] (issue: {issue}6372[#6372])
* Simplify delayed shard allocation {pull}14808[#14808]
* Add cluster-wide setting for total shard limit {pull}14563[#14563] (issue: {issue}14456[#14456])
* Early terminate high disk watermark checks on single data node cluster {pull}13882[#13882] (issue: {issue}9391[#9391])
* Also use PriorityComparator in shard balancer {pull}13256[#13256] (issue: {issue}13249[#13249])
* Add support for filtering by publish IP address {pull}8801[#8801]

Analysis::
* Add detail response support for _analyze API {pull}11660[#11660] (issue: {issue}11076[#11076])

CAT API::
* Add sync_id to cat shards API {pull}14712[#14712] (issue: {issue}14705[#14705])
* Add duration field to /_cat/snapshots {pull}14385[#14385]
* Add cat API for repositories and snapshots {pull}14247[#14247] (issue: {issue}13919[#13919])
* Adds disk used by indices to _cat/allocation {pull}13783[#13783] (issue: {issue}13529[#13529])

Cluster::
* Shard state action request logging {pull}16396[#16396]
* Safe cluster state task notifications {pull}15777[#15777]
* Reroute once per batch of shard failures {pull}15510[#15510]
* Add callback for publication of new cluster state {pull}15494[#15494] (issue: {issue}15482[#15482])
* Use general cluster state batching mechanism for shard started {pull}15023[#15023] (issues: {issue}14725[#14725], {issue}14899[#14899])
* Use general cluster state batching mechanism for shard failures {pull}15016[#15016] (issues: {issue}14725[#14725], {issue}14899[#14899])
* Set an newly created IndexShard's ShardRouting before exposing it to operations {pull}14918[#14918] (issue: {issue}10708[#10708])
* Uniform exceptions for TransportMasterNodeAction {pull}14737[#14737]

Core::
* Remove log4j exception hiding {pull}16834[#16834]
* Avoid cloning MessageDigest instances {pull}16479[#16479]
* Add a hard check to ensure we are running with the expected lucene version {pull}16305[#16305] (issue: {issue}16301[#16301])
* If we can't get a MAC address for the node, use a dummy one {pull}15266[#15266] (issue: {issue}10099[#10099])
* Simplify shard inactive logging {pull}15259[#15259] (issue: {issue}15252[#15252])
* Simplify IndexingMemoryController#checkIdle {pull}15252[#15252] (issue: {issue}15251[#15251])
* IndexingMemoryController should not track shard index states {pull}15251[#15251] (issues: {issue}13918[#13918], {issue}15225[#15225])
* Verify Checksum once it has been fully written to fail as soon as possible {pull}13896[#13896]

Discovery::
* Don't allow nodes with missing custom meta data to join cluster {pull}15401[#15401] (issue: {issue}13445[#13445])

Exceptions::
* Added file name to exceptions when failing to read index state {pull}16850[#16850] (issue: {issue}16713[#16713])
* Add Exception class name to message in `NotSerializableExceptionWrapper` {pull}16325[#16325]
* Deduplicate cause if already contained in shard failures {pull}14432[#14432]
* Give a better exception when running from freebsd jail without enforce_statfs=1 {pull}14135[#14135] (issue: {issue}12018[#12018])
* Make root_cause of field conflicts more obvious {pull}13976[#13976] (issue: {issue}12839[#12839])
* Use a dedicated id to serialize EsExceptions instead of it's class name. {pull}13629[#13629]

Fielddata::
* Update GeoPoint FieldData for GeoPointV2 {pull}14345[#14345]

Geo::
* Upgrade GeoPointField to use Lucene 5.5 PrefixEncoding {pull}16482[#16482]
* Geo: Fix toString() in GeoDistanceRangeQuery and GeoPolygonQuery {pull}15026[#15026]
* Enable GeoPointV2 with backward compatibility testing {pull}14667[#14667] (issues: {issue}10761[#10761], {issue}11159[#11159], {issue}9859[#9859])
* Refactor Geo utilities to Lucene 5.4 {pull}14339[#14339]

Index APIs::
* Add option to disable closing indices {pull}14169[#14169] (issue: {issue}14168[#14168])

Index Templates::
* Disallow index template pattern to be the same as an alias name {pull}15184[#15184] (issue: {issue}14842[#14842])

Internal::
* Implement available for all StreamInput classes {pull}17218[#17218]
* Cleanup search sub transport actions and collapse o.e.action.search.type package into o.e.action.search {pull}16758[#16758] (issue: {issue}11710[#11710])
* Simplify the Text API. {pull}15511[#15511]
* Simpler using compressed oops flag representation {pull}15509[#15509] (issue: {issue}15489[#15489])
* Info on compressed ordinary object pointers {pull}15489[#15489] (issues: {issue}13187[#13187], {issue}455[#455])
* Explicitly log cluster state update failures {pull}15428[#15428] (issues: {issue}14899[#14899], {issue}15016[#15016], {issue}15023[#15023])
* Use transport service to handle RetryOnReplicaException to execute replica action on the current node {pull}15363[#15363]
* Make IndexShard operation be more explicit about whether they are expected to run on a primary or replica {pull}15282[#15282]
* Avoid trace logging allocations in TransportBroadcastByNodeAction {pull}15221[#15221]
* Only trace log shard not available exceptions {pull}14950[#14950] (issue: {issue}14927[#14927])
* Transport options should be immutable {pull}14760[#14760]
* Fix dangling comma in ClusterBlock#toString {pull}14483[#14483]
* Improve some logging around master election and cluster state {pull}14481[#14481]
* Add System#exit(), Runtime#exit() and Runtime#halt() to forbidden APIs {pull}14473[#14473] (issue: {issue}12596[#12596])
* Simplify XContent detection. {pull}14472[#14472]
* Add threadgroup isolation. {pull}14353[#14353]
* Cleanup plugin security {pull}14311[#14311]
* Add workaround for JDK-8014008 {pull}14274[#14274]
* Refactor retry logic for TransportMasterNodeAction {pull}14222[#14222]
* Remove MetaDataSerivce and it's semaphores {pull}14159[#14159] (issue: {issue}1296[#1296])
* Cleanup IndexMetaData {pull}14119[#14119]
* Add SpecialPermission to guard exceptions to security policy. {pull}13854[#13854]
* Clean up scripting permissions. {pull}13844[#13844]
* Factor groovy out of core into lang-groovy {pull}13834[#13834] (issue: {issue}13725[#13725])
* More helpful error message on parameter order {pull}13737[#13737]
* Factor expressions scripts out to lang-expression plugin {pull}13726[#13726] (issue: {issue}13725[#13725])
* Cleanup InternalClusterInfoService {pull}13543[#13543]
* Remove and forbid use of com.google.common.base.Throwables {pull}13409[#13409] (issue: {issue}13224[#13224])
* Remove cyclic dependencies between IndexService and FieldData / BitSet caches {pull}13381[#13381]
* Remove and forbid use of com.google.common.base.Objects {pull}13355[#13355] (issue: {issue}13224[#13224])
* Enable indy (invokedynamic) compile flag for Groovy scripts by default {pull}8201[#8201] (issue: {issue}8184[#8184])

Java API::
* Add created flag to IndexingOperationListener#postIndex {pull}17340[#17340] (issue: {issue}17333[#17333])
* Align handling of interrupts in BulkProcessor {pull}15527[#15527] (issue: {issue}14833[#14833])
* BulkProcessor backs off exponentially by default {pull}15513[#15513] (issue: {issue}14829[#14829])
* Reject refresh usage in bulk items when using and fix NPE when no source {pull}15082[#15082] (issue: {issue}7361[#7361])
* BulkProcessor retries after request handling has been rejected due to a full thread pool {pull}14829[#14829] (issue: {issue}14620[#14620])

Logging::
* Log suppressed stack traces under DEBUG {pull}16627[#16627] (issues: {issue}12991[#12991], {issue}15329[#15329], {issue}16622[#16622])
* Add circuit breaker name to logging package {pull}14661[#14661]
* Move logging for the amount of free disk to TRACE {pull}14403[#14403] (issue: {issue}12843[#12843])
* Map log-level 'trace' to JDK-Level 'FINEST' {pull}14234[#14234]

Mapping::
* Expose the reason why a mapping merge is issued. {pull}16059[#16059] (issue: {issue}15989[#15989])
* Add sub-fields support to `bool` fields. {pull}15636[#15636] (issue: {issue}6587[#6587])
* Improve cross-type dynamic mapping updates. {pull}15633[#15633] (issue: {issue}15568[#15568])
* Make mapping updates more robust. {pull}15539[#15539]
* Make mapping serialization more robust. {pull}15480[#15480]
* Make mappings immutable. {pull}15313[#15313] (issue: {issue}9365[#9365])
* Make MappedFieldType.checkTypeName part of MappedFieldType.checkCompatibility. {pull}15245[#15245]
* Register field mappers at the node level. {pull}14896[#14896] (issue: {issue}14828[#14828])

Network::
* Provide better error message when an incompatible node connects to a node {pull}17182[#17182] (issue: {issue}17090[#17090])
* Add additional fallback to http.publish_port and restrict fallback to transport.publish_port {pull}16626[#16626] (issue: {issue}14535[#14535])
* only allow code to bind to the user's configured port numbers/ranges {pull}14549[#14549]
* Port of publishAddress should match port of corresponding boundAddress {pull}14535[#14535] (issues: {issue}14503[#14503], {issue}14513[#14513], {issue}14514[#14514])

Packaging::
* Windows service: Use JAVA_HOME environment variable in registry {pull}16552[#16552] (issue: {issue}13521[#13521])
* Default standard output to the journal in systemd {pull}16159[#16159] (issues: {issue}15315[#15315], {issue}16134[#16134])
* Use egrep instead of grep -E for Solaris {pull}15755[#15755] (issue: {issue}15628[#15628])
* punch thru symlinks when loading plugins/modules {pull}15311[#15311]
* set ActiveProcessLimit=1 on windows {pull}15055[#15055]
* set RLIMIT_NPROC = 0 on bsd/os X systems. {pull}15039[#15039]
* Drop ability to execute on Solaris {pull}14200[#14200]
* Nuke ES_CLASSPATH appending, JarHell fail on empty classpath elements {pull}13880[#13880] (issues: {issue}13812[#13812], {issue}13864[#13864])
* improve seccomp syscall filtering {pull}13829[#13829]
* Block process execution with seccomp on linux/amd64 {pull}13753[#13753]
* Get lang-javascript, lang-python, securemock ready for script refactoring {pull}13695[#13695]
* Remove some bogus permissions only needed for tests. {pull}13620[#13620]
* Remove java.lang.reflect.ReflectPermission "suppressAccessChecks" {pull}13603[#13603]
* Remove JAVA_HOME detection from the debian init script {pull}13514[#13514] (issues: {issue}13403[#13403], {issue}9774[#9774])

Plugin Cloud AWS::
* Add ap-northeast-2 (seoul) endpoints for EC2 discovery and S3 snapshots {pull}16167[#16167] (issue: {issue}16166[#16166])
* Add aws canned acl {pull}14297[#14297] (issue: {issue}14103[#14103])
* Improved building of disco nodes {pull}14155[#14155]
* Enable S3SignerType {pull}13360[#13360] (issue: {issue}13332[#13332])

Plugin Cloud Azure::
* Add support for secondary azure storage account {pull}13779[#13779] (issue: {issue}13228[#13228])

Plugin Cloud GCE::
* cloud-gce plugin should check `discovery.type` {pull}13809[#13809] (issue: {issue}13614[#13614])
* Adding backoff from retries on GCE errors {pull}13671[#13671] (issue: {issue}13460[#13460])

Plugin Discovery EC2::
* Adding US-Gov-West {pull}14358[#14358]

Plugin Ingest Attachment::
* Fix attachments plugins with docx {pull}17059[#17059] (issue: {issue}16864[#16864])

Plugins::
* Expose http.type setting, and collapse al(most all) modules relating to transport/http {pull}15434[#15434] (issue: {issue}14148[#14148])
* Ban RuntimePermission("getClassLoader") {pull}15253[#15253]
* Add nicer error message when a plugin descriptor is missing {pull}15200[#15200] (issue: {issue}15197[#15197])
* Don't be lenient in PluginService#processModule(Module) {pull}14306[#14306]
* Adds a validation for plugins script to check if java is set {pull}13633[#13633] (issue: {issue}13613[#13613])
* Output plugin info only in verbose mode {pull}12908[#12908] (issue: {issue}12907[#12907])

Query DSL::
* Allow CIDR notation in query string query {pull}14773[#14773] (issue: {issue}7464[#7464])
* Internal: simplify filtered query conversion to lucene query {pull}13312[#13312] (issue: {issue}13272[#13272])

REST::
* Make XContentGenerator.writeRaw* safer. {pull}15358[#15358]
* Filter path refactoring {pull}14390[#14390] (issues: {issue}10980[#10980], {issue}11560[#11560], {issue}13344[#13344])

Recovery::
* Handle cancel exceptions on recovery target if the cancel comes from the source {pull}15309[#15309]
* Decouple routing and primary operation logic in TransportReplicationAction {pull}14852[#14852]

Reindex API::
* Implement helpful interfaces in reindex requests {pull}17032[#17032]
* Reindex should timeout if sub-requests timeout {pull}16962[#16962]
* Teach reindex to retry on rejection {pull}16556[#16556] (issue: {issue}16093[#16093])

Scripting::
* Remove suppressAccessChecks permission for Groovy script plugin {pull}16839[#16839] (issue: {issue}16527[#16527])
* Class permission for Groovy references {pull}16660[#16660] (issue: {issue}16657[#16657])
* Scripting: Allow to get size of array in mustache {pull}16193[#16193]
* Enhancements to the mustache script engine {pull}15661[#15661]
* Add property permissions so groovy scripts can serialize json {pull}14500[#14500] (issue: {issue}14488[#14488])
* Remove ScriptEngineService.unwrap. {pull}13958[#13958]
* Remove ScriptEngineService.execute. {pull}13956[#13956]

Search::
* Caching Weight wrappers should propagate the BulkScorer. {pull}14317[#14317]
* fix numerical issue in function score query {pull}14085[#14085]
* Optimize scrolls for constant-score queries. {pull}13311[#13311]

Settings::
* Log warning if max file descriptors too low {pull}16506[#16506]

Snapshot/Restore::
* Support wildcards for getting repositories and snapshots {pull}15151[#15151] (issue: {issue}4758[#4758])
* Add ignore_unavailable parameter to skip unavailable snapshot {pull}14471[#14471] (issue: {issue}13887[#13887])
* Simplify the BlobContainer blob writing interface {pull}13434[#13434]

Stats::
* Pull Fields instance once from LeafReader in completion stats {pull}15090[#15090] (issue: {issue}6593[#6593])
* Add os.allocated_processors stats {pull}14409[#14409] (issue: {issue}13917[#13917])
* Adds stats counter for failed indexing requests {pull}13130[#13130] (issue: {issue}8938[#8938])

Top Hits::
* Put method addField on TopHitsBuilder {pull}14597[#14597] (issue: {issue}12962[#12962])

Translog::
* Check for tragic event on all kinds of exceptions not only ACE and IOException {pull}15535[#15535]

Tribe Node::
* Tribe nodes should apply cluster state updates in batches {pull}14993[#14993] (issues: {issue}14725[#14725], {issue}14899[#14899])

[float]
=== Bug Fixes


Aggregations::
* Prevents exception being raised when ordering by an aggregation which wasn't collected {pull}17379[#17379] (issue: {issue}17225[#17225])
* Setting 'other' bucket on empty aggregation {pull}17264[#17264] (issue: {issue}16546[#16546])
* Build empty extended stats aggregation if no docs collected for bucket {pull}16972[#16972] (issues: {issue}16812[#16812], {issue}9544[#9544])
* Set meta data for pipeline aggregations {pull}16516[#16516] (issue: {issue}16484[#16484])
* Filter(s) aggregation should create weights only once. {pull}15998[#15998]
* Make `missing` on terms aggs work with all execution modes. {pull}15746[#15746] (issue: {issue}14882[#14882])
* Run pipeline aggregations for empty buckets added in the Range Aggregation {pull}15519[#15519] (issue: {issue}15471[#15471])
* [Children agg] fix bug that prevented all child docs from being evaluated {pull}15457[#15457]
* Correct typo in class name of StatsAggregator {pull}15321[#15321] (issue: {issue}14730[#14730])
* Fix significant terms reduce for long terms {pull}14948[#14948] (issue: {issue}13522[#13522])
* Fix NPE in Derivative Pipeline when current bucket value is null {pull}14745[#14745]
* Pass extended bounds into HistogramAggregator when creating an unmapped aggregator {pull}14742[#14742] (issue: {issue}14735[#14735])
* Added correct generic type parameter on ScriptedMetricBuilder {pull}14018[#14018] (issue: {issue}13986[#13986])
* Pipeline Aggregations at the root of the agg tree are now validated {pull}13475[#13475] (issue: {issue}13179[#13179])

Aliases::
* Fix _aliases filter and null parameters {pull}16553[#16553] (issues: {issue}16547[#16547], {issue}16549[#16549])

Allocation::
* IndicesStore checks for `allocated elsewhere` for every shard not alocated on the local node {pull}17106[#17106]
* Prevent peer recovery from node with older version {pull}15775[#15775]
* Fix calculation of next delay for delayed shard allocation {pull}14765[#14765]
* Take ignored unallocated shards into account when making allocation decision {pull}14678[#14678] (issue: {issue}14670[#14670])
* Only allow rebalance operations to run if all shard store data is available {pull}14591[#14591] (issue: {issue}14387[#14387])
* Delayed allocation can miss a reroute {pull}14494[#14494] (issues: {issue}14010[#14010], {issue}14011[#14011], {issue}14445[#14445])
* Check rebalancing constraints when shards are moved from a node they can no longer remain on {pull}14259[#14259] (issue: {issue}14057[#14057])

Analysis::
* Analysis : Allow string explain param in JSON {pull}16977[#16977] (issue: {issue}16925[#16925])
* Analysis : Fix no response from Analyze API without specified index {pull}15447[#15447] (issue: {issue}15148[#15148])

Bulk::
* Bulk api: fail deletes when routing is required but not specified {pull}16675[#16675] (issues: {issue}10136[#10136], {issue}16645[#16645])
* Do not release unacquired semaphore {pull}14909[#14909] (issue: {issue}14908[#14908])

CAT API::
* Fix column aliases in _cat/indices, _cat/nodes and _cat/shards APIs {pull}17145[#17145] (issue: {issue}17101[#17101])
* Properly set indices and indicesOptions on subrequest made by /_cat/indices {pull}14360[#14360]

CRUD::
* Throw exception if content type could not be determined in Update API {pull}15904[#15904] (issue: {issue}15822[#15822])
* Index name expressions should not be broken up {pull}13691[#13691] (issue: {issue}13665[#13665])

Cache::
* Handle closed readers in ShardCoreKeyMap {pull}16027[#16027]

Cluster::
* Index deletes not applied when cluster UUID has changed {pull}16825[#16825] (issue: {issue}11665[#11665])
* Only fail the relocation target when a replication request on it fails {pull}15791[#15791] (issue: {issue}15790[#15790])
* Handle shards assigned to nodes that are not in the cluster state {pull}14586[#14586] (issue: {issue}14584[#14584])
* Bulk cluster state updates on index deletion {pull}11258[#11258] (issue: {issue}7295[#7295])

Core::
* BitSetFilterCache duplicates its content. {pull}15836[#15836] (issue: {issue}15820[#15820])
* Limit the max size of bulk and index thread pools to bounded number of processors {pull}15585[#15585] (issue: {issue}15582[#15582])
* AllTermQuery's scorer should skip segments that never saw the requested term {pull}15506[#15506]
* Include root-cause exception when we fail to change shard's index buffer {pull}14867[#14867]
* Restore thread interrupt flag after an InterruptedException {pull}14799[#14799] (issue: {issue}14798[#14798])
* Record all bytes of the checksum in VerifyingIndexOutput {pull}13923[#13923] (issues: {issue}13848[#13848], {issue}13896[#13896])
* When shard becomes active again, immediately increase its indexing buffer {pull}13918[#13918] (issue: {issue}13802[#13802])
* Close TokenStream in finally clause {pull}13870[#13870] (issue: {issue}11947[#11947])
* LoggingRunnable.run should catch and log all errors, not just Exception? {pull}13718[#13718] (issue: {issue}13487[#13487])

Exceptions::
* Fix ensureNodesAreAvailable's error message {pull}14007[#14007] (issue: {issue}13957[#13957])

Expressions::
* Check that _value is used in aggregations script before setting value to specialValue {pull}17091[#17091] (issue: {issue}14262[#14262])

Fielddata::
* Don't cache top level field data for fields that don't exist {pull}14693[#14693]

Geo::
* Remove .geohash suffix from GeoDistanceQuery and GeoDistanceRangeQuery {pull}15871[#15871] (issue: {issue}15179[#15179])
* Geo: Allow numeric parameters enclosed in quotes for 'geohash_grid' aggregation {pull}14440[#14440] (issue: {issue}13132[#13132])
* Resync Geopoint hashCode/equals method {pull}14124[#14124] (issue: {issue}14083[#14083])
* Fix GeoPointFieldMapper to index geohash at correct precision. {pull}13649[#13649] (issue: {issue}12467[#12467])

Highlighting::
* Don't override originalQuery with request filters {pull}15793[#15793] (issue: {issue}15689[#15689])
* Fix spans extraction to not also include individual terms. {pull}15516[#15516] (issues: {issue}13239[#13239], {issue}15291[#15291])

Index APIs::
* Field stats: Index constraints should remove indices in the response if the field to evaluate is empty {pull}14868[#14868]
* Field stats: Fix NPE for index constraint on empty index {pull}14841[#14841]
* Field stats: Added `format` option for index constraints {pull}14823[#14823] (issue: {issue}14804[#14804])
* Forbid index name `.` and `..` {pull}13862[#13862] (issue: {issue}13858[#13858])

Inner Hits::
* Query and top level inner hit definitions shouldn't overwrite each other {pull}16222[#16222] (issue: {issue}16218[#16218])

Internal::
* Log uncaught exceptions from scheduled once tasks {pull}15824[#15824] (issue: {issue}15814[#15814])
* FunctionScoreQuery should implement two-phase iteration. {pull}15602[#15602]
* Make sure the remaining delay of unassigned shard is updated with every reroute {pull}14890[#14890] (issue: {issue}14808[#14808])
* Throw a meaningful error when loading metadata and an alias and index have the same name {pull}14842[#14842] (issue: {issue}14706[#14706])
* fixup issues with 32-bit jvm {pull}14609[#14609]
* Failure to update the cluster state with the recovered state should make sure it will be recovered later {pull}14485[#14485]
* Gateway: a race condition can prevent the initial cluster state from being recovered {pull}13997[#13997]
* Verify actually written checksum in VerifyingIndexOutput {pull}13848[#13848]
* An inactive shard is activated by triggered synced flush {pull}13802[#13802]
* Remove all setAccessible in tests and forbid {pull}13539[#13539]
* Remove easy uses of setAccessible in tests. {pull}13537[#13537]
* Ban setAccessible from core code, restore monitoring stats under java 9 {pull}13531[#13531] (issue: {issue}13527[#13527])

Logging::
* Add missing index name to indexing slow log {pull}17026[#17026] (issue: {issue}17025[#17025])
* ParseFieldMatcher should log when using deprecated settings. {pull}16988[#16988]
* Don't log multi-megabyte guice exceptions. {pull}13782[#13782]
* Moving system property setting to before it can be used {pull}13660[#13660] (issue: {issue}13658[#13658])

Mapping::
* Put mapping operations must update metadata of all types. {pull}16264[#16264] (issue: {issue}16239[#16239])
* Fix serialization of `search_analyzer`. {pull}16255[#16255]
* Reuse metadata mappers for dynamic updates. {pull}16023[#16023] (issue: {issue}15997[#15997])
* Fix MapperService#searchFilter(...) {pull}15923[#15923] (issue: {issue}15757[#15757])
* Fix initial sizing of BytesStreamOutput. {pull}15864[#15864] (issue: {issue}15789[#15789])
* MetaDataMappingService should call MapperService.merge with the original mapping update. {pull}15508[#15508]
* MapperService: check index.mapper.dynamic during index creation {pull}15424[#15424] (issue: {issue}15381[#15381])
* Only text fields should accept analyzer and term vector settings. {pull}15308[#15308]
* Mapper parsers should not check for a `tokenized` property. {pull}15289[#15289]
* Validate that fields are defined only once. {pull}15243[#15243] (issue: {issue}15057[#15057])
* Check mapping compatibility up-front. {pull}15175[#15175] (issue: {issue}15049[#15049])
* Don't treat _default_ as a regular type. {pull}15156[#15156] (issue: {issue}15049[#15049])
* Don't ignore mapping merge failures. {pull}15144[#15144] (issue: {issue}15049[#15049])
* Treat mappings at an index-level feature. {pull}15142[#15142]
* Make _type use doc values {pull}14783[#14783] (issue: {issue}14781[#14781])

Network::
* Only accept transport requests after node is fully initialized {pull}16746[#16746] (issue: {issue}16723[#16723])

Packaging::
* Fix waiting for pidfile {pull}16718[#16718] (issue: {issue}16717[#16717])
* Fix Windows service installation failure {pull}15549[#15549] (issue: {issue}15349[#15349])
* Enable es_include at init {pull}15173[#15173]
* Handle system policy correctly {pull}14704[#14704] (issue: {issue}14690[#14690])
* Startup script exit status should catch daemonized startup failures {pull}14170[#14170] (issue: {issue}14163[#14163])
* Don't let ubuntu try to install its crazy jayatana agent. {pull}13813[#13813] (issue: {issue}13785[#13785])

Parent/Child::
* Check that parent_type in Has Parent Query has child types {pull}16923[#16923] (issue: {issue}16692[#16692])
* Has child query forces default similarity {pull}16611[#16611] (issues: {issue}16550[#16550], {issue}4977[#4977])

Percolator::
* Don't replace found fields if map unmapped fields as string is enabled {pull}16043[#16043] (issue: {issue}10500[#10500])
* mpercolate api should serialise start time  {pull}15938[#15938] (issue: {issue}15908[#15908])

Plugin Delete By Query::
* Fix Delete-by-Query with Shield {pull}14658[#14658] (issue: {issue}14527[#14527])

Plugin Discovery GCE::
* Add setFactory permission to GceDiscoveryPlugin {pull}16860[#16860] (issue: {issue}16485[#16485])

Plugin Mapper Attachment::
* Fix toXContent() for mapper attachments field {pull}15110[#15110]

Plugin Repository S3::
* Hack around aws security hole of accessing sun.security.ssl, s3 repository works on java 9 again {pull}13538[#13538] (issue: {issue}432[#432])

Plugins::
* Fix plugin list command error message {pull}14288[#14288] (issue: {issue}14287[#14287])
* Fix HTML response during redirection {pull}11374[#11374] (issue: {issue}11370[#11370])

Query DSL::
* Fix FunctionScore equals/hashCode to include minScore and friends {pull}15676[#15676]
* Min should match greater than the number of optional clauses should return no result {pull}15571[#15571] (issue: {issue}15521[#15521])
* Return a better exception message when `regexp` query is used on a numeric field {pull}14910[#14910] (issue: {issue}14782[#14782])

REST::
* Remove detect_noop from REST spec {pull}16386[#16386]
* Make text parsing less lenient. {pull}15679[#15679]
* Throw exception when trying to write map with null keys {pull}15479[#15479] (issue: {issue}14346[#14346])
* Fix OOM in AbstractXContentParser {pull}15350[#15350] (issue: {issue}15338[#15338])
* XContentFactory.xContentType: allow for possible UTF-8 BOM for JSON XContentType {pull}14611[#14611] (issue: {issue}14442[#14442])
* RestUtils.decodeQueryString ignores the URI fragment when parsing a query string {pull}13365[#13365] (issue: {issue}13320[#13320])

Recovery::
* Try to renew sync ID if `flush=true` on forceMerge {pull}17108[#17108] (issue: {issue}17019[#17019])
* CancellableThreads should also treat ThreadInterruptedException as InterruptedException {pull}15318[#15318]

Reindex API::
* Properly register reindex status {pull}17125[#17125]
* Make search failure cause rest failure {pull}16889[#16889] (issue: {issue}16037[#16037])

Scripting::
* Add permission to access sun.reflect.MethodAccessorImpl from Groovy scripts {pull}16540[#16540] (issue: {issue}16536[#16536])
* Security permissions for Groovy closures {pull}16196[#16196] (issues: {issue}16194[#16194], {issue}248[#248])

Search::
* Do not apply minimum_should_match on auto generated boolean query if the coordination factor is disabled. {pull}16155[#16155]
* Do not apply minimum-should-match on a boolean query if the coords are disabled {pull}16078[#16078] (issue: {issue}15858[#15858])
* Fix blended terms take 2 {pull}15894[#15894] (issue: {issue}15860[#15860])
* Fix NPE when a segment with an empty cache gets closed. {pull}15202[#15202] (issue: {issue}15043[#15043])
* Fix the quotes in the explain message for a script score function without parameters {pull}11398[#11398]

Settings::
* TransportClient should use updated setting for initialization of modules and service {pull}16095[#16095]
* ByteSizeValue.equals should normalize units {pull}13784[#13784]

Snapshot/Restore::
* Prevent closing index during snapshot restore {pull}16933[#16933] (issue: {issue}16321[#16321])
* Add node version check to shard allocation during restore {pull}16520[#16520] (issue: {issue}16519[#16519])
* Snapshot restore and index creates should keep index settings and cluster blocks in sync {pull}13931[#13931] (issue: {issue}13213[#13213])
* Fix blob size in writeBlob() method {pull}13574[#13574] (issue: {issue}13434[#13434])

Stats::
* Fix recovery translog stats totals when recovering from store {pull}16493[#16493] (issue: {issue}15974[#15974])
* Fix calculation of age of pending tasks {pull}15995[#15995] (issue: {issue}15988[#15988])
* Add extra validation into `cluster/stats` {pull}14699[#14699] (issue: {issue}7390[#7390])
* Omit current* stats for OldShardStats {pull}13801[#13801] (issue: {issue}13386[#13386])

Task Manager::
* Fix TaskId#isSet to return true when id is set and not other way around {pull}17307[#17307]
* Don't wait for completion of list tasks tasks when wait_for_completion flag is set {pull}17231[#17231]

Translog::
* Never delete translog-N.tlog file when creation fails {pull}15788[#15788]
* Close recovered translog readers if createWriter fails {pull}15762[#15762] (issue: {issue}15754[#15754])
* Fail and close translog hard if writing to disk fails {pull}15420[#15420] (issue: {issue}15333[#15333])
* Prevent writing to closed channel if translog is already closed {pull}15012[#15012] (issue: {issue}14866[#14866])
* Don't delete temp recovered checkpoint file if it was renamed {pull}14872[#14872] (issue: {issue}14695[#14695])
* Translog recovery can repeatedly fail if we run out of disk {pull}14695[#14695]
* Pending operations in the translog prevent shard from being marked as inactive {pull}13759[#13759] (issue: {issue}13707[#13707])

Tribe Node::
* Passthrough environment and network settings to tribe client nodes {pull}16893[#16893]
* Tribe node: pass path.conf to inner tribe clients {pull}16258[#16258] (issue: {issue}16253[#16253])
* Fix tribe node to load config file for internal client nodes {pull}15300[#15300] (issues: {issue}13383[#13383], {issue}14573[#14573])

[float]
=== Regressions


Analysis::
* Add PathHierarchy type back to path_hierarchy tokenizer for backward compatibility with 1.x {pull}15785[#15785] (issue: {issue}15756[#15756])

Internal::
* Deduplicate concrete indices after indices resolution {pull}14316[#14316] (issues: {issue}11258[#11258], {issue}12058[#12058])

Plugin Cloud Azure::
* Filter cloud azure credentials {pull}14863[#14863] (issues: {issue}13779[#13779], {issue}14843[#14843])

REST::
* Don't return all indices immediately if count of expressions >1 and first expression is * {pull}17033[#17033] (issue: {issue}17027[#17027])

//[float]
//=== Known Issues

[float]
=== Upgrades

Core::
* Upgrade to Lucene 5.5.0 official release {pull}16742[#16742]
* Upgrade to lucene 5.5.0-snapshot-850c6c2 {pull}16615[#16615]
* Upgrade to lucene 5.5.0-snapshot-4de5f1d {pull}16400[#16400] (issues: {issue}16373[#16373], {issue}16399[#16399])
* Update lucene to r1725675 {pull}16114[#16114]
* Upgrade to lucene-5.5.0-snapshot-1721183. {pull}15575[#15575]
* Upgrade Lucene to 5.4.0-snapshot-1715952 {pull}14951[#14951]
* Upgrade Lucene to 5.4.0-snapshot-1714615 {pull}14784[#14784]
* Upgrade to lucene-5.4.0-snapshot-1712973. {pull}14619[#14619]
* update to lucene-5.4.x-snapshot-1711508 {pull}14398[#14398]
* Upgrade to lucene-5.4-snapshot-1710880. {pull}14320[#14320]
* Upgrade to lucene-5.4-snapshot-1708254. {pull}14074[#14074]
* upgrade lucene to r1702265 {pull}13439[#13439]
* Upgrade master to lucene 5.4-snapshot r1701068 {pull}13324[#13324]

Geo::
* Update to spatial4j 0.5 for correct Multi-Geometry {pull}14269[#14269] (issue: {issue}9904[#9904])

Internal::
* Update to Jackson 2.6.2 {pull}13344[#13344] (issues: {issue}10980[#10980], {issue}207[#207], {issue}213[#213])

Plugin Cloud AWS::
* Update AWS SDK version to 1.10.19 {pull}13655[#13655] (issue: {issue}13656[#13656])

Plugin Cloud Azure::
* Upgrade Azure Storage client to 4.0.0 {pull}16084[#16084] (issues: {issue}12567[#12567], {issue}15080[#15080], {issue}15976[#15976])
* Update Azure Service Management API to 0.9.0 {pull}15232[#15232] (issue: {issue}15209[#15209])

Plugin Discovery Azure::
* Upgrade azure SDK to 0.9.3 {pull}17102[#17102] (issues: {issue}17042[#17042], {issue}557[#557])

Plugin Discovery EC2::
* Upgrade to aws 1.10.33 {pull}14672[#14672]

Plugin Lang JS::
* upgrade rhino for plugins/lang-javascript {pull}14466[#14466]

Scripting::
* Upgrade groovy dependency in lang-groovy module to version 2.4.6 {pull}16830[#16830] (issue: {issue}16527[#16527])
