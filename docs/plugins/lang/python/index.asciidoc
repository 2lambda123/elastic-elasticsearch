[[lang-python]]
= Python lang Plugin for Elasticsearch

The Python (jython) language plugin allows to have `python` as the language of scripts to execute.

[lang-python-install]
=== Installation

This plugin can be installed using the plugin manager:

[source,sh]
----------------------------------------------------------------
bin/plugin install elasticsearch-lang-python
----------------------------------------------------------------

The plugin must be installed on every node in the cluster, and each node must
be restarted after installation.

[lang-python-remove]
=== Removal

The plugin can be removed with the following command:

[source,sh]
----------------------------------------------------------------
bin/plugin remove elasticsearch-lang-python
----------------------------------------------------------------

The node must be stopped before removing the plugin.

[lang-python-function-score]
== Using python with function_score

Let's say you want to use `function_score` API using `python`. Here is a way of doing it:

[source,json]
----
DELETE test

PUT test/doc/1
{
  "num": 1.0
}

PUT test/doc/2?refresh
{
  "num": 2.0
}

GET test/_search
{
  "query": {
    "function_score": {
      "script_score": {
        "script": "doc[\"num\"].value * _score",
        "lang": "python"
      }
    }
  }
}
----
// AUTOSENSE

gives

[source,javascript]
----
{
   // ...
   "hits": {
      "total": 2,
      "max_score": 2,
      "hits": [
         {
            // ...
            "_score": 2
         },
         {
            // ...
            "_score": 1
         }
      ]
   }
}
----

[lang-python-script-fields]
== Using python with script_fields

[source,json]
----
DELETE test

PUT test/doc/1?refresh
{
  "obj1": {
   "test": "something"
  },
  "obj2": {
    "arr2": [ "arr_value1", "arr_value2" ]
  }
}

GET test/_search
{
  "script_fields": {
    "s_obj1": {
      "script": "_source[\"obj1\"]", "lang": "python"
    },
    "s_obj1_test": {
      "script": "_source[\"obj1\"][\"test\"]", "lang": "python"
    },
    "s_obj2": {
      "script": "_source[\"obj2\"]", "lang": "python"
    },
    "s_obj2_arr2": {
      "script": "_source[\"obj2\"][\"arr2\"]", "lang": "python"
    }
  }
}
----
// AUTOSENSE

gives

[source,javascript]
----
{
  // ...
  "hits": [
     {
        // ...
        "fields": {
           "s_obj2_arr2": [
              [
                 "arr_value1",
                 "arr_value2"
              ]
           ],
           "s_obj1_test": [
              "something"
           ],
           "s_obj2": [
              {
                 "arr2": [
                    "arr_value1",
                    "arr_value2"
                 ]
              }
           ],
           "s_obj1": [
              {
                 "test": "something"
              }
           ]
        }
     }
  ]
}
----
