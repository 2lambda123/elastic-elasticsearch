setup:
  - do:
      indices.create:
          index: test
          body:
            settings:
              number_of_replicas: 0
            mappings:
              properties:
                double:
                  type: double

  - do:
      cluster.health:
        wait_for_status: green

---
"Double range":
  - do:
      index:
        index: test
        id: 1
        body: { "double" : 42 }

  - do:
      index:
        index: test
        id: 2
        body: { "double" : 100 }

  - do:
      index:
        index: test
        id: 3
        body: { "double" : 50 }

  - do:
      indices.refresh: {}

  - do:
      search:
        rest_total_hits_as_int: true
        body: { "size" : 0, "aggs" : { "double_range" : { "range" : { "field" : "double", "ranges": [ { "to": 50 }, { "from": 50, "to": 150 }, { "from": 150 } ] } } } }

  - match: { hits.total: 3 }
  - length: { aggregations.double_range.buckets: 3 }
  - match: { aggregations.double_range.buckets.0.key: "*-50.0" }
  - is_false: aggregations.double_range.buckets.0.from
  - match: { aggregations.double_range.buckets.0.to: 50.0 }
  - match: { aggregations.double_range.buckets.0.doc_count: 1 }
  - match: { aggregations.double_range.buckets.1.key: "50.0-150.0" }
  - match: { aggregations.double_range.buckets.1.from: 50.0 }
  - match: { aggregations.double_range.buckets.1.to: 150.0 }
  - match: { aggregations.double_range.buckets.1.doc_count: 2 }
  - match: { aggregations.double_range.buckets.2.key: "150.0-*" }
  - match: { aggregations.double_range.buckets.2.from: 150.0 }
  - is_false:  aggregations.double_range.buckets.2.to
  - match: { aggregations.double_range.buckets.2.doc_count: 0 }

  - do:
      search:
        rest_total_hits_as_int: true
        body: { "size" : 0, "aggs" : { "double_range" : { "range" : { "field" : "double", "ranges": [ { "from": null, "to": 50 }, { "from": 50, "to": 150 }, { "from": 150, "to": null } ] } } } }

  - match: { hits.total: 3 }
  - length: { aggregations.double_range.buckets: 3 }
  - match: { aggregations.double_range.buckets.0.key: "*-50.0" }
  - is_false: aggregations.double_range.buckets.0.from
  - match: { aggregations.double_range.buckets.0.to: 50.0 }
  - match: { aggregations.double_range.buckets.0.doc_count: 1 }
  - match: { aggregations.double_range.buckets.1.key: "50.0-150.0" }
  - match: { aggregations.double_range.buckets.1.from: 50.0 }
  - match: { aggregations.double_range.buckets.1.to: 150.0 }
  - match: { aggregations.double_range.buckets.1.doc_count: 2 }
  - match: { aggregations.double_range.buckets.2.key: "150.0-*" }
  - match: { aggregations.double_range.buckets.2.from: 150.0 }
  - is_false:  aggregations.double_range.buckets.2.to
  - match: { aggregations.double_range.buckets.2.doc_count: 0 }
