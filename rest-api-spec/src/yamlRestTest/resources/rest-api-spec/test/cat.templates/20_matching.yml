setup:
    - do:
        indices.put_template:
          name: legacy-1
          body:
            order: 12
            version: 3
            index_patterns: foo*

    - do:
        indices.put_template:
          name: legacy-2
          body:
            order: 45
            version: 6
            index_patterns:
              - bar*
              - baz*

    - do:
        cluster.put_component_template:
          name: test-component-template
          body:
            template:
              settings:
                number_of_shards: 1
                number_of_replicas: 0

    - do:
        indices.put_index_template:
          name: composable-1
          body:
            index_patterns:
              - quux*
            priority: 78
            version: 9
            composed_of:
              - test-component-template

    - do:
        indices.put_index_template:
          name: composable-2
          body:
            index_patterns:
              - gruly*
            priority: 99
            version: 1
            composed_of:
              - test-component-template

---
"Matching all templates":

    - do:
        cat.templates:
            h: [name]
            s: [name]

    - match:
        $body: /^composable-1\ncomposable-2\nlegacy-1\nlegacy-2\n$/

    - do:
        cat.templates:
            name: "x,*"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-1\ncomposable-2\nlegacy-1\nlegacy-2\n$/

---
"Matching all templates with other patterns":
    - skip:
        version: " - 7.99.99"
        reason: "support for multiple patterns added in 8.0.0"

    - do:
        cat.templates:
            name: "nonexistent*,*,other-name"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-1\ncomposable-2\nlegacy-1\nlegacy-2\n$/

---
"Matching no templates":

    - do:
        cat.templates:
            name: "nonexistent"
            h: [name]
            s: [name]

    - match:
        $body: /^$/

---
"Matching single names":

    - do:
        cat.templates:
            name: "legacy-1"
            h: [name]
            s: [name]

    - match:
        $body: /^legacy-1\n$/


    - do:
        cat.templates:
            name: "composable-2"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-2\n$/

---
"Matching single patterns":

    - do:
        cat.templates:
            name: "legacy-*"
            h: [name]
            s: [name]

    - match:
        $body: /^legacy-1\nlegacy-2\n$/


    - do:
        cat.templates:
            name: "*-2"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-2\nlegacy-2\n$/

---
"Matching lists of names":
    - skip:
        version: " - 7.99.99"
        reason: "support for multiple patterns added in 8.0.0"

    - do:
        cat.templates:
            name: "legacy-1,composable-2"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-2\nlegacy-1\n$/

---
"Matching names and wildcards":
    - skip:
        version: " - 7.99.99"
        reason: "support for multiple patterns added in 8.0.0"

    - do:
        cat.templates:
            name: "legacy-1,composable-*"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-1\ncomposable-2\nlegacy-1\n$/

    - do:
        cat.templates:
            name: "legacy-*,composable-2"
            h: [name]
            s: [name]

    - match:
        $body: /^composable-2\nlegacy-1\nlegacy-2\n$/
