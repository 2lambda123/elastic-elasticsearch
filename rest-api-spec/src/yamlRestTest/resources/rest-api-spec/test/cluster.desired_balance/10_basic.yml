---
setup:
    -   skip:
            version: " - 8.5.99"
            reason: "API added in in 8.6.0"
    -   do:
            indices.create:
                index: test
                body:
                    settings:
                        number_of_shards: 2

    -   do:
            bulk:
                index: test
                refresh: true
                body:
                    - '{ "index": {"_id": "1"}}'
                    - '{  "field": "foo" }'
                    - '{ "index": {"_id": "2"}}'
                    - '{ "field": "foo 2" }'
                    - '{ "index": {"_id": "3"}}'
                    - '{ "field": "foo 3" }'
                    - '{ "index": {"_id": "4"}}'
                    - '{ "field": "foo 4" }'
                    - '{ "index": {"_id": "5"}}'
                    - '{ "field": "bar" }'
---
"Test get desired balance":
    -   do:
            _internal.get_desired_balance: { }
    -   gte: { stats.computation_submitted: 0 }
    -   gte: { stats.computation_executed: 0 }
    -   gte: { stats.computation_converged: 0 }
    -   gte: { stats.computation_iterations: 0 }
    -   gte: { stats.computation_converged_index: 0 }
    -   gte: { stats.computation_time_in_millis: 0 }
    -   gte: { stats.reconciliation_time_in_millis: 0 }
    -   match: { routing_table.test.0.current.state: 'STARTED' }
    -   match: { routing_table.test.0.current.primary: true }
    -   match: { routing_table.test.0.current.shard_id: 0 }
    -   match: { routing_table.test.0.current.index: test }
    -   gte: { routing_table.test.0.desired.total: 0 }
    -   gte: { routing_table.test.0.desired.unassigned: 0 }
    -   gte: { routing_table.test.0.desired.ignored: 0 }
    -   match: { routing_table.test.1.current.state: 'STARTED' }
    -   match: { routing_table.test.1.current.primary: true }
    -   match: { routing_table.test.1.current.shard_id: 1 }
    -   match: { routing_table.test.1.current.index: test }
    -   gte: { routing_table.test.1.desired.total: 0 }
    -   gte: { routing_table.test.1.desired.unassigned: 0 }
    -   gte: { routing_table.test.1.desired.ignored: 0 }
