{
  "ml.put_job":{
    "documentation":{
      "url":"https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-put-job.html",
      "description":"Instantiates an anomaly detection job."
    },
    "stability":"stable",
    "visibility":"public",
    "headers":{
      "accept": [ "application/json"],
      "content_type": ["application/json"]
    },
    "url":{
      "paths":[
        {
          "path":"/_ml/anomaly_detectors/{job_id}",
          "methods":[
            "PUT"
          ],
          "parts":{
            "job_id":{
              "type":"string",
              "description":"Identifier for the anomaly detection job. This identifier can contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores. It must start and end with alphanumeric characters."
            }
          }
        }
      ]
    },
    "params":{},
    "body":{
      "description":"The job",
      "required":true,
      "allow_lazy_open":{
        "type":"boolean",
        "required":false,
        "default":false,
        "description":"Advanced configuration option. Specifies whether this job can open when there is insufficient machine learning node capacity for it to be immediately assigned to a node. By default, a machine learning node with capacity to run the job cannot immediately be found, the open anomaly detection jobs API returns an error. However, this is also subject to the cluster-wide `xpack.ml.max_lazy_ml_nodes` setting. If this option is set to `true`, the open anomaly detection jobs API does not return an error and the job waits in the opening state until sufficient machine learning node capacity is available.",
      },
      "analysis_config":{
        "type":"object",
        "description":"The analysis configuration, which specifies how to analyze the data. After you create a job, you cannot change the analysis configuration; all the properties are informational.",
        "required":true
      },
      "analysis_limits":{
        "type":"object",
        "description":"Limits can be applied for the resources required to hold the mathematical models in memory. These limits are approximate and can be set per job. They do not control the memory used by other processes, for example the Elasticsearch Java processes.",
        "required":false
      },
      "background_persist_interval":{
        "type":"time",
        "description":"Advanced configuration option. The time between each periodic persistence of the model. The default value is a randomized value between 3 to 4 hours, which avoids all jobs persisting at exactly the same time. The smallest allowed value is 1 hour.",
        "required":false
      },
      "custom_settings":{
        "type":"object",
        "description":"Advanced configuration option. Contains custom meta data about the job.",
        "required":false
      },
      "daily_model_snapshot_retention_after_days":{
        "type":"long",
        "description":"Advanced configuration option, which affects the automatic removal of old model snapshots for this job. It specifies a period of time (in days) after which only the first snapshot per day is retained. This period is relative to the timestamp of the most recent snapshot for this job. Valid values range from 0 to `model_snapshot_retention_days`. For new jobs, the default value is `1`. For jobs created before version 7.8.0, the default value matches `model_snapshot_retention_days`.",
        "required":false
      },
      "data_description":{
        "type":"object",
        "description":"The data description defines the format of the input data when you send data to the job by using the post data API. Note that when configure a datafeed, these properties are automatically set. When data is received via the post data API, it is not stored in Elasticsearch. Only the results for anomaly detection are retained.",
        "required":true
      },
      "datafeed_config":{
        "type":"object",
        "required":false,
        "aggregations":{
          "type":"object",
          "description":"If set, the datafeed performs aggregation searches. Support for aggregations is limited and should be used only with low cardinality data.",
          "required":false
        },
        "chunking_config":{
          "type":"object",
          "description":"Datafeeds might be required to search over long time periods, for several months or years. This search is split into time chunks in order to ensure the load on Elasticsearch is managed. Chunking configuration controls how the size of these time chunks are calculated and is an advanced configuration option.",
          "required":false
        },
        "datafeed_id":{
          "type":"string",
          "description":"A numerical character string that uniquely identifies the datafeed. This identifier can contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores. It must start and end with alphanumeric characters.",
          "required":false
        },
        "delayed_data_check_config":{
          "type":"object",
          "description":"Specifies whether the datafeed checks for missing data and the size of the window. The datafeed can optionally search over indices that have already been read in an effort to determine whether any data has subsequently been added to the index. If missing data is found, it is a good indication that the query_delay option is set too low and the data is being indexed after the datafeed has passed that moment in time. This check runs only on real-time datafeeds.",
          "required":false
        },
        "frequency":{
          "type":"time",
          "required":false,
          "description":"The interval at which scheduled queries are made while the datafeed runs in real time. The default value is either the bucket span for short bucket spans, or, for longer bucket spans, a sensible fraction of the bucket span. For example: 150s. When frequency is shorter than the bucket span, interim results for the last (partial) bucket are written then eventually overwritten by the full bucket results. If the datafeed uses aggregations, this value must be divisible by the interval of the date histogram aggregation."
        },
        "indices":{
          "type":"array",
          "description":"An array of index names. Wildcards are supported.",
          "required":false
        }, 
        "indices_options" : {
          "type":"object",
          "required":false,
          "description":"Specifies index expansion options that are used during search.",
          "allow_no_indices":{
            "type":"boolean",
            "description":"",
            "description":"Ignore if the source indices expressions resolves to no concrete indices (default: true). Only set if datafeed_config is provided."
          },
          "expand_wildcards":{
            "type":"enum",
            "options":[
              "open",
              "closed",
              "hidden",
              "none",
              "all"
            ],
            "description":"Whether source index expressions should get expanded to open or closed indices (default: open). Only set if datafeed_config is provided."
          },
          "ignore_throttled":{
            "type":"boolean",
            "description":"Ignore indices that are marked as throttled (default: true). Only set if datafeed_config is provided."
          },
          "ignore_unavailable":{
            "type":"boolean",
            "description":"Ignore unavailable indexes (default: false). Only set if datafeed_config is provided."
          }
        },
        "max_empty_searches":
        {
          "type":"integer",
          "required":false,
          "description":"If a real-time datafeed has never seen any data (including during any initial training period) then it will automatically stop itself and close its associated job after this many real-time searches that return no documents. In other words, it will stop after frequency times `max_empty_searches` of real-time operation. If not set then a datafeed with no end time that sees no data will remain started until it is explicitly stopped. By default, this setting is not set."
        },
        "query":{
          "type":"object",
          "description":"The Elasticsearch query domain-specific language (DSL). This value corresponds to the query object in an Elasticsearch search POST body. All the options that are supported by Elasticsearch can be used, as this object is passed verbatim to Elasticsearch. By default, this property has the following value: `{"match_all": {"boost": 1}}`.",
          "required":false 
        },
        "query_delay":{
          "type":"time",
          "description":"The number of seconds behind real time that data is queried. For example, if data from 10:04 a.m. might not be searchable in Elasticsearch until 10:06 a.m., set this property to 120 seconds. The default value is randomly selected between 60s and 120s. This randomness improves the query performance when there are multiple jobs running on the same node.",
          "required":false
        },
        "runtime_mappings":{
          "type":"object",
          "description":"Specifies runtime fields for the datafeed search.",
          "required":false
        },
        "script_fields":{
          "type":"object",
          "description":"Specifies scripts that evaluate custom expressions and returns script fields to the datafeed. The detector configuration objects in a job can contain functions that use these script fields.",
          "required":false
        },
        "scroll_size":{
          "type":"unsigned integer",
          "required":false,
          "default":"1000",
          "description":"The size parameter that is used in Elasticsearch searches when the datafeed does not use aggregations. The maximum value is the value of `index.max_result_window` which is 10,000 by default."
        } 
      },
      "description":{
        "type":"string",
        "description":"A description of the job.",
        "required":false
      },
      "groups":{
        "type":"array of strings",
        "description":"A list of job groups. A job can belong to no groups or many.",
        "required":false
      },
      "model_plot_config":{
        "type":"object",
        "description":"This advanced configuration option stores model information along with the results. It provides a more detailed view into anomaly detection. If you enable model plot it can add considerable overhead to the performance of the system; it is not feasible for jobs with many entities. Model plot provides a simplified and indicative view of the model and its bounds. It does not display complex features such as multivariate correlations or multimodal data. As such, anomalies may occasionally be reported which cannot be seen in the model plot. Model plot config can be configured when the job is created or updated later. It must be disabled if performance issues are experienced.",
        "required":false
      },
      "model_snapshot_retention_days":{
        "type":"long",
        "default":"10",
        "description":"Advanced configuration option, which affects the automatic removal of old model snapshots for this job. It specifies the maximum period of time (in days) that snapshots are retained. This period is relative to the timestamp of the most recent snapshot for this job. By default, snapshots ten days older than the newest snapshot are deleted.",
        "required":false
      },
      "renormalization_window_days":{
        "type":"long",
        "description":"Advanced configuration option. The period over which adjustments to the score are applied, as new data is seen. The default value is the longer of 30 days or 100 bucket spans.",
        "required":false
      },
      "results_index_name":{
        "type":"string",
        "default":"shared",
        "description":"A text string that affects the name of the machine learning results index. By default, it generates an index named .ml-anomalies-shared.",
        "required":false
      },
      "results_retention_days":{
        "type":"long",
        "description":"Advanced configuration option. The period of time (in days) that results are retained. Age is calculated relative to the timestamp of the latest bucket result. If this property has a non-null value, once per day at 00:30 (server time), results that are the specified number of days older than the latest bucket result are deleted from Elasticsearch. The default value is null, which means all results are retained.",
        "required":false
      }
    }
  }
}