---
"shard failures":
  - do:
      indices.create:
        index: text
        body:
          settings:
            number_of_replicas: 0
            number_of_shards: 1
          mappings:
            doc:
              properties:
                creation_date:
                  type: keyword

  - do:
      indices.create:
        index: date
        body:
          settings:
            number_of_replicas: 0
            number_of_shards: 3
          mappings:
            doc:
              properties:
                creation_date:
                  type: date

  - do:
      msearch:
        body:
          - index: text,date
          - { query: { match: { creation_date: text} } }

  - length: { responses.0._shards.failures: 1  }
  - match: { responses.0._shards.failed: 3}
  - match: { responses.0._shards.total: 4}
  - match: { responses.0._shards.successful: 1}

  - do:
      msearch:
        group_shard_failures: false
        body:
          - index: text,date
          - { query: { match: { creation_date: text} } }

  - length:   { responses.0._shards.failures: 3  }
  - match: { responses.0._shards.failed: 3}
  - match: { responses.0._shards.total: 4}
  - match: { responses.0._shards.successful: 1}
