setup:
  - do:
      indices.create:
          index: test_1
          body:
            settings:
              number_of_replicas: 0
            mappings:
              doc:
                properties:
                  int_field:
                     type : integer
                  double_field:
                     type : double
                  string_field:
                     type: keyword

  - do:
       bulk:
         refresh: true
         body:
           - index:
               _index: test_1
               _type:  doc
               _id:    1
           - int_field: 1
             double_field: 1.0
             string_field: foo
           - index:
               _index: test_1
               _type:  doc
               _id:    2
           - int_field: 51
             double_field: 51.0
             string_field: foo
           - index:
               _index: test_1
               _type:  doc
               _id:    3
           - int_field: 101
             double_field: 101.0
             string_field: foo
           - index:
               _index: test_1
               _type:  doc
               _id:    4
           - int_field: 151
             double_field: 151.0
             string_field: foo

---
"Dots in agg names":

  - skip:
      version: " - 6.3.99"
      reason: this feature was deprecated in 6.4.0
      features: "warnings"
  - do:
      warnings:
        - "Dots in aggregation names are deprecated and will be removed in 8.0"
      search:
        body:
          aggs:
            dots.in.agg.name:
              avg:
                field: int_field

  - match: { hits.total: 4 }
  - length: { hits.hits: 4 }
  - match:
      aggregations:
        dots.in.agg.name:
          value: 76.0


