setup:
  - skip:
      version: " - 6.99.99"
      reason:  "Implemented in 7.0"

  - do:
        indices.create:
          index:  test
          body:
            mappings:
              test:
                properties:
                  text:
                    type: text
                    analyzer: standard
  - do:
        bulk:
          refresh: true
          body:
            - '{"index": {"_index": "test", "_type": "test", "_id": "1"}}'
            - '{"text" : "Some like it hot, some like it cold"}'
            - '{"index": {"_index": "test", "_type": "test", "_id": "2"}}'
            - '{"text" : "Its cold outside, theres no kind of atmosphere"}'
            - '{"index": {"_index": "test", "_type": "test", "_id": "3"}}'
            - '{"text" : "Baby its cold there outside"}'
            - '{"index": {"_index": "test", "_type": "test", "_id": "4"}}'
            - '{"text" : "Outside it is cold and wet"}'

---
"Test ordered matching":
  - do:
        search:
          index: test
          body:
            query:
              intervals:
                field: text
                source:
                  match:
                    text: "cold outside"
                    type: ordered
  - match: { hits.total: 2 }

---
"Test default unordered matching":
  - do:
        search:
          index: test
          body:
            query:
              intervals:
                field: text
                source:
                  match:
                    text: "cold outside"
  - match: { hits.total: 3 }

---
"Test explicit unordered matching":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                match:
                  text: "cold outside"
                  type: "unordered"
  - match: { hits.total: 3 }

---
"Test phrase matching":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                match:
                  text: "cold outside"
                  type: "phrase"
  - match: { hits.total: 1 }

---
"Test unordered max_width matching":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                match:
                  text: "cold outside"
                  max_width: 3
  - match: { hits.total: 2 }

---
"Test ordered max_width matching":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                match:
                  text: "cold outside"
                  max_width: 2
                  type: ordered
  - match: { hits.total: 1 }

---
"Test ordered combination with max_width":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                combine:
                  sources:
                    - match:
                        text: "cold"
                    - match:
                        text: "outside"
                  max_width: 2
                  type: ordered
  - match: { hits.total: 1 }

---
"Test ordered combination":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                combine:
                  sources:
                    - match:
                        text: "cold"
                    - match:
                        text: "outside"
                  type: ordered
  - match: { hits.total: 2 }

---
"Test unordered combination":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                combine:
                  sources:
                    - match:
                        text: "cold"
                    - match:
                        text: "outside"
                  max_width: 3
                  type: unordered
  - match: { hits.total: 2 }

---
"Test block combination":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                combine:
                  sources:
                    - match:
                        text: "cold"
                    - match:
                        text: "outside"
                  type: block
  - match: { hits.total: 1 }


---
"Test containing":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                relate:
                  source:
                    combine:
                      sources:
                        - match:
                            text: "cold"
                        - match:
                            text: "outside"
                      type: unordered
                  filter:
                    match:
                        text: "is"
                  relation: containing
  - match: { hits.total: 1 }


---
"Test not containing":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                relate:
                  source:
                    combine:
                      sources:
                        - match:
                            text: "cold"
                        - match:
                            text: "outside"
                      type: unordered
                  filter:
                    match:
                      text: "is"
                  relation: not_containing
  - match: { hits.total: 2 }

---
"Test contained_by":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                relate:
                  source:
                    match:
                      text: "is"
                  filter:
                    combine:
                      sources:
                        - match:
                            text: "cold"
                        - match:
                            text: "outside"
                      type: unordered
                  relation: contained_by
  - match: { hits.total: 1 }

---
"Test not_contained_by":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                relate:
                  source:
                    match:
                      text: "it"
                  filter:
                    combine:
                      sources:
                        - match:
                            text: "cold"
                        - match:
                            text: "outside"
                      type: unordered
                  relation: not_contained_by
  - match: { hits.total: 1 }

---
"Test not_overlapping":
  - do:
      search:
        index: test
        body:
          query:
            intervals:
              field: text
              source:
                relate:
                  source:
                    combine:
                      sources:
                        - match:
                            text: "cold"
                        - match:
                            text: "outside"
                      type: ordered
                  filter:
                    combine:
                      sources:
                        - match:
                            text: "baby"
                        - match:
                            text: "there"
                      type: unordered
                  relation: not_overlapping
  - match: { hits.total: 1 }


