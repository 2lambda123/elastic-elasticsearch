setup:
  - skip:
      version: " - 7.9.99" #TODO adjust to 7.0.99 after merging to 7.x
      reason:  "Implemented in 7.1"

  - do:
      indices.create:
        index: index1
        body:
          settings:
            number_of_replicas: 0
          mappings:
            properties:
              my_long:
                type: long
              my_date:
                type: date
              my_geo:
                type: geo_point

  - do:
      bulk:
        refresh: true
        body:
        - '{ "index" : { "_index" : "index1", "_id" : "1" } }'
        - '{ "my_long" : 22, "my_date": "2018-02-01T10:00:30Z", "my_geo": [-71.34, 41.13] }'
        - '{ "index" : { "_index" : "index1", "_id" : "2" } }'
        - '{ "my_long" : 25, "my_date": "2018-02-01T11:00:30Z", "my_geo": [-71.34, 41.14] }'
        - '{ "index" : { "_index" : "index1", "_id" : "3" } }'
        - '{ "my_long" : 19, "my_date": "2018-02-01T09:00:30Z", "my_geo": [-71.34, 41.12] }'

---
"test distance_feature query on long type":

  - do:
      search:
        rest_total_hits_as_int: true
        index: index1
        body:
          query:
            distance_feature:
              field: my_long
              pivot: 5
              origin: 15

  - length: { hits.hits: 3 }
  - match: { hits.hits.0._id: "3" }
  - match: { hits.hits.1._id: "1" }
  - match: { hits.hits.2._id: "2" }

---
"test distance_feature query on date type":

- do:
    search:
      rest_total_hits_as_int: true
      index: index1
      body:
        query:
          distance_feature:
            field: my_date
            pivot: 1h
            origin: 2018-02-01T08:00:30Z

- length: { hits.hits: 3 }
- match: { hits.hits.0._id: "3" }
- match: { hits.hits.1._id: "1" }
- match: { hits.hits.2._id: "2" }

---
"test distance_feature query on geo_point type":

- do:
    search:
      rest_total_hits_as_int: true
      index: index1
      body:
        query:
          distance_feature:
            field: my_geo
            pivot: 1km
            origin: [-71.35, 41.12]

- length: { hits.hits: 3 }
- match: { hits.hits.0._id: "3" }
- match: { hits.hits.1._id: "1" }
- match: { hits.hits.2._id: "2" }
