setup:
  - skip:
      version: " - 7.0.99"
      reason: index_prefixes is only available as of 6.3.0

  - do:
      indices.create:
        index:  test
        body:
          mappings:
            properties:
              my_field:
                type: text

  - do:
      index:
        index: test
        id: 1
        body:
          my_field: "red fox jump"

  - do:
      index:
        index: test
        id: 2
        body:
          my_field: "red fox"

  - do:
      index:
        index: test
        id: 3
        body:
          my_field: "jumparound"

  - do:
      index:
        index: test
        id: 4
        body:
          my_field: "dog"

  - do:
      indices.refresh: {}

---
"scoring":

  - do:
      search:
        rest_total_hits_as_int: true
        index: test
        body:
          query:
            bool_prefix:
              my_field: "red fox jump"

  - match: { hits.total: 3 }
  - match: { hits.hits.0._source.my_field: "red fox jump" }
  - match: { hits.hits.1._source.my_field: "red fox" }
  - match: { hits.hits.2._source.my_field: "jumparound" }

---
"minimum should match":

  - do:
      search:
        rest_total_hits_as_int: true
        index: test
        body:
          query:
            bool_prefix:
              my_field:
                query: "red fox jump"
                minimum_should_match: 3

  - match: { hits.total: 1 }
  - match: { hits.hits.0._source.my_field: "red fox jump" }

---
"analyzer":

  - do:
      search:
        rest_total_hits_as_int: true
        explain: true
        index: test
        body:
          query:
            bool_prefix:
              my_field:
                query: "RED dog"
                analyzer: whitespace

  - match: { hits.total: 1 }
  - match: { hits.hits.0._source.my_field: "dog" }
