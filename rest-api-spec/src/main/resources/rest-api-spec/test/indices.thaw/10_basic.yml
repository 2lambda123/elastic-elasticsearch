---
"Basic test for index freeze/unfreeze":
  - skip:
      version: " - 6.99.99"
      reason: this feature didn't exist until 7.0

  - do:
      indices.create:
        index: test_index
        body:
          settings:
            number_of_replicas: 0

  - do:
      cluster.health:
        wait_for_status: green

  - do:
      index:
        index: test_index
        type: _doc
        id: 1
        body: { "foo": "bar" }
        refresh: wait_for

  - do:
      indices.freeze:
        index: test_index

  - do:
      search:
        index: test_index

  - do:
      catch: /index frozen \(read only\)/
      index:
        index: test_index
        type: _doc
        id: 2
        body: { "foo": "bar" }

  - do:
      indices.unfreeze:
        index: test_index

  - do:
      search:
        index: test_index
  - length: { hits.hits: 1 }
  - match: { hits.hits.0._source.foo: bar }

---
"Unfreeze index with wait_for_active_shards set to all":
  - skip:
      version: " - 6.9.99"
      reason: freeze/unfreeze was added in 7.0

  - do:
      indices.create:
        index: test_index
        body:
          settings:
            number_of_replicas: 0

  - do:
      indices.freeze:
        index: test_index

  - do:
      indices.unfreeze:
        index: test_index
        wait_for_active_shards: all

  - match: { acknowledged: true }
  - match: { shards_acknowledged: true }
