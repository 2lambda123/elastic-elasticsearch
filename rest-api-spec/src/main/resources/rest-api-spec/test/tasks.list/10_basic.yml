---
"tasks_list test":
  - skip:
      features: [arbitrary_key]

  - do:
      nodes.info: {}
  - set:
      nodes._arbitrary_key_: node_id

  - do:
      tasks.list: {}

  - is_true: nodes
  - is_true: nodes.$node_id.roles

  - do:
      tasks.list:
        group_by: parents

  - is_true: tasks

---
"tasks_list headers":
  - skip:
      features: headers

  - do:
      headers: { "X-Opaque-Id": "That is me" }
      tasks.list:
        actions: "cluster:monitor/tasks/lists"
        group_by: none

  - is_true: tasks
  - match: { tasks.0.headers.X-Opaque-Id: "That is me" }
---
"tasks_list on description":
  - skip:
      # change after backport
      version: " - 7.99.99"
      reason: support for listing tasks via description was not added until 7.13.0

  - do:
      tasks.list:
        actions: "cluster:monitor/tasks/lists"
        detailed: true
        descriptions: "anything*"

  - length: { tasks: 0 }

  - do:
      tasks.list:
        actions: "cluster:monitor/tasks/lists"
        detailed: true
        descriptions: "*"

  - length: { tasks: 1 }

  - do:
      catch: /matching on descriptions is not available when \[detailed\] is false/
      tasks.list:
        actions: "cluster:monitor/tasks/lists"
        descriptions: "*"

