---
"Help - node level":
  - do:
      cat.fielddata:
        help: true

  - match:
      $body: |
               /^  id    .+ \n
                   host  .+ \n
                   ip    .+ \n
                   node  .+ \n
                   total .+ \n
               $/

---
"Help - field level":
  - do:
      cat.fielddata:
        fields: '*'
        help: true

  - match:
      $body: |
               /^  id    .+ \n
                   host  .+ \n
                   ip    .+ \n
                   node  .+ \n
                   total .+ \n
                   field .+ \n
                   size  .+ \n
               $/

---
"Test cat fielddata output":

  - do:
      cat.fielddata:
        v: false

  - do:
      index:
        index: index
        type: type
        body: { foo: bar }
        refresh: true

# no fielddata => no output on field level
  - do:
      cat.fielddata:
        h: total
        fields: '*'
        v: false
  - match:
      $body: |
               /^$/

# no fielddata => still have node totals on node level
  - do:
      cat.fielddata:
        h: total
        v: false
  - match:
      $body: |
               /^ (\s* \d+(\.\d+)?[gmk]?b \s* \n)+ $/


  - do:
      search:
        index: index
        body:
          query: { match_all: {} }
          sort: foo
  

#field level data on foo
  - do:
      cat.fielddata:
        h: total,field,size
        fields: '*'
        v: true

  - match:
      $body: |
               /^        total               \s+ field  \s+ size                 \s+ \n
                    (\s* \d+(\.\d+)?[gmk]?b  \s+ foo    \s+ (\d+(\.\d+)?[gmk]?b) \s* \n)* 
                $/


#no fielddata on field "notfoo" => no output on field level
  - do:
      cat.fielddata:
        h: total,field,size
        fields: notfoo
        v: false

  - match:
      $body: |
               /^$/
