---
"Stored script":

  - skip:
      features: groovy_scripting

  - do:
      put_script:
        id: "1"
        body: {
            "script": {
                "lang": "groovy",
                "code": "_score * doc[\"myParent.weight\"].value"
            }
        }
  - match: { acknowledged: true }

  - do:
     get_script:
       id: "1"
  - match: { found: true }
  - match: { lang: groovy }
  - match: { id: "1" }
  - match: { "code":  "_score * doc[\"myParent.weight\"].value" }

  - do:
     catch: missing
     get_script:
       id: "2"
  - match: { found: false }
  - match: { id: "2" }
  - is_false: script

  - do:
     delete_script:
       id: "1"
  - match: { acknowledged: true }

  - do:
     catch: missing
     delete_script:
       id: "non_existing"

  - do:
      catch: request
      put_script:
        id: "1"
        body: { "script": { "lang": "groovy", "code": "_score * foo bar + doc[\"myParent.weight\"].value" } }


  - do:
      catch: /script_exception,.+Error.compiling.script.*/
      put_script:
        id: "1"
        body: { "script": { "lang": "groovy", "code": "_score * foo bar + doc[\"myParent.weight\"].value" } }

  - do:
      catch: /resource_not_found/
      put_script:
        id: "1"
        body: { "script" : { "lang": "foobar", "code": "_score * doc[\"myParent.weight\"].value" } }

  - do:
      catch: /script.lang.\[foobar\].does.not.exist/
      put_script:
        id: "1"
        body: { "script" : { "lang": "foobar", "code": "_score * doc[\"myParent.weight\"].value" } }

