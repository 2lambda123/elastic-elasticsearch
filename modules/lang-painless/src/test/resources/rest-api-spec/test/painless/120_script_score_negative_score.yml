# Integration tests for ScriptScoreQuery using Painless
setup:
  - skip:
      version: " - 7.6.99"
      reason: "script_score negative score was not allowed again from 7.7"
  - do:
      indices.create:
        index: test_index
        body:
          settings:
            index:
              number_of_shards: 1
              number_of_replicas: 0
          mappings:
            properties:
              k:
                type: keyword

  - do:
      index:
        index: test_index
        id: 1
        body: { "k": "value" }
        refresh: true

---
"script_score should error on negative score":
    - do:
        catch: /.*script_score script returned an invalid score \[-1000.0\] for doc \[0\].*/
        search:
          index: test_index
          body:
            query:
              script_score:
                query: {match_all: {}}
                script:
                  source: "-1000"
