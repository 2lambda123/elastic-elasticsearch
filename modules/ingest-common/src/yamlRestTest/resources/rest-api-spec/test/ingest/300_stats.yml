setup:
  - do:
      ingest.put_pipeline:
        id: "pipeline1"
        body: >
          {
            "processors": [
              {
                "set": {
                  "tag": "set-a",
                  "field": "a",
                  "value": "1"
                }
              },
              {
                "set": {
                  "tag": "set-b",
                  "field": "b",
                  "value": "2",
                  "if": "false"
                }
              },
              {
                "set": {
                  "tag": "set-c",
                  "field": "c",
                  "value": "3",
                  "ignore_failure": true
                }
              },
              {
                "set": {
                  "tag": "set-d",
                  "field": "d",
                  "value": "4",
                  "if": "true",
                  "ignore_failure": true
                }
              }
            ]
          }
  - do:
      bulk:
        body:
          - index:
              _index: test_index
              _id:    test_id1
              pipeline: pipeline1
          - f1: v1

---
teardown:
  - do:
      ingest.delete_pipeline:
        id: "pipeline1"
        ignore: 404

---
"Test processor names and types from the node stats":
  - do:
      cluster.state: {}
    # Get master node id
  - set: { master_node: master }

  - do:
      nodes.stats:
        metric: [ ingest ]
  - match: {nodes.$master.ingest.pipelines.pipeline1.processors.0.set:set-a.type: "set"}
  - match: {nodes.$master.ingest.pipelines.pipeline1.processors.1.set:set-b.type: "conditional"}
  - match: {nodes.$master.ingest.pipelines.pipeline1.processors.2.set:set-c.type: "set"}
  - match: {nodes.$master.ingest.pipelines.pipeline1.processors.3.compound:CompoundProcessor-set-d.type: "conditional"}

---
"Test processor call count from the cluster stats":
  - do:
      cluster.stats: {}
  - match: { nodes.ingest.processor_stats.set.count: 2 }
  - match: { nodes.ingest.processor_stats.conditional.count: 1 }
