setup:
  - skip:
      version: " - 7.1.0"
      reason: "added in 7.1.0"

  - do:
      indices.create:
        index: test
        body:
          settings:
            number_of_replicas: 0
          mappings:
            properties:
              a_field:
                type: search_as_you_type
                analyzer: simple
                max_shingle_size: 4
              text_field:
                type: text
                analyzer: simple

  - do:
      index:
        index: test
        type: _doc
        id: 1
        body:
          a_field: "quick red fox lazy brown dog"
          text_field: "quick red fox lazy brown dog"

  - do:
      indices.refresh: {}

---
"phrase query unified with full term":

  - do:
      search:
        rest_total_hits_as_int: true
        index: test
        body:
          query:
            match_phrase:
              a_field: "red"
          highlight:
            fields:
              a_field:
                type: unified

  - match: { hits.total: 1 }
  - match: { hits.hits.0._source.a_field: "quick red fox lazy brown dog" }
  - match: { hits.hits.0._source.text_field: "quick red fox lazy brown dog" }
  - match: { hits.hits.0.highlight.a_field.0: "quick <em>red</em> fox lazy brown dog" }

---
"bool prefix query unified with full term":

  - do:
      search:
        rest_total_hits_as_int: true
        index: test
        body:
          query:
            bool_prefix:
              a_field: "red fo"
          highlight:
            fields:
              a_field:
                type: unified

  - match: { hits.total: 1 }
  - match: { hits.hits.0._source.a_field: "quick red fox lazy brown dog" }
  - match: { hits.hits.0._source.text_field: "quick red fox lazy brown dog" }
  - match: { hits.hits.0.highlight.a_field.0: "quick <em>red</em> fox lazy brown dog" }
