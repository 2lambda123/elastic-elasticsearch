plugins {
    id 'elasticsearch.testclusters'
    id 'base'
}

allprojects { all ->
    repositories {
        maven {
            name "local"
            url System.getProperty("local.repo.path")
        }
    }

    if (project == rootProject || project.name == "alpha" || project.name == "bravo") {
        apply plugin: 'elasticsearch.testclusters'

        all.testClusters {
            myTestCluster {
                distribution = 'DEFAULT'
                version = System.getProperty("test.version_under_test")
                javaHome = file(System.getProperty('java.home'))
            }
        }

        task user1 {
            useCluster testClusters.myTestCluster
            doFirst {
                println "$path: Cluster running @ ${testClusters.myTestCluster.httpSocketURI}"
            }
        }
        task user2 {
            useCluster testClusters.myTestCluster
            doFirst {
                println "$path: Cluster running @ ${testClusters.myTestCluster.httpSocketURI}"
            }
        }
    }
}

testClusters {
    multiNode {
        version = System.getProperty("test.version_under_test")
        distribution = 'DEFAULT'
        javaHome = file(System.getProperty('java.home'))
        numberOfNodes = 3
    }
    releasedVersionDefault {
        version = "7.0.0"
        distribution = 'DEFAULT'
        javaHome = file(System.getProperty('java.home'))
    }
    releasedVersionOSS {
        version = "7.0.0"
        distribution = 'OSS'
        javaHome = file(System.getProperty('java.home'))
    }
    releasedVersionIntegTest {
        version = "7.0.0"
        distribution = 'INTEG_TEST'
        javaHome = file(System.getProperty('java.home'))
    }
}
