---
"Upsert into index that is allowed":
  - do:
      update:
        index:    foo
        type:     doc
        id:       1
        body:
          doc:    { text: test }
          upsert: { text: test }

  - do:
      get:
        index: foo
        type: doc
        id: 1
  - match: { _source.text: "test" }

---
"Upsert into index that is explicitly forbidden":
  - do:
      catch: /no such index and \[action.auto_create_index\] contains \[-bar\*\] which forbids automatic creation of the index/
      update:
        index:    bar
        type:     doc
        id:       1
        body:
          doc:    { text: test }
          upsert: { text: test }

---
"Upsert into index that is not mentioned":
  - do:
      catch: /no such index and \[action.auto_create_index\] \(\[foo\*,-bar\*\]\) doesn't match/
      update:
        index:    bort
        type:     doc
        id:       1
        body:
          doc:    { text: test }
          upsert: { text: test }
