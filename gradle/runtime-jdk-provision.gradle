import org.elasticsearch.gradle.OS
import org.elasticsearch.gradle.VersionProperties

apply plugin: 'elasticsearch.jdk-download'

jdks {
    provisioned_runtime {
        vendor = VersionProperties.bundledJdkVendor
        version = VersionProperties.bundledJdk
        platform = OS.current().name().toLowerCase()
    }
}

allprojects {
    project.tasks.withType(Test).configureEach { Test test ->
        test.dependsOn(rootProject.jdks.provisioned_runtime)
        test.doFirst {
            if (project.ext.isRuntimeJavaHomeSet) {
                test.executable = "${project.runtimeJavaHome}/bin/java"
            } else {
                test.executable = "${rootProject.jdks.provisioned_runtime}/bin/java"
            }
        }
    }
}