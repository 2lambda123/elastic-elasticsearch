
apply plugin: 'elasticsearch.java'

dependencies {
  compileOnly project(':server')
}

sourceSets {
  unsupportedJdkVersionEntrypoint
}

tasks.named('compileUnsupportedJdkVersionEntrypointJava').configure {
  targetCompatibility = JavaVersion.VERSION_1_7
}

tasks.named("jar") {
  manifest {
    attributes("Multi-Release": "true")
  }

  from(sourceSets.unsupportedJdkVersionEntrypoint.output)
  eachFile { details ->
    if (details.path.equals("org/elasticsearch/launcher/Launcher.class") &&
        sourceSets.main.output.asFileTree.contains(details.file)) {
      details.relativePath = details.relativePath.prepend("META-INF/versions/17")
    }
  }
}
