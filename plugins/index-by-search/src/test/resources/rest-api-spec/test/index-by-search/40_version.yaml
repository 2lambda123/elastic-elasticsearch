---
"Preserve external version if version_type=external":
  - do:
      index:
        index:        test
        type:         test
        id:           1
        version:      4
        version_type: external
        body:         { "text": "test" }
  - do:
      indices.refresh: {}

  - do:
      get:
        index: test
        type:  test
        id:    1
  - match: { _version: 4 }

  - do:
      index_by_search:
        body:
          source:
            index: test
          index:
            version_type: external  # TODO this should just preserve by default
            index: target
  - do:
      indices.refresh: {}

  - do:
      get:
        index: target
        type:  test
        id:    1
  - match: { _version: 4 }
