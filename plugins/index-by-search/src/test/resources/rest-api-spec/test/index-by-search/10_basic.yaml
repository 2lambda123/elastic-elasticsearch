---
"Response format for created":
  - do:
      index:
        index:   test
        type:    foo
        id:      1
        body:    { "text": "test" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: test
            type:  foo
          index:
            index: test
            type:  baz
  - match: {created: 1}
  - match: {updated: 0}
  - match: {version_conflicts: 0}
  - match: {batches: 1}
  - match: {failures: []}
  - is_true: took

---
"Response format for updated":
  - do:
      index:
        index:   test
        type:    foo
        id:      1
        body:    { "text": "test" }
  - do:
      index:
        index:   test
        type:    baz
        id:      1
        body:    { "text": "test" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index:   test
            type:    foo
          index:
            index:   test
            type:    baz
            version: not_set
  - match: {created: 0}
  - match: {updated: 1}
  - match: {version_conflicts: 0}
  - match: {batches: 1}
  - match: {failures: []}
  - is_true: took

---
"Response format for version conflict":
  - do:
      index:
        index:   test
        type:    foo
        id:      1
        body:    { "text": "test" }
  - do:
      index:
        index:   test
        type:    bar
        id:      1
        body:    { "text": "test" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index:        test
            type:         foo
          index:
            index:        test
            type:         bar
            version_type: external
  - match: {created: 0}
  - match: {updated: 0}
  - match: {version_conflicts: 1}
  - match: {batches: 1}
  - match: {failures: []}
  - is_true: took

---
"Response format for version conflict with abort_on_version_conflict":
  - do:
      index:
        index:   test
        type:    foo
        id:      1
        body:    { "text": "test" }
  - do:
      index:
        index:   test
        type:    bar
        id:      1
        body:    { "text": "test" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          abort_on_version_conflict: true
          source:
            index:        test
            type:         foo
          index:
            index:        test
            type:         bar
            version_type: external
  - match: {created: 0}
  - match: {updated: 0}
  - match: {version_conflicts: 1}
  - match: {batches: 1}
  - match: {failures.0.index:  test}
  - match: {failures.0.type:   bar}
  - match: {failures.0.id:     "1"}
  - match: {failures.0.status: CONFLICT}
  - match: {failures.0.cause.type:   version_conflict_engine_exception}
  - match: {failures.0.cause.reason: "[bar][1]: version conflict, current version [1] is higher or equal to the one provided [1]"}
  - match: {failures.0.cause.shard:  /\d+/}
  - match: {failures.0.cause.index:  test}
  - is_true: took

---
"Simplest example in docs":
  - do:
      index:
        index:   twitter
        type:    tweet
        id:      1
        body:    { "user": "kimchy" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: twitter
          index:
            index: new_twitter
  - do:
      indices.refresh: {}

  - do:
      search:
        index: new_twitter
  - match: { hits.total: 1 }

---
"Limit by type example in docs":
  - do:
      index:
        index:   twitter
        type:    tweet
        id:      1
        body:    { "user": "kimchy" }
  - do:
      index:
        index:   twitter
        type:    junk
        id:      1
        body:    { "user": "kimchy" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: twitter
            type:  tweet
          index:
            index: new_twitter
  - do:
      indices.refresh: {}

  - do:
      search:
        index: new_twitter
  - match: { hits.total: 1 }

---
"Limit by query example in docs":
  - do:
      index:
        index:   twitter
        type:    tweet
        id:      1
        body:    { "user": "kimchy" }
  - do:
      index:
        index:   twitter
        type:    tweet
        id:      2
        body:    { "user": "junk" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: twitter
            search:
              query:
                match:
                  user: kimchy
          index:
            index: new_twitter
  - do:
      indices.refresh: {}

  - do:
      search:
        index: new_twitter
  - match: { hits.total: 1 }

---
"Override type example in docs":
  - do:
      index:
        index:   twitter
        type:    tweet
        id:      1
        body:    { "user": "kimchy" }
  - do:
      index:
        index:   twitter
        type:    junk
        id:      1
        body:    { "user": "kimchy" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: twitter
            type:  tweet
          index:
            index: new_twitter
            type:  chirp
  - do:
      indices.refresh: {}

  - do:
      search:
        index: new_twitter
        type:  chirp
  - match: { hits.total: 1 }

---
"Multi index, multi type example from docs":
  - do:
      index:
        index:  twitter
        type:   tweet
        id:     1
        body:   { "user": "kimchy" }
  - do:
      index:
        index:  blog
        type:   post
        id:     1
        body:   { "user": "kimchy" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: [twitter, blog]
            type:  [tweet, post]
          index:
            index: all_together
  - do:
      indices.refresh: {}

  - do:
      search:
        index: all_together
        type: tweet
        body:
          query:
            match:
              user: kimchy
  - match: { hits.total: 1 }

  - do:
      search:
        index: all_together
        type: post
        body:
          query:
            match:
              user: kimchy
  - match: { hits.total: 1 }

---
"Limit by size example from docs":
  - do:
      index:
        index:  twitter
        type:   tweet
        id:     1
        body:   { "user": "kimchy" }
  - do:
      index:
        index:  twitter
        type:   tweet
        id:     2
        body:   { "user": "kimchy" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          size: 1
          source:
            index: twitter
          index:
            index: new_twitter
  - do:
      indices.refresh: {}

  - do:
      search:
        index: new_twitter
        type: tweet
  - match: { hits.total: 1 }
