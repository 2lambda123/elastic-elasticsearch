---
"Set routing on copy":
  - do:
      index:
        index:        src
        type:         test
        id:           1
        body:         { "company": "cat" }
  - do:
      index:
        index:        src
        type:         test
        id:           2
        body:         { "company": "dog" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index: src
            search:
              query:
                match:
                  company: cat
          index:
            index: dest
            routing: =cat
  - do:
      indices.refresh: {}

  - do:
      get:
        index:   dest
        type:    test
        id:      1
        routing: cat
  - match: { _routing: cat }
