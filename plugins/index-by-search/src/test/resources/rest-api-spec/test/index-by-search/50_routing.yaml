---
"Set routing on copy":
  - do:
      index:
        index:        src
        type:         test
        id:           1
        body:         { "company": "cat" }
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index:   src
          dest:
            index:   dest
            routing: =cat
  - do:
      indices.refresh: {}

  - do:
      get:
        index:   dest
        type:    test
        id:      1
        routing: cat
  - match: { _routing: cat }

---
"Discard routing on copy":
  - do:
      index:
        index:        src
        type:         test
        id:           1
        body:         { "company": "cat" }
        routing:
  - do:
      indices.refresh: {}

  - do:
      index_by_search:
        body:
          source:
            index:   src
          dest:
            index:   dest
            routing: discard
  - do:
      indices.refresh: {}

  - do:
      get:
        index:   dest
        type:    test
        id:      1
  - is_false: _routing
