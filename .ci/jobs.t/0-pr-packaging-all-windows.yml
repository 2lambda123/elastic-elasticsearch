- job:
    name: elastic+elasticsearch+pr+multijob+packaging-windows
    workspace: /var/lib/jenkins/elastic+elasticsearch+pr+multijob+packaging-windows
    display-name: "elastic / elasticsearch # PR - packaging - Windows (experimental)"
    project-type: matrix
    axes:
      - axis:
          type: label-expression
          name: os
          # Keep this in sync with 2-packaging-windows.yml
          values:
            - "windows-2012-r2"
            - "windows-2016"
            - "windows-2019"
    builders:
      - powershell: |
          java -jar "C:\Program Files\infra\bin\runbld" `
            --program powershell.exe `
            --redirect-stderr `
            --args "-NonInteractive -ExecutionPolicy ByPass -File .\.ci\os.ps1"`
    publishers:
      - postbuildscript:
          builders:
            - role: SLAVE
              build-steps:
                # We need this to override the default that uses curl
                - shell: "echo Notify H.O.M.E.R."
                - powershell: |-
                    Invoke-WebRequest `
                    -Method Post `
                    -ContentType "text/plain" `
                    -Body "$env:BUILD_URL" `
                    -Uri "https://homer.app.elstc.co/webhook/jenkins/build-finished" `
                    -ErrorAction Ignore
