import org.elasticsearch.gradle.info.BuildParams

apply plugin: 'elasticsearch.esplugin'
apply plugin: 'elasticsearch.java-rest-test'

esplugin {
  name 'op-test'
  description 'An test plugin for testing hard to get internals'
  classname 'org.elasticsearch.example.OpTestPlugin'
}

dependencies {
  compileOnly project(':x-pack:plugin:core')
  javaRestTestImplementation project(':x-pack:plugin:core')
  javaRestTestImplementation project(':client:rest-high-level')
  javaRestTestImplementation project(':x-pack:plugin:security')
  // let the javaRestTest see the classpath of main
  javaRestTestImplementation project.sourceSets.main.runtimeClasspath
}

boolean enableOperatorPrivileges = (new Random(Long.parseUnsignedLong(BuildParams.testSeed.tokenize(':').get(0), 16))).nextBoolean()

testClusters.all {
  testDistribution = 'DEFAULT'

  extraConfigFile 'operator_users.yml', file('src/javaRestTest/resources/operator_users.yml')
  extraConfigFile 'roles.yml', file('src/javaRestTest/resources/roles.yml')

  setting 'xpack.license.self_generated.type', 'trial'
  setting 'xpack.security.enabled', 'true'
  setting 'xpack.security.http.ssl.enabled', 'false'
  setting 'xpack.security.operator_privileges.enabled', enableOperatorPrivileges.toString()

  user username: "test_admin", password: 'x-pack-test-password', role: "superuser"
  user username: "test_operator", password: 'x-pack-test-password', role: "limited_operator"
}
