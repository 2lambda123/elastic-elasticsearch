[role="xpack"]
[[security-api-update-api-key]]
=== Update API key API

++++
<titleabbrev>Update API key</titleabbrev>
++++

[[security-api-update-api-key-request]]
==== {api-request-title}

`PUT /_security/api_key/<id>`

[[security-api-update-api-key-prereqs]]
==== {api-prereq-title}

* To use this API, you must have at least the `manage_own_api_key` cluster privilege.

IMPORTANT: Only the user who created an API key can update it.
// TODO Don't hardcode?
Other users, including `superuser`, cannot.
It's not possible to use an API key as the authentication credential for this API.
Doing so will result in an error.

[[security-api-update-api-key-desc]]
==== {api-description-title}

The API keys created by <<security-api-create-api-key,create API Key>> can be updated using this API.

It's not possible to update expired API keys, or API keys that have been invalidated by <<security-api-invalidate-api-key,invalidate API Key>>

[[security-api-update-api-key-path-params]]
==== {api-path-parms-title}

`id`::
(Required, string) The ID of the API key to be updated.

[[security-api-update-api-key-request-body]]
==== {api-request-body-title}

// TODO body optional

IMPORTANT: An API key's permissions are always limited by the permissions of the authenticated user creating or updating the API key.
Any call to the update API, **regardless** of whether any parameters are supplied or not, will automatically apply the authenticated user's current permissions to the API key.
This may result in a change in the API key's permissions, even when <<security-api-update-api-key-api-key-role-descriptors,`role_descriptors`>> is not specified in the update request.

The following parameters can be specified in the body of a PUT request:

[[security-api-update-api-key-api-key-role-descriptors]]
`role_descriptors`::
(Optional, array-of-role-descriptor) An array of new role descriptors for this API key.
This parameter is optional.
When it is an empty array, the API key's new permissions will be a _point in time snapshot of permissions of the authenticated user_.
If you supply role descriptors, the API key's permissions will be the intersection of the supplied permissions and the authenticated user's permissions, thereby limiting the API key's access scope.
If this parameter is not supplied, the API key's permissions will be the intersection of the API key's previously assigned permissions (if any) and the authenticated user's permissions.
The structure of role descriptor is the same as the request for create role API.
For more details, see <<security-api-put-role, create or update roles API>>.

//(Optional, array-of-role-descriptor) An array of new role descriptors for this API key.
//This parameter is optional.
//When specified, the new role descriptors replace those currently assigned to this API key.
//When it is not specified, the API key keeps the role descriptors assigned previously.
//If the assigned role descriptors are empty (either because empty role descriptors were supplied, or because they were empty and no new descriptors were supplied), the resulting permissions of the API key are the _point in time snapshot of permissions of the authenticated user_.
//If the assigned role descriptors are not empty, then the resultant permissions would be an intersection of the API key's permissions and authenticated user's permissions thereby limiting the access scope for API keys.
//The structure of role descriptor is the same as the request for create role API.
//For more details, see <<security-api-put-role, create or update roles API>>.

`metadata`::
(Optional, object) Arbitrary metadata that you want to associate with the API key.
It supports nested data structure.
Within the `metadata` object, keys beginning with `_` are reserved for system usage.
When specified, this fully replaces metadata previously associated with the API key.

[[security-api-update-api-key-response-body]]
==== {api-response-body-title}

`updated`::
(boolean) `true` if the API key was updated, `false` if the API key did not change.

[[security-api-create-api-key-example]]
==== {api-examples-title}

If you create an API key as follows:

[source,console]
------------------------------------------------------------
POST /_security/api_key
{
  "name": "my-api-key",
  "role_descriptors": {
    "role-a": {
      "cluster": ["all"],
      "index": [
        {
          "names": ["index-a*"],
          "privileges": ["read"]
        }
      ]
    }
  },
  "metadata": {
    "application": "my-application",
    "environment": {
       "level": 1,
       "trusted": true,
       "tags": ["dev", "staging"]
    }
  }
}
------------------------------------------------------------

A successful call returns a JSON structure that provides API key information.
For example:

[source,console-result]
--------------------------------------------------
{
  "id": "VuaCfGcBCdbkQm-e5aOx",
  "name": "my-api-key",
  "api_key": "ui2lp2axTNmsyakw9tvNnw",
  "encoded": "VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw=="
}
--------------------------------------------------
// TESTRESPONSE[s/VuaCfGcBCdbkQm-e5aOx/$body.id/]
// TESTRESPONSE[s/ui2lp2axTNmsyakw9tvNnw/$body.api_key/]
// TESTRESPONSE[s/VnVhQ2ZHY0JDZGJrUW0tZTVhT3g6dWkybHAyYXhUTm1zeWFrdzl0dk5udw==/$body.encoded/]

The following example updates the API key, assigning it new role descriptors and metadata:

[source,console]
----
PUT /_security/api_key/VuaCfGcBCdbkQm-e5aOx
{
  "role_descriptors": {
    "role-a": {
      "index": [
        {
          "names": ["*"],
          "privileges": ["write"]
        }
      ]
    }
  },
  "metadata": {
    "environment": {
       "level": 2,
       "trusted": true,
       "tags": ["production"]
    }
  }
}
----

A successful call returns a JSON structure indicating that the API key was updated:

[source,console-result]
----
{
  "updated": true
}
----

The following example updates the API key, applying the authenticated user's permissions to the API key:

[source,console]
----
PUT /_security/api_key/VuaCfGcBCdbkQm-e5aOx
----

Which returns the response:

[source,console-result]
----
{
  "updated": true
}
----

The following example updates the API key, replacing the API key's assigned permissions with the authenticated user's:

[source,console]
----
PUT /_security/api_key/VuaCfGcBCdbkQm-e5aOx
{
  "role_descriptors": {}
}
----

Which returns the response:

[source,console-result]
----
{
  "updated": true
}
----
