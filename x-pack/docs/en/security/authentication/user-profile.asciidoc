[role="xpack"]
[[user-profile]]
=== User profiles

beta::[]

User profiles provide persistent and stable representations of end-users.
Persistent means it exists without the need for the user to be online.
Stable means it has an unique identifier that does not change through
the lifetime of a deployment and can be used to refer to the associated
user.
Being able to uniquely refer to users is a critical function that underpins
important features like personalisation and collaboration in {kib}.

==== How user profile works

In the {stack}, a user is required to authenticate each request. Each user is
represented as an object that encapsulates its identity and privileges.
This object is ephemeral especially for users authenticating from a realm
backed by external identity providers, e.g. <<saml-realm,SAML>>.
There is simply no way to refer to a user without that user being online
at the moment.

User profiles solve the problem by creating profile documents for
authenticated users and persisting these documents in the profile
<<system-indices,system index>>. Each profile document is assigned a unique ID
which can be used to refer to the associated user.
The user profile essentially becomes the representation of the user,
even when it's not actively online.

When a user logs in to {kib}, {kib} creates a new profile or associates an
existing one for the user.
By using the unique ID of the user profile, {kib} can store user preferences
separately for each user, which is key to fine-grained level of customisation.
This unique ID also offers a way to uniquely refer to a user so that
{kib} can route messages and notifications to the appropriate user,
regardless of whether they're logged in.

===== Why a new unique ID instead of just the `username`?

The `username` is _not_ unique outside a single realm. Using just the `username`
is not possible to differentiate two users with the same `username` but from
different realms.

NOTE: For certain use cases where the same user can indeed authenticate with
different realms, consider using the <<security-domain,security domain>>
feature.

==== Create and manage user profiles

To create a new user profile or update an existing one, use the
<<security-api-activate-user-profile,activate user profile API>>. When you
submit a request, {es} attempts to locate an existing profile document for the
specified user. If one doesn't exist, {es} creates a new profile document.

In either case, the profile document captures the user's `full_name`, `email`,
`roles`, and `realms`, and also includes the profile unique ID, timestamp for
the operation, and version control numbers. You can retrieve a user profile with
the <<security-api-get-user-profile,get user profile API>> by including the
profile's unique ID (`uid`).

On top of the user's basic information, you can add data to a profile document
with the <<security-api-update-user-profile-data,update user profile API>>. For
example, you can add user-specific preferences as part of the profile data.

The <<security-api-search-user-profile>> can be used to search profiles
that match given criteria. The search API is tailor-made for {kib}'s collaboration
feature and is not intended to support every conceivable piece of user-search
functionality.

==== Limitations

* Creating a new user profile requires a user's authentication details
(`username` and `password` or its
<<token-authentication-services,OAuth2 access token>>).
This means that a user must authenticate at least one time to create a
profile document. If a user hasn't authenticated into the system,
then it's not possible to refer to that user with user profile.

* User profiles are meant for interactive users, such as a human user who
interacts with {kib}. Therefore, user profiles don't support API keys or
<<service-accounts,service accounts>>.
+
NOTE: <<token-authentication-services,OAuth2 tokens>> that represent an
interactive end-user are supported.
