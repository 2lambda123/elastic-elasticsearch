setup:
  - do:
      indices.create:
        index: test-index1
        body:
          settings:
            index:
              number_of_shards: 1
              number_of_replicas: 0

  - do:
      indices.create:
        index: test-index2
        body:
          settings:
            index:
              number_of_shards: 1
              number_of_replicas: 0

  - do:
      engine.put:
        engine_id: test-engine-1
        body:
          indices: [ "test-index1" ]
          analytics_collection_name: "test-analytics1"

  - do:
      engine.put:
        engine_id: test-engine-2
        body:
          indices: [ "test-index2" ]
          analytics_collection_name: "test-analytics2"

  - do:
      engine.put:
        engine_id: another-test-engine
        body:
          indices: [ "test-index1", "test-index2" ]
          analytics_collection_name: "test-another-analytics"

---
teardown:
  - do:
      engine.delete:
        engine_id: test-engine-1
        ignore: 404

  - do:
      engine.delete:
        engine_id: test-engine-2
        ignore: 404

  - do:
      engine.delete:
        engine_id: another-test-engine
        ignore: 404

---
"List Engines":
  - do:
      engine.list: { }

  - match: { count: 3 }

  # Alphabetical order for results
  - match: { results.0.name: "another-test-engine" }
  - match: { results.0.indices: [ "test-index1", "test-index2" ] }
  - match: { results.0..analytics_collection_name: "test-another-analytics" }
  - gte: { results.0.updated_at_millis: 0 }

  - match: { results.1.name: "test-engine-1" }
  - match: { results.1.indices: ["test-index1"] }
  - match: { results.1..analytics_collection_name: "test-analytics1" }
  - gte: { results.1.updated_at_millis: 0 }

  - match: { results.2.name: "test-engine-2" }
  - match: { results.2.indices: ["test-index2"] }
  - match: { results.2..analytics_collection_name: "test-analytics2" }
  - gte: { results.2.updated_at_millis: 0 }

---
"Pagination - From":
  - do:
      engine.list:
        from: 1

  - match: { count: 3 }

  - match: { results.0.name: "test-engine-1" }
  - match: { results.0.indices: ["test-index1"] }
  - match: { results.0..analytics_collection_name: "test-analytics1" }
  - gte: { results.0.updated_at_millis: 0 }

  - match: { results.1.name: "test-engine-2" }
  - match: { results.1.indices: ["test-index2"] }
  - match: { results.1..analytics_collection_name: "test-analytics2" }
  - gte: { results.1.updated_at_millis: 0 }

---
"Pagination - Size":
  - do:
      engine.list:
        size: 2

  - match: { count: 3 }

  - match: { results.0.name: "another-test-engine" }
  - match: { results.0.indices: [ "test-index1", "test-index2" ] }
  - match: { results.0..analytics_collection_name: "test-another-analytics" }
  - gte: { results.0.updated_at_millis: 0 }

  - match: { results.1.name: "test-engine-1" }
  - match: { results.1.indices: ["test-index1"] }
  - match: { results.1..analytics_collection_name: "test-analytics1" }
  - gte: { results.1.updated_at_millis: 0 }


---
"Query":
  - do:
      engine.list:
        q: "test-engine-*"

  - match: { count: 2 }

  - match: { results.0.name: "test-engine-1" }
  - match: { results.0.indices: ["test-index1"] }
  - match: { results.0..analytics_collection_name: "test-analytics1" }
  - gte: { results.0.updated_at_millis: 0 }

  - match: { results.1.name: "test-engine-2" }
  - match: { results.1.indices: ["test-index2"] }
  - match: { results.1..analytics_collection_name: "test-analytics2" }
  - gte: { results.1.updated_at_millis: 0 }

---
"Empty query results":
  - do:
      engine.list:
        q: "non-existing-query"

  - match: { count: 0 }
  - match: { results: [] }
