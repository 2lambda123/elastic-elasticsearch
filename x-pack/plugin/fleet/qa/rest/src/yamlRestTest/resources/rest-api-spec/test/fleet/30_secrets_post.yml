setup:
  - do:
      indices.create:
        index: .fleet-secrets
        body:
          settings:
            number_of_shards: "1"

---
teardown:
  - do:
      indices.delete:
        index: [ ".fleet-secrets-7" ]
        ignore: 404

---
"Create Fleet Secret":
  - do:
      fleet.post_secret:
        body: '{"value": "test secret"}'
  - set:  { id: id }
  - do:
      fleet.delete_secret:
        id: $id

---
"Create secret fails for unprivileged user":
  - skip:
      features: headers
  - transform_and_set:  { login_creds: "#base64EncodeCredentials(fleet_unprivileged_secrets,password)" }  
  - do:
      catch: unauthorized
      headers: { Authorization: "Basic ${login_creds}" }
      fleet.post_secret:
        body: '{"value": "test unprivileged"}'

