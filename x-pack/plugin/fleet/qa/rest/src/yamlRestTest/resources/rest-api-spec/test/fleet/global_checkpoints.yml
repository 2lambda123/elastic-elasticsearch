setup:
  - do:
      indices.create:
        index: test-1
        body:
          settings:
            number_of_shards: "2"

  - do:
      indices.create:
        index: test-2
        body:
          settings:
            number_of_shards: "1"

  - do:
      index:
        index:  test-2
        body:   { max: 2 }

  - do:
      indices.refresh: {}

---
"Get Global Checkpoints":
  - do:
      fleet.global_checkpoints:
        index: "test-1"

  - match: { global_checkpoints.0: -1 }
  - match: { global_checkpoints.1: -1 }

---
"Get Global Checkpoints after advance":
  - do:
      fleet.global_checkpoints:
        index: "test-2"

  - match: { global_checkpoints.0: 0 }

---
"Advance timeout":
  - do:
      catch: gateway_timeout
      fleet.global_checkpoints:
        index: "test-2"
        wait_for_advance: true
        current_checkpoints: [100]
        poll_timeout: "50ms"
