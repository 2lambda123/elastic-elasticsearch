setup:
  - do:
      indices.create:
        index:  test
        body:
          mappings:
            properties:
              values:
                type: counted_keyword

  - do:
      bulk:
        index: test
        refresh: true
        body: |
          { "index": {"_id" : "1"} }
          { "values": ["a", "b"] }
          { "index": {"_id" : "2"} }
          { "values": ["c", "d"] }

---
"Plain Counted Terms Aggregation":
  - do:
      search:
        index: test
        body:
          size: 0
          aggs:
            all_values:
              counted_terms:
                field: "values"

  - length: { aggregations.all_values.buckets: 4 }

---
# Use a probability of 1.0 to ensure a consistent bucket count.
"Sampled Counted Terms Aggregation":
  - do:
      search:
        index: test
        body:
          size: 0
          aggs:
            sample:
              random_sampler:
                probability: 1.0
              aggs:
                all_values:
                  counted_terms:
                    field: "values"

  - length: { aggregations.sample.all_values.buckets: 4 }

