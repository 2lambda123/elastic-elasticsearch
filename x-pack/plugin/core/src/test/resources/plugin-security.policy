// Policy for x-pack security tests

grant {
  // needed because of problems in testing with ApacheDS + Kerberos
  permission java.lang.RuntimePermission "createClassLoader";

  permission java.lang.reflect.ReflectPermission "suppressAccessChecks";
  permission java.lang.RuntimePermission "accessDeclaredMembers";
  permission java.security.SecurityPermission "insertProvider";
  permission java.lang.RuntimePermission "accessClassInPackage.sun.security.krb5";

  // needed for Kerberos login
  permission javax.security.auth.AuthPermission "modifyPrincipals";
  permission javax.security.auth.AuthPermission "modifyPrivateCredentials";
  permission javax.security.auth.PrivateCredentialPermission "* * \"*\"", "read";
  permission javax.security.auth.AuthPermission "doAs";
  permission javax.security.auth.kerberos.ServicePermission "*","initiate,accept";

  permission java.util.PropertyPermission "javax.security.auth.useSubjectCredsOnly","write";
  permission java.util.PropertyPermission "java.security.krb5.conf","write";
  permission java.util.PropertyPermission "sun.security.krb5.debug","write";
  permission java.util.PropertyPermission "java.security.debug","write";
  permission java.util.PropertyPermission "sun.security.spnego.debug","write";

};

// For minikdc server which uses apache mina
grant codebase "${codebase.mina-core}" {
  permission java.net.SocketPermission "localhost:0","accept,resolve";
};