---
version: ${xpack.apm.template.version}
template:
  mappings:
    properties:
      processor.event:
        type: constant_keyword
        value: error
      error.custom:
        type: flattened
      error.exception.attributes:
        type: flattened
      error.exception.stacktrace:
        type: flattened
      error.grouping_name:
        type: keyword
        script: |
          def logMessage = params['_source'].error?.log?.message;
          if (logMessage != null) {
            emit(logMessage);
            return;
          }
          def exception = params['_source'].error?.exception;
          if (exception != null && exception.length > 0) {
            emit(exception[0].message);
          }
