setup:
  - skip:
      version: " - 7.99.99" # TODO: make this 7.5.99 after backport
      reason: "telemetry for constant-keyword fields was added in 7.6"

---
"Usage stats for constant-keyword fields":
  - do:
      xpack.usage: {}

  - match: { constant_keyword.available: true }
  - match: { constant_keyword.enabled: true }
  - match: { constant_keyword.field_count: 0 }

  - do:
      indices.create:
        index: test-index1
        body:
          mappings:
            properties:
              quux:
                type: constant_keyword
                value: foo

  - do:
      indices.create:
        index: test-index2
        body:
          mappings:
            properties:
              foo:
                type: constant_keyword
                value: bar
              obj:
                properties:
                  bar:
                    type: constant_keyword
                    value: quux

  - do:
      xpack.usage: {}

  - match: { constant_keyword.available: true }
  - match: { constant_keyword.enabled: true }
  - match: { constant_keyword.field_count: 3 }
