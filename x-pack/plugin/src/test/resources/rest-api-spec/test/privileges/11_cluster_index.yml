---
setup:
  - skip:
      features: headers

  - do:
      cluster.health:
        wait_for_status: yellow

  - do:
      # So we can test getting cluster privileges alongside app privileges
      security.put_privileges:
        body:  >
          {
            "appX": {
              "p1": {
                "actions": [ "*" ]
              }
            }
          }

---
teardown:
  - do:
      security.delete_privileges:
        application: appX
        name: "p1"
        ignore: 404

---
"Test get cluster privileges only":
  - do:
      security.get_privileges:
        application: _cluster

  # This is fragile - it needs to be updated every time we add a new cluster privilege
  # I would much prefer we could just check that specific entries are in the array, but we don't have
  # an assertion for that
  - length: { "_cluster" : 25 }
  - is_false: "_index"
---
"Test get index privileges only":
  - do:
      security.get_privileges:
        application: _index

  # This is fragile - see above
  - length: { "_index" : 16 }
  - is_false: "_cluster"

---
"Test get all privileges":
  - do:
      security.get_privileges:
        application: ""

  # This is fragile - see above
  - length: { "_cluster" : 25 }
  - length: { "_index" : 16 }
  - match: { "appX.p1.actions" : [ "*" ] }
